<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>菜鸟童靴</title>
  
  <subtitle>个人技术博客</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2021-06-06T05:15:23.463Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>MrYang</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>bloomfilter</title>
    <link href="http://yoursite.com/2021/06/06/bloomfilter/"/>
    <id>http://yoursite.com/2021/06/06/bloomfilter/</id>
    <published>2021-06-06T05:01:39.000Z</published>
    <updated>2021-06-06T05:15:23.463Z</updated>
    
    <content type="html"><![CDATA[<p>布隆过滤器介绍</p><a id="more"></a><h2 id="什么是布隆过滤器"><a href="#什么是布隆过滤器" class="headerlink" title="什么是布隆过滤器"></a><strong>什么是布隆过滤器</strong></h2><p>本质上布隆过滤器是一种数据结构，比较巧妙的概率型数据结构（probabilistic data structure），特点是高效地插入和查询，可以用来告诉你 <strong>“某样东西一定不存在或者可能存在”</strong>。</p><p>相比于传统的 List、Set、Map 等数据结构，它更高效、占用空间更少，但是缺点是其返回的结果是概率性的，而不是确切的。</p><h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a><strong>实现原理</strong></h2><p><strong>HashMap 的问题</strong></p><p>讲述布隆过滤器的原理之前，我们先思考一下，通常你判断某个元素是否存在用的是什么？应该蛮多人回答 HashMap 吧，确实可以将值映射到 HashMap 的 Key，然后可以在 O(1) 的时间复杂度内返回结果，效率奇高。但是 HashMap 的实现也有缺点，例如存储容量占比高，考虑到负载因子的存在，通常空间是不能被用满的，而一旦你的值很多例如上亿的时候，那 HashMap 占据的内存大小就变得很可观了。</p><p>还比如说你的数据集存储在远程服务器上，本地服务接受输入，而数据集非常大不可能一次性读进内存构建 HashMap 的时候，也会存在问题。</p><p><strong>布隆过滤器数据结构</strong></p><p>布隆过滤器是一个 bit 向量或者说 bit 数组，长这样：</p><p><img src="/2021/06/06/bloomfilter/1.jpg" alt></p><p>如果我们要映射一个值到布隆过滤器中，我们需要使用<strong>多个不同的哈希函数</strong>生成<strong>多个哈希值，</strong>并对每个生成的哈希值指向的 bit 位置 1，例如针对值 “baidu” 和三个不同的哈希函数分别生成了哈希值 1、4、7，则上图转变为：</p><p><img src="/2021/06/06/bloomfilter/2.jpg" alt></p><p>Ok，我们现在再存一个值 “tencent”，如果哈希函数返回 3、4、8 的话，图继续变为：</p><p><img src="/2021/06/06/bloomfilter/3.jpg" alt></p><p>值得注意的是，4 这个 bit 位由于两个值的哈希函数都返回了这个 bit 位，因此它被覆盖了。现在我们如果想查询 “dianping” 这个值是否存在，哈希函数返回了 1、5、8三个值，结果我们发现 5 这个 bit 位上的值为 0，<strong>说明没有任何一个值映射到这个 bit 位上</strong>，因此我们可以很确定地说 “dianping” 这个值不存在。而当我们需要查询 “baidu” 这个值是否存在的话，那么哈希函数必然会返回 1、4、7，然后我们检查发现这三个 bit 位上的值均为 1，那么我们可以说 “baidu” <strong>存在了么？答案是不可以，只能是 “baidu” 这个值可能存在。</strong></p><p>这是为什么呢？答案跟简单，因为随着增加的值越来越多，被置为 1 的 bit 位也会越来越多，这样某个值 “taobao” 即使没有被存储过，但是万一哈希函数返回的三个 bit 位都被其他值置位了 1 ，那么程序还是会判断 “taobao” 这个值存在。</p><h2 id="支持删除么"><a href="#支持删除么" class="headerlink" title="支持删除么"></a>支持删除么</h2><p>感谢评论区提醒，传统的布隆过滤器并不支持删除操作。但是名为 Counting Bloom filter 的变种可以用来测试元素计数个数是否绝对小于某个阈值，它支持元素删除。可以参考文章 <a href="https://link.zhihu.com/?target=https%3A//cloud.tencent.com/developer/article/1136056">Counting Bloom Filter 的原理和实现</a></p><h2 id="如何选择哈希函数个数和布隆过滤器长度"><a href="#如何选择哈希函数个数和布隆过滤器长度" class="headerlink" title="如何选择哈希函数个数和布隆过滤器长度"></a><strong>如何选择哈希函数个数和布隆过滤器长度</strong></h2><p>很显然，过小的布隆过滤器很快所有的 bit 位均为 1，那么查询任何值都会返回“可能存在”，起不到过滤的目的了。布隆过滤器的长度会直接影响误报率，布隆过滤器越长其误报率越小。</p><p>另外，哈希函数的个数也需要权衡，个数越多则布隆过滤器 bit 位置位 1 的速度越快，且布隆过滤器的效率越低；但是如果太少的话，那我们的误报率会变高。</p><p><img src="/2021/06/06/bloomfilter/4.jpg" alt>k 为哈希函数个数，m 为布隆过滤器长度，n 为插入的元素个数，p 为误报率</p><p>如何选择适合业务的 k 和 m 值呢，这里直接贴一个公式：</p><p><img src="/2021/06/06/bloomfilter/5.png" alt></p><p>如何推导这个公式这里只是提一句，因为对于使用来说并没有太大的意义，你让一个高中生来推会推得很快。k 次哈希函数某一 bit 位未被置为 1 的概率为：</p><p><img src="/2021/06/06/bloomfilter/6.png" alt></p><p>插入n个元素后依旧为 0 的概率和为 1 的概率分别是：</p><p><img src="/2021/06/06/bloomfilter/7.png" alt></p><p>标明某个元素是否在集合中所需的 k 个位置都按照如上的方法设置为 1，但是该方法可能会使算法错误的认为某一原本不在集合中的元素却被检测为在该集合中（False Positives），该概率由以下公式确定</p><p><img src="/2021/06/06/bloomfilter/8.png" alt></p><h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a><strong>最佳实践</strong></h2><p>常见的适用常见有，利用布隆过滤器减少磁盘 IO 或者网络请求，因为一旦一个值必定不存在的话，我们可以不用进行后续昂贵的查询请求。</p><p>另外，既然你使用布隆过滤器来加速查找和判断是否存在，那么性能很低的哈希函数不是个好选择，推荐 MurmurHash、Fnv 这些。</p><p><strong>大Value拆分</strong></p><p>Redis 因其支持 setbit 和 getbit 操作，且纯内存性能高等特点，因此天然就可以作为布隆过滤器来使用。但是布隆过滤器的不当使用极易产生大 Value，增加 Redis 阻塞风险，因此生成环境中建议对体积庞大的布隆过滤器进行拆分。</p><p>拆分的形式方法多种多样，但是本质是不要将 Hash(Key) 之后的请求分散在多个节点的多个小 bitmap 上，而是应该拆分成多个小 bitmap 之后，对一个 Key 的所有哈希函数都落在这一个小 bitmap 上。</p><p><strong>参考资料：</strong></p><p><a href="https://hackernoon.com/probabilistic-data-structures-bloom-filter-5374112a7832" target="_blank" rel="noopener">https://hackernoon.com/probabilistic-data-structures-bloom-filter-5374112a7832</a></p><p><a href="https://www.jasondavies.com/bloomfilter/" target="_blank" rel="noopener">https://www.jasondavies.com/bloomfilter/</a></p><p><strong>转载</strong> ：<a href="https://zhuanlan.zhihu.com/p/43263751" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/43263751</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;布隆过滤器介绍&lt;/p&gt;
    
    </summary>
    
    
      <category term="去重，面试集锦" scheme="http://yoursite.com/categories/%E5%8E%BB%E9%87%8D%EF%BC%8C%E9%9D%A2%E8%AF%95%E9%9B%86%E9%94%A6/"/>
    
    
      <category term="去重，面试集锦" scheme="http://yoursite.com/tags/%E5%8E%BB%E9%87%8D%EF%BC%8C%E9%9D%A2%E8%AF%95%E9%9B%86%E9%94%A6/"/>
    
  </entry>
  
  <entry>
    <title>同步和异步，进程，线程和协程之间的区别和联系</title>
    <link href="http://yoursite.com/2021/06/05/%E5%90%8C%E6%AD%A5%E5%92%8C%E5%BC%82%E6%AD%A5%EF%BC%8C%E8%BF%9B%E7%A8%8B%EF%BC%8C%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%8D%8F%E7%A8%8B%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB%E5%92%8C%E8%81%94%E7%B3%BB/"/>
    <id>http://yoursite.com/2021/06/05/%E5%90%8C%E6%AD%A5%E5%92%8C%E5%BC%82%E6%AD%A5%EF%BC%8C%E8%BF%9B%E7%A8%8B%EF%BC%8C%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%8D%8F%E7%A8%8B%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB%E5%92%8C%E8%81%94%E7%B3%BB/</id>
    <published>2021-06-05T07:49:35.000Z</published>
    <updated>2021-06-06T04:12:53.419Z</updated>
    
    <content type="html"><![CDATA[<p>同步和异步，进程，线程和协程之间的区别和联系</p><a id="more"></a><h1 id="同步和异步，进程，线程和协程之间的区别和联系"><a href="#同步和异步，进程，线程和协程之间的区别和联系" class="headerlink" title="同步和异步，进程，线程和协程之间的区别和联系"></a>同步和异步，进程，线程和协程之间的区别和联系</h1><p><strong>同步和异步、阻塞和非阻塞</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">异步： 多任务， 多个任务之间执行没有先后顺序，可以同时运行，执行的先后顺序不会有什么影响，存在的多条运行主线</span><br><span class="line">同步： 多任务， 多个任务之间执行的时候要求有先后顺序，必须一个先执行完成之后，另一个才能继续执行， 只有一个主线</span><br><span class="line">阻塞：从调用者的角度出发，如果在调用的时候，被卡住，不能再继续向下运行，需要等待，就说是阻塞</span><br><span class="line">非阻塞： 从调用者的角度出发， 如果在调用的时候，没有被卡住，能够继续向下运行，无需等待，就说是非阻塞</span><br></pre></td></tr></table></figure><p><strong>1）同步、异步</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">函数或方法被调用的时候，调用者是否得到最终的结果。</span><br><span class="line"></span><br><span class="line">直接得到最终结果的结果，就是同步调用。（打饭模型，打饭不打好不走开，直到打饭给我后才离开）</span><br><span class="line">不直接得到的最终的结果，就是异步调用。（打饭，不会一直等着，会时不时的过来看看，打完了把饭拿走，异步不保证多长时间打完了饭）</span><br></pre></td></tr></table></figure><p><strong>2）阻塞、非阻塞：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">函数或方法调用的时候，是否立即返回。</span><br><span class="line"></span><br><span class="line">立即返回就是非阻塞调用。</span><br><span class="line">不立即返回就是阻塞调用。</span><br></pre></td></tr></table></figure><p><strong>3）区别：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">同步、异步，与阻塞、非阻塞不相关。</span><br><span class="line">同步、异步强调的是结果。阻塞和非阻塞强调的是时间，是否等待。</span><br><span class="line">同步与异步区别在于：调用者是否得到了想要的最终结果。</span><br><span class="line">同步就是一直要执行到返回最终结果。异步就是直接返回了，但是返回的不是最终的结果，调用者不能通过这种调用得到结果，还要通过被调用者，使用其他方式通知调用者，来取回最终结果。</span><br><span class="line">阻塞与非阻塞的区别在于，调用者是否还能干其他的事情。</span><br><span class="line">阻塞，调用者只能干等。非阻塞，调用者可以先忙一会别的，不用一直等。</span><br></pre></td></tr></table></figure><p><strong>4）联系：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">同步阻塞：调用者阻塞，直到等到拿到最终结果。（打饭模型，什么事情也不敢，就等着打饭，打饭是结果，什么也不干，一直在等着，同步加阻塞）</span><br><span class="line">同步非阻塞：（等着打饭，但是可以玩会手机，看看电视，打饭是结果，但是不用一直在等着）</span><br><span class="line">异步阻塞：（我要打饭，你说等着较好，并没有返回饭给我，我啥事不干，就干等着饭好了叫我）</span><br><span class="line">异步非阻塞：回调的话。（我要打饭，你说等较好，并没有返回饭给我，可以在旁边看看电视，玩玩手机，饭好了叫我）</span><br></pre></td></tr></table></figure><h2 id="进程、线程和协程之间的区别和联系"><a href="#进程、线程和协程之间的区别和联系" class="headerlink" title="进程、线程和协程之间的区别和联系"></a><strong>进程、线程和协程之间的区别和联系</strong></h2><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a><strong>定义</strong></h2><p>进程: 一个运行起来的程序或者软件叫做进程，进程是操作系统分配资源的 基本单位<br>线程：指进程内的一个执行单元,也是进程内的可调度实体。<br>协程：是一种程序组件，是由子例程（过程、函数、例程、方法、子程序）的概念泛化而来的，子例程只有一个入口点且只返回一次，而协程允许多个入口点，可以在指定位置挂起和恢复执行。</p><h2 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h2><p>进程是资源分配的最小单位,线程是CPU调度的最小单位.<br>进程是操作系统资源分配的单位<br>线程是CPU调度的单位<br>进程切换需要的资源最大，效率很低<br>线程切换需要的资源一般，效率一般<br>协程切换需要资源很小，效率高</p><h2 id="线程与进程的区别"><a href="#线程与进程的区别" class="headerlink" title="线程与进程的区别"></a>线程与进程的区别</h2><p>同一个进程中的线程共享同一内存空间，但是进程之间是独立的。<br>同一个进程中的所有线程的数据是共享的（进程通讯），进程之间的数据是独立的。<br>对主线程的修改可能会影响其他线程的行为，但是父进程的修改（除了删除以外）不会影响其他子进程。<br>一个进程至少有一个线程<br>同一个进程的线程之间可以直接通信，但是进程之间的交流需要借助中间代理(队列)来实现<br>创建新的线程很容易，但是创建新的进程需要对父进程做一次复制。<br>一个线程可以操作同一进程的其他线程，但是进程只能操作其子进程。<br>线程启动速度快，进程启动速度慢（但是两者运行速度没有可比性）。</p><h2 id="协程与线程的比较"><a href="#协程与线程的比较" class="headerlink" title="协程与线程的比较"></a>协程与线程的比较</h2><p>一个线程可以多个协程，一个进程也可以单独拥有多个协程，这样python中则能使用多核CPU。<br>线程进程都是同步机制，而协程则是异步<br>协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态</p><p><strong>代码demo：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consumer</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">"%s准备开始吃包子啦..."</span> % name)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        new_baozi = <span class="keyword">yield</span></span><br><span class="line">        print(<span class="string">"[%s] 正在吃包子 %s"</span> % (name,new_baozi))</span><br><span class="line">        <span class="comment">#time.sleep(1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">producer</span><span class="params">()</span>:</span></span><br><span class="line">    r = con.__next__()</span><br><span class="line">    r = con2.__next__()</span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> n &lt; <span class="number">5</span>:    <span class="comment"># 生产者只做5个包子</span></span><br><span class="line">        n += <span class="number">1</span></span><br><span class="line">        print(<span class="string">"\033[32;1m[producer]\033[0m做好了新包子 %s"</span> % n )</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        con.send(n)</span><br><span class="line">        con2.send(n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 定义2个消费者、1个生产者</span></span><br><span class="line">    con = consumer(<span class="string">"c1"</span>)</span><br><span class="line">    con2 = consumer(<span class="string">"c2"</span>)</span><br><span class="line">    p = producer()</span><br></pre></td></tr></table></figure><p>协程介绍： <a href="https://zhuanlan.zhihu.com/p/38528865" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/38528865</a> </p><p>参考链接 ： <a href="https://blog.csdn.net/DD18203614685/article/details/93226319" target="_blank" rel="noopener">https://blog.csdn.net/DD18203614685/article/details/93226319</a> </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;同步和异步，进程，线程和协程之间的区别和联系&lt;/p&gt;
    
    </summary>
    
    
      <category term="python基础知识，面试集锦" scheme="http://yoursite.com/categories/python%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%EF%BC%8C%E9%9D%A2%E8%AF%95%E9%9B%86%E9%94%A6/"/>
    
    
      <category term="python基础知识" scheme="http://yoursite.com/tags/python%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    
      <category term="面试" scheme="http://yoursite.com/tags/%E9%9D%A2%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>douyin-signature</title>
    <link href="http://yoursite.com/2021/05/28/douyin-signature/"/>
    <id>http://yoursite.com/2021/05/28/douyin-signature/</id>
    <published>2021-05-28T15:45:47.000Z</published>
    <updated>2021-05-28T15:54:10.301Z</updated>
    
    <content type="html"><![CDATA[<p>声明：本文只作学习研究，禁止用于非法用途，否则后果自负，如有侵权，请告知删除，谢谢！</p><p>练习网站平台：</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JXU1MjREJXU5NzYyJXU2NkI0JXU5NzMyJXU3Njg0JXU4RkQ4JXU0RTBEJXU2NjBFJXU2NjNFJXU0RTQ4</span><br></pre></td></tr></table></figure><p><strong>抓取目标：</strong></p><p>这次要分析的如何抓取指定用户发布的视频<br>开启分析之旅：</p><p>首先在手机上分享出，我们要抓取的用户</p><p><img src="/2021/05/28/douyin-signature/1.png" alt></p><p>看到这个页面之后，我抓一下包分析一下</p><p> <img src="/2021/05/28/douyin-signature/2.png" alt></p><p><strong>滑动刷新多抓两个包，进行比较，分析一下参数</strong></p><p><img src="/2021/05/28/douyin-signature/17.png" alt></p><p>max_cursor ：每次会根据，上一次的抓包结果里面有</p><p>_signature:每次是变化的，和今日头条那个差不多（预计）</p><p>dytk:这个值呢，插看原网页就有，如图所示</p><p> <img src="/2021/05/28/douyin-signature/3.png" alt></p><p>让我们瞧一瞧_signature这个参数,全局搜索参数</p><p><img src="/2021/05/28/douyin-signature/4.png" alt></p><p>进入到第一个js文件，我们发现</p><p><img src="/2021/05/28/douyin-signature/5.png" alt></p><p>继续向下搜索signature,我们看到生成的函数：</p><p><img src="/2021/05/28/douyin-signature/6.png" alt></p><p>打上断点分析一下</p><p><img src="/2021/05/28/douyin-signature/7.png" alt></p><p>我们发现仅仅需要传进去uid，我们就能生成_signature值，我们把js复制下下来进行分析，</p><p>这里有两种还原方式：</p><p>下面我阐述其中一种：</p><p>首先么搜索_bytedAcrawler。结果如图所示：</p><p><img src="/2021/05/28/douyin-signature/8.png" alt></p><p>我们进入这个函数：</p><p>接下来把这个函数复制出来：</p><p>!function(t) {<br>    if (t.<strong>M = t.</strong>M || {},<br>        !t.<strong>M.require) {<br>        var e, n, r = document.getElementsByTagName(“head”)[0], i = {}, o = {}, a = {}, u = {}, c = {}, s = {}, l = function(t, n) {<br>            if (!(t in u)) {<br>                u[t] = !0;<br>                var i = document.createElement(“script”);<br>                if (n) {<br>                    var o = setTimeout(n, e.timeout);<br>                    i.onerror = function() {<br>                        clearTimeout(o),<br>                            n()<br>                    }<br>                    ;<br>                    var a = function() {<br>                        clearTimeout(o)<br>                    };<br>                    “onload”in i ? i.onload = a : i.onreadystatechange = function() {<br>                        (“loaded” === this.readyState || “complete” === this.readyState) &amp;&amp; a()<br>                    }<br>                }<br>                return i.type = “text/javascript”,<br>                    i.src = t,<br>                    r.appendChild(i),<br>                    i<br>            }<br>        }, f = function(t, e, n) {<br>            var r = i[t] || (i[t] = []);<br>            r.push(e);<br>            var o, a = c[t] || c[t + “.js”] || {}, u = a.pkg;<br>            o = u ? s[u].url || s[u].uri : a.url || a.uri || t,<br>                l(o, n &amp;&amp; function() {<br>                    n(t)<br>                }<br>                )<br>        };<br>        n = function(t, e) {<br>            “function” != typeof e &amp;&amp; (e = arguments[2]),<br>                t = t.replace(/.js$/i, “”),<br>                o[t] = e;<br>            var n = i[t];<br>            if (n) {<br>                for (var r = 0, a = n.length; a &gt; r; r++)<br>                    n<a href>r</a>;<br>                delete i[t]<br>            }<br>        }<br>            ,<br>            e = function(t) {<br>                if (t &amp;&amp; t.splice)<br>                    return e.async.apply(this, arguments);<br>                t = e.alias(t);<br>                var n = a[t];<br>                if (n)<br>                    return n.exports;<br>                var r = o[t];<br>                if (!r)<br>                    throw “[ModJS] Cannot find module <code>&quot; + t + &quot;</code>“;<br>                n = a[t] = {<br>                    exports: {}<br>                };<br>                var i = “function” == typeof r ? r.apply(n, [e, n.exports, n]) : r;<br>                return i &amp;&amp; (n.exports = i),<br>                n.exports &amp;&amp; !n.exports[“default”] &amp;&amp; Object.defineProperty &amp;&amp; Object.isExtensible(n.exports) &amp;&amp; Object.defineProperty(n.exports, “default”, {<br>                    value: n.exports<br>                }),<br>                    n.exports<br>            }<br>            ,<br>            e.async = function(n, r, i) {<br>                function a(t) {<br>                    for (var n, r = 0, h = t.length; h &gt; r; r++) {<br>                        var p = e.alias(t[r]);<br>                        p in o ? (n = c[p] || c[p + “.js”],<br>                        n &amp;&amp; “deps”in n &amp;&amp; a(n.deps)) : p in s || (s[p] = !0,<br>                            l++,<br>                            f(p, u, i),<br>                            n = c[p] || c[p + “.js”],<br>                        n &amp;&amp; “deps”in n &amp;&amp; a(n.deps))<br>                    }<br>                }<br>                function u() {<br>                    if (0 === l—) {<br>                        for (var i = [], o = 0, a = n.length; a &gt; o; o++)<br>                            i[o] = e(n[o]);<br>                        r &amp;&amp; r.apply(t, i)<br>                    }<br>                }<br>                “string” == typeof n &amp;&amp; (n = [n]);<br>                var s = {}<br>                    , l = 0;<br>                a(n),<br>                    u()<br>            }<br>            ,<br>            e.resourceMap = function(t) {<br>                var e, n;<br>                n = t.res;<br>                for (e in n)<br>                    n.hasOwnProperty(e) &amp;&amp; (c[e] = n[e]);<br>                n = t.pkg;<br>                for (e in n)<br>                    n.hasOwnProperty(e) &amp;&amp; (s[e] = n[e])<br>            }<br>            ,<br>            e.loadJs = function(t) {<br>                l(t)<br>            }<br>            ,<br>            e.loadCss = function(t) {<br>                if (t.content) {<br>                    var e = document.createElement(“style”);<br>                    e.type = “text/css”,<br>                        e.styleSheet ? e.styleSheet.cssText = t.content : e.innerHTML = t.content,<br>                        r.appendChild(e)<br>                } else if (t.url) {<br>                    var n = document.createElement(“link”);<br>                    n.href = t.url,<br>                        n.rel = “stylesheet”,<br>                        n.type = “text/css”,<br>                        r.appendChild(n)<br>                }<br>            }<br>            ,<br>            e.alias = function(t) {<br>                return t.replace(/.js$/i, “”)<br>            }<br>            ,<br>            e.timeout = 5e3,<br>            t.</strong>M.define = n,<br>            t.__M.require = e<br>    }<br>}(this);</p><p><strong>M.define(“douyin_falcon:node_modules/byted-acrawler/dist/runtime”, function(l, e) {<br>    Function(function(l) {<br>        return ‘e(e,a,r){(b[e]||(b[e]=t(“x,y”,”x “+e+” y”)(r,a)}a(e,a,r){(k[r]||(k[r]=t(“x,y”,”new x<a href="&quot;+Array(r+1">y</a>.join(“,x[y]”)(1)+”)”)(e,a)}r(e,a,r){n,t,s={},b=s.d=r?r.d+1:0;for(s[“$”+b]=s,t=0;t<b;t)s[n="$"+t]=r[n];for(t=0,b=s=a;t<b;t)s[t]=a[t];c(e,0,s)}c(t,b,k){u(e){v[x]=e}f{g=,ting(bg)}l{try{y=c(t,b,k)}catch(e){h=e,y=l}}for(h,y,d,g,v=[],x=0;;)switch(g=){case 1:u(!)4:f5:u((e){a="0,r=e;{c=a<r;c&&u(e[a]),c}}(6:y=,u((y8:if(g=,lg,g=,y===c)b+=g;else" if(y!="=l)y9:c10:u(s(11:y=,u(+y)12:for(y=f,d=[],g=0;g<y;g)d[g]=y.charCodeAt(g)^g+y;u(String.fromCharCode.apply(null,d13:y=,h=delete" [y]14:59:u((g=")?(y=x,v.slice(x-=g,y:[])61:u([])62:g=,k[0]=65599*k[0]+k[1].charCodeAt(g)">&gt;&gt;065:h=,y=,[y]=h66:u(e(t[b],,67:y=,d=,u((g=).x===c?r(g.y,y,k):g.apply(d,y68:u(e((g=t[b])&lt;”&lt;”?(b—,f):g+g,,70:u(!1)71:n72:+f73:u(parseInt(f,3675:if(){bcase 74:g=&lt;<16>&gt;16g76:u(k[])77:y=,u([y])78:g=,u(a(v,x-=g+1,g79:g=,u(k[“$”+g])81:h=,[f]=h82:u([f])83:h=,k[]=h84:!085:void 086:u(v[x-1])88:h=,y=,h,y89:u({e{r(e.y,arguments,k)}e.y=f,e.x=c,e})90:null91:h93:h=0:;default:u((g&lt;<16>&gt;16)-16)}}n=this,t=n.Function,s=Object.keys||(e){a={},r=0;for(c in e)a[r]=c;a=r,a},b={},k={};r’.replace(/[-]/g, function(e) {<br>            return l[15 &amp; e.charCodeAt(0)]<br>        })<br>    }(“v[x++]=v[—x]t.charCodeAt(b++)-32function return ))++.substrvar .length(),b+=;break;case ;break}”.split(“”)))()(‘gr$Daten Иb/s!l y͒yĹg,(lfi~ah`{mv,-n|jqewVxp{rvmmx,&amp;effkx[!cs”l”.Pq%widthl”@q&amp;heightl”vr<em>getContextx$”2d[!cs#l#,</em>;?|u.|uc{uq$fontl#vr(fillTextx<script type="math/tex">龘ฑภ경2<[#c}l#2q*shadowBlurl#1q-shadowOffsetXl#</script>limeq+shadowColorl#vr#arcx88802[%c}l#vr&amp;strokex[ c}l”v,)}eOmyoZB]mx[ cs!0s$l$Pb<k7l l!r&lengthb%^l$1+s$jl s#i$1ek1s$gr#tack4)zgr#tac$! +0o![#cj?o ]!l$b%s"o ]!l"l$b*b^0d#>&gt;&gt;s!0s%yA0s”l”l!r&amp;lengthb<k+l"^l"1+s"jl s&l&z0l!$ +["cs\'(0l#i\'1ps9wxb&s() &{s) s(gr&stringr,fromcharcodes)0s*ywl ._b&s o!])l l jb<k$.aj;l .tb<k$.gj .^b<k&i"-4j!+& s+ypo!]+s!l!l hd>&l!l Bd>&+l!l <d>&+l!l 6d>&+l!l &+ s,y=o!o!]/q"13o!l q"10o!],l 2d>& s.{s-yMo!o!]0q"13o!]*Ld<l 4d#>&gt;&gt;b|s!o!l q”10o!],l!&amp; s/yIo!o!].q”13o!],o!]*Jd<l 6d#>&gt;&gt;b|&amp;o!]+l &amp;+ s0l-l!&amp;l-l!i\’1z141z4b/@d&lt;l”b|&amp;+l-l(l!b^&amp;+l-l&amp;zl\’g,)gk}ejo{cm,)|yn~Lij~em[“cl$b%@d&lt;l&amp;zl\’l $ +[“cl$b%b|&amp;+l-l%8d&lt;@b|l!b^&amp;+ q$sign ‘, [Object.defineProperty(e, “</l></l></d></k+l"^l"1+s"jl></k7l></16></16></b;t)s[n="$"+t]=r[n];for(t=0,b=s=a;t<b;t)s[t]=a[t];c(e,0,s)}c(t,b,k){u(e){v[x]=e}f{g=,ting(bg)}l{try{y=c(t,b,k)}catch(e){h=e,y=l}}for(h,y,d,g,v=[],x=0;;)switch(g=){case></strong>esModule”, {<br>        value: !0<br>    })])<br>});</p><p>var dycs = __M.require(“douyin_falcon:node_modules/byted-acrawler/dist/runtime”);</p><p>function sign(uid){<br>    return dycs.sign(uid);<br>}<br>console.log(sign(382237371544059));<br> 初步还原点代码，下面我们继续分析</p><p>接下来就是我们本片文章的重点内容：</p><p>我进入函数sign里，看看最检测有哪些：</p><p><img src="/2021/05/28/douyin-signature/9.png" alt></p><p>打上断点，调试，一顿操作猛如虎：</p><p><img src="/2021/05/28/douyin-signature/10.png" alt></p><p>首先看到的是webdriver的检测，这里是检测selenium等等webdriver的特征，这就是为啥无法用selenium获取数据的原因</p><p>我们继续调试;</p><p>然后是对location对象进行检测</p><p><img src="/2021/05/28/douyin-signature/11.png" alt></p><p><strong>环境参数_zid</strong> </p><p><img src="/2021/05/28/douyin-signature/12.png" alt></p><p>接下来是重要的环节，继续调试可以发现这个js还对canvas做了检测 </p><p><img src="/2021/05/28/douyin-signature/13.png" alt></p><p> 最后是tac的字符串，这段东西是动态生成的，需要从静态页面源码获取 </p><p><img src="/2021/05/28/douyin-signature/14.png" alt></p><p>接下来开始逐步还原js加密算法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">window = <span class="keyword">global</span>;</span><br><span class="line"> </span><br><span class="line">document = &#123;</span><br><span class="line">    _zid :<span class="number">1</span>,</span><br><span class="line">    createElement: function() &#123;</span><br><span class="line">        <span class="keyword">return</span> canvas</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">canvas = &#123;</span><br><span class="line">    getContext: function getContext() &#123;</span><br><span class="line">        <span class="keyword">return</span> CanvasRenderingContext2D</span><br><span class="line">    &#125;,</span><br><span class="line">    toDataURL: function toDataURL() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAQCAYAAABQrvyxAAACy0lEQVRIS8XWT4hVVRwH8M+bCBt9KWGaGJG5KSEN3LSoINqEbgSjP+S0KaRFELgTohRtkasg7M8ESZAGLSoCXczGTUbowk0uso0WyJDUCE6kI+/Nk9+dc+DM8b5pIBzP5t573r2/9/33+93bMX8Nquu47KS9+C2ft9y25FuP4o02QBloDbgmdzvJrMYxPF/JMo49uIZbCLSpn5+vwd4JN57CcziYQLU60KZ6GaFSkNvpQJ3HUXyIb/EC3kw3jLcpWz88rAdKsrvwWlLnPbyN84j9o4i9rFzUD/W+wRMZSBGNtmaKOhtbatzSAws5EIXb+iCsPVUAOYut+Ayv4mscKkjlfAehn5DV/THlviYQ4J9JBJdXvdHqwGIUnyM6MGKVMTc8gpOum005fRBX8QP+wkcFgZJwdqYEGQ0aKxMNkqV7meCCTRwkstrleR6rAZ2+FcZt8L7DruiZcUDPYezDNryD+ysCOUIlqZrAuwiisf/3kAHdSiCDLY85OvN/G1hmvQ88bK2ffYLfrLTJdAP6U2xJysUflWCjXoALkBlgmwOl0mW/5P2xiFPZxMPGaO3AXIEV6DpuuylHfIlzVnosEbiIr1LGSwJ/pGkSU2RiEQRqohl87ptL/zUK2+d9BGiNvqumHPWFF5vx9qu7bdYTzViCKwkEgO04s0gHwqWTSYg6SVF3/zAHhvdAgO+adR9GnPN7E4+YQhd1mukT5+XYHOZAE4GEaliEwoGP8XIayws6UH9ClOrPnd9loOdeG02bdMVex+zzPX7BlI7+kIb7P9v1OyPXejqcqR3oGDHQt8xyM82d/7rHqOuu6VrjH9950g6nbcBZOxL4Scw0g3WJ1/weGOg4out1XaxKX5+9dBy100smvOVZp5zweZN7LjUfV53mHbDkqyYw4iGvmLHbegNrTZvV96cHXPC4dSaNmbC/eUFdwOU7CT7Uugk6/uUeZMZ6UQAAAABJRU5ErkJggg=="</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">CanvasRenderingContext2D = &#123;</span><br><span class="line">    arc: function arc() &#123;&#125;,</span><br><span class="line">    stroke: function stroke() &#123;&#125;,</span><br><span class="line">    fillText: function fillText() &#123;&#125;,</span><br><span class="line">&#125;;</span><br><span class="line">window.document=document;</span><br><span class="line"> </span><br><span class="line">navigator = &#123;</span><br><span class="line">    userAgent: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36'</span>,</span><br><span class="line">    // userAgent: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36"</span>,</span><br><span class="line">&#125;;</span><br><span class="line">window.navigator = navigator;</span><br><span class="line"> </span><br><span class="line">location = &#123;</span><br><span class="line">    <span class="string">"href"</span>: <span class="string">"https://www.iesdouyin.com/share/user/102064772608"</span>,</span><br><span class="line">    <span class="string">"origin"</span>: <span class="string">"https://www.iesdouyin.com"</span>,</span><br><span class="line">    <span class="string">"protocol"</span>: <span class="string">"https:"</span></span><br><span class="line">    ,</span><br><span class="line">&#125;;</span><br><span class="line">window.location = location;</span><br></pre></td></tr></table></figure><p> 游览器对象补充完毕：</p><p>我们和并完成代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">window = <span class="keyword">global</span>;</span><br><span class="line"> </span><br><span class="line">document = &#123;</span><br><span class="line">    createElement: function() &#123;</span><br><span class="line">        <span class="keyword">return</span> canvas</span><br><span class="line">    &#125;,</span><br><span class="line">    getElementsByTagName:function () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">canvas = &#123;</span><br><span class="line">    getContext: function getContext() &#123;</span><br><span class="line">        <span class="keyword">return</span> CanvasRenderingContext2D</span><br><span class="line">    &#125;,</span><br><span class="line">    toDataURL: function toDataURL() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAQCAYAAABQrvyxAAACy0lEQVRIS8XWT4hVVRwH8M+bCBt9KWGaGJG5KSEN3LSoINqEbgSjP+S0KaRFELgTohRtkasg7M8ESZAGLSoCXczGTUbowk0uso0WyJDUCE6kI+/Nk9+dc+DM8b5pIBzP5t573r2/9/33+93bMX8Nquu47KS9+C2ft9y25FuP4o02QBloDbgmdzvJrMYxPF/JMo49uIZbCLSpn5+vwd4JN57CcziYQLU60KZ6GaFSkNvpQJ3HUXyIb/EC3kw3jLcpWz88rAdKsrvwWlLnPbyN84j9o4i9rFzUD/W+wRMZSBGNtmaKOhtbatzSAws5EIXb+iCsPVUAOYut+Ayv4mscKkjlfAehn5DV/THlviYQ4J9JBJdXvdHqwGIUnyM6MGKVMTc8gpOum005fRBX8QP+wkcFgZJwdqYEGQ0aKxMNkqV7meCCTRwkstrleR6rAZ2+FcZt8L7DruiZcUDPYezDNryD+ysCOUIlqZrAuwiisf/3kAHdSiCDLY85OvN/G1hmvQ88bK2ffYLfrLTJdAP6U2xJysUflWCjXoALkBlgmwOl0mW/5P2xiFPZxMPGaO3AXIEV6DpuuylHfIlzVnosEbiIr1LGSwJ/pGkSU2RiEQRqohl87ptL/zUK2+d9BGiNvqumHPWFF5vx9qu7bdYTzViCKwkEgO04s0gHwqWTSYg6SVF3/zAHhvdAgO+adR9GnPN7E4+YQhd1mukT5+XYHOZAE4GEaliEwoGP8XIayws6UH9ClOrPnd9loOdeG02bdMVex+zzPX7BlI7+kIb7P9v1OyPXejqcqR3oGDHQt8xyM82d/7rHqOuu6VrjH9950g6nbcBZOxL4Scw0g3WJ1/weGOg4out1XaxKX5+9dBy100smvOVZp5zweZN7LjUfV53mHbDkqyYw4iGvmLHbegNrTZvV96cHXPC4dSaNmbC/eUFdwOU7CT7Uugk6/uUeZMZ6UQAAAABJRU5ErkJggg=="</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">CanvasRenderingContext2D = &#123;</span><br><span class="line">    arc: function arc() &#123;&#125;,</span><br><span class="line">    stroke: function stroke() &#123;&#125;,</span><br><span class="line">    fillText: function fillText() &#123;&#125;,</span><br><span class="line">&#125;;</span><br><span class="line">window.document=document;</span><br><span class="line"> </span><br><span class="line">navigator = &#123;</span><br><span class="line">    userAgent: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36'</span>,</span><br><span class="line">    // userAgent: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36"</span>,</span><br><span class="line">&#125;;</span><br><span class="line">window.navigator = navigator;</span><br><span class="line"> </span><br><span class="line">location = &#123;</span><br><span class="line">    <span class="string">"href"</span>: <span class="string">"https://www.iesdouyin.com/share/user/102064772608"</span>,</span><br><span class="line">    <span class="string">"origin"</span>: <span class="string">"https://www.iesdouyin.com"</span>,</span><br><span class="line">    <span class="string">"protocol"</span>: <span class="string">"https:"</span>,</span><br><span class="line">&#125;;</span><br><span class="line">window.location = location;</span><br><span class="line">tac=<span class="string">'i)6a62m09ams!i$141qs"0y\u02a1g,&amp;qnfme|ms g,)gk&#125;ejo&#123;\x7fcms!g,&amp;Iebli\x7fms"l!,)~oih\x7fgyucmk"t (\x80,.jjvx|vDgyg&#125;knbl"d"inkfl"v,.jjvx|vDgyg&#125;knbmxl!,)~oih\x7fgyucgr&amp;Objectn vuq%valuevfq(writable[#c&#125;) %&#123;s#t ,4KJarz&#125;hrjxl@EWCOQDRB,3LKfs&#123;&#125;wsnqB&#123;iAMWBP@,;DCj&#123;&#125;DSKUAWyTK[C[XrHZ^RFZ[[,7HGn\x7fyxowiES&#125;PGWOW\\vL^BN,5JI`&#125;&#123;~iuk&#123;m\x7fRAQMURxNG,3LKsnsjpl~nB&#123;iAMWBP@,2MLpg\x7fa&#125;kEnrjl~PQGG,5JI`&#125;&#123;~iuk&#123;m\x7fTLTVDVWMM,1NMwf|`rjF\x7fm&#125;qk~TD,4KJert|tripAjNVPBTUCC,4KJpo|ksmyoAjNVPBTUCC[+s#,)Vyn`h`fe|,,olbcCt~vz|cz,6ID&#125;u\x7fuuhs@ieg|v@EHZMOY[#s$l$*%s%l%u&amp;k4s&amp;l$l&amp;ms\'l l\'mk"t j\x06l#*%s%l%u&amp;k?s&amp;l#l&amp;ms\'l ,(lfi~ah`&#123;ml\'mk"t j\ufffbl ,(lfi~ah`&#123;m*%s%l%u&amp;kls&amp;l&amp;vr%matchxgr&amp;RegExp$*\\$[a-z]dc_$ n"[!cvk:&#125;l ,(lfi~ah`&#123;ml&amp;m,&amp;efkaoTmk"t j\uffcef z[ cb|1d&lt;,%Dscafgd"in,8[xtm&#125;nLzNEGQMKAdGG^NTY\x1ckgd"inb&lt;b|1d&lt;g,&amp;TboLr&#123;m,(\x02)!jx-2n&amp;vr$testxg,%@tug&#123;mn ,%vrfkbm[!cb|'</span>;</span><br><span class="line"> </span><br><span class="line">// tac=<span class="string">'i)69f3puf9ts!i$1019s"0y\u02a1g,&amp;qnfme|ms g,)gk&#125;ejo&#123;\x7fcms!g,&amp;Iebli\x7fms"l!,)~oih\x7fgyucmk"t (\x80,.jjvx|vDgyg&#125;knbl"d"inkfl"v,.jjvx|vDgyg&#125;knbmxl!,)~oih\x7fgyucgr&amp;Objectn vuq%valuevfq(writable[#c&#125;) %&#123;s#t ,4KJarz&#125;hrjxl@EWCOQDRB,3LKfs&#123;&#125;wsnqB&#123;iAMWBP@,;DCj&#123;&#125;DSKUAWyTK[C[XrHZ^RFZ[[,7HGn\x7fyxowiES&#125;PGWOW\\vL^BN,5JI`&#125;&#123;~iuk&#123;m\x7fRAQMURxNG,3LKsnsjpl~nB&#123;iAMWBP@,2MLpg\x7fa&#125;kEnrjl~PQGG,5JI`&#125;&#123;~iuk&#123;m\x7fTLTVDVWMM,1NMwf|`rjF\x7fm&#125;qk~TD,4KJert|tripAjNVPBTUCC,4KJpo|ksmyoAjNVPBTUCC[+s#,)Vyn`h`fe|,,olbcCt~vz|cz,6ID&#125;u\x7fuuhs@ieg|v@EHZMOY[#s$l$*%s%l%u&amp;k4s&amp;l$l&amp;ms\'l l\'mk"t j\x06l#*%s%l%u&amp;k?s&amp;l#l&amp;ms\'l ,(lfi~ah`&#123;ml\'mk"t j\ufffbl ,(lfi~ah`&#123;m*%s%l%u&amp;kls&amp;l&amp;vr%matchxgr&amp;RegExp$*\\$[a-z]dc_$ n"[!cvk:&#125;l ,(lfi~ah`&#123;ml&amp;m,&amp;efkaoTmk"t j\uffcef z[ cb|1d&lt;,%Dscafgd"in,8[xtm&#125;nLzNEGQMKAdGG^NTY\x1ckgd"inb&lt;b|1d&lt;g,&amp;TboLr&#123;m,(\x02)!jx-2n&amp;vr$testxg,%@tug&#123;mn ,%vrfkbm[!cb|'</span></span><br><span class="line">!function(t) &#123;</span><br><span class="line">    <span class="keyword">if</span> (t.__M = t.__M || &#123;&#125;,</span><br><span class="line">        !t.__M.require) &#123;</span><br><span class="line">        var e, n, r = document.getElementsByTagName(<span class="string">"head"</span>)[<span class="number">0</span>], i = &#123;&#125;, o = &#123;&#125;, a = &#123;&#125;, u = &#123;&#125;, c = &#123;&#125;, s = &#123;&#125;, l = function(t, n) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!(t <span class="keyword">in</span> u)) &#123;</span><br><span class="line">                u[t] = !<span class="number">0</span>;</span><br><span class="line">                var i = document.createElement(<span class="string">"script"</span>);</span><br><span class="line">                <span class="keyword">if</span> (n) &#123;</span><br><span class="line">                    var o = setTimeout(n, e.timeout);</span><br><span class="line">                    i.onerror = function() &#123;</span><br><span class="line">                        clearTimeout(o),</span><br><span class="line">                            n()</span><br><span class="line">                    &#125;</span><br><span class="line">                    ;</span><br><span class="line">                    var a = function() &#123;</span><br><span class="line">                        clearTimeout(o)</span><br><span class="line">                    &#125;;</span><br><span class="line">                    "onload"in i ? i.onload = a : i.onreadystatechange = function() &#123;</span><br><span class="line">                        (<span class="string">"loaded"</span> === this.readyState || <span class="string">"complete"</span> === this.readyState) &amp;&amp; a()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> i.type = <span class="string">"text/javascript"</span>,</span><br><span class="line">                    i.src = t,</span><br><span class="line">                    r.appendChild(i),</span><br><span class="line">                    i</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, f = function(t, e, n) &#123;</span><br><span class="line">            var r = i[t] || (i[t] = []);</span><br><span class="line">            r.push(e);</span><br><span class="line">            var o, a = c[t] || c[t + <span class="string">".js"</span>] || &#123;&#125;, u = a.pkg;</span><br><span class="line">            o = u ? s[u].url || s[u].uri : a.url || a.uri || t,</span><br><span class="line">                l(o, n &amp;&amp; function() &#123;</span><br><span class="line">                    n(t)</span><br><span class="line">                &#125;</span><br><span class="line">                )</span><br><span class="line">        &#125;;</span><br><span class="line">        n = function(t, e) &#123;</span><br><span class="line">            <span class="string">"function"</span> != typeof e &amp;&amp; (e = arguments[<span class="number">2</span>]),</span><br><span class="line">                t = t.replace(/\.js$/i, <span class="string">""</span>),</span><br><span class="line">                o[t] = e;</span><br><span class="line">            var n = i[t];</span><br><span class="line">            <span class="keyword">if</span> (n) &#123;</span><br><span class="line">                <span class="keyword">for</span> (var r = <span class="number">0</span>, a = n.length; a &gt; r; r++)</span><br><span class="line">                    n[r]();</span><br><span class="line">                delete i[t]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">            ,</span><br><span class="line">            e = function(t) &#123;</span><br><span class="line">                <span class="keyword">if</span> (t &amp;&amp; t.splice)</span><br><span class="line">                    <span class="keyword">return</span> e.<span class="keyword">async</span>.apply(this, arguments);</span><br><span class="line">                t = e.alias(t);</span><br><span class="line">                var n = a[t];</span><br><span class="line">                <span class="keyword">if</span> (n)</span><br><span class="line">                    <span class="keyword">return</span> n.exports;</span><br><span class="line">                var r = o[t];</span><br><span class="line">                <span class="keyword">if</span> (!r)</span><br><span class="line">                    throw <span class="string">"[ModJS] Cannot find module `"</span> + t + <span class="string">"`"</span>;</span><br><span class="line">                n = a[t] = &#123;</span><br><span class="line">                    exports: &#123;&#125;</span><br><span class="line">                &#125;;</span><br><span class="line">                var i = "function" == typeof r ? r.apply(n, [e, n.exports, n]) : r;</span><br><span class="line">                <span class="keyword">return</span> i &amp;&amp; (n.exports = i),</span><br><span class="line">                n.exports &amp;&amp; !n.exports[<span class="string">"default"</span>] &amp;&amp; Object.defineProperty &amp;&amp; Object.isExtensible(n.exports) &amp;&amp; Object.defineProperty(n.exports, <span class="string">"default"</span>, &#123;</span><br><span class="line">                    value: n.exports</span><br><span class="line">                &#125;),</span><br><span class="line">                    n.exports</span><br><span class="line">            &#125;</span><br><span class="line">            ,</span><br><span class="line">            e.<span class="keyword">async</span> = function(n, r, i) &#123;</span><br><span class="line">                function a(t) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (var n, r = <span class="number">0</span>, h = t.length; h &gt; r; r++) &#123;</span><br><span class="line">                        var p = e.alias(t[r]);</span><br><span class="line">                        p in o ? (n = c[p] || c[p + ".js"],</span><br><span class="line">                        n &amp;&amp; <span class="string">"deps"</span><span class="keyword">in</span> n &amp;&amp; a(n.deps)) : p <span class="keyword">in</span> s || (s[p] = !<span class="number">0</span>,</span><br><span class="line">                            l++,</span><br><span class="line">                            f(p, u, i),</span><br><span class="line">                            n = c[p] || c[p + <span class="string">".js"</span>],</span><br><span class="line">                        n &amp;&amp; <span class="string">"deps"</span><span class="keyword">in</span> n &amp;&amp; a(n.deps))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                function u() &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="number">0</span> === l--) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (var i = [], o = <span class="number">0</span>, a = n.length; a &gt; o; o++)</span><br><span class="line">                            i[o] = e(n[o]);</span><br><span class="line">                        r &amp;&amp; r.apply(t, i)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="string">"string"</span> == typeof n &amp;&amp; (n = [n]);</span><br><span class="line">                var s = &#123;&#125;</span><br><span class="line">                    , l = <span class="number">0</span>;</span><br><span class="line">                a(n),</span><br><span class="line">                    u()</span><br><span class="line">            &#125;</span><br><span class="line">            ,</span><br><span class="line">            e.resourceMap = function(t) &#123;</span><br><span class="line">                var e, n;</span><br><span class="line">                n = t.res;</span><br><span class="line">                <span class="keyword">for</span> (e <span class="keyword">in</span> n)</span><br><span class="line">                    n.hasOwnProperty(e) &amp;&amp; (c[e] = n[e]);</span><br><span class="line">                n = t.pkg;</span><br><span class="line">                <span class="keyword">for</span> (e <span class="keyword">in</span> n)</span><br><span class="line">                    n.hasOwnProperty(e) &amp;&amp; (s[e] = n[e])</span><br><span class="line">            &#125;</span><br><span class="line">            ,</span><br><span class="line">            e.loadJs = function(t) &#123;</span><br><span class="line">                l(t)</span><br><span class="line">            &#125;</span><br><span class="line">            ,</span><br><span class="line">            e.loadCss = function(t) &#123;</span><br><span class="line">                <span class="keyword">if</span> (t.content) &#123;</span><br><span class="line">                    var e = document.createElement(<span class="string">"style"</span>);</span><br><span class="line">                    e.type = <span class="string">"text/css"</span>,</span><br><span class="line">                        e.styleSheet ? e.styleSheet.cssText = t.content : e.innerHTML = t.content,</span><br><span class="line">                        r.appendChild(e)</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (t.url) &#123;</span><br><span class="line">                    var n = document.createElement(<span class="string">"link"</span>);</span><br><span class="line">                    n.href = t.url,</span><br><span class="line">                        n.rel = <span class="string">"stylesheet"</span>,</span><br><span class="line">                        n.type = <span class="string">"text/css"</span>,</span><br><span class="line">                        r.appendChild(n)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            ,</span><br><span class="line">            e.alias = function(t) &#123;</span><br><span class="line">                <span class="keyword">return</span> t.replace(/\.js$/i, <span class="string">""</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            ,</span><br><span class="line">            e.timeout = <span class="number">5e3</span>,</span><br><span class="line">            t.__M.define = n,</span><br><span class="line">            t.__M.require = e</span><br><span class="line">    &#125;</span><br><span class="line">&#125;(window);</span><br><span class="line">__M.define(<span class="string">"douyin_falcon:node_modules/byted-acrawler/dist/runtime"</span>, function(l, e) &#123;</span><br><span class="line">    Function(function(l) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'e(e,a,r)&#123;(b[e]||(b[e]=t("x,y","x "+e+" y")(r,a)&#125;a(e,a,r)&#123;(k[r]||(k[r]=t("x,y","new x[y]("+Array(r+1).join(",x[y]")(1)+")")(e,a)&#125;r(e,a,r)&#123;n,t,s=&#123;&#125;,b=s.d=r?r.d+1:0;for(s["$"+b]=s,t=0;t&lt;b;t)s[n="$"+t]=r[n];for(t=0,b=s=a;t&lt;b;t)s[t]=a[t];c(e,0,s)&#125;c(t,b,k)&#123;u(e)&#123;v[x]=e&#125;f&#123;g=,ting(bg)&#125;l&#123;try&#123;y=c(t,b,k)&#125;catch(e)&#123;h=e,y=l&#125;&#125;for(h,y,d,g,v=[],x=0;;)switch(g=)&#123;case 1:u(!)4:f5:u((e)&#123;a=0,r=e;&#123;c=a&lt;r;c&amp;&amp;u(e[a]),c&#125;&#125;(6:y=,u((y8:if(g=,lg,g=,y===c)b+=g;else if(y!==l)y9:c10:u(s(11:y=,u(+y)12:for(y=f,d=[],g=0;g&lt;y;g)d[g]=y.charCodeAt(g)^g+y;u(String.fromCharCode.apply(null,d13:y=,h=delete [y]14:59:u((g=)?(y=x,v.slice(x-=g,y:[])61:u([])62:g=,k[0]=65599*k[0]+k[1].charCodeAt(g)&gt;&gt;&gt;065:h=,y=,[y]=h66:u(e(t[b],,67:y=,d=,u((g=).x===c?r(g.y,y,k):g.apply(d,y68:u(e((g=t[b])&lt;"&lt;"?(b--,f):g+g,,70:u(!1)71:n72:+f73:u(parseInt(f,3675:if()&#123;bcase 74:g=&lt;&lt;16&gt;&gt;16g76:u(k[])77:y=,u([y])78:g=,u(a(v,x-=g+1,g79:g=,u(k["$"+g])81:h=,[f]=h82:u([f])83:h=,k[]=h84:!085:void 086:u(v[x-1])88:h=,y=,h,y89:u(&#123;e&#123;r(e.y,arguments,k)&#125;e.y=f,e.x=c,e&#125;)90:null91:h93:h=0:;default:u((g&lt;&lt;16&gt;&gt;16)-16)&#125;&#125;n=this,t=n.Function,s=Object.keys||(e)&#123;a=&#123;&#125;,r=0;for(c in e)a[r]=c;a=r,a&#125;,b=&#123;&#125;,k=&#123;&#125;;r'</span>.replace(/[-]/g, function(e) &#123;</span><br><span class="line">            <span class="keyword">return</span> l[<span class="number">15</span> &amp; e.charCodeAt(<span class="number">0</span>)]</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;(<span class="string">"v[x++]=v[--x]t.charCodeAt(b++)-32function return ))++.substrvar .length(),b+=;break;case ;break&#125;"</span>.split(<span class="string">""</span>)))()(<span class="string">'gr$Daten Иb/s!l y͒yĹg,(lfi~ah`&#123;mv,-n|jqewVxp&#123;rvmmx,&amp;effkx[!cs"l".Pq%widthl"@q&amp;heightl"vr*getContextx$"2d[!cs#l#,*;?|u.|uc&#123;uq$fontl#vr(fillTextx$$龘ฑภ경2&lt;[#c&#125;l#2q*shadowBlurl#1q-shadowOffsetXl#$$limeq+shadowColorl#vr#arcx88802[%c&#125;l#vr&amp;strokex[ c&#125;l"v,)&#125;eOmyoZB]mx[ cs!0s$l$Pb&lt;k7l l!r&amp;lengthb%^l$1+s$jl  s#i$1ek1s$gr#tack4)zgr#tac$! +0o![#cj?o ]!l$b%s"o ]!l"l$b*b^0d#&gt;&gt;&gt;s!0s%yA0s"l"l!r&amp;lengthb&lt;k+l"^l"1+s"jl  s&amp;l&amp;z0l!$ +["cs\'(0l#i\'1ps9wxb&amp;s() &amp;&#123;s)/s(gr&amp;Stringr,fromCharCodes)0s*yWl ._b&amp;s o!])l l Jb&lt;k$.aj;l .Tb&lt;k$.gj/l .^b&lt;k&amp;i"-4j!+&amp; s+yPo!]+s!l!l Hd&gt;&amp;l!l Bd&gt;&amp;+l!l &lt;d&gt;&amp;+l!l 6d&gt;&amp;+l!l &amp;+ s,y=o!o!]/q"13o!l q"10o!],l 2d&gt;&amp; s.&#123;s-yMo!o!]0q"13o!]*Ld&lt;l 4d#&gt;&gt;&gt;b|s!o!l q"10o!],l!&amp; s/yIo!o!].q"13o!],o!]*Jd&lt;l 6d#&gt;&gt;&gt;b|&amp;o!]+l &amp;+ s0l-l!&amp;l-l!i\'1z141z4b/@d&lt;l"b|&amp;+l-l(l!b^&amp;+l-l&amp;zl\'g,)gk&#125;ejo&#123;cm,)|yn~Lij~em["cl$b%@d&lt;l&amp;zl\'l $ +["cl$b%b|&amp;+l-l%8d&lt;@b|l!b^&amp;+ q$sign '</span>, [Object.defineProperty(e, <span class="string">"__esModule"</span>, &#123;</span><br><span class="line">        value: !<span class="number">0</span></span><br><span class="line">    &#125;)])</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">var dycs = __M.require(<span class="string">"douyin_falcon:node_modules/byted-acrawler/dist/runtime"</span>);</span><br><span class="line"> </span><br><span class="line">function sign(uid)&#123;</span><br><span class="line">    <span class="keyword">return</span> dycs.sign(uid);</span><br><span class="line">&#125;</span><br><span class="line">console.log(sign(<span class="number">382237371544059</span>));</span><br></pre></td></tr></table></figure><p>到这里我们就还原成功了：</p><p><img src="/2021/05/28/douyin-signature/15.png" alt></p><p>到此我们分析结束，</p><p>请求数据时注意：</p><p>保持游览器头和js写的一致，如有疑问，搜索公众号，后台点击联系我。</p><p>微信公众号菜鸟童靴，不定期更新，欢迎关注，我们一起进步</p><p>​          <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TcElaaWE4OGljZ1RVSzJjaWI5d1U5RUdWaDRrcWVIRVVpYmtFaWE4TVdTbG40MlJEZnpnaWFJTHhiUllJR2ZxdmQzeTVWRlk0aWNkREY3dW4zRUZWSjlSaG1LT1EvNjQw?x-oss-process=image/format,png" alt="img">      </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;声明：本文只作学习研究，禁止用于非法用途，否则后果自负，如有侵权，请告知删除，谢谢！&lt;/p&gt;
&lt;p&gt;练习网站平台：&lt;/p&gt;
    
    </summary>
    
    
      <category term="python爬虫，js逆向" scheme="http://yoursite.com/categories/python%E7%88%AC%E8%99%AB%EF%BC%8Cjs%E9%80%86%E5%90%91/"/>
    
    
      <category term="爬虫" scheme="http://yoursite.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="反编译" scheme="http://yoursite.com/tags/%E5%8F%8D%E7%BC%96%E8%AF%91/"/>
    
      <category term="js逆向，刷机，root" scheme="http://yoursite.com/tags/js%E9%80%86%E5%90%91%EF%BC%8C%E5%88%B7%E6%9C%BA%EF%BC%8Croot/"/>
    
  </entry>
  
  <entry>
    <title>日常开发中，超级实用的热更新插件</title>
    <link href="http://yoursite.com/2021/02/14/%E6%97%A5%E5%B8%B8%E5%BC%80%E5%8F%91%E4%B8%AD%EF%BC%8C%E8%B6%85%E7%BA%A7%E5%AE%9E%E7%94%A8%E7%9A%84%E7%83%AD%E6%9B%B4%E6%96%B0%E6%8F%92%E4%BB%B6/"/>
    <id>http://yoursite.com/2021/02/14/%E6%97%A5%E5%B8%B8%E5%BC%80%E5%8F%91%E4%B8%AD%EF%BC%8C%E8%B6%85%E7%BA%A7%E5%AE%9E%E7%94%A8%E7%9A%84%E7%83%AD%E6%9B%B4%E6%96%B0%E6%8F%92%E4%BB%B6/</id>
    <published>2021-02-14T07:49:35.000Z</published>
    <updated>2021-05-28T15:28:30.518Z</updated>
    
    <content type="html"><![CDATA[<p><strong>前言：</strong></p><p>好久没写文章了，今天来给大家更新一篇，非常实用的文章，希望能在工作中，帮助到你们</p><a id="more"></a><p><strong>1、背景：</strong></p><p>  在程序开发过程中,每次增加新的需求，按照常规做法，你都要改项目代码，然后重新启动程序。</p><p><strong>2、痛点：</strong></p><p>  这种方式很麻烦，如何改动很小的话，很得不偿失，</p><p><strong>3、期望：</strong></p><p>  那么有没有一种方式，可以在不需要重新启动程序，就可以完成文件线上实时更新，且能被运行的程序正常读取到。</p><p><strong>4、热乎乎的干货来了</strong></p><p>  答案有的，接下来，就是今天我们要介绍的”热更新”这一功能，也可以称之为“插件系统”，所谓的“插件系统”，看起来非常高大，实际上远离非常简单，我们的主程序定期扫描特定文件夹，如果发现新增文件或者有文件发生了修改，就热加载这个文件中的代码。</p><p>本文依托，python 的 importlib.reload函数来实现此功能。</p><p>（1）首先创建一个setting.py文件，文件内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis&#x3D;&quot;你好&quot;</span><br></pre></td></tr></table></figure><p>（2）再创建一个ceshi.py文件，文件内容</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> reload_conf <span class="keyword">import</span> setting</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ceshi</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        importlib.reload(setting)</span><br><span class="line">        print(setting.redis)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">ceshi()</span><br></pre></td></tr></table></figure><p>我们在控制台运行ceshi.py文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ceshi.py</span><br></pre></td></tr></table></figure><p>我们会看到控制台源源不断的 打印出 你好，如图所示：</p><p><img src="/2021/02/14/%E6%97%A5%E5%B8%B8%E5%BC%80%E5%8F%91%E4%B8%AD%EF%BC%8C%E8%B6%85%E7%BA%A7%E5%AE%9E%E7%94%A8%E7%9A%84%E7%83%AD%E6%9B%B4%E6%96%B0%E6%8F%92%E4%BB%B6/更新插件3.png" alt></p><p>我们保持程序在运行的同时，更改setting中的文件内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis&#x3D;&quot;你好，精神小伙&quot;</span><br></pre></td></tr></table></figure><p>当我更改完之后，你就会发现控制台，输出内容变成了“你好，精神小伙”如图所示</p><p><img src="/2021/02/14/%E6%97%A5%E5%B8%B8%E5%BC%80%E5%8F%91%E4%B8%AD%EF%BC%8C%E8%B6%85%E7%BA%A7%E5%AE%9E%E7%94%A8%E7%9A%84%E7%83%AD%E6%9B%B4%E6%96%B0%E6%8F%92%E4%BB%B6/更新插件2.png" alt></p><p>这样愉快的就解决了我们问题</p><p><strong>注 意 ：</strong></p><p>1、代码中的 <strong>importlib.reload(setting)</strong> 中的<strong>setting</strong>，必须是module ，也就是setting这个文件，否则会报错**</p><p><img src="/2021/02/14/%E6%97%A5%E5%B8%B8%E5%BC%80%E5%8F%91%E4%B8%AD%EF%BC%8C%E8%B6%85%E7%BA%A7%E5%AE%9E%E7%94%A8%E7%9A%84%E7%83%AD%E6%9B%B4%E6%96%B0%E6%8F%92%E4%BB%B6/更新插件1.png" alt></p><p>2、如果你的程序是在，pycharm上运行的话，会出现更新完文件，但是没有被及时打印出，这是因为，pycharm 有个缓存，不是实时写到硬盘上的，最好在更改完文件是，ctrl + s保存下，就可以实时热加载了。</p><p>当然如果你是在cmd窗口运行，那就不需要担心了</p><p><strong>彩 蛋 </strong>：</p><p>为了更好的在实际应用中，发挥作用，我们可以把这个功能，写成装饰器，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line"><span class="keyword">from</span> reload_conf <span class="keyword">import</span> setting</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">module_reload</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kw)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            importlib.reload(setting)</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kw)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">            logger.error(err)</span><br><span class="line">            traceback.print_exc()</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@module_reload</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ceshi</span><span class="params">()</span>:</span></span><br><span class="line">    print(setting.redis)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        ceshi()</span><br></pre></td></tr></table></figure><p>本文到此结束，这样就可以基于importlib.reload，你可以写一段代码，监控某个特定的文件，一旦发现里面内容被新增、修改你就把这些变动的代码热加载一次。然后正在运行中的 Python 程序就可以不停机使用新增的功能了。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;前言：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;好久没写文章了，今天来给大家更新一篇，非常实用的文章，希望能在工作中，帮助到你们&lt;/p&gt;
    
    </summary>
    
    
      <category term="python爬虫，python技巧" scheme="http://yoursite.com/categories/python%E7%88%AC%E8%99%AB%EF%BC%8Cpython%E6%8A%80%E5%B7%A7/"/>
    
    
      <category term="python爬虫，热更新文件，技术优化" scheme="http://yoursite.com/tags/python%E7%88%AC%E8%99%AB%EF%BC%8C%E7%83%AD%E6%9B%B4%E6%96%B0%E6%96%87%E4%BB%B6%EF%BC%8C%E6%8A%80%E6%9C%AF%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>oneplus6手机刷机实战教程</title>
    <link href="http://yoursite.com/2021/01/14/oneplus6%E6%89%8B%E6%9C%BA%E5%88%B7%E6%9C%BA%E5%AE%9E%E6%88%98%E6%95%99%E7%A8%8B/"/>
    <id>http://yoursite.com/2021/01/14/oneplus6%E6%89%8B%E6%9C%BA%E5%88%B7%E6%9C%BA%E5%AE%9E%E6%88%98%E6%95%99%E7%A8%8B/</id>
    <published>2021-01-14T07:49:35.000Z</published>
    <updated>2021-05-29T02:27:34.365Z</updated>
    
    <content type="html"><![CDATA[<p>本篇文章，仅仅讲的是刷机实战和刷机的用处，对刷机的专有名词和原理不做解释，（网站文章教程很多，后期也会整合一篇笔记出来）</p><a id="more"></a><p><strong>手机刷机有什么好处？</strong><br>　　1）手机root，刷机后的大多数ROM可以自动ROOT，获得最高的管理权限，可以使用更好玩，更丰富的手机软件。<br>　　2）优化手机系统性能，由于可定制的ROM（即刷机ROM）对内存进行了优化处理，删除了一些不常用的软件，以及针对特定人群进行定制优化，因此在性能上更加卓越。<br>　　3）解决手机运行卡、慢等问题，许多朋友可能会遇到手机无缘无故的重启、卡机、无法启动、无法关机等等问题。如果其他方法不奏效，刷机是最直接的方式。<br>　　4）改变官方版本的界面，自定义自己手机界面，官方版本的版本包由于采用优化技术来重点提高了性能，因此对于界面缺乏个性化和多样化的设计，尤其是所提供的主题包有限，从而降低了用户的体验度。因此可以通过刷机来拥有更加丰富的用户界面。</p><p>​        5) 对于程序员来说，用处大大的，比如 使用frida 对app进行hook拦截等</p><p>当然有利就有弊。许多用户在刷机前也会担心会有什么后遗症，或者刷机不当造成更大的损失。<br><strong>手机刷机有什么坏处？</strong><br>　　有一些朋友可能从手机买来到一直用到抛弃的过程中都没有进行过一次手机刷机，因为可能听说一些手机刷机的坏处。<br>　　首先最重要的一点手机刷机也就是抛弃了手机厂商对手机的调整，自己定义了手机的功能，所以显而易见的大多数厂商的手机在刷机后是不再享受官方联保服务。<br>　　下载了不适合的rom里面可能包含了捆绑病毒等文件，不是任何情况下都适合刷机，比如硬件问题你的手机喇叭损坏了，你想通过刷机来解决这可能吗？<br>　　新手需要学习刷机教学，刚接触刷机不久的用户可能由于某些不规范的操作导致手机刷机后遗留各种问题，轻则手机无信号，重则可能连手机变砖，无信号等等！</p><hr><p><strong>oneplus6刷机实操教程：</strong></p><p><strong>第一步：解锁一加**</strong>6<strong> </strong>bl**</p><p> 解锁教程：<a href="https://oneplus.gadgethacks.com/how-to/unlock-bootloader-your-oneplus-6-0185473/" target="_blank" rel="noopener">https:<strong>//</strong>oneplus.gadgethacks.com<strong>/</strong>how<strong>-</strong>to<strong>/</strong>unlock<strong>-</strong>bootloader<strong>-</strong>your<strong>-</strong>oneplus<strong>-</strong>6<strong>-</strong>0185473<strong>/</strong></a></p><p>1、启用开发者选项</p><p>现在您需要启用手机上的“开发人员选项”菜单来访问一个允许您解锁引导装载程序的设置。点击设置-&gt; 关于手机，然后向下滚动到底部，快速连续点击“版本号”七次。如果操作正确，您将看到一个祝酒词，声明“您现在是一名开发人员”</p><p>2、启用 OEM 解锁</p><p>从这里，点击后退按钮一次，头回到主设置页面。向下滚动，你会发现新解锁的开发者选项菜单。选择它，然后向下滚动，并启用开关旁边的“ OEM 解锁”在下一页。点击弹出窗口上的“启用” ，如果提示输入你的手机密码。</p><p>3、启用高级重启</p><p>当你还在“开发者选项”菜单中时，向下滚动并启用“高级重新启动”设置。这将使进入 Fastboot 模式变得更加容易。</p><p>4、启动到快速启动模式</p><p>启用高级重新启动后，按住电源按钮，打开电源菜单。在第一个提示符上选择“ Reboot” ，然后在第二个提示符上选择“ Bootloader（引导加载器）”并确认您的选择。当您的电话启动进入快速启动模式，继续并连接到您的计算机与 USB 数据线，但留在主要的快速启动菜单。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">或者命令实行： adb reboot bootloader</span><br></pre></td></tr></table></figure><p>5、</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastboot oem unlock</span><br></pre></td></tr></table></figure><p>6、</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">选择 unlock the bootloader</span><br></pre></td></tr></table></figure><p>给你的手机长达15分钟的时间来完成擦除程序，然后简单地再次运行初始设置，就像你第一次打开你的手机一样。此时，您的引导加载程序已正式解锁，因此您可以开始刷新自定义固件文件了！</p><p><strong>第2步开始刷机：</strong></p><p>1、解锁完成，adb reboot bootloader 进入手机开发者模式，打开adb调试，通过以下指令刷入rec</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastboot boot twrp**-**3.2.3**-**x_blu_spark_v9.86_op6.img （输入临时twrp）</span><br></pre></td></tr></table></figure><p>2、选择语言，中文，向右滑动 允许修改， 自动重启到rec模式后,首先进行清除，直接划</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb push twrp-installer-3.3.1-2-enchilada.zip &#x2F;sdcard adb push Magisk-v20.4.zip &#x2F;sdcard</span><br></pre></td></tr></table></figure><p>3、点击安装twrp<strong>-</strong>installer，选择多个刷机包Magisk，向右滑动， 返回重启选择系统进行重启 再选择系统，重启机即可，不要直接在刷完包之后重启系统。</p><p>4、测试root是否启动成功：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell su</span><br></pre></td></tr></table></figure><p><strong>第3步如果失败了先重新刷入系统，换成官方系统，重复第一二步骤即可</strong></p><p> 刷机教程:https:<strong>//</strong>bbs.mokeedev.com<strong>/</strong>t<strong>/</strong>topic<strong>/</strong>14940 直接看最下面的刷回官方系统的教程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">（1）、电脑安装一加驱动，官方系统的一加6连接电脑，电脑会有一个 CD驱动器Oneplus drivers，双击它安装。</span><br><span class="line">（2）、把准备工作下载的 氧OS_9.0系统_一加6救砖包enchilada_22_O.27_181025.zip 解压 </span><br><span class="line">（3）、双击打开 MsmDownloadTool V4.0_factory.exe，手机完全关机后，按住音量加键 不松，插入数据线，显示已连接后松手，</span><br><span class="line">（4）点击start，等待完成，手机自动重启。</span><br><span class="line">！！！注意！！！氧os开机一路跳过，不要联网，氢os随便</span><br></pre></td></tr></table></figure><p><img src="/2021/01/14/oneplus6%E6%89%8B%E6%9C%BA%E5%88%B7%E6%9C%BA%E5%AE%9E%E6%88%98%E6%95%99%E7%A8%8B/2.png" alt></p><p>本片文章结束，文章所用资源，微信公众号后台回复oneplus6刷机，可得到。</p><p>文章首发于微信公众号菜鸟童靴，不定期更新，如有需要后台加微信</p><p><img src="https://img-blog.csdnimg.cn/20200304210850537.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JpZ0JveV9Db2Rlcg==,size_16,color_FFFFFF,t_70" alt="img"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本篇文章，仅仅讲的是刷机实战和刷机的用处，对刷机的专有名词和原理不做解释，（网站文章教程很多，后期也会整合一篇笔记出来）&lt;/p&gt;
    
    </summary>
    
    
      <category term="python爬虫，手机刷机" scheme="http://yoursite.com/categories/python%E7%88%AC%E8%99%AB%EF%BC%8C%E6%89%8B%E6%9C%BA%E5%88%B7%E6%9C%BA/"/>
    
    
      <category term="爬虫" scheme="http://yoursite.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="反编译" scheme="http://yoursite.com/tags/%E5%8F%8D%E7%BC%96%E8%AF%91/"/>
    
      <category term="js逆向，刷机，root" scheme="http://yoursite.com/tags/js%E9%80%86%E5%90%91%EF%BC%8C%E5%88%B7%E6%9C%BA%EF%BC%8Croot/"/>
    
  </entry>
  
  <entry>
    <title>如何用window命令行更改文件创建和修改时间</title>
    <link href="http://yoursite.com/2020/10/17/%E5%A6%82%E4%BD%95%E7%94%A8window%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%9B%B4%E6%94%B9%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BF%AE%E6%94%B9%E6%97%B6%E9%97%B4/"/>
    <id>http://yoursite.com/2020/10/17/%E5%A6%82%E4%BD%95%E7%94%A8window%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%9B%B4%E6%94%B9%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BF%AE%E6%94%B9%E6%97%B6%E9%97%B4/</id>
    <published>2020-10-17T07:49:35.000Z</published>
    <updated>2020-10-18T04:36:45.208Z</updated>
    
    <content type="html"><![CDATA[<p>昨天朋友突然给我发来消息，说他有个文件，文件的创建时间和修改时间，想修改一下，往前提个几天，刚开始给他推荐了几个软件，但是想想一个程序员怎么能用他人的软件呢，于是乎，安排……..</p> <a id="more"></a><h3 id="1-步骤："><a href="#1-步骤：" class="headerlink" title="1. 步骤："></a>1. 步骤：</h3><p>　　新建一个bat文件，在其中添加语句：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@ECHO OFF</span><br><span class="line">powershell.exe -command &quot;ls &#39;folder_path\*.dll&#39; | foreach-object &#123; $_.LastWriteTime &#x3D; Get-Date; $_.CreationTime &#x3D; Get-Date; $_.LastAccessTime &#x3D; Get-Date;&#125;&quot;</span><br><span class="line">PAUSE</span><br></pre></td></tr></table></figure><h3 id="2-解释："><a href="#2-解释：" class="headerlink" title="2. 解释："></a>2. 解释：</h3><p>　　代码将folder_path路径下的所有dll文件的创建时间和修改时间改成现在的时间。</p><p>　　-command: tells powershell to run the following command and return immediately</p><p>　　ls: list all matching files at the path specified</p><p>　　foreach-object: run the following block on each file that ls found</p><p>　　$_.LastWriteTime = Get-Date: for each file, set the LastWriteTime to the value returned by Get-Date (today’s date and time)</p><p>　　$_.CreationTime = Get-Date： for each file, set the CreationTime to the value returned by Get-Date (today’s date and time)</p><h3 id="3-修改至指定时间："><a href="#3-修改至指定时间：" class="headerlink" title="3. 修改至指定时间："></a>3. 修改至指定时间：</h3><p>　　将.LastWriteTime=Get−Date:改为.LastWriteTime=Get−Date:改为_.LastWriteTime = ‘01/11/2004 22:13:36’：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@ECHO OFF</span><br><span class="line">powershell.exe -command &quot;ls &#39;folder_path\*.*&#39; | foreach-object &#123; $_.LastWriteTime &#x3D; &#39;01&#x2F;11&#x2F;2004 22:13:36&#39;; $_.CreationTime &#x3D; &#39;01&#x2F;11&#x2F;2004 22:13:36&#39; &#125;&quot;</span><br><span class="line">PAUSE</span><br></pre></td></tr></table></figure><h3 id="4-递归文件夹中所有文件："><a href="#4-递归文件夹中所有文件：" class="headerlink" title="4. 递归文件夹中所有文件："></a>4. 递归文件夹中所有文件：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@ECHO OFF</span><br><span class="line">powershell.exe -command &quot;Get-Childitem -path &#39;E:\project_llj\install\test\&#39; -Recurse | foreach-object &#123; $_.LastWriteTime &#x3D; Get-Date; $_.CreationTime &#x3D; Get-Date &#125;&quot; </span><br><span class="line">PAUSE</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;昨天朋友突然给我发来消息，说他有个文件，文件的创建时间和修改时间，想修改一下，往前提个几天，刚开始给他推荐了几个软件，但是想想一个程序员怎么能用他人的软件呢，于是乎，安排……..&lt;/p&gt;
    
    </summary>
    
    
      <category term="技术杂谈" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/"/>
    
    
  </entry>
  
  <entry>
    <title>JS解析之 某json混淆阅读思路</title>
    <link href="http://yoursite.com/2020/01/04/JS%E8%A7%A3%E6%9E%90%E4%B9%8B%20%E6%9F%90json%E6%B7%B7%E6%B7%86%E9%98%85%E8%AF%BB%E6%80%9D%E8%B7%AF/"/>
    <id>http://yoursite.com/2020/01/04/JS%E8%A7%A3%E6%9E%90%E4%B9%8B%20%E6%9F%90json%E6%B7%B7%E6%B7%86%E9%98%85%E8%AF%BB%E6%80%9D%E8%B7%AF/</id>
    <published>2020-01-04T07:49:35.000Z</published>
    <updated>2020-01-04T14:05:22.235Z</updated>
    
    <content type="html"><![CDATA[<p> 目标网址：<a href="http://www.python-spider.com/" target="_blank" rel="noopener">http://www.python-spider.com</a></p><p>  采集任务：成功获取首页HTML源码</p><a id="more"></a><hr><p><strong>一、代码分析</strong></p><p>闲话少叙，让我们开搞</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">'http://www.python-spider.com'</span></span><br><span class="line">response = requests.get(url)</span><br><span class="line">html = response.content.decode()</span><br><span class="line">print(html)</span><br></pre></td></tr></table></figure><p>​    直接发请求观察返回代码（目标网站<strong>不限制</strong>请求头、IP等进行，所以无需传入headers），查看返回代码——-&gt;</p><p><img src="/2020/01/04/JS%E8%A7%A3%E6%9E%90%E4%B9%8B%20%E6%9F%90json%E6%B7%B7%E6%B7%86%E9%98%85%E8%AF%BB%E6%80%9D%E8%B7%AF/www5\Hexo\BoyYongXin\source\_posts\images\微信图片_20200104211607.png" alt="微信图片_20200104211607"></p><p>​    没有错，就是上面一坨。<strong>sojson.v5</strong> 映入眼帘，这么恶心的代码，可以说毫无可读性。自然是要先js美化走一波（如何美化请自行百度 JS美化 第一个网页即可）</p><p>美化后，代码就清晰可见了———&gt;</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">;</span><br><span class="line"><span class="keyword">var</span> encode_version = <span class="string">'sojson.v5'</span>,</span><br><span class="line">    arktk = <span class="string">'__0x67e38'</span>,</span><br><span class="line">    __0x67e38 = [<span class="string">'w7dkI2rDmcK0'</span>, <span class="string">'HsK8E8K9wpk7DCEmew=='</span>, <span class="string">'w4kwwr4qwrM='</span>, <span class="string">'w5czYMKJVkEowqg='</span>, <span class="string">'DBtxwq4='</span>, <span class="string">'wphiw6vCisKpcsOMwqTCh8OmLsKewobDg2PCgErCiRwQBwE9d8OVZcKbwpI='</span>, <span class="string">'McOXHUvDmB7ChHDCtQ=='</span>, <span class="string">'JTvCosKMwoc='</span>, <span class="string">'5Lm46IOe5YmJ6ZudO0tlw4nCsMK2ez0f'</span>, <span class="string">'w4LDnFp+Ug=='</span>, <span class="string">'UsKVwq7Co8OZw4w='</span>, <span class="string">'FXrDjsOEAFw='</span>, <span class="string">'wpvDksKeaSt8dg=='</span>, <span class="string">'woB/wrslwqNkXhY='</span>];</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">_0x15e061, _0x24d8c2</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x28d7df = <span class="function"><span class="keyword">function</span> (<span class="params">_0x3a3784</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (--_0x3a3784) &#123;</span><br><span class="line">            _0x15e061[<span class="string">'push'</span>](_0x15e061[<span class="string">'shift'</span>]());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    _0x28d7df(++_0x24d8c2);</span><br><span class="line">&#125;(__0x67e38, <span class="number">0x1c9</span>));</span><br><span class="line"><span class="keyword">var</span> _0x421e = <span class="function"><span class="keyword">function</span> (<span class="params">_0x6a3a69, _0x333514</span>) </span>&#123;</span><br><span class="line">    _0x6a3a69 = _0x6a3a69 - <span class="number">0x0</span>;</span><br><span class="line">    <span class="keyword">var</span> _0x39a8d7 = __0x67e38[_0x6a3a69];</span><br><span class="line">    <span class="keyword">if</span> (_0x421e[<span class="string">'initialized'</span>] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x22548a = <span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">'undefined'</span> ? <span class="built_in">window</span> : <span class="keyword">typeof</span> process === <span class="string">'object'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">require</span> === <span class="string">'function'</span> &amp;&amp; <span class="keyword">typeof</span> global === <span class="string">'object'</span> ? global : <span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">var</span> _0x582a25 = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='</span>;</span><br><span class="line">            _0x22548a[<span class="string">'atob'</span>] || (_0x22548a[<span class="string">'atob'</span>] = <span class="function"><span class="keyword">function</span> (<span class="params">_0x35d241</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> _0x5e5a32 = <span class="built_in">String</span>(_0x35d241)[<span class="string">'replace'</span>](<span class="regexp">/=+$/</span>, <span class="string">''</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> _0x28a5e3 = <span class="number">0x0</span>, _0x2b45a3, _0x343cbf, _0xe0f1d0 = <span class="number">0x0</span>, _0x431162 = <span class="string">''</span>; _0x343cbf = _0x5e5a32[<span class="string">'charAt'</span>](_0xe0f1d0++);~ _0x343cbf &amp;&amp; (_0x2b45a3 = _0x28a5e3 % <span class="number">0x4</span> ? _0x2b45a3 * <span class="number">0x40</span> + _0x343cbf : _0x343cbf, _0x28a5e3++ % <span class="number">0x4</span>) ? _0x431162 += <span class="built_in">String</span>[<span class="string">'fromCharCode'</span>](<span class="number">0xff</span> &amp; _0x2b45a3 &gt;&gt; (<span class="number">-0x2</span> * _0x28a5e3 &amp; <span class="number">0x6</span>)) : <span class="number">0x0</span>) &#123;</span><br><span class="line">                    _0x343cbf = _0x582a25[<span class="string">'indexOf'</span>](_0x343cbf);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> _0x431162;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;());</span><br><span class="line">        <span class="keyword">var</span> _0x5d2a8c = <span class="function"><span class="keyword">function</span> (<span class="params">_0x354c7d, _0xac1c57</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x3ef3da = [],</span><br><span class="line">                _0x1e7821 = <span class="number">0x0</span>,</span><br><span class="line">                _0x363fd2, _0x3b7037 = <span class="string">''</span>,</span><br><span class="line">                _0x3533d5 = <span class="string">''</span>;</span><br><span class="line">            _0x354c7d = atob(_0x354c7d);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0x39c851 = <span class="number">0x0</span>, _0x63560e = _0x354c7d[<span class="string">'length'</span>]; _0x39c851 &lt; _0x63560e; _0x39c851++) &#123;</span><br><span class="line">                _0x3533d5 += <span class="string">'%'</span> + (<span class="string">'00'</span> + _0x354c7d[<span class="string">'charCodeAt'</span>](_0x39c851)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'slice'</span>](<span class="number">-0x2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            _0x354c7d = <span class="built_in">decodeURIComponent</span>(_0x3533d5);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0xdb88b7 = <span class="number">0x0</span>; _0xdb88b7 &lt; <span class="number">0x100</span>; _0xdb88b7++) &#123;</span><br><span class="line">                _0x3ef3da[_0xdb88b7] = _0xdb88b7;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (_0xdb88b7 = <span class="number">0x0</span>; _0xdb88b7 &lt; <span class="number">0x100</span>; _0xdb88b7++) &#123;</span><br><span class="line">                _0x1e7821 = (_0x1e7821 + _0x3ef3da[_0xdb88b7] + _0xac1c57[<span class="string">'charCodeAt'</span>](_0xdb88b7 % _0xac1c57[<span class="string">'length'</span>])) % <span class="number">0x100</span>;</span><br><span class="line">                _0x363fd2 = _0x3ef3da[_0xdb88b7];</span><br><span class="line">                _0x3ef3da[_0xdb88b7] = _0x3ef3da[_0x1e7821];</span><br><span class="line">                _0x3ef3da[_0x1e7821] = _0x363fd2;</span><br><span class="line">            &#125;</span><br><span class="line">            _0xdb88b7 = <span class="number">0x0</span>;</span><br><span class="line">            _0x1e7821 = <span class="number">0x0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0x3cdf31 = <span class="number">0x0</span>; _0x3cdf31 &lt; _0x354c7d[<span class="string">'length'</span>]; _0x3cdf31++) &#123;</span><br><span class="line">                _0xdb88b7 = (_0xdb88b7 + <span class="number">0x1</span>) % <span class="number">0x100</span>;</span><br><span class="line">                _0x1e7821 = (_0x1e7821 + _0x3ef3da[_0xdb88b7]) % <span class="number">0x100</span>;</span><br><span class="line">                _0x363fd2 = _0x3ef3da[_0xdb88b7];</span><br><span class="line">                _0x3ef3da[_0xdb88b7] = _0x3ef3da[_0x1e7821];</span><br><span class="line">                _0x3ef3da[_0x1e7821] = _0x363fd2;</span><br><span class="line">                _0x3b7037 += <span class="built_in">String</span>[<span class="string">'fromCharCode'</span>](_0x354c7d[<span class="string">'charCodeAt'</span>](_0x3cdf31) ^ _0x3ef3da[(_0x3ef3da[_0xdb88b7] + _0x3ef3da[_0x1e7821]) % <span class="number">0x100</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> _0x3b7037;</span><br><span class="line">        &#125;;</span><br><span class="line">        _0x421e[<span class="string">'rc4'</span>] = _0x5d2a8c;</span><br><span class="line">        _0x421e[<span class="string">'data'</span>] = &#123;&#125;;</span><br><span class="line">        _0x421e[<span class="string">'initialized'</span>] = !![];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> _0x548bc2 = _0x421e[<span class="string">'data'</span>][_0x6a3a69];</span><br><span class="line">    <span class="keyword">if</span> (_0x548bc2 === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (_0x421e[<span class="string">'once'</span>] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            _0x421e[<span class="string">'once'</span>] = !![];</span><br><span class="line">        &#125;</span><br><span class="line">        _0x39a8d7 = _0x421e[<span class="string">'rc4'</span>](_0x39a8d7, _0x333514);</span><br><span class="line">        _0x421e[<span class="string">'data'</span>][_0x6a3a69] = _0x39a8d7;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        _0x39a8d7 = _0x548bc2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _0x39a8d7;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> timestamp = <span class="keyword">new</span> <span class="built_in">Date</span>()[<span class="string">'valueOf'</span>]();</span><br><span class="line"><span class="keyword">var</span> token = <span class="built_in">window</span>[<span class="string">'btoa'</span>](<span class="string">'aiding_win'</span> + <span class="built_in">String</span>(<span class="built_in">Math</span>[_0x421e(<span class="string">'0x0'</span>, <span class="string">'OoTU'</span>)](timestamp / <span class="number">0xf4240</span>)));</span><br><span class="line"><span class="built_in">document</span>[_0x421e(<span class="string">'0x1'</span>, <span class="string">'l[QL'</span>)] = _0x421e(<span class="string">'0x2'</span>, <span class="string">'75NN'</span>) + token[_0x421e(<span class="string">'0x3'</span>, <span class="string">'xR0U'</span>)](<span class="string">'='</span>, <span class="string">''</span>) + <span class="string">'sp'</span> + token + _0x421e(<span class="string">'0x4'</span>, <span class="string">'vC8m'</span>);</span><br><span class="line"><span class="built_in">document</span>[_0x421e(<span class="string">'0x5'</span>, <span class="string">'n%hx'</span>)] = _0x421e(<span class="string">'0x6'</span>, <span class="string">'rDxU'</span>) + <span class="built_in">String</span>(<span class="built_in">Math</span>[_0x421e(<span class="string">'0x7'</span>, <span class="string">'vC8m'</span>)](timestamp / <span class="number">0xf4240</span>)) + _0x421e(<span class="string">'0x8'</span>, <span class="string">'3B5*'</span>);</span><br><span class="line"><span class="keyword">let</span> nh = <span class="built_in">window</span>[<span class="string">'location'</span>][_0x421e(<span class="string">'0x9'</span>, <span class="string">'L64&amp;'</span>)];</span><br><span class="line"><span class="keyword">let</span> href = nh[<span class="string">'split'</span>](<span class="string">'/'</span>);</span><br><span class="line"><span class="keyword">if</span> (href[<span class="string">'length'</span>] &gt;= <span class="number">0x3</span>) &#123;</span><br><span class="line">    setTimeout(<span class="string">'javascript:location.href=nh'</span>, <span class="number">0x1f4</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    setTimeout(_0x421e(<span class="string">'0xa'</span>, <span class="string">'&amp;#k4'</span>), <span class="number">0x1f4</span>);</span><br><span class="line">&#125;; <span class="keyword">if</span> (!(<span class="keyword">typeof</span> encode_version !== <span class="string">'undefined'</span> &amp;&amp; encode_version === _0x421e(<span class="string">'0xb'</span>, <span class="string">'5Khz'</span>))) &#123;</span><br><span class="line">    <span class="built_in">window</span>[_0x421e(<span class="string">'0xc'</span>, <span class="string">'*#To'</span>)](_0x421e(<span class="string">'0xd'</span>, <span class="string">'2e!l'</span>));</span><br><span class="line">&#125;;</span><br><span class="line">encode_version = <span class="string">'sojson.v5'</span>;</span><br></pre></td></tr></table></figure><hr><p>​    当看到这美化后的一坨代码的时候，我相信大家大家还是一脸懵逼。不过不要紧，让我们逐个分析</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> encode_version = <span class="string">'sojson.v5'</span>,</span><br><span class="line">    arktk = <span class="string">'__0x67e38'</span>,</span><br><span class="line">    __0x67e38 = [<span class="string">'w7dkI2rDmcK0'</span>, <span class="string">'HsK8E8K9wpk7DCEmew=='</span>, <span class="string">'w4kwwr4qwrM='</span>, <span class="string">'w5czYMKJVkEowqg='</span>, <span class="string">'DBtxwq4='</span>, <span class="string">'wphiw6vCisKpcsOMwqTCh8OmLsKewobDg2PCgErCiRwQBwE9d8OVZcKbwpI='</span>, <span class="string">'McOXHUvDmB7ChHDCtQ=='</span>, <span class="string">'JTvCosKMwoc='</span>, <span class="string">'5Lm46IOe5YmJ6ZudO0tlw4nCsMK2ez0f'</span>, <span class="string">'w4LDnFp+Ug=='</span>, <span class="string">'UsKVwq7Co8OZw4w='</span>, <span class="string">'FXrDjsOEAFw='</span>, <span class="string">'wpvDksKeaSt8dg=='</span>, <span class="string">'woB/wrslwqNkXhY='</span>];</span><br></pre></td></tr></table></figure><p>​    首先，声明了3个变量。暂时先放这就行了。</p><p>​    继续向下看，我们就会看到了一个匿名函数 —-&gt; </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">_0x15e061, _0x24d8c2</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x28d7df = <span class="function"><span class="keyword">function</span> (<span class="params">_0x3a3784</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (--_0x3a3784) &#123;</span><br><span class="line">            _0x15e061[<span class="string">'push'</span>](_0x15e061[<span class="string">'shift'</span>]());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    _0x28d7df(++_0x24d8c2);</span><br><span class="line">&#125;(__0x67e38, <span class="number">0x1c9</span>));</span><br></pre></td></tr></table></figure><p>​    这个功能不难看出，是一个数组移位函数。我们继续向下看，就会看到一个很长很长的函数</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _0x421e = <span class="function"><span class="keyword">function</span> (<span class="params">_0x6a3a69, _0x333514</span>) </span>&#123;</span><br><span class="line">    _0x6a3a69 = _0x6a3a69 - <span class="number">0x0</span>;</span><br><span class="line">    <span class="keyword">var</span> _0x39a8d7 = __0x67e38[_0x6a3a69];</span><br><span class="line">    <span class="keyword">if</span> (_0x421e[<span class="string">'initialized'</span>] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x22548a = <span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">'undefined'</span> ? <span class="built_in">window</span> : <span class="keyword">typeof</span> process === <span class="string">'object'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">require</span> === <span class="string">'function'</span> &amp;&amp; <span class="keyword">typeof</span> global === <span class="string">'object'</span> ? global : <span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">var</span> _0x582a25 = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='</span>;</span><br><span class="line">            _0x22548a[<span class="string">'atob'</span>] || (_0x22548a[<span class="string">'atob'</span>] = <span class="function"><span class="keyword">function</span> (<span class="params">_0x35d241</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> _0x5e5a32 = <span class="built_in">String</span>(_0x35d241)[<span class="string">'replace'</span>](<span class="regexp">/=+$/</span>, <span class="string">''</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> _0x28a5e3 = <span class="number">0x0</span>, _0x2b45a3, _0x343cbf, _0xe0f1d0 = <span class="number">0x0</span>, _0x431162 = <span class="string">''</span>; _0x343cbf = _0x5e5a32[<span class="string">'charAt'</span>](_0xe0f1d0++);~ _0x343cbf &amp;&amp; (_0x2b45a3 = _0x28a5e3 % <span class="number">0x4</span> ? _0x2b45a3 * <span class="number">0x40</span> + _0x343cbf : _0x343cbf, _0x28a5e3++ % <span class="number">0x4</span>) ? _0x431162 += <span class="built_in">String</span>[<span class="string">'fromCharCode'</span>](<span class="number">0xff</span> &amp; _0x2b45a3 &gt;&gt; (<span class="number">-0x2</span> * _0x28a5e3 &amp; <span class="number">0x6</span>)) : <span class="number">0x0</span>) &#123;</span><br><span class="line">                    _0x343cbf = _0x582a25[<span class="string">'indexOf'</span>](_0x343cbf);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> _0x431162;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;());</span><br><span class="line">        <span class="keyword">var</span> _0x5d2a8c = <span class="function"><span class="keyword">function</span> (<span class="params">_0x354c7d, _0xac1c57</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x3ef3da = [],</span><br><span class="line">                _0x1e7821 = <span class="number">0x0</span>,</span><br><span class="line">                _0x363fd2, _0x3b7037 = <span class="string">''</span>,</span><br><span class="line">                _0x3533d5 = <span class="string">''</span>;</span><br><span class="line">            _0x354c7d = atob(_0x354c7d);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0x39c851 = <span class="number">0x0</span>, _0x63560e = _0x354c7d[<span class="string">'length'</span>]; _0x39c851 &lt; _0x63560e; _0x39c851++) &#123;</span><br><span class="line">                _0x3533d5 += <span class="string">'%'</span> + (<span class="string">'00'</span> + _0x354c7d[<span class="string">'charCodeAt'</span>](_0x39c851)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'slice'</span>](<span class="number">-0x2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            _0x354c7d = <span class="built_in">decodeURIComponent</span>(_0x3533d5);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0xdb88b7 = <span class="number">0x0</span>; _0xdb88b7 &lt; <span class="number">0x100</span>; _0xdb88b7++) &#123;</span><br><span class="line">                _0x3ef3da[_0xdb88b7] = _0xdb88b7;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (_0xdb88b7 = <span class="number">0x0</span>; _0xdb88b7 &lt; <span class="number">0x100</span>; _0xdb88b7++) &#123;</span><br><span class="line">                _0x1e7821 = (_0x1e7821 + _0x3ef3da[_0xdb88b7] + _0xac1c57[<span class="string">'charCodeAt'</span>](_0xdb88b7 % _0xac1c57[<span class="string">'length'</span>])) % <span class="number">0x100</span>;</span><br><span class="line">                _0x363fd2 = _0x3ef3da[_0xdb88b7];</span><br><span class="line">                _0x3ef3da[_0xdb88b7] = _0x3ef3da[_0x1e7821];</span><br><span class="line">                _0x3ef3da[_0x1e7821] = _0x363fd2;</span><br><span class="line">            &#125;</span><br><span class="line">            _0xdb88b7 = <span class="number">0x0</span>;</span><br><span class="line">            _0x1e7821 = <span class="number">0x0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0x3cdf31 = <span class="number">0x0</span>; _0x3cdf31 &lt; _0x354c7d[<span class="string">'length'</span>]; _0x3cdf31++) &#123;</span><br><span class="line">                _0xdb88b7 = (_0xdb88b7 + <span class="number">0x1</span>) % <span class="number">0x100</span>;</span><br><span class="line">                _0x1e7821 = (_0x1e7821 + _0x3ef3da[_0xdb88b7]) % <span class="number">0x100</span>;</span><br><span class="line">                _0x363fd2 = _0x3ef3da[_0xdb88b7];</span><br><span class="line">                _0x3ef3da[_0xdb88b7] = _0x3ef3da[_0x1e7821];</span><br><span class="line">                _0x3ef3da[_0x1e7821] = _0x363fd2;</span><br><span class="line">                _0x3b7037 += <span class="built_in">String</span>[<span class="string">'fromCharCode'</span>](_0x354c7d[<span class="string">'charCodeAt'</span>](_0x3cdf31) ^ _0x3ef3da[(_0x3ef3da[_0xdb88b7] + _0x3ef3da[_0x1e7821]) % <span class="number">0x100</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> _0x3b7037;</span><br><span class="line">        &#125;;</span><br><span class="line">        _0x421e[<span class="string">'rc4'</span>] = _0x5d2a8c;</span><br><span class="line">        _0x421e[<span class="string">'data'</span>] = &#123;&#125;;</span><br><span class="line">        _0x421e[<span class="string">'initialized'</span>] = !![];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> _0x548bc2 = _0x421e[<span class="string">'data'</span>][_0x6a3a69];</span><br><span class="line">    <span class="keyword">if</span> (_0x548bc2 === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (_0x421e[<span class="string">'once'</span>] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            _0x421e[<span class="string">'once'</span>] = !![];</span><br><span class="line">        &#125;</span><br><span class="line">        _0x39a8d7 = _0x421e[<span class="string">'rc4'</span>](_0x39a8d7, _0x333514);</span><br><span class="line">        _0x421e[<span class="string">'data'</span>][_0x6a3a69] = _0x39a8d7;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        _0x39a8d7 = _0x548bc2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _0x39a8d7;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>​    这个函数比较复杂，乍一看看不出什么端倪，只能分析出这是一个函数（包含两个形参），并且有一个返回值，我们继续向下阅读剩余代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> timestamp = <span class="keyword">new</span> <span class="built_in">Date</span>()[<span class="string">'valueOf'</span>]();</span><br><span class="line"><span class="keyword">var</span> token = <span class="built_in">window</span>[<span class="string">'btoa'</span>](<span class="string">'aiding_win'</span> + <span class="built_in">String</span>(<span class="built_in">Math</span>[_0x421e(<span class="string">'0x0'</span>, <span class="string">'OoTU'</span>)](timestamp / <span class="number">0xf4240</span>)));</span><br><span class="line"><span class="built_in">document</span>[_0x421e(<span class="string">'0x1'</span>, <span class="string">'l[QL'</span>)] = _0x421e(<span class="string">'0x2'</span>, <span class="string">'75NN'</span>) + token[_0x421e(<span class="string">'0x3'</span>, <span class="string">'xR0U'</span>)](<span class="string">'='</span>, <span class="string">''</span>) + <span class="string">'sp'</span> + token + _0x421e(<span class="string">'0x4'</span>, <span class="string">'vC8m'</span>);</span><br><span class="line"><span class="built_in">document</span>[_0x421e(<span class="string">'0x5'</span>, <span class="string">'n%hx'</span>)] = _0x421e(<span class="string">'0x6'</span>, <span class="string">'rDxU'</span>) + <span class="built_in">String</span>(<span class="built_in">Math</span>[_0x421e(<span class="string">'0x7'</span>, <span class="string">'vC8m'</span>)](timestamp / <span class="number">0xf4240</span>)) + _0x421e(<span class="string">'0x8'</span>, <span class="string">'3B5*'</span>);</span><br><span class="line"><span class="keyword">let</span> nh = <span class="built_in">window</span>[<span class="string">'location'</span>][_0x421e(<span class="string">'0x9'</span>, <span class="string">'L64&amp;'</span>)];</span><br><span class="line"><span class="keyword">let</span> href = nh[<span class="string">'split'</span>](<span class="string">'/'</span>);</span><br><span class="line"><span class="keyword">if</span> (href[<span class="string">'length'</span>] &gt;= <span class="number">0x3</span>) &#123;</span><br><span class="line">    setTimeout(<span class="string">'javascript:location.href=nh'</span>, <span class="number">0x1f4</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    setTimeout(_0x421e(<span class="string">'0xa'</span>, <span class="string">'&amp;#k4'</span>), <span class="number">0x1f4</span>);</span><br><span class="line">&#125;; <span class="keyword">if</span> (!(<span class="keyword">typeof</span> encode_version !== <span class="string">'undefined'</span> &amp;&amp; encode_version === _0x421e(<span class="string">'0xb'</span>, <span class="string">'5Khz'</span>))) &#123;</span><br><span class="line">    <span class="built_in">window</span>[_0x421e(<span class="string">'0xc'</span>, <span class="string">'*#To'</span>)](_0x421e(<span class="string">'0xd'</span>, <span class="string">'2e!l'</span>));</span><br><span class="line">&#125;;</span><br><span class="line">encode_version = <span class="string">'sojson.v5'</span>;</span><br></pre></td></tr></table></figure><p>可以看出，这最后一部分的代码就很零散，隐隐约约的能看出一些关键字。但是想要理解代码含义还是有一定难度，最初笔者也卡住了很久，直到最后。。。我做了自己的网站，才看出这最后部分的端倪，我先上一段代码——&gt;</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> timestamp = (<span class="keyword">new</span> <span class="built_in">Date</span>()).valueOf();</span><br><span class="line"><span class="keyword">var</span> token=<span class="built_in">window</span>.btoa(<span class="string">'aiding_win'</span> + <span class="built_in">String</span>(<span class="built_in">Math</span>.round(timestamp/<span class="number">1000000</span>)));</span><br><span class="line"><span class="built_in">document</span>.cookie=<span class="string">'token='</span> + token.replace(<span class="string">'='</span>, <span class="string">''</span>) + <span class="string">'sp'</span> + token+ <span class="string">'; path=/'</span> ;</span><br><span class="line"><span class="built_in">document</span>.cookie=<span class="string">'tokentime='</span> + <span class="built_in">String</span>(<span class="built_in">Math</span>.round(timestamp/<span class="number">1000000</span>))+ <span class="string">'; path=/'</span> ;</span><br><span class="line"><span class="keyword">let</span> nh = <span class="built_in">window</span>.location.href;</span><br><span class="line"><span class="keyword">let</span> href = nh.split(<span class="string">'/'</span>);</span><br><span class="line"><span class="keyword">if</span> (href.length &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">    setTimeout(<span class="string">"javascript:location.href=nh"</span>, <span class="number">500</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    setTimeout(<span class="string">"javascript:location.href='/'"</span>, <span class="number">500</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​    上面的代码其实是我原始的cookie生成js代码。是不是发现了什么端倪？ 没错，最后一部分明显就是原始代码通过混淆得到的。所以我们就有了一个大胆的猜测</p><p>之前所有的代码实际上都是为了 _0x421e这个函数服务，最终的目的就是制造了一个真实的解密函数 _0x421e 来解密原始代码。既然有了猜测，我们就开始尝试破解它！</p><hr><p><strong>二、反混淆</strong></p><p>其实反混淆的逻辑非常简单，通过第一部分的分析可知，整个sojson的加密是由四部分组合而成的</p><p>\1. 变量声明</p><p>\2. 数组移位</p><p>\3. 解密函数</p><p>\4. 执行函数</p><p>​    不说废话了，调试神奇 chrome console登场，新建标签页，F12，console一气呵成（有条件的可以使用 node.js，没有电脑的可以用口算/心算）。之后把前三部分丢进console里，怒敲回车！</p><p><img src="/2020/01/04/JS%E8%A7%A3%E6%9E%90%E4%B9%8B%20%E6%9F%90json%E6%B7%B7%E6%B7%86%E9%98%85%E8%AF%BB%E6%80%9D%E8%B7%AF/www5\Hexo\BoyYongXin\source\_posts\images\微信图片_20200104211316.png" alt="微信图片_20200104211316"></p><p>可以看到解密函数正常，并没有报错。那么整个反混淆就完成了。下面就是在解密函数的基础上断点调试找cookie实际生成代码，模拟后即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line"><span class="string">"Accept"</span>:<span class="string">"application/json, text/javascript, */*; q=0.01"</span>,</span><br><span class="line"><span class="string">"Accept-Encoding"</span>:<span class="string">"gzip, deflate"</span>,</span><br><span class="line"><span class="string">"Accept-Language"</span>:<span class="string">"zh-CN,zh;q=0.9"</span>,</span><br><span class="line"><span class="string">"Connection"</span>:<span class="string">"keep-alive"</span>,</span><br><span class="line"><span class="string">"Cookie"</span>:<span class="string">"token=YWlkaW5nX3dpbjE1NzgxNDIspYWlkaW5nX3dpbjE1NzgxNDI=; tokentime=1578142"</span>,</span><br><span class="line"><span class="string">"Host"</span>:<span class="string">"www.python-spider.com"</span>,</span><br><span class="line"><span class="string">"Referer"</span>:<span class="string">"http://www.python-spider.com/content?sku=996"</span>,</span><br><span class="line"><span class="string">"User-Agent"</span>:<span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.88 Safari/537.36"</span>,</span><br><span class="line"><span class="string">"X-Requested-With"</span>:<span class="string">"XMLHttpRequest"</span>,</span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">'http://www.python-spider.com/detail?skuID=996'</span></span><br><span class="line">response = requests.get(url,headers=headers)</span><br><span class="line">html = response.content.decode()</span><br><span class="line">print(html)</span><br></pre></td></tr></table></figure><p>代码里加入cookie生成方式：</p><p>补充一下知识点：</p><h1 id="Window-btoa-方法"><a href="#Window-btoa-方法" class="headerlink" title="Window btoa() 方法"></a>Window btoa() 方法</h1><hr><h2 id="定义和用法"><a href="#定义和用法" class="headerlink" title="定义和用法"></a>定义和用法</h2><p>btoa() 方法用于创建一个 base-64 编码的字符串。</p><p>该方法使用 “A-Z”, “a-z”, “0-9”, “+”, “/“ 和 “=” 字符来编码字符串。</p><p>base-64 解码使用方法是 <a href="https://www.runoob.com/jsref/met-win-atob.html" target="_blank" rel="noopener">atob()</a> 。</p><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.btoa(str)</span><br></pre></td></tr></table></figure><p>最后python代码复现：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line">   </span><br><span class="line">    <span class="string">"Cookie"</span>:<span class="string">""</span>,</span><br><span class="line">    <span class="string">"Host"</span>:<span class="string">"www.python-spider.com"</span>,</span><br><span class="line">    <span class="string">"Referer"</span>:<span class="string">"http://www.python-spider.com/content?sku=996"</span>,</span><br><span class="line">    <span class="string">"User-Agent"</span>:<span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.88 Safari/537.36"</span>,</span><br><span class="line">    <span class="string">"X-Requested-With"</span>:<span class="string">"XMLHttpRequest"</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">timestamp = time.time()*<span class="number">1000</span></span><br><span class="line">result_str = <span class="string">'aiding_win'</span> + str(round(timestamp/<span class="number">1000000</span>))</span><br><span class="line">token = base64.encodebytes(result_str.encode(<span class="string">'utf-8'</span>)).decode(<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line">cookie = <span class="string">'token=%ssp%s'</span>%(token.replace(<span class="string">'='</span>, <span class="string">''</span>),token)</span><br><span class="line">tokentime =<span class="string">'tokentime='</span> + str(round(timestamp/<span class="number">1000000</span>))</span><br><span class="line">headers[<span class="string">"Cookie"</span>] = cookie + <span class="string">";"</span> + tokentime</span><br><span class="line">headers[<span class="string">"Cookie"</span>] = headers[<span class="string">"Cookie"</span>].replace(<span class="string">"\n"</span>,<span class="string">""</span>)</span><br><span class="line">url = <span class="string">'http://www.python-spider.com/detail?skuID=996'</span></span><br><span class="line">response = requests.get(url,headers=headers)</span><br><span class="line">html = response.content.decode()</span><br><span class="line">print(html)</span><br></pre></td></tr></table></figure><p>本文参考链接：<a href="http://www.python-spider.com/content?sku=996" target="_blank" rel="noopener">http://www.python-spider.com/content?sku=996</a></p><p><a href="https://blog.csdn.net/Mandyucan/article/details/80421711" target="_blank" rel="noopener">https://blog.csdn.net/Mandyucan/article/details/80421711</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt; 目标网址：&lt;a href=&quot;http://www.python-spider.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.python-spider.com&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;  采集任务：成功获取首页HTML源码&lt;/p&gt;
    
    </summary>
    
    
      <category term="python爬虫" scheme="http://yoursite.com/categories/python%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="爬虫" scheme="http://yoursite.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="反编译" scheme="http://yoursite.com/tags/%E5%8F%8D%E7%BC%96%E8%AF%91/"/>
    
      <category term="js逆向" scheme="http://yoursite.com/tags/js%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>某日报搜索参数securitykey加密破解</title>
    <link href="http://yoursite.com/2019/12/31/people-app/"/>
    <id>http://yoursite.com/2019/12/31/people-app/</id>
    <published>2019-12-31T07:49:35.000Z</published>
    <updated>2019-12-31T08:10:58.474Z</updated>
    
    <content type="html"><![CDATA[<p>感觉好久没发文章了，最近小编基本处于放养状态，言归正传，最近遇到一个app，怎么遇到的呢，还用说么，公司来活了，给你的任务</p> <a id="more"></a><p><strong>任务要求：</strong></p><p>给定一批关键词，进行搜索，把搜索结果近期的数据，进行，提取、入库。</p><p>接到这个app，首先进行常规操作，配置好手机代理，进行fiddler抓包，于是乎，抓到包了，拿下来，使用postman进行模拟请求</p><p>数据返回成功，ok完事了？？</p><p>根本不可能，更换一个关键词；不换关键词，请求下一页；都不能用，分析一下请求结构</p><p><img src="https://img-blog.csdnimg.cn/20191231151029774.png" alt="img"></p><p>我们看到是post请求，一起看看他的form表单</p><p><img src="https://img-blog.csdnimg.cn/20191231151224429.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JpZ0JveV9Db2Rlcg==,size_16,color_FFFFFF,t_70" alt="img"></p><p>如何确定那个参数是校验加密，反复抓包几次，对比信息即可，对比发现：</p><p>securitykey ：主要校验参数<br>longitude，latitude 经纬度，暂时不重要<br>province_code 时间戳，十位时间戳，后面跟000</p><p>开始下一个步骤，反编译APP，看他的源码，找到加密参数的方法</p><p>小坑出现了，使用apktool反编译失败，有点猫腻，jadx直接打开apk，如图所示</p><p><img src="https://img-blog.csdnimg.cn/20191231152321514.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JpZ0JveV9Db2Rlcg==,size_16,color_FFFFFF,t_70" alt="img"></p><p>不看不知道，一看吓一跳，腾讯和360加固，有加固，需要脱壳</p><p>脱壳成功后，把所有脱出来的classs.dex文件，全部拿到，对比一下，先拿文件最大的下手</p><p><img src="https://img-blog.csdnimg.cn/20191231152730740.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JpZ0JveV9Db2Rlcg==,size_16,color_FFFFFF,t_70" alt="img"></p><p>全局搜索，加密参数，我们找到了这个文件，瞧一瞧是不是咱所需要的</p><p><img src="https://img-blog.csdnimg.cn/20191231152951945.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JpZ0JveV9Db2Rlcg==,size_16,color_FFFFFF,t_70" alt="img"></p><p>如标注位置，发现正是咱们所需要的，加密算法调用，进入getMD5Str方法里面去，看看是如何加密的</p><p><img src="https://img-blog.csdnimg.cn/20191231153145614.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JpZ0JveV9Db2Rlcg==,size_16,color_FFFFFF,t_70" alt="img"></p><p>看一看，瞧一瞧，hook这个方法，看看传进来的是什么参数</p><p><img src="https://img-blog.csdnimg.cn/20191231153415752.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JpZ0JveV9Db2Rlcg==,size_16,color_FFFFFF,t_70" alt="img"></p><p>跟据多次堆栈和print打印的结果，发现发参数基本就是这个了</p><p>有几个参数是变化的，标注一下</p><p>经纬度，页码，时间戳</p><p>这个app到这里基本就差不多，破解了，</p><p>本想着直接python调用这段java代码呢，研究了一下（代码不多），加密代码，使用python还原一下</p><p>md5_str = hashlib.md5(security_args.encode(encoding=’UTF-8’)).hexdigest()</p><p>其实就是python的md5加密，哈哈</p><p>构造请求就可以了，完整代码，就不上传了</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;感觉好久没发文章了，最近小编基本处于放养状态，言归正传，最近遇到一个app，怎么遇到的呢，还用说么，公司来活了，给你的任务&lt;/p&gt;
    
    </summary>
    
    
      <category term="python爬虫" scheme="http://yoursite.com/categories/python%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="爬虫" scheme="http://yoursite.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="反编译" scheme="http://yoursite.com/tags/%E5%8F%8D%E7%BC%96%E8%AF%91/"/>
    
      <category term="Android逆向" scheme="http://yoursite.com/tags/Android%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>自动化工具uiautomator2安装和使用教程</title>
    <link href="http://yoursite.com/2019/12/21/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7uiautomator2%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/"/>
    <id>http://yoursite.com/2019/12/21/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7uiautomator2%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</id>
    <published>2019-12-21T07:26:13.000Z</published>
    <updated>2019-12-23T07:32:18.226Z</updated>
    
    <content type="html"><![CDATA[<p><strong>1、参考链接</strong></p><p> GitHub： <a href="https://github.com/openatx/uiautomator2" target="_blank" rel="noopener">https://github.com/openatx/uiautomator2</a><br> <a id="more"></a></p><p><strong>2、工作原理：</strong></p><p>三、uiautomator2工作原理：</p><p><img src="https://img2018.cnblogs.com/blog/1231206/201903/1231206-20190317123618691-734760575.png" alt="img"></p><p>如图所示，python-uiautomator2主要分为两个部分，python客户端，移动设备</p><ul><li>python端: 运行脚本，并向移动设备发送HTTP请求</li><li>移动设备：移动设备上运行了封装了uiautomator2的HTTP服务，解析收到的请求，并转化成uiautomator2的代码。</li></ul><p>整个过程</p><ol><li>在移动设备上安装<code>atx-agent</code>(守护进程), 随后<code>atx-agent</code>启动uiautomator2服务(默认7912端口)进行监听</li><li>在PC上编写测试脚本并执行（相当于发送HTTP请求到移动设备的server端）</li><li>移动设备通过WIFI或USB接收到PC上发来的HTTP请求，执行制定的操作</li></ol><p><strong>三、安装测试</strong></p><p><strong>第一步：</strong></p><p>先准备一台（不要两台）开启了<code>开发者选项</code>的安卓手机，连接上电脑，确保执行<code>adb devices</code>可以看到连接上的设备。</p><ul><li>运行<code>pip3 install -U uiautomator2</code>安装uiautomator2</li><li>运行<code>python3 -m uiautomator2 init</code>安装包含httprpc服务的apk到手机+<code>atx-agent, minicap, minitouch</code></li></ul><p><strong>第二步：</strong></p><p>命令行运行<code>python</code>打开python交互窗口。然后将下面的命令输入到窗口中。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import uiautomator2 as u2</span><br><span class="line"></span><br><span class="line">d &#x3D; u2.connect() # connect to device</span><br><span class="line">print(d.info)</span><br></pre></td></tr></table></figure><p>这时看到类似下面的输出，就可以正式开始用我们这个库了。因为这个库功能太多，后面还有很多的内容，需要慢慢去看 ….</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;currentPackageName&#39;: &#39;net.oneplus.launcher&#39;, &#39;displayHeight&#39;: 1920, &#39;displayRotation&#39;: 0, &#39;displaySizeDpX&#39;: 411, &#39;displaySizeDpY&#39;: 731, &#39;displayWidth&#39;: 1080, &#39;productName&#39;: &#39;OnePlus5&#39;, &#39;</span><br><span class="line">screenOn&#39;: True, &#39;sdkInt&#39;: 27, &#39;naturalOrientation&#39;: True&#125;</span><br></pre></td></tr></table></figure><p><strong>四、应用及操作</strong></p><p><strong>调用uiautomator2的过程</strong></p><ol><li>配置手机设备参数，设置具体操作的是哪一台手机</li><li>抓取手机上应用的控件，制定对应的控件来进行操作</li><li>对抓取到的控件进行操作，比如点击、填写参数等。</li></ol><p><strong>配置手机设备参数</strong></p><p>python-uiautomator2连接手机的方式有两种，一种是通过WIFI，另外一种是通过USB。两种方法各有优缺点。<br>WIFI最便利的地方要数可以不用连接数据线，USB则可以用在PC和手机网络不在一个网段用不了的情况。</p><ol><li><p>使用WIFI连接</p><p>手机获取到手机的IP，并确保电脑可以PING通手机。手机的IP可以在设置-WIFI设置里面获取到。<br>比如手机的IP是<code>192.168.0.100</code>，连接设备的代码为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import uiautomator2 as u2d &#x3D; u2.connect(&#39;192.168.0.100&#39;)</span><br></pre></td></tr></table></figure></li><li><p>使用USB连接</p><p>手机的序列号可以通过<code>adb devices</code>获取到，假设序列号是<code>123456f</code>，连接代码为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import uiautomator2 as u2d &#x3D; u2.connect_usb(&#39;123456f&#39;)</span><br></pre></td></tr></table></figure></li></ol><h4 id="抓取手机上应用的控件"><a href="#抓取手机上应用的控件" class="headerlink" title="抓取手机上应用的控件"></a>抓取手机上应用的控件</h4><p>安装方法: <code>pip install --pre weditor</code></p><p>使用方法:<br>首先运行<code>python -m weditor</code>，之后浏览器会自动打开一个网页 <code>http://atx.open.netease.com</code> （注：这个网址仅提供一个前端，而<code>python -mweditor</code>这个命令则本地开放了HTTP的接口，前端去跟本地的服务去通信）</p><p>定位方式</p><ol><li>ResourceId定位: <code>d(resourceId=&quot;com.smartisanos.clock:id/text_stopwatch&quot;).click()</code></li><li>Text定位 <code>d(text=&quot;秒表&quot;).click()</code></li><li>Description定位 <code>d(description=&quot;..&quot;).click()</code></li><li>ClassName定位 <code>d(className=&quot;android.widget.TextView&quot;).click()</code></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;1、参考链接&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt; GitHub： &lt;a href=&quot;https://github.com/openatx/uiautomator2&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/openatx/uiautomator2&lt;/a&gt;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://yoursite.com/2019/12/21/hello-world/"/>
    <id>http://yoursite.com/2019/12/21/hello-world/</id>
    <published>2019-12-21T03:51:08.817Z</published>
    <updated>2019-12-21T07:31:22.219Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.<br><a id="more"></a></p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;documentation&lt;/a&gt; for more info. If you get any problems when using Hexo, you can find the answer in &lt;a href=&quot;https://hexo.io/docs/troubleshooting.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;troubleshooting&lt;/a&gt; or you can ask me on &lt;a href=&quot;https://github.com/hexojs/hexo/issues&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GitHub&lt;/a&gt;.&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
    
    
  </entry>
  
</feed>
