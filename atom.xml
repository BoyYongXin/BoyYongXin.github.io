<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>菜鸟童靴</title>
  
  <subtitle>个人技术博客</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2022-03-19T13:36:11.323Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Monday</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>fastapi数据库操作之创建数据库</title>
    <link href="http://yoursite.com/2022/03/19/fastapi%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/"/>
    <id>http://yoursite.com/2022/03/19/fastapi%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/</id>
    <published>2022-03-19T11:46:10.000Z</published>
    <updated>2022-03-19T13:36:11.323Z</updated>
    
    <content type="html"><![CDATA[<p>hello 大家好我是Monday，今天给大家带来一篇FastAPI中通过SQLAlchemy操作mysql数据库的文章</p><a id="more"></a><h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>FastAPI中你可以使用任何关系型数据库，可以通过SQLAlchemy将其轻松的适应于任何的数据库，比如：</p><ul><li>PostgreSQL</li><li>MySQL</li><li>SQLite</li><li>Oracle</li></ul><p>　　SQLAlchemy是一个ORM（object-relational mapping）的框架。在ORM中，你创建一个类就会通过SQLAlchemy将其自动转成一张表，在类中的每一个属性就会将其转成表中的字段。</p><h2 id="二、项目结构"><a href="#二、项目结构" class="headerlink" title="二、项目结构"></a>二、项目结构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">└── xxxxx_app</span><br><span class="line">    ├── __init__.py</span><br><span class="line">    ├── crud.py</span><br><span class="line">    ├── database.py</span><br><span class="line">    ├── main.py</span><br><span class="line">    ├── models.py</span><br><span class="line">    └── schemas.py</span><br></pre></td></tr></table></figure><ul><li><strong>init</strong>.py 是一个空文件，但是说明xxxx_app是一个package</li><li>database.py 数据库配置相关</li><li>models.py 数据库模型表</li><li>schemas.py 模型验证</li><li>crud.py 数据库操作相关</li><li>main.py 主文件</li></ul><h2 id="三、简单实例"><a href="#三、简单实例" class="headerlink" title="三、简单实例"></a>三、简单实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install sqlalchemy</span><br><span class="line">pip install pymysql</span><br></pre></td></tr></table></figure><h4 id="1、database-py"><a href="#1、database-py" class="headerlink" title="1、database.py"></a>1、database.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line"></span><br><span class="line">SQLALCHEMY_DATABASE_URL = <span class="string">"mysql+pymysql://root:123456@127.0.0.1:3306/test"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># echo=True表示引擎将用repr()函数记录所有语句及其参数列表到日志</span></span><br><span class="line">engine = create_engine(</span><br><span class="line">    SQLALCHEMY_DATABASE_URL, encoding=<span class="string">'utf8'</span>, echo=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># SQLAlchemy中，CRUD是通过会话进行管理的，所以需要先创建会话，</span></span><br><span class="line"><span class="comment"># 每一个SessionLocal实例就是一个数据库session</span></span><br><span class="line"><span class="comment"># flush指发送到数据库语句到数据库，但数据库不一定执行写入磁盘</span></span><br><span class="line"><span class="comment"># commit是指提交事务，将变更保存到数据库文件中</span></span><br><span class="line">SessionLocal = sessionmaker(autocommit=<span class="literal">False</span>, autoflush=<span class="literal">False</span>, bind=engine)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建基本映射类</span></span><br><span class="line">Base = declarative_base()</span><br></pre></td></tr></table></figure><p>在数据库相关的配置文件中，首先创建一个SQLAlchemy的”engine”，然后创建SessionLocal实例进行会话，最后创建模型类的基类。</p><h4 id="2、models-py"><a href="#2、models-py" class="headerlink" title="2、models.py"></a>2、models.py</h4><p>我们开始创建用户表，字段大致如下，后面做用户token认证时也会用到这张表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;username&quot;: &quot;johndoe&quot;,</span><br><span class="line">    &quot;full_name&quot;: &quot;John Doe&quot;,</span><br><span class="line">    &quot;email&quot;: &quot;johndoe@example.com&quot;,</span><br><span class="line">    &quot;hashed_password&quot;: &quot;$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW&quot;,</span><br><span class="line">    &quot;disabled&quot;: False</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Boolean, Column, Integer, String, DateTime</span><br><span class="line"><span class="keyword">from</span> database <span class="keyword">import</span> Base</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">"users"</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>, index=<span class="literal">True</span>, comment=<span class="string">'自增id'</span>)</span><br><span class="line">    user_name = Column(String(<span class="number">32</span>), unique=<span class="literal">True</span>, index=<span class="literal">True</span>, comment=<span class="string">'用户名'</span>)</span><br><span class="line">    full_name = Column(String(<span class="number">32</span>), unique=<span class="literal">False</span>, index=<span class="literal">False</span>, default=<span class="literal">None</span>, comment=<span class="string">'全称'</span>)</span><br><span class="line">    email = Column(String(<span class="number">32</span>), unique=<span class="literal">True</span>, index=<span class="literal">True</span>, comment=<span class="string">'邮箱地址'</span>)</span><br><span class="line">    hashed_password = Column(String(<span class="number">64</span>), comment=<span class="string">'加密密码'</span>)</span><br><span class="line">    disabled = Column(Boolean, default=<span class="literal">True</span>, comment=<span class="string">'用户状态'</span>)</span><br><span class="line">    createtime = Column(DateTime, default=datetime.datetime.now, comment=<span class="string">'创建时间'</span>)</span><br><span class="line">    updatetime = Column(DateTime, default=datetime.datetime.now, comment=<span class="string">'修改时间'</span>)</span><br></pre></td></tr></table></figure><p>通过数据库配置文件中的基类来创建模型类。</p><h4 id="3、schemas-py"><a href="#3、schemas-py" class="headerlink" title="3、schemas.py"></a>3、schemas.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*-coding=utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: Mr.Yang</span></span><br><span class="line"><span class="comment"># @Date: </span></span><br><span class="line"><span class="comment"># @email: </span></span><br><span class="line"><span class="comment"># @Pagefunction</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Optional</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserBase</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    email: str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserCreate</span><span class="params">(UserBase)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    请求模型验证：</span></span><br><span class="line"><span class="string">    email:</span></span><br><span class="line"><span class="string">    password:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    password: str</span><br><span class="line">    user_name: str</span><br><span class="line">    full_name: Optional[str] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(UserBase)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    响应模型：</span></span><br><span class="line"><span class="string">    id:</span></span><br><span class="line"><span class="string">    email:</span></span><br><span class="line"><span class="string">    is_active</span></span><br><span class="line"><span class="string">    并且设置orm_mode与之兼容</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    id: int</span><br><span class="line">    disabled: bool</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Config</span>:</span></span><br><span class="line">        orm_mode = <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>定义请求参数模型验证与响应模型验证的Pydantic模型，其中响应模型中设置orm_mode=True参数，表示与ORM模型兼容，因为后续中返回的数据库查询是orm模型，通过设置这个参数可以将orm模型通过pydantic模型进行验证。</p><h4 id="4、crud-py"><a href="#4、crud-py" class="headerlink" title="4、crud.py"></a>4、crud.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> Session</span><br><span class="line"><span class="keyword">import</span> models, schemas</span><br><span class="line"><span class="keyword">from</span> passlib.context <span class="keyword">import</span> CryptContext  <span class="comment"># passlib 处理哈希加密的包</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">为了数据安全，我们利用PassLib对入库的用户密码进行加密处理，推荐的加密算法是"Bcrypt"</span></span><br><span class="line"><span class="string">其中，我们主要使用下面方法：</span></span><br><span class="line"><span class="string">pwd_context.hash(password) # 对密码进行加密</span></span><br><span class="line"><span class="string">pwd_context.verify(plain_password, hashed_password) 对密码进行校验</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># Context是上下文,CryptContext是密码上下文</span></span><br><span class="line">pwd_context = CryptContext(schemes=[<span class="string">"bcrypt"</span>], deprecated=<span class="string">"auto"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过id查询用户</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_user</span><span class="params">(db: Session, user_id: int)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> db.query(models.User).filter(models.User.id == user_id).first()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建用户</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">db_create_user</span><span class="params">(db: Session, user: schemas.UserCreate)</span>:</span></span><br><span class="line">    fake_hashed_password = pwd_context.hash(user.password)</span><br><span class="line">    db_user = models.User(email=user.email, hashed_password=fake_hashed_password,</span><br><span class="line">                          user_name=user.user_name, full_name=user.full_name)</span><br><span class="line">    db.add(db_user)</span><br><span class="line">    db.commit()  <span class="comment"># 提交保存到数据库中</span></span><br><span class="line">    db.refresh(db_user)  <span class="comment"># 刷新</span></span><br><span class="line">    <span class="keyword">return</span> db_user</span><br></pre></td></tr></table></figure><p>通过传入数据库连接以及参数等进行数据库操作，包括创建用户、查询用户等，返回的是orm模型对象。</p><h4 id="5、main-py"><a href="#5、main-py" class="headerlink" title="5、main.py"></a>5、main.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">"../"</span>)</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Depends, HTTPException</span><br><span class="line"><span class="keyword">import</span> crud, schemas</span><br><span class="line"><span class="keyword">from</span> database <span class="keyword">import</span> SessionLocal, engine, Base</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> Session</span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"></span><br><span class="line">Base.metadata.create_all(bind=engine) <span class="comment">#数据库初始化，如果没有库或者表，会自动创建</span></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Dependency</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_db</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    每一个请求处理完毕后会关闭当前连接，不同的请求使用不同的连接</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    db = SessionLocal()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> db</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        db.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建用户</span></span><br><span class="line"><span class="meta">@app.post("/users/", response_model=schemas.User)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_user</span><span class="params">(user: schemas.UserCreate, db: Session = Depends<span class="params">(get_db)</span>)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> crud.db_create_user(db=db, user=user)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过id查询用户</span></span><br><span class="line"><span class="meta">@app.get("/user/&#123;user_id&#125;", response_model=schemas.User)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_user</span><span class="params">(user_id: int, db: Session = Depends<span class="params">(get_db)</span>)</span>:</span></span><br><span class="line">    db_user = crud.get_user(db, user_id=user_id)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> db_user:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">404</span>, detail=<span class="string">"User not found"</span>)</span><br><span class="line">    <span class="keyword">return</span> db_user</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    uvicorn.run(app=<span class="string">"main:app"</span>, host=<span class="string">"0.0.0.0"</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure><h4 id="5、测试验证"><a href="#5、测试验证" class="headerlink" title="5、测试验证"></a>5、测试验证</h4><p>现在我们查看下文档<a href="http://localhost:8000/docs#/" target="_blank" rel="noopener">FastAPI - Swagger UI</a>操作一下</p><p><img src="/2022/03/19/fastapi%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/1.jpg" style="zoom: 50%;"></p><p><strong>使用postman测试下</strong></p><p><img src="/2022/03/19/fastapi%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/3.jpg" style="zoom: 50%;"></p><p><strong>python代码</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"accept"</span>: <span class="string">"application/json"</span>,</span><br><span class="line">    <span class="string">"Content-Type"</span>: <span class="string">"application/json"</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">"http://localhost:8000/users/"</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"user_name"</span>: <span class="string">"monday"</span>,</span><br><span class="line">    <span class="string">"email"</span>: <span class="string">"14268333@qq.com"</span>,</span><br><span class="line">    <span class="string">"password"</span>: <span class="string">"123456"</span>,</span><br><span class="line">    <span class="string">"full_name"</span>: <span class="string">"菜鸟童靴"</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.post(url, headers=headers, json=data)</span><br><span class="line">print(response.text)</span><br><span class="line">print(response)</span><br></pre></td></tr></table></figure><p><strong>结果显示：</strong></p><p><img src="/2022/03/19/fastapi%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/2.jpg" style="zoom: 50%;"></p><p><strong>查询用户：</strong></p><p><img src="/2022/03/19/fastapi%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/4.jpg" style="zoom: 50%;"></p><p><strong>项目完整代码：</strong></p><p><a href="https://github.com/BoyYongXin/wx_pub_artcole_code" target="_blank" rel="noopener">BoyYongXin/wx_pub_artcole_code: 博客发文使用的代码 (github.com)</a></p><p><strong>结束语</strong>：</p><p>​    今天的分享就到这里了，欢迎大家关注微信公众号”<strong>菜鸟童靴</strong>“</p><p><img src="/2022/03/19/fastapi%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/微信.png" style="zoom: 50%;"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;hello 大家好我是Monday，今天给大家带来一篇FastAPI中通过SQLAlchemy操作mysql数据库的文章&lt;/p&gt;
    
    </summary>
    
    
      <category term="后端" scheme="http://yoursite.com/categories/%E5%90%8E%E7%AB%AF/"/>
    
    
      <category term="后端" scheme="http://yoursite.com/tags/%E5%90%8E%E7%AB%AF/"/>
    
      <category term="fastapi" scheme="http://yoursite.com/tags/fastapi/"/>
    
  </entry>
  
  <entry>
    <title>解决某阿里系app抓包问题并开发持久化hook抓包插件</title>
    <link href="http://yoursite.com/2022/03/15/%E8%A7%A3%E5%86%B3%E6%9F%90%E9%98%BF%E9%87%8C%E7%B3%BBapp%E6%8A%93%E5%8C%85%E9%97%AE%E9%A2%98%E5%B9%B6%E5%BC%80%E5%8F%91%E6%8C%81%E4%B9%85%E5%8C%96hook%E6%8A%93%E5%8C%85%E6%8F%92%E4%BB%B6/"/>
    <id>http://yoursite.com/2022/03/15/%E8%A7%A3%E5%86%B3%E6%9F%90%E9%98%BF%E9%87%8C%E7%B3%BBapp%E6%8A%93%E5%8C%85%E9%97%AE%E9%A2%98%E5%B9%B6%E5%BC%80%E5%8F%91%E6%8C%81%E4%B9%85%E5%8C%96hook%E6%8A%93%E5%8C%85%E6%8F%92%E4%BB%B6/</id>
    <published>2022-03-15T10:24:34.000Z</published>
    <updated>2022-03-15T10:24:34.737Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>NDK开发之JNI技术</title>
    <link href="http://yoursite.com/2022/03/15/NDK%E5%BC%80%E5%8F%91%E4%B9%8BJNI%E6%8A%80%E6%9C%AF/"/>
    <id>http://yoursite.com/2022/03/15/NDK%E5%BC%80%E5%8F%91%E4%B9%8BJNI%E6%8A%80%E6%9C%AF/</id>
    <published>2022-03-15T01:37:24.000Z</published>
    <updated>2022-03-15T03:28:50.369Z</updated>
    
    <content type="html"><![CDATA[<p>本篇文章，JNI技术</p><a id="more"></a><p><strong>01</strong>、 <strong>NDK和JNI的关系</strong></p><p>在前面安卓NDK开发之Hello JNI中，我们讲解了安卓上的ndk开发的一般流程，初步了解了jni技术。那么ndk和jni到底是什么关系呢？事实上jni和ndk没什么关系，但ndk和jni有关系，准确的说是ndk开发需要用到jni技术。就像水和鱼没关系，但是鱼和水有关系，鱼需要在水中生存。</p><ul><li>JNI（Java Native Interface）技术是java本身提供的技术，是用来在java层和c/c++层进行通信的接口，和安卓没啥关系。</li><li>NDK（Native Development Kit）是谷歌为了更好的支持安卓开发者进行jni开发而提供的一套开发工具包，通过Android.mk和Application.mk文件来管理编译c/c++代码，然后将其so打包到apk中。</li></ul><p>也就是说ndk开发部分的核心是jni技术，ndk编译c/c++代码的核心部分是mk/cmake脚本的编写。所以我们先了解下ndk开发的用到的jni技术。</p><p><strong>02、JNI技术</strong></p><p>java的jni开发官方文档地址：<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/jni/spec/jniTOC.html。推荐大家先大概浏览下。" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/guides/jni/spec/jniTOC.html。推荐大家先大概浏览下。</a></p><p>在正式讲解本节内容之前，我们来看一下上一节中利用javah命令自动生成的.h文件中的函数与我们在java层定义的函数之间的关系：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//java层代码</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">getString</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//C/C++层代码</span></span><br><span class="line">jstring JNICALL Java_com_htq_baidu_ndk_NDKTest_getString</span><br><span class="line">    (JNIEnv * env, jobject object)&#123;</span><br><span class="line">   <span class="keyword">return</span> env-&gt;NewStringUTF(<span class="string">"hello.this is from native code"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这两个参数的作用是什么呢？jobject很容易理解就是java层对应的C++层引用类型，即表示java中的Object类型，当我们在java代码中调用某个native函数时，该类即为该native函数对应到.cpp代码函数的jobject参数。这一点和java代码中类编译为class文件时，函数参数中会自动多一个this指针用来表示调用该函数的类的对象一样，这个很容易理解，因此重点来看下JNIEnv*是个什么东东。</p><p><strong>JNIEnv*</strong></p><p>我们来看下java的jni.h中是如何定义JNIEnv*的，jni.h位于jdk安装目录的include目录下。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(__cplusplus)</span></span><br><span class="line"><span class="keyword">typedef</span> _JNIEnv JNIEnv;</span><br><span class="line"><span class="keyword">typedef</span> _JavaVM JavaVM;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">JNINativeInterface</span>* <span class="title">JNIEnv</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">JNIInvokeInterface</span>* <span class="title">JavaVM</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>从上面可以看到JNIEnv表示的是JNINativeInterface这个结构体的指针，从上面也可以看到JNIEnv在C和C++下的定义是不同的，这个仅仅影响到我们调用函数的方式而已，对逻辑无影响，主要来说就是在c++中调用JNI提供的API接口函数时不需要JNIEnv参数，而c中通常将该参数作为函数第一个参数，如下所示：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//C++调用方式</span></span><br><span class="line">jclass jclazz = env-&gt;FindClass(<span class="string">"com/htq/baidu/ndk/NDKTest"</span>);</span><br><span class="line"><span class="comment">//C调用方式</span></span><br><span class="line">jclass jclazz = (*env)-&gt;FindClass(env, <span class="string">"com/htq/baidu/ndk/NDKTest"</span>);</span><br></pre></td></tr></table></figure><p>这两种方式仅仅是调用方式不同而已，对逻辑无影响，这里以C为例进行分析，那么我们来看下JNINativeInterface是如何定义的：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Table of interface function pointers.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">JNINativeInterface</span> &#123;</span></span><br><span class="line">    <span class="keyword">void</span>*       reserved0;</span><br><span class="line">    <span class="keyword">void</span>*       reserved1;</span><br><span class="line">    <span class="keyword">void</span>*       reserved2;</span><br><span class="line">    <span class="keyword">void</span>*       reserved3;</span><br><span class="line"></span><br><span class="line">    jint        (*GetVersion)(JNIEnv *);</span><br><span class="line"></span><br><span class="line">    jclass      (*DefineClass)(JNIEnv*, <span class="keyword">const</span> <span class="keyword">char</span>*, jobject, <span class="keyword">const</span> jbyte*,</span><br><span class="line">    jsize);</span><br><span class="line">    jclass      (*FindClass)(JNIEnv*, <span class="keyword">const</span> <span class="keyword">char</span>*);</span><br><span class="line"></span><br><span class="line">    jmethodID   (*FromReflectedMethod)(JNIEnv*, jobject);</span><br><span class="line">    jfieldID    (*FromReflectedField)(JNIEnv*, jobject);</span><br><span class="line"><span class="comment">/* spec doesn't show jboolean parameter */</span></span><br><span class="line">    jobject     (*ToReflectedMethod)(JNIEnv*, jclass, jmethodID, jboolean);</span><br><span class="line"></span><br><span class="line">    jclass      (*GetSuperclass)(JNIEnv*, jclass);</span><br><span class="line">    jboolean    (*IsAssignableFrom)(JNIEnv*, jclass, jclass);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* spec doesn't show jboolean parameter */</span></span><br><span class="line">    jobject     (*ToReflectedField)(JNIEnv*, jclass, jfieldID, jboolean);</span><br><span class="line">  </span><br><span class="line">    ......</span><br><span class="line">    </span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure><p>从注释可以看到JNINativeInterface表示的是接口函数指针表（Table of interface function pointers），也就是说该结构体定义了一系列的接口函数指针，注意是接口函数-&gt;指针，说白了就是该结构体中申明了一系列的功能函数，如FindClass函数，只不过这些函数不是普通形式的函数申明，而是通过函数指针的形式申明的，如：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义了一个名为FindClass的指针，该指针指向格式为 jclass fun(JNIEnv*, const char*)的函数</span></span><br><span class="line">jclass   (*FindClass)(JNIEnv*, <span class="keyword">const</span> <span class="keyword">char</span>*);</span><br></pre></td></tr></table></figure><p>而这些函数指针最终指向的是JVM虚拟机中对应的JNI函数的地址，这样当我们在C/C++代码中通过JNIEnv调用函数的时候才能够被JVM虚拟机正确执行。用图示表示如下：</p><p><img src="/2022/03/15/NDK%E5%BC%80%E5%8F%91%E4%B9%8BJNI%E6%8A%80%E6%9C%AF/1.jpg" style="zoom: 100%;"></p><p>所以<strong>JNIEnv可以理解为一个存放大量API接口指针的表，调用某个API时会通过该表的指针找到该函数。</strong>注意JNIEnv是和线程相关的，也就是说不能在多个线程中共享使用一个JNIEnv。</p><p><strong>03、JNI中核心数据类型</strong></p><p>前面提到过javah为我们自动生成的c/c++方法中包含一个jobject类型参数。这个jobject类型就是jni开发中的一种数据结构。就像c/c++中包含基本数据类型int等一样。下面讲解下JNI中的核心数据类型以及java中数据类型在JNI中对应的数据类型的映射关系。</p><p><strong>jclass, jobject,jmethodID, jfieldID</strong></p><p>JNI中native层与java层通信本质就是在C/C++代码中利用JNI接口去调用本身属于java层的方法。也就是在so层调用java层方法。那么既然是C调java代码，那么最终该方法的执行肯定还是JVM通过加载java字节码来完成java层这些方法的执行。所以如果我们要调用某个java函数，首先得知道该函数属于哪个类，以便得到该类的字节码对象，然后需要知道该函数完整签名，以便得到该方法的方法id，从而能够调用该方法。这就涉及到JNI中的一些重要的数据类型了</p><ul><li>jclass：JNI中表示类字节码对象的数据结构。对应于java层的类的字节码对象Class</li><li>jobject：JNI中表示类字节码对象的实例数据结构。对应于java层的类的字节码对象的实例Object</li><li>jmethodID：JNI中表示某方法的id，该id用来唯一确定该类中的某个方法</li><li>jfieldID：JNI中表示某域的id，该id用唯一确定该类中的某个域</li></ul><p>jclass和jobject可以先理解为类似java中对象和实例的区别。即静态方法可直接被对象调用，非静态方法需要被该对象的一个实例调用。这在JNI中也是适用的，后面会讲到JNI中静态方法的调用第一个参数是jclass。而非静态方法的调用第一个参数是jobject。</p><p><strong>JNI 数据类型与 Java 数据类型的映射关系</strong></p><p>最前面的例子中说到如果java层的方法是无参数的，javah在生成该方法JNI对应的函数时会增加JNIEnv*和jobject/jclass这2个参数。那如果方法本身含有参数呢？那么生成的方法除了上面2个参数之外还会包括java层这些方法本身的参数对应的JNI参数类型。这些参数类型及其对应关系如下：</p><p><strong>基本数据类型</strong></p><p><img src="/2022/03/15/NDK%E5%BC%80%E5%8F%91%E4%B9%8BJNI%E6%8A%80%E6%9C%AF/2.png" style="zoom: 100%;"></p><p><strong>引用数据类型</strong></p><p><img src="/2022/03/15/NDK%E5%BC%80%E5%8F%91%E4%B9%8BJNI%E6%8A%80%E6%9C%AF/3.png" style="zoom: 100%;"></p><p><strong>可以看到JNI中的基本数据类型和引用类型是在java中对应基本数据类型/引用类型的前面加上j，</strong></p><p><strong>如java中int类型对应jint，java中的String对应jstring。</strong></p><p><strong>数组类型加上j前缀和Array后缀，如int[]对应jintArray。</strong></p><p><strong>注意特殊类型void在JNI中仍然以void类型表示。</strong></p><p><strong>04、JNI中数据类型的类型描述符</strong></p><p>通过前面介绍大家可能发现了在JNI中对象数据类型只提供了jclass,jobject和jstring这3个数据结构，但是java中的对象数据类型虽然只有Object，但是对应的类实在是太多了，比如java.lang这个包下就有很多类。如何用有限的数据类型表示所有的类呢？这就涉及到JNI中的类型描述符了。</p><p><strong>类型描述符可以概括为类描述符，基本类型/数组类型/引用类型描述符2大类。</strong></p><p><strong>类描述符</strong></p><p>所谓类描述符即在JNI中得到该类的字节码对象时需要传递的描述符。即调用FindClass接口的时候的描述符。类描述符是将java中类的完整名路径（包名+类名）中原来的 . 分隔符换成 / 分隔符后得到的。</p><p>例如：java中的java.lang.String类的类描述符就是java/lang/String</p><p>这样如果我们要得到某个类的jni层的class对象，则只需要把该类在java层的类对应的类描述符作为参数传递给FindClass接口即可。这样根据不同类描述符来得到不同的jcass对象就能表示所有的java层的类了。</p><p>比如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jclass jclazz &#x3D; env-&gt;FindClass(“com&#x2F;htq&#x2F;baidu&#x2F;ndk&#x2F;NDKTest”);</span><br><span class="line">jstring jstr&#x3D;(jstring) env-&gt;FindClass(“java&#x2F;lang&#x2F;String”);</span><br></pre></td></tr></table></figure><p><strong>基本类型/数组类型/引用类型描述符</strong></p><p>基本类型/数组类型/引用类型描述符是用来得到某个域/函数ID的时候作为参数传递的描述符。其中基本类型在JNI层描述符对应关系如下：</p><p><img src="/2022/03/15/NDK%E5%BC%80%E5%8F%91%E4%B9%8BJNI%E6%8A%80%E6%9C%AF/4.png" style="zoom: 100%;"></p><p><strong>除了long用J表示boolean用Z表示外，其余基本类型对应的JNI层类型描述符都是java层表示的首字母大写</strong>。例如int用I表示，double用D表示，void用V表示。</p><p><strong>引用类型用大写的 L + 该类型类描述符 + ;（注意结尾包含一个英文分号;）</strong>，例如：</p><blockquote><p>String类型用Ljava/lang/String;表示</p></blockquote><p><strong>数组类型用[加上该数组基本元素类型</strong>，例如</p><blockquote><p>int[]用[I表示<br>int[][]用[[I表示<br>Stirng[]用[Ljava/lang/String;表示</p></blockquote><p>注意同为描述类，作为FindClass参数时传递的是类描述符，而作为GetMethodID系类接口参数传递的是引用类型描述符，这2者的区别是后者需要包含前面大写的L和结尾的英文分号;</p><p><strong>05 、JNI开发常用API接口</strong></p><p>弄清楚了最核心的JNIEnv<em>的概念以及JNI中的数据类型及其描述，接下来就看看如何使用JNIEnv提供的API接口。前面提到过，<em>*首先需要得到该类的字节码对象，然后实例化该对象，接着得到某个方法的方法ID，最终通过该类对象/实例调用该方法（静态方法通过类对象直接调用，非静态方法通过类实例调用）</em></em>。在JNI中是通过JNIEnv对象的FindClass函数来获取字节码对象的。通过GetMethodID/GetStaticMethodID函数来获取某个方法ID。</p><p><strong>通过FindClass得到类对象jclass</strong></p><p>函数定义如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jclass (*FindClass)(JNIEnv*, const char*);</span><br></pre></td></tr></table></figure><p>该函数的参数及返回值意义如下：</p><ul><li>JNIEnv*，该参数为JNIEnv类型的指针，</li><li>const char*，字符串常量，类描述符，即将类完整路径的包名分隔符.替换为/之后的结果，具体见前面类描述符相关部分</li><li>返回值jclass表示的是java字节码对象。</li></ul><p><strong>通过GetMethodID/GetStaticMethodID来得到函数ID</strong></p><p>获得了类的字节码对象之后就可以通过函数名来调用函数了，而java层函数包括静态函数和非静态函数2部分。对应到JNI层分别对应GetStaticMethodID和GetMethodID。这2个函数定义分别如下所示如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jmethodID (JNICALL *GetStaticMethodID)(JNIEnv *env, jclass clazz, <span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">const</span> <span class="keyword">char</span> *sig);</span><br><span class="line">jmethodID (NICALL *GetMethodID)(JNIEnv *env, jclass clazz, <span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">const</span> <span class="keyword">char</span> *sig);</span><br></pre></td></tr></table></figure><p>可以看到这2个函数的参数和返回值完全一样。其参数及返回值意义如下：</p><ul><li>JNIEnv*：JNIEnv对象指针</li><li>jclass ：java字节码对象，用来表示该方法是在哪个类中定义的。即通过FindClass接口得到的返回值对象</li><li>name：函数名字符串，该字符串内容为该函数在java层定义时的函数名</li><li>sig：函数签名字符串，也就是函数对应的各个参数及返回值类型的描述符</li><li>返回值jmethodID：函数的ID，可以理解为函数的指针</li></ul><p>其中最后一个参数是函数签名，我们怎么知道函数的签名呢？JNI中函数签名按照如下格式表示：</p><blockquote><p>（函数每个参数描述符）函数返回值描述符</p></blockquote><p>例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String test(int i,String str) 对应的函数签名描述符为(ILjava&#x2F;lang&#x2F;String;)Ljava&#x2F;lang&#x2F;String;</span><br><span class="line">void test(int []i,String str) 对应的函数签名描述符为([ILjava&#x2F;lang&#x2F;String;)V</span><br></pre></td></tr></table></figure><p>所以只要理解了前面讲解的JNI中数据类型的类型描述符，那么很容易知道函数签名描述符。</p><p>另外还可以使用javap命令，命令格式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javap -s 类名（包含包名的全路径类名）</span><br></pre></td></tr></table></figure><p>同样的该命令也需要在字节码所在的目录执行，例如在自己的工程的app\build\intermediates\classes\debug目录下执行上述命令，另外当我们执行javah命令自动生成JNI头文件时函数的签名信息在.h文件会以注释的信息告知。</p><p><strong>注意虽然GetStaticMethodID和GetMethodID函数的参数以及返回值完全一样，但是决不能乱用，即如果该方法java层是static的就调用GetStaticMethodID，反之调用GetMethodID，需要严格遵守此规定，不然运行时会出现异常。</strong>而前面提到的FindClass使用类描述符可以不严格遵守，也可以使用引用类型描述符。即FindClass(“java/lang/String”)和FindClass(“Ljava/lang/String;”)均可。</p><p><strong>通过CallXXXMethod/CallStaticXXXMethod调用函数</strong></p><p>得到了MethodID之后就可以调用该函数了，在JNIEnv中定义了一系列的调用对应返回值的函数，都是形如CallXXXMethod/CallStaticXXXMethod的形式，如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#x2F;&#x2F;调用静态方法</span><br><span class="line">jobject (JNICALL *CallStaticObjectMethod)(JNIEnv *env, jclass clazz, jmethodID methodID, ...);</span><br><span class="line">jint (JNICALL *CallStaticIntMethod)(JNIEnv *env, jclass clazz, jmethodID methodID, ...);</span><br><span class="line">void (JNICALL *CallStaticVoidMethod)(JNIEnv *env, jclass cls, jmethodID methodID, ...);</span><br><span class="line">jchar (JNICALL *CallStaticCharMethod)(JNIEnv *env, jclass clazz, jmethodID methodID, ...);</span><br><span class="line">&#x2F;&#x2F;调用非静态方法</span><br><span class="line">jint (JNICALL *CallIntMethod)(JNIEnv *env, jobject obj, jmethodID methodID, ...);</span><br><span class="line">void (JNICALL *CallVoidMethod)(JNIEnv *env, jobject obj, jmethodID methodID, ...);</span><br><span class="line">jchar (JNICALL *CallCharMethod)(JNIEnv *env, jobject obj, jmethodID methodID, ...);</span><br></pre></td></tr></table></figure><p>这类函数的第一个参数为JNIEnv对象，第二个参数为jclass（调用静态函数）或jobject（调用非静态函数），第三个参数为函数ID（即调用GetMethodID/GetStaticMethodID接口返回的对象），最后的可变参数就是调用该函数时需要传递的参数。</p><p>当我们调用的函数签名返回值属于void则调用CallVoidMethod，返回值为int则调用CallIntMethod，依此类推，如若java层代码为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public native void printString();</span><br></pre></td></tr></table></figure><p>则对应的C++层调用java代码为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#x2F;&#x2F;首先得到类的字节码对象</span><br><span class="line">jclass jclazz &#x3D; env-&gt;FindClass(&quot;com&#x2F;htq&#x2F;baidu&#x2F;ndk&#x2F;NDKTest&quot;);</span><br><span class="line">&#x2F;&#x2F;得到函数ID</span><br><span class="line">jmethodID methodID &#x3D; env-&gt;GetMethodID(jclazz, &quot;prinString&quot;, &quot;()V&quot;);&#x2F;&#x2F;非静态函数使用GetMethodID</span><br><span class="line">&#x2F;&#x2F;调用函数，第一个参数为JNIEnv对象，第二个参数为类对象，第三个参数为函数ID，最后参数为需要传给原函数的参数，因为为void，所以不需要传参数。C++中调用时无需JNIEnv参数 </span><br><span class="line">env-&gt;CallVoidMethod(object,methodID);</span><br></pre></td></tr></table></figure><p>可以看到首先获取字节码对象，然后获取函数ID，最后调用函数，这一点和java中的反射调用某个函数的过程非常类似。</p><p><strong>06、native调用java代码实例</strong></p><p>那么我们就在前面一节代码的基础上进行改进，此时的主界面包含三个按钮，分别对应c调java中的void函数，c调java中的返回值为int的函数，c调java中函数参数为字符串的函数。此时的MainActivity代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TextView tv;</span><br><span class="line">    <span class="keyword">private</span> Button btnVoid,btnInt,btnString;</span><br><span class="line">    <span class="keyword">private</span> NDKTest ndkTest;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        ndkTest=<span class="keyword">new</span> NDKTest();</span><br><span class="line"></span><br><span class="line">        tv= (TextView) findViewById(R.id.text);</span><br><span class="line">        btnVoid= (Button) findViewById(R.id.btn_void);</span><br><span class="line">        btnVoid.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        btnInt= (Button) findViewById(R.id.btn_int);</span><br><span class="line">        btnInt.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        btnString= (Button) findViewById(R.id.btn_string);</span><br><span class="line">        btnString.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (v.getId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.btn_void:</span><br><span class="line">                ndkTest.callBackMethod();</span><br><span class="line">                tv.setText(ndkTest.text);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btn_int:</span><br><span class="line">                <span class="keyword">int</span> sum=ndkTest.callBackIntMethod(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">                tv.setText(<span class="string">"1加2的和为："</span>+String.valueOf(sum));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btn_string:</span><br><span class="line">                ndkTest.callBackStringArgMethod();</span><br><span class="line">                tv.setText(ndkTest.text);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码很简单，大家应该都能够看得懂，就是三个Button用来响应调用三个不同签名格式的native函数。其中的NDKTest类就是用来定义native函数的类，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NDKTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> String text;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">static</span> &#123;</span><br><span class="line"> System.loadLibrary(<span class="string">"ndk"</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//java调C函数声明</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">callBackMethod</span><span class="params">()</span></span>;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">int</span> <span class="title">callBackIntMethod</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">callBackStringArgMethod</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">//c层回调java函数，</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prinString</span><span class="params">()</span></span>&#123;</span><br><span class="line">     String str=<span class="string">"this string is from java code but it called by native code"</span>;</span><br><span class="line">     <span class="keyword">this</span>.text=str;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addTwoNum</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"> <span class="keyword">return</span> x+y;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setString</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line"> <span class="keyword">this</span>.text=str;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最核心的当然是.cpp代码，在cpp代码中反过来调用java层的代码，调用的原理即是前面讲解的JNI技术，代码如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"com_htq_baidu_ndk_NDKTest.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL <span class="title">Java_com_htq_baidu_ndk_NDKTest_callBackMethod</span><span class="params">(JNIEnv * env,jobject object)</span></span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//首先得到类的字节码对象</span></span><br><span class="line"> jclass jclazz = env-&gt;FindClass(<span class="string">"com/htq/baidu/ndk/NDKTest"</span>);</span><br><span class="line"> <span class="comment">//得到函数ID</span></span><br><span class="line"> jmethodID methodID = env-&gt;GetMethodID(jclazz, <span class="string">"prinString"</span>, <span class="string">"()V"</span>);</span><br><span class="line"></span><br><span class="line"> <span class="comment">//调用函数，第一个参数为JNIEnv对象，第二个参数为类对象，第三个参数为函数ID，C++中调用时无需JNIEnv参数</span></span><br><span class="line"> env-&gt;CallVoidMethod(object,methodID);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">JNIEXPORT jint JNICALL <span class="title">Java_com_htq_baidu_ndk_NDKTest_callBackIntMethod</span><span class="params">(JNIEnv *env, jobject object, jint x, jint y)</span></span>&#123;</span><br><span class="line"> <span class="comment">//首先得到类的字节码对象</span></span><br><span class="line"> jclass jclazz = env-&gt;FindClass(<span class="string">"com/htq/baidu/ndk/NDKTest"</span>);</span><br><span class="line"> <span class="comment">//得到函数ID</span></span><br><span class="line"> jmethodID methodID = env-&gt;GetMethodID( jclazz, <span class="string">"addTwoNum"</span>, <span class="string">"(II)I"</span>);</span><br><span class="line"> <span class="comment">//调用函数，第一个参数为JNIEnv对象，第二个参数为类对象，第三个参数为函数ID,C++中调用时无需JNIEnv参数</span></span><br><span class="line"> <span class="keyword">int</span> sum=env-&gt;CallIntMethod(object,methodID,x,y);</span><br><span class="line"> <span class="keyword">return</span> sum;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL <span class="title">Java_com_htq_baidu_ndk_NDKTest_callBackStringArgMethod</span><span class="params">(JNIEnv *env, jobject object)</span></span>&#123;</span><br><span class="line"> <span class="comment">//首先得到类的字节码对象</span></span><br><span class="line"> jclass jclazz = env-&gt;FindClass(<span class="string">"com/htq/baidu/ndk/NDKTest"</span>);</span><br><span class="line"> <span class="comment">//得到函数ID</span></span><br><span class="line"> jmethodID methodID = env-&gt;GetMethodID( jclazz, <span class="string">"setString"</span>, <span class="string">"(Ljava/lang/String;)V"</span>);</span><br><span class="line"> <span class="comment">//将cpp文件中的字符串转化为java层的字符串jstring</span></span><br><span class="line"> jstring str=env-&gt;NewStringUTF(<span class="string">"this string is from c call java"</span>);</span><br><span class="line"> <span class="comment">//调用函数，第一个参数为JNIEnv对象，第二个参数为类对象，第三个参数为函数ID，C++中调用时无需JNIEnv参数</span></span><br><span class="line"> env-&gt;CallVoidMethod(object,methodID,str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码注释很详细，大家应该能够看懂。然后运行程序，依次点击void，int，参数为String三种情况对应的按钮，程序输出结果如下：</p><p><img src="/2022/03/15/NDK%E5%BC%80%E5%8F%91%E4%B9%8BJNI%E6%8A%80%E6%9C%AF/5.jpg" style="zoom: 100%;"></p><p>当点击void按钮时首先在MainActivity的java代码中调用了native函数callBackMethod()，然后在该函数中我们通过JNI中的一系列API接口反过来调用了java层的prinString函数，在该函数中将字符串”this string is from java code but it called by native code”赋值给NDKTest类的text成员变量，最终在MainActivity中通过TextView的setText函数将text显示在控件上。这样就完成了Java层和C++层相互调用的过程。</p><p>文章转载于：</p><p>​    公众号 [<strong>爱祺科技</strong>]：<a href="https://mp.weixin.qq.com/s/vdPQomwnobRfSuxw0mmWlw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/vdPQomwnobRfSuxw0mmWlw</a></p><p><strong>结束语</strong>：</p><p>​    今天的分享就到这里了，欢迎大家关注微信公众号 [<strong>菜鸟童靴</strong>]</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本篇文章，JNI技术&lt;/p&gt;
    
    </summary>
    
    
      <category term="爬虫" scheme="http://yoursite.com/categories/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="JNI" scheme="http://yoursite.com/tags/JNI/"/>
    
      <category term="逆向知识" scheme="http://yoursite.com/tags/%E9%80%86%E5%90%91%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>hexo发生error：spawn failed错误的解决方法</title>
    <link href="http://yoursite.com/2022/03/13/failed%E9%94%99%E8%AF%AF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"/>
    <id>http://yoursite.com/2022/03/13/failed%E9%94%99%E8%AF%AF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</id>
    <published>2022-03-13T13:48:33.000Z</published>
    <updated>2022-03-13T14:48:36.477Z</updated>
    
    <content type="html"><![CDATA[<p>小编使用hexo 写博客时，经历了很多次发文失败的问题，在上面浪费了很多时间，踩了很多的坑，很是苦恼，今天小编整理了下</p><p>发文不成功遇到的问题和解决办法，分享给大家，希望能让有问题的小伙伴，少走些弯路。</p><a id="more"></a><p><strong>1.检查本机是否有ssh key设置</strong></p><p>如果过没有的话，解决办法将本的id_rsa.pub秘钥复制到github上新建秘钥</p><p>（不要迷之自信，小编有一次去github仓库看了一下，发现的ssh key没了，入坑了好半天），</p><p>$ cd ~/.ssh 或cd .ssh</p><p><img src="/2022/03/13/failed%E9%94%99%E8%AF%AF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/1.png" style="zoom: 100%;"></p><p>如果重新设了一个也连接不上，继续向下看。</p><p><strong>2、创建config文件，换443端口</strong></p><p>在存放key的目录下新建config文件。</p><p>填入以下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">User 你GitHub的邮箱</span><br><span class="line">Hostname ssh.github.com</span><br><span class="line">PreferredAuthentications publickey</span><br><span class="line">IdentityFile ~&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line">Port 443</span><br></pre></td></tr></table></figure><p>然后用 ssh -T git@github.com命令测试能否连接</p><p>如果重新也连接不上，继续向下看。</p><p><strong>3、更改hexo文件下的_config.yml配置文件</strong></p><p>修改以下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">type: git</span><br><span class="line">repo: https:&#x2F;&#x2F;github.com&#x2F;yourname&#x2F;yourname.github.io.git</span><br><span class="line">branch: master</span><br><span class="line">其中的repo修改为</span><br><span class="line">git@github.com:yourname&#x2F;yourname.github.io.git</span><br></pre></td></tr></table></figure><p>如果也连接不上，继续向下看（这时候我们就该回头看看本机电脑能否访问github）。</p><p>看看是不是网络原因，ping  github.com 查看是否能ping通，果真了访问不了github</p><p>到了这里我可以使用科学上网的方式来解决，或者看我之前发的文章，</p><p><a href="https://mp.weixin.qq.com/s?__biz=MzI5ODYzMTkxMQ==&amp;mid=2247484031&amp;idx=1&amp;sn=2ef515cc09ebf069c5c769ebf0cc49da&amp;chksm=eca395f7dbd41ce14abd7666120fc65cc98b72858969e0057dadcc28d3c26e759039c3df4638&amp;token=2073142941&amp;lang=zh_CN#rd" target="_blank" rel="noopener">github访问慢，一直不成功，难道非得科学上网吗 (qq.com)</a></p><p><a href="https://boyyongxin.github.io/2022/03/06/github访问慢，一直不成功，难道非得科学上网吗/" target="_blank" rel="noopener">github 访问慢，一直不成功，难道非得科学上网吗 | 菜鸟童靴 (boyyongxin.github.io)</a></p><p>网页可以访问成功后，我们发现还是无法解决问题，先别急，那就继续向下看吧</p><p><strong>4、配置 代理</strong><br>windows 中 git 默认不会使用系统代理，所以即使连接代理或者打开代理软件，浏览器仍然可以访问 GitHub 或 Gitee；但是使用 git 命令行连接 GitHub 或 Gitee 远程仓库可能会出现无法访问的现象。通过为 git 配置代理解决出现的问题。</p><p>Windows、Linux、Mac OS 中 git 命令相同：</p><p>设置代理命令：</p><p><strong>（2）配置socks5代理</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.proxy socks5 192.138.43.112:31181</span><br><span class="line">git config --global https.proxy socks5 192.138.43.112:31181</span><br></pre></td></tr></table></figure><p><strong>（3）配置http代理</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.proxy 192.138.43.112:31181</span><br><span class="line">git config --global https.proxy 192.138.43.112:31181</span><br></pre></td></tr></table></figure><p><strong>注意事项：</strong></p><p>命令中的主机号（192.138.43.112）是使用的代理的主机号，如果代理软件运行在本机则填入127.0.0.1即可，否则填入代理主机 ip<br>命令中的端口号为代理软件或代理主机的监听IP，可以从代理服务器配置中获得<br>socks5和http两种协议由使用的代理软件决定，不同软件对这两种协议的支持有差异，如果不确定可以都尝试一下<br>查看代理命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global --get http.proxy</span><br><span class="line">git config --global --get https.proxy</span><br></pre></td></tr></table></figure><p>取消代理命令:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global --unset http.proxy</span><br><span class="line">git config --global --unset https.proxy</span><br></pre></td></tr></table></figure><p>最终发文成功</p><p><img src="/2022/03/13/failed%E9%94%99%E8%AF%AF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/2.jpg" style="zoom: 100%;"></p><p>是小编踩过的所有的坑了。</p><p><strong>结束语</strong>：</p><p>​    今天的分享就到这里了，欢迎大家关注微信公众号”<strong>菜鸟童靴</strong>“</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;小编使用hexo 写博客时，经历了很多次发文失败的问题，在上面浪费了很多时间，踩了很多的坑，很是苦恼，今天小编整理了下&lt;/p&gt;
&lt;p&gt;发文不成功遇到的问题和解决办法，分享给大家，希望能让有问题的小伙伴，少走些弯路。&lt;/p&gt;
    
    </summary>
    
    
      <category term="爬虫" scheme="http://yoursite.com/categories/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="hexo" scheme="http://yoursite.com/tags/hexo/"/>
    
      <category term="博客" scheme="http://yoursite.com/tags/%E5%8D%9A%E5%AE%A2/"/>
    
  </entry>
  
  <entry>
    <title>内网穿透原来这么容易就能搭建起来</title>
    <link href="http://yoursite.com/2022/03/11/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%8E%9F%E6%9D%A5%E8%BF%99%E4%B9%88%E5%AE%B9%E6%98%93%E5%B0%B1%E8%83%BD%E6%90%AD%E5%BB%BA%E8%B5%B7%E6%9D%A5/"/>
    <id>http://yoursite.com/2022/03/11/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%8E%9F%E6%9D%A5%E8%BF%99%E4%B9%88%E5%AE%B9%E6%98%93%E5%B0%B1%E8%83%BD%E6%90%AD%E5%BB%BA%E8%B5%B7%E6%9D%A5/</id>
    <published>2022-03-11T02:10:32.000Z</published>
    <updated>2022-03-11T03:10:08.116Z</updated>
    
    <content type="html"><![CDATA[<p><strong>前言：</strong></p><p>​    在局域网搭建了个服务，外网想访问怎么办呢，别担心今天小编带来个开源免费的工具？</p><a id="more"></a><h2 id="1、什么是内网穿透"><a href="#1、什么是内网穿透" class="headerlink" title="1、什么是内网穿透?"></a><strong>1、什么是内网穿透?</strong></h2><p><strong>首先解释一下“内网”与“外网”的概念：</strong></p><p><strong>内网</strong>：即所说的局域网，比如学校的局域网，局域网内每台计算机的IP地址在本局域网内具有互异性，是不可重复的。但两个局域网内的内网IP可以有相同的。</p><p><strong>外网</strong>：即互联网，局域网通过一台服务器或是一个路由器对外连接的网络，这个IP地址是唯一的。也就是说内网里所有的计算机都是连接到这一个外网IP上，通过这一个外网IP对外进行交换数据的。也就是说，一个局域网里所有电脑的内网IP是互不相同的,但共用一个外网IP。（用ipconfig/all查到的IP是你本机的内网IP；在<a href="https://link.zhihu.com/?target=http%3A//www.ip138.com">http://www.ip138.com</a>上看到的是你连接互联网所使用的IP，即外网）。</p><p>​    </p><h2 id="2、钉钉提供的内网穿透工具"><a href="#2、钉钉提供的内网穿透工具" class="headerlink" title="2、钉钉提供的内网穿透工具"></a>2、钉钉提供的内网穿透工具</h2><p><strong>（1）github网址：</strong></p><h3 id="https-github-com-open-dingtalk-pierced"><a href="#https-github-com-open-dingtalk-pierced" class="headerlink" title="https://github.com/open-dingtalk/pierced"></a><a href="https://github.com/open-dingtalk/pierced" target="_blank" rel="noopener">https://github.com/open-dingtalk/pierced</a></h3><p><strong>（2）介绍</strong></p><p>本仓库及以下说明来自钉钉官方开发文档。</p><blockquote><p>注意：鉴于很多开发者在临时体验开发时往往没有公网域名或者公网IP，本工具提供了一个公网代理服务，目的是方便开发测试。</p><p>本工具当前不保证多个开发者随意设置相同的子域名导致的冲突以及通道稳定性，因此正式应用、正式环境必须是真实的公网IP或者域名，正式应用上线绝对不能使用本工具。</p></blockquote><h3 id="内网穿透示意图"><a href="#内网穿透示意图" class="headerlink" title="内网穿透示意图"></a>内网穿透示意图</h3><p><img src="/2022/03/11/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%8E%9F%E6%9D%A5%E8%BF%99%E4%B9%88%E5%AE%B9%E6%98%93%E5%B0%B1%E8%83%BD%E6%90%AD%E5%BB%BA%E8%B5%B7%E6%9D%A5/tunnel.png" style="zoom: 150%;"></p><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><h3 id="HTTP-穿透"><a href="#HTTP-穿透" class="headerlink" title="HTTP 穿透"></a>HTTP 穿透</h3><ol><li><p>下载工具</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;open-dingtalk&#x2F;pierced.git</span><br></pre></td></tr></table></figure></li><li><p>执行命令 <code>./ding -config=./ding.cfg -subdomain=域名前缀 端口</code>。</p><p>以 Mac 为例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd mac_64</span><br><span class="line">chmod 777 .&#x2F;ding</span><br><span class="line">.&#x2F;ding -config&#x3D;.&#x2F;ding.cfg -subdomain&#x3D;abcde 8080</span><br></pre></td></tr></table></figure><p>Windows：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd windows_64</span><br><span class="line">.&#x2F;ding -config ding.cfg -subdomain abcde 8080</span><br></pre></td></tr></table></figure></li></ol><h2 id="3、下面小编以windows为例做个测试："><a href="#3、下面小编以windows为例做个测试：" class="headerlink" title="3、下面小编以windows为例做个测试："></a>3、<strong>下面小编以windows为例做个测试：</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意 -subdomain 后面的参数，最好复杂一些，避免有人已经使用，导致操作不成功</span><br></pre></td></tr></table></figure><p>（1）搭建服务端server</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Created on 2021-12-13 16:29:25</span></span><br><span class="line"><span class="string">---------</span></span><br><span class="line"><span class="string">@summary:</span></span><br><span class="line"><span class="string">---------</span></span><br><span class="line"><span class="string">@author: yangyx01</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">from</span> starlette.responses <span class="keyword">import</span> JSONResponse  <span class="comment"># 此类型不可少</span></span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Response, Request</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> APIRouter</span><br><span class="line"><span class="keyword">from</span> fastapi.middleware.cors <span class="keyword">import</span> CORSMiddleware</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Header</span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line">REDIS_HOST = <span class="string">'127.0.0.1'</span></span><br><span class="line">REDIS_PORT = <span class="number">6379</span></span><br><span class="line">REDIS_DB = <span class="number">1</span></span><br><span class="line">redis_client = redis.ConnectionPool(host=REDIS_HOST, port=REDIS_PORT, db=REDIS_DB, max_connections=<span class="number">1</span>,</span><br><span class="line">                                    decode_responses=<span class="literal">True</span>)</span><br><span class="line">redis_db = redis.StrictRedis(connection_pool=redis_client)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">startup</span><span class="params">()</span>:</span></span><br><span class="line">    logger.warning(<span class="string">"服务已启动！"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shutdown</span><span class="params">()</span>:</span></span><br><span class="line">    logger.warning(<span class="string">"服务已关闭！"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = FastAPI(on_startup=[startup], on_shutdown=[shutdown])</span><br><span class="line"></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">"*"</span>]</span><br><span class="line"></span><br><span class="line">app.add_middleware(</span><br><span class="line">    CORSMiddleware,</span><br><span class="line">    allow_origins=ALLOWED_HOSTS,</span><br><span class="line">    allow_credentials=<span class="literal">True</span>,</span><br><span class="line">    allow_methods=[<span class="string">"*"</span>],</span><br><span class="line">    allow_headers=[<span class="string">"*"</span>],</span><br><span class="line">)</span><br><span class="line">app.debug = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">bp = APIRouter(tags=[<span class="string">'内网穿透测试'</span>], prefix=<span class="string">'/api/v1'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.middleware("http")</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">add_process_time_header</span><span class="params">(request: Request, call_next)</span>:</span></span><br><span class="line">    start_time = time.time()</span><br><span class="line">    response = <span class="keyword">await</span> call_next(request)</span><br><span class="line">    process_time = time.time() - start_time</span><br><span class="line">    response.headers[<span class="string">"X-Process-Time"</span>] = str(process_time)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@bp.put("/callback_client", summary='callback主动调用接口', description='callback主动调用接口', tags=['callback_client'])</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">callback_client</span><span class="params">(action: str, request: Request, response: Response)</span>:</span></span><br><span class="line">    _body = <span class="keyword">await</span> request.body()</span><br><span class="line">    _header = request.headers</span><br><span class="line">    data_info = json.loads(_body)</span><br><span class="line">    <span class="keyword">if</span> action == <span class="string">'pull_task'</span>:</span><br><span class="line">        logger.debug(<span class="string">"添加任务到redis队列，主动回调接口"</span>)</span><br><span class="line">        <span class="keyword">if</span> data_info.get(<span class="string">"data"</span>, &#123;&#125;) != &#123;&#125;:</span><br><span class="line">            logger.debug(<span class="string">f"callback_client : <span class="subst">&#123;data_info&#125;</span>"</span>)</span><br><span class="line">            redis_db.lpush(<span class="string">"wxtools_callback"</span>, json.dumps(data_info))</span><br><span class="line">            <span class="keyword">return</span> JSONResponse(data_info)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            redis_db.lpush(<span class="string">"wxtools_callback"</span>, json.dumps(data_info))</span><br><span class="line">            <span class="keyword">return</span> JSONResponse(&#123;<span class="string">"code"</span>: <span class="number">-1</span>&#125;)</span><br><span class="line">    <span class="keyword">return</span> JSONResponse(json.dumps(&#123;<span class="string">"code"</span>: <span class="number">1</span>&#125;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@bp.get("/index", summary='测试主页', description='测试主页', tags=['index'])</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">callback_client</span><span class="params">(request: Request, response: Response)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> JSONResponse(&#123;<span class="string">"code"</span>: <span class="number">1</span>, <span class="string">"res"</span>: <span class="string">"内网穿透成功"</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加路由组</span></span><br><span class="line">app.include_router(bp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    uvicorn.run(app=<span class="string">'callback_server:app'</span>, host=<span class="string">"0.0.0.0"</span>, workers=<span class="number">1</span>, port=<span class="number">7883</span>, reload=<span class="literal">True</span>, debug=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># nohup python3 server.py &gt;/dev/null 2&gt;&amp;1 &amp;</span></span><br></pre></td></tr></table></figure><p><strong>（2） pull代码进入windows目录下</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd windows_64</span><br><span class="line">.&#x2F;ding -config ding.cfg -subdomain dengta123456 7883</span><br></pre></td></tr></table></figure><p>运行后结果显示：</p><p><img src="/2022/03/11/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%8E%9F%E6%9D%A5%E8%BF%99%E4%B9%88%E5%AE%B9%E6%98%93%E5%B0%B1%E8%83%BD%E6%90%AD%E5%BB%BA%E8%B5%B7%E6%9D%A5/1.jpg" style="zoom: 150%;"></p><p><strong>（4）测试是够成功，我们在外网访问下 index和callback_client 接口</strong></p><p><img src="/2022/03/11/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%8E%9F%E6%9D%A5%E8%BF%99%E4%B9%88%E5%AE%B9%E6%98%93%E5%B0%B1%E8%83%BD%E6%90%AD%E5%BB%BA%E8%B5%B7%E6%9D%A5/3.jpg" style="zoom: 150%;"></p><p><img src="/2022/03/11/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%8E%9F%E6%9D%A5%E8%BF%99%E4%B9%88%E5%AE%B9%E6%98%93%E5%B0%B1%E8%83%BD%E6%90%AD%E5%BB%BA%E8%B5%B7%E6%9D%A5/2.jpg" style="zoom: 150%;"></p><p>完美成功，更多的功能，请移步官网，参考教程</p><p><strong>（4）tips:</strong></p><p>frp也是免费的，而且贼好使。但是 frp前提自己要有公网ip，云服务器之类的。</p><p><strong>结束语</strong>：</p><p>​    今天的分享就到这里了，欢迎大家关注微信公众号<strong>菜鸟童靴</strong></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;前言：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;​    在局域网搭建了个服务，外网想访问怎么办呢，别担心今天小编带来个开源免费的工具？&lt;/p&gt;
    
    </summary>
    
    
      <category term="技术杂谈" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="内网穿透" scheme="http://yoursite.com/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"/>
    
      <category term="测试" scheme="http://yoursite.com/tags/%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>mitmproxy-ca-cert.pem证书安装不上，终极解决办法手机证书文件安装</title>
    <link href="http://yoursite.com/2022/03/10/mitmproxy-ca-cert-pem%E8%AF%81%E4%B9%A6%E5%AE%89%E8%A3%85%E4%B8%8D%E4%B8%8A%EF%BC%8C%E7%BB%88%E6%9E%81%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95%E6%89%8B%E6%9C%BA%E8%AF%81%E4%B9%A6%E6%96%87%E4%BB%B6%E5%AE%89%E8%A3%85/"/>
    <id>http://yoursite.com/2022/03/10/mitmproxy-ca-cert-pem%E8%AF%81%E4%B9%A6%E5%AE%89%E8%A3%85%E4%B8%8D%E4%B8%8A%EF%BC%8C%E7%BB%88%E6%9E%81%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95%E6%89%8B%E6%9C%BA%E8%AF%81%E4%B9%A6%E6%96%87%E4%BB%B6%E5%AE%89%E8%A3%85/</id>
    <published>2022-03-10T08:43:58.000Z</published>
    <updated>2022-03-10T09:58:11.715Z</updated>
    
    <content type="html"><![CDATA[<p>mitmproxy-ca-cert.pem证书安装不上,终极解决办法手机证书文件安装</p><a id="more"></a><p><strong>在mitmproxy软件证书配置中，其中手机的证书安装过程一般为：</strong></p><p>​    将mitmproxy-ca-cert.pem”文件发送到手机上，点击证书文件，便会出现一个安装窗口。</p><p>但是，我的Android手机并不识别pem文件，如华为荣耀10 ，华为Nova青春版。</p><p><strong>解决方法为：</strong></p><p>（打开手机“设置”；选择“安全和隐私”；点击“更多安全设置”，找到“从SD卡安装”；搜索该证书文件，点击安装.）</p><p>1  设置</p><p>2 安全与隐私</p><p>3 更多安全设置</p><p>4 从存储设备安装</p><p>5 选中证书文件，点击安装</p><p>6 输入锁屏密码</p><p>7 给安装文件命名mitmproxy</p><p>8 结束了，完成安装！！！</p><p><strong>结束语</strong>：</p><p>​    今天的分享就到这里了，欢迎大家关注微信公众号”<strong>菜鸟童靴</strong>“</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;mitmproxy-ca-cert.pem证书安装不上,终极解决办法手机证书文件安装&lt;/p&gt;
    
    </summary>
    
    
      <category term="技术杂谈" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="科学上网" scheme="http://yoursite.com/tags/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"/>
    
      <category term="mitmproxy" scheme="http://yoursite.com/tags/mitmproxy/"/>
    
  </entry>
  
  <entry>
    <title>Android10不能使用uiautomatorviewer定位元素的终极解决</title>
    <link href="http://yoursite.com/2022/03/10/Android10%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8uiautomatorviewer%E5%AE%9A%E4%BD%8D%E5%85%83%E7%B4%A0%E7%9A%84%E7%BB%88%E6%9E%81%E8%A7%A3%E5%86%B3/"/>
    <id>http://yoursite.com/2022/03/10/Android10%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8uiautomatorviewer%E5%AE%9A%E4%BD%8D%E5%85%83%E7%B4%A0%E7%9A%84%E7%BB%88%E6%9E%81%E8%A7%A3%E5%86%B3/</id>
    <published>2022-03-10T07:34:27.000Z</published>
    <updated>2022-03-10T08:04:37.307Z</updated>
    
    <content type="html"><![CDATA[<p>Android app 元素定位除了使用Appium 、Inspector 、Airtest外，还可以使用Android SDK 里tools中的uiautomatorviewer 工具。</p><a id="more"></a><p>但今天打算使用 uiautomatorviewer 进行元素定位的时候，发现无法截图，并报如下错误：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Unexpected</span> <span class="selector-tag">error</span> <span class="selector-tag">while</span> <span class="selector-tag">obtaining</span> <span class="selector-tag">UI</span> <span class="selector-tag">hierarchy</span></span><br></pre></td></tr></table></figure><p><strong>点击Details</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.reflect.InvocationTargetException</span><br></pre></td></tr></table></figure><p><img src="/2022/03/10/Android10%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8uiautomatorviewer%E5%AE%9A%E4%BD%8D%E5%85%83%E7%B4%A0%E7%9A%84%E7%BB%88%E6%9E%81%E8%A7%A3%E5%86%B3/1.jpg" style="zoom: 50%;"></p><p><strong>原先使用过啊，没一点问题啊</strong>：</p><p>查找资料了解到，从Android 8.0开始，SDK 工具软件包在新版本中已经弃用，所以tools里的uiautomatorviewer工具都不支持了。于是开始查找解决方法。</p><p><strong>查找资料找到解决办法</strong>：</p><p>1，使用adb命令截图，再导入uiautomatorviewer进行定位。这种方法虽然可行，但太麻烦了。</p><p>2，下载修改过的 uiautomatorviewer.bat，将tools里的uiautomatorviewer.bat文件替换掉。</p><p><strong>3，终极方法！！！！将SDK目录中tools文件夹下lib中的ddmlib、ddms、ddmuilib 、uiautomatorviewer这四个jar文件替换掉即可。下面是这四个新文件的下载地址：</strong></p><p> 链接：<a href="https://pan.baidu.com/s/1NIPNk8ApQIPveVkAfVOpJA" target="_blank" rel="noopener">https://pan.baidu.com/s/1NIPNk8ApQIPveVkAfVOpJA</a><br> 提取码：k5rc<br> <strong>替换完成后，重新打开tools中uiautomatorviewer.bat即可进行元素定位。</strong></p><p><img src="/2022/03/10/Android10%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8uiautomatorviewer%E5%AE%9A%E4%BD%8D%E5%85%83%E7%B4%A0%E7%9A%84%E7%BB%88%E6%9E%81%E8%A7%A3%E5%86%B3/end.jpg" style="zoom: 50%;"></p><p><strong>结束语</strong>：</p><p>​    今天的分享就到这里了，欢迎大家关注微信公众号<strong>菜鸟童靴</strong></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Android app 元素定位除了使用Appium 、Inspector 、Airtest外，还可以使用Android SDK 里tools中的uiautomatorviewer 工具。&lt;/p&gt;
    
    </summary>
    
    
      <category term="爬虫" scheme="http://yoursite.com/categories/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="自动化" scheme="http://yoursite.com/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    
      <category term="ui" scheme="http://yoursite.com/tags/ui/"/>
    
  </entry>
  
  <entry>
    <title>Autojs通过VSCode电脑进行调试</title>
    <link href="http://yoursite.com/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/"/>
    <id>http://yoursite.com/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/</id>
    <published>2022-03-10T05:09:52.000Z</published>
    <updated>2022-03-10T05:37:52.849Z</updated>
    
    <content type="html"><![CDATA[<p>hello 大家好我是Monday，今天给大家带来一篇关于自动化的文章，Auto js如何通过VS Code电脑进行调试？</p><a id="more"></a><h2 id="前提："><a href="#前提：" class="headerlink" title="前提："></a>前提：</h2><p>首先手机里面安装AutoJs app, 官方代码，</p><p>apk 在release 里面下载： <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fhyb1996%2FAuto.js" target="_blank" rel="noopener">https://github.com/hyb1996/Auto.js</a></p><p>官方下载VS code:  <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fcode.visualstudio.com%2F" target="_blank" rel="noopener">https://code.visualstudio.com/</a></p><h2 id="一、vscode启动Auto-js"><a href="#一、vscode启动Auto-js" class="headerlink" title="一、vscode启动Auto.js"></a>一、vscode启动Auto.js</h2><h3 id="1-vscode里安装auto-js插件"><a href="#1-vscode里安装auto-js插件" class="headerlink" title="1.vscode里安装auto.js插件"></a>1.vscode里安装auto.js插件</h3><p><img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/1.png" style="zoom: 100%;"></p><h3 id="2-ctrl-shift-p调出命令面板"><a href="#2-ctrl-shift-p调出命令面板" class="headerlink" title="2.ctrl + shift + p调出命令面板"></a>2.ctrl + shift + p调出命令面板</h3><p><img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/2.png" style="zoom: 100%;"></p><p> <img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/3.png" style="zoom: 100%;"></p><h2 id="二、连接手机操作"><a href="#二、连接手机操作" class="headerlink" title="二、连接手机操作"></a>二、连接手机操作</h2><h3 id="1、ipconfig查看自己本机ip"><a href="#1、ipconfig查看自己本机ip" class="headerlink" title="1、ipconfig查看自己本机ip"></a>1、ipconfig查看自己本机ip</h3><h3 id="2、手机打开Auto-js侧边选项卡—-gt-连接电脑——-gt-输入ip地址。与电脑同意局域网，或者手机连接电脑无线"><a href="#2、手机打开Auto-js侧边选项卡—-gt-连接电脑——-gt-输入ip地址。与电脑同意局域网，或者手机连接电脑无线" class="headerlink" title="2、手机打开Auto.js侧边选项卡—-&gt;连接电脑——&gt;输入ip地址。与电脑同意局域网，或者手机连接电脑无线"></a>2、手机打开Auto.js侧边选项卡—-&gt;连接电脑——&gt;输入ip地址。与电脑同意局域网，或者手机连接电脑无线</h3><p><img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/4.png" style="zoom: 100%;"></p><h4 id="此时可以看到连接成功"><a href="#此时可以看到连接成功" class="headerlink" title="此时可以看到连接成功"></a>此时可以看到连接成功</h4><p><img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/5.png" style="zoom: 100%;"></p><p> 在vscode里新建js文件，按f5或命令run，就可以在手机上运行</p><p><img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/6.png" style="zoom: 100%;"></p><p>手机弹出toast</p><p><img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/7.png" style="zoom: 100%;"></p><p>保存文件，ctrl + shift + p</p><p><img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/8.png" style="zoom: 100%;"></p><p> 可以看到连接的手机信息，选择就能保存成功</p><p><img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/9.png" style="zoom: 100%;"></p><p> <img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/10.png" style="zoom: 100%;"></p><p><img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/11.png" style="zoom: 100%;"></p><h1 id="插件常用命令"><a href="#插件常用命令" class="headerlink" title="插件常用命令"></a>插件常用命令</h1><p>Start Server: 启动插件服务。之后在确保手机和电脑在同一区域网的情况下，在Auto.js的侧拉菜单中使用连接电脑功能连接。<br>Stop Server: 停止插件服务。<br>Run 运行当前编辑器的脚本。如果有多个设备连接，则在所有设备运行。<br>Rerun 停止当前文件对应的脚本并重新运行。如果有多个设备连接，则在所有设备重新运行。<br>Stop 停止当前文件对应的脚本。如果有多个设备连接，则在所有设备停止。<br>StopAll 停止所有正在运行的脚本。如果有多个设备连接，则在所有设备运行所有脚本。<br>Save 保存当前文件到手机的脚本默认目录（文件名会加上前缀remote)。如果有多个设备连接，则在所有设备保存。<br>RunOnDevice: 弹出设备菜单并在指定设备运行脚本。<br>SaveToDevice: 弹出设备菜单并在指定设备保存脚本。<br>New Project（新建项目）：选择一个空文件夹（或者在文件管理器中新建一个空文件夹），将会自动创建一个项目<br>Run Project（运行项目）：运行一个项目，需要Auto.js 4.0.4Alpha5以上支持<br>Save Project（保存项目）：保存一个项目，需要Auto.js 4.0.4Alpha5以上支持</p><p><strong>结束语</strong>：</p><p>​    今天的分享就到这里了，欢迎大家关注微信公众号”<strong>菜鸟童靴</strong>“</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;hello 大家好我是Monday，今天给大家带来一篇关于自动化的文章，Auto js如何通过VS Code电脑进行调试？&lt;/p&gt;
    
    </summary>
    
    
      <category term="爬虫" scheme="http://yoursite.com/categories/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="自动化" scheme="http://yoursite.com/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    
      <category term="爬虫" scheme="http://yoursite.com/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>mitmproxy安装和使用方法总结</title>
    <link href="http://yoursite.com/2022/03/09/mitmproxy%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/"/>
    <id>http://yoursite.com/2022/03/09/mitmproxy%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/</id>
    <published>2022-03-09T09:08:15.000Z</published>
    <updated>2022-03-09T09:11:16.771Z</updated>
    
    <content type="html"><![CDATA[<hr><p>笔记_mitmproxy安装和使用方法总结</p><a id="more"></a><p><strong>MitmProxy 介绍</strong>：</p><p>支持 HTTP 和 HTTPS 的抓包程序，类似 Fiddler、Charles 的功能，只不过它是一个控制台的形式操作。<br>同时 MitmProxy 还有两个关联组件，一个是 MitmDump，它是 MitmProxy 的命令行接口，利用它我们可以对接 Python 脚本，用 Python 实现监听后的处理。另一个是 MitmWeb，它是一个 Web 程序，通过它我们可以清楚地观察到 MitmProxy 捕获的请求。</p><p><strong>相关链接</strong></p><p>mitmproxy不错的中文学习网站 <a href="https://blog.wolfogre.com/posts/usage-of-mitmproxy/" target="_blank" rel="noopener">https://blog.wolfogre.com/posts/usage-of-mitmproxy/</a> </p><p>GitHub：<a href="https://github.com/mitmproxy/mitmproxy" target="_blank" rel="noopener">https://github.com/mitmproxy/mitmproxy</a><br>官方网站：<a href="https://mitmproxy.org" target="_blank" rel="noopener">https://mitmproxy.org</a><br>PyPi：<a href="https://pypi.python.org/pypi/mitmproxy" target="_blank" rel="noopener">https://pypi.python.org/pypi/mitmproxy</a><br>官方文档：<a href="http://docs.mitmproxy.org" target="_blank" rel="noopener">http://docs.mitmproxy.org</a><br>MitmDump脚本：<a href="http://docs.mitmproxy.org/en/stable/scripting/overview.html" target="_blank" rel="noopener">http://docs.mitmproxy.org/en/stable/scripting/overview.html</a><br>下载地址：<a href="https://github.com/mitmproxy/mitmproxy/releases" target="_blank" rel="noopener">https://github.com/mitmproxy/mitmproxy/releases</a><br>DockerHub：<a href="https://hub.docker.com/r/mitmproxy/mitmproxy" target="_blank" rel="noopener">https://hub.docker.com/r/mitmproxy/mitmproxy</a></p><p>报错可能解决方案： <a href="https://blog.csdn.net/andrew_wf/article/details/84991989" target="_blank" rel="noopener">https://blog.csdn.net/andrew_wf/article/details/84991989</a> </p><p><strong>安装：</strong></p><p> pip install mitmproxy </p><p> 这是最简单和通用的安装方式，执行完毕之后即可完成 MitmProxy的安装，另外还安装了MitmDump、MitmWeb 两个组件 </p><p><strong>安装证书</strong></p><p>安装好mitmproxy后，到C:\Users\Administrator.mitmproxy目录下</p><p><strong>电脑安装证书：</strong><br>mitmproxy-ca.p12</p><p>双击下一，直到最后</p><p><strong>手机安装证书：</strong><br>mitmproxy-ca.pem</p><p><strong>手机模拟器安装证书：</strong></p><p>mitmproxy-ca.pem</p><p>设置-安全-从SD卡导入证书即可</p><p><strong>这样我们就可以愉快的使用mitmproxy去搞一些事情了：</strong></p><p><strong>我下面用它抓取一下，皮皮虾app推荐模块抓取：</strong></p><p>首先建立两个py文件，一个用于app的视频json信息的抓取</p><p><strong>(1)get_request_data.py</strong>  :</p><p>用来获取视频列表的url和headers</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">'../'</span>)</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> mitmproxy</span><br><span class="line"><span class="keyword">from</span> mitmproxy <span class="keyword">import</span> http</span><br><span class="line"><span class="keyword">from</span> mitmproxy <span class="keyword">import</span> flow, proxy, controller, options</span><br><span class="line"><span class="keyword">from</span> mitmproxy.proxy.server <span class="keyword">import</span> ProxyServer</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">程序运行</span></span><br><span class="line"><span class="string"> mitmdump -s xxxx.py</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">response</span><span class="params">(flow)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'https://it.snssdk.com/bds/feed/stream/'</span> <span class="keyword">in</span> flow.request.url:</span><br><span class="line">        datas = flow.request.headers</span><br><span class="line">        headers = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> k,v <span class="keyword">in</span> datas.items():</span><br><span class="line">            headers[k] = v</span><br><span class="line">        print(<span class="string">f'root_url&gt;&gt;&gt;<span class="subst">&#123;flow.request.url&#125;</span>&lt;&lt;&lt;headers&gt;&gt;&gt;<span class="subst">&#123;headers&#125;</span>&lt;&lt;&lt;'</span>)</span><br></pre></td></tr></table></figure><p><strong>(2)spider_data.py</strong>  :</p><p>对获取到url和headers进行对视频信息的抓取</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">管道执行命令</span></span><br><span class="line"><span class="string"> mitmdump -s &lt;python1.y&gt; | python &lt;python2.py&gt;</span></span><br><span class="line"><span class="string">  mitmdump -s test.py | python receive.py</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">from</span> jsonpath <span class="keyword">import</span> jsonpath</span><br><span class="line"><span class="keyword">from</span> glom <span class="keyword">import</span> glom</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> sys.stdin:</span><br><span class="line">    root_url = re.search(<span class="string">'root_url&gt;&gt;&gt;(.*?)&lt;&lt;&lt;'</span>, line)</span><br><span class="line">    headers = re.search(<span class="string">'headers&gt;&gt;&gt;(.*?)&lt;&lt;&lt;'</span>, line)</span><br><span class="line">    <span class="keyword">if</span> root_url <span class="keyword">and</span> headers:</span><br><span class="line">        html = requests.get(root_url.group(<span class="number">1</span>),headers=eval(headers.group(<span class="number">1</span>)))</span><br><span class="line">        html.encoding = <span class="string">'utf-8'</span></span><br><span class="line">        data_info = html.json()</span><br><span class="line"></span><br><span class="line">        data_list = glom(data_info, <span class="string">'data.data'</span>)</span><br><span class="line">        <span class="keyword">for</span> datas <span class="keyword">in</span> data_list:</span><br><span class="line">            data = glom(datas, <span class="string">'item.share'</span>)</span><br><span class="line">            title = <span class="string">''</span>.join(jsonpath(data, <span class="string">"$..title"</span>))</span><br><span class="line">            url = <span class="string">''</span>.join(jsonpath(data, <span class="string">"$..compound_page_url"</span>))</span><br><span class="line">            image_url = <span class="string">''</span>.join(jsonpath(data, <span class="string">"$..image_url"</span>))</span><br><span class="line">            video_url = glom(datas, <span class="string">'item.origin_video_download.url_list'</span>)[<span class="number">0</span>].get(<span class="string">'url'</span>)</span><br><span class="line"></span><br><span class="line">            release_time = datas[<span class="string">'item'</span>][<span class="string">'create_time'</span>]</span><br><span class="line">            print(title)</span><br><span class="line">            print(url)</span><br><span class="line">            print(image_url)</span><br><span class="line">            print(video_url)</span><br><span class="line">            print(release_time)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p><strong>怎么运行：</strong></p><p>进入cmd，窗口</p><p>mitmdump -s get_request_data.py | python spider_data.py</p><p>在手机端滑动就行了</p><p><strong>总结：</strong></p><p>中间抓取思路有很多种，get_request_data.py在文件里print()的信息写到文件里或数据库里，mitmdump -s get_request_data.py  在窗口执行这个命令，我们单独在写个程序，扫描数据库或文件，单独进行抓取数据</p><p>本文这个，只是小编想用一下，管道命令，</p><p><strong>结束语</strong>：</p><p> 今天的分享就到这里了，欢迎大家关注微信公众号”<strong>菜鸟童靴</strong>“</p>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;笔记_mitmproxy安装和使用方法总结&lt;/p&gt;
    
    </summary>
    
    
      <category term="技术杂谈" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="科学上网" scheme="http://yoursite.com/tags/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"/>
    
      <category term="mitmproxy" scheme="http://yoursite.com/tags/mitmproxy/"/>
    
  </entry>
  
  <entry>
    <title>安卓7.0以上手机写入安全证书</title>
    <link href="http://yoursite.com/2022/03/09/%E5%AE%89%E5%8D%937-0%E4%BB%A5%E4%B8%8A%E6%89%8B%E6%9C%BA%E5%86%99%E5%85%A5%E5%AE%89%E5%85%A8%E8%AF%81%E4%B9%A6/"/>
    <id>http://yoursite.com/2022/03/09/%E5%AE%89%E5%8D%937-0%E4%BB%A5%E4%B8%8A%E6%89%8B%E6%9C%BA%E5%86%99%E5%85%A5%E5%AE%89%E5%85%A8%E8%AF%81%E4%B9%A6/</id>
    <published>2022-03-09T08:14:48.000Z</published>
    <updated>2022-03-10T07:36:21.426Z</updated>
    
    <content type="html"><![CDATA[<p>安卓7.0以上手机写入安全证书，具体操作？</p><a id="more"></a><h3 id="1、背景："><a href="#1、背景：" class="headerlink" title="1、背景："></a><strong>1、背景：</strong></h3><p>谷歌在安卓7.0修改了安全策略，用户添加的CA证书不能再用于安全连接，</p><p>对于https传输的数据就抓取不到了，会显示<strong>“<unknown></unknown></strong>“。</p><p>既然又知道了原因，那就总还是有办法去解决的。我们只要把代理软件的根证书安装成系统证书就可以了。</p><h3 id="2、解决方法及操作方法"><a href="#2、解决方法及操作方法" class="headerlink" title="2、解决方法及操作方法"></a><strong>2、解决方法及操作方法</strong></h3><p>实际上将证书安装到系统区操作还是相对简单的，</p><p><strong>（1）将证书用指定的名称放到指定的位置就可以了</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;system&#x2F;etc&#x2F;security&#x2F;cacerts&#x2F;</span><br></pre></td></tr></table></figure><p><strong>（2）先将我们的根证书名称改为</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Certificate_Hash&gt;.&lt;Number&gt;</span><br></pre></td></tr></table></figure><p>Certificate_Hash表示证书文件的hash值，Number是为了防止证书文件的hash值一致而增加的后缀（用0就行了）</p><p><strong>（3）下载自己的根证书FiddlerRoot.cer，使用</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -subject_hash_old -in &lt;Certificate_File&gt;</span><br></pre></td></tr></table></figure><p><img src="/2022/03/09/%E5%AE%89%E5%8D%937-0%E4%BB%A5%E4%B8%8A%E6%89%8B%E6%9C%BA%E5%86%99%E5%85%A5%E5%AE%89%E5%85%A8%E8%AF%81%E4%B9%A6/1.jpg" style="zoom: 150%;"></p><p>计算证书hash ，根据hash将证书重命名为 c8750f0d.0（c8750f0d.0是笔者证书的hash，大家的肯定不一样）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp ***.pem c8750f0d.0</span><br></pre></td></tr></table></figure><p>然后将c8750f0d.0文件复制到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;system&#x2F;etc&#x2F;security&#x2F;cacerts&#x2F;</span><br></pre></td></tr></table></figure><p><img src="/2022/03/09/%E5%AE%89%E5%8D%937-0%E4%BB%A5%E4%B8%8A%E6%89%8B%E6%9C%BA%E5%86%99%E5%85%A5%E5%AE%89%E5%85%A8%E8%AF%81%E4%B9%A6/2.jpg" style="zoom: 150%;"></p><p>完成后我们就可以看到代理软件的证书出现在系统区了。</p><p><strong>这里还有一点需要单独说明，/system/etc/security/cacerts/目录的写权限，需要手机root权限。</strong></p><h3 id="3、将证书安装到System中"><a href="#3、将证书安装到System中" class="headerlink" title="3、将证书安装到System中"></a>3、将证书安装到System中</h3><p>不要直接用adb push，安卓5以后有问题，不通用。</p><p><strong>（1）重启adb，作为root启动</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb root</span><br></pre></td></tr></table></figure><p><strong>（2）获取Android设备上访问/system的权限</strong></p><p>在早期的Android版本中（API LEVEL &lt; 28），需要使用如下命令获得访问权限：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell su -c &quot;mount -o rw,remount &#x2F;system&quot;</span><br></pre></td></tr></table></figure><p>API LEVEL &gt;= 29，否则，使用如下命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell su -c &quot;mount -o rw,remount &#x2F;system&quot;</span><br></pre></td></tr></table></figure><p>（<strong>3）将自己的证书push到系统证书目录</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb push c8750f0d.0 &#x2F;system&#x2F;etc&#x2F;security&#x2F;cacerts </span><br><span class="line">adb shell &quot;chmod 664 &#x2F;system&#x2F;etc&#x2F;security&#x2F;cacerts&#x2F;c8750f0d.0&quot;</span><br></pre></td></tr></table></figure><p><img src="/2022/03/09/%E5%AE%89%E5%8D%937-0%E4%BB%A5%E4%B8%8A%E6%89%8B%E6%9C%BA%E5%86%99%E5%85%A5%E5%AE%89%E5%85%A8%E8%AF%81%E4%B9%A6/3.jpg" style="zoom: 150%;"></p><h4 id="3-1、如果失敗了，解决办法："><a href="#3-1、如果失敗了，解决办法：" class="headerlink" title="3.1、如果失敗了，解决办法："></a><strong>3.1、如果失敗了，解决办法：</strong></h4><p>（<strong>1）通过微信传输文件后，点击保存文件到手机，</strong> </p><p>​        文件的目录存放的位置： /sdcard/Download/WeiXin</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mido:&#x2F;sdcard&#x2F;Download&#x2F;WeiXin # pwd</span><br><span class="line">&#x2F;sdcard&#x2F;Download&#x2F;WeiXin</span><br><span class="line">mido:&#x2F;sdcard&#x2F;Download&#x2F;WeiXin # cp c8750f0d.0 &#x2F;system&#x2F;etc&#x2F;security&#x2F;cacerts&#x2F;</span><br><span class="line">mido:&#x2F;sdcard&#x2F;Download&#x2F;WeiXin #</span><br></pre></td></tr></table></figure><p><strong>（2）如果修改了之后还是提示Read-only file system，还有方法</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">adb root</span><br><span class="line"></span><br><span class="line">adb disable-verity</span><br><span class="line"></span><br><span class="line">adb reboot #手机会重启，不用关闭cmd窗口，手机可能需要拔掉数据写重新连接</span><br><span class="line"></span><br><span class="line">adb root</span><br><span class="line"></span><br><span class="line">adb shell </span><br><span class="line"></span><br><span class="line">mount -o rw,remount &#x2F;system  #再次进行修改</span><br></pre></td></tr></table></figure><p><strong>(3)如果还是错误还是报错’/system’ not in /proc/mounts</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -o rw,remount -t auto &#x2F;</span><br></pre></td></tr></table></figure><p><img src="/2022/03/09/%E5%AE%89%E5%8D%937-0%E4%BB%A5%E4%B8%8A%E6%89%8B%E6%9C%BA%E5%86%99%E5%85%A5%E5%AE%89%E5%85%A8%E8%AF%81%E4%B9%A6/4.jpg" style="zoom: 150%;"></p><p>验证成功</p><p><img src="/2022/03/09/%E5%AE%89%E5%8D%937-0%E4%BB%A5%E4%B8%8A%E6%89%8B%E6%9C%BA%E5%86%99%E5%85%A5%E5%AE%89%E5%85%A8%E8%AF%81%E4%B9%A6/5.jpg" style="zoom: 150%;"></p><p><strong>结束语</strong>：</p><p>​    今天的分享就到这里了，欢迎大家关注微信公众号”<strong>菜鸟童靴</strong>“</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;安卓7.0以上手机写入安全证书，具体操作？&lt;/p&gt;
    
    </summary>
    
    
      <category term="爬虫" scheme="http://yoursite.com/categories/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="抓包" scheme="http://yoursite.com/tags/%E6%8A%93%E5%8C%85/"/>
    
      <category term="证书" scheme="http://yoursite.com/tags/%E8%AF%81%E4%B9%A6/"/>
    
  </entry>
  
  <entry>
    <title>github访问慢，一直不成功，难道非得科学上网吗</title>
    <link href="http://yoursite.com/2022/03/06/github%E8%AE%BF%E9%97%AE%E6%85%A2%EF%BC%8C%E4%B8%80%E7%9B%B4%E4%B8%8D%E6%88%90%E5%8A%9F%EF%BC%8C%E9%9A%BE%E9%81%93%E9%9D%9E%E5%BE%97%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E5%90%97/"/>
    <id>http://yoursite.com/2022/03/06/github%E8%AE%BF%E9%97%AE%E6%85%A2%EF%BC%8C%E4%B8%80%E7%9B%B4%E4%B8%8D%E6%88%90%E5%8A%9F%EF%BC%8C%E9%9A%BE%E9%81%93%E9%9D%9E%E5%BE%97%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E5%90%97/</id>
    <published>2022-03-06T12:56:22.000Z</published>
    <updated>2022-03-06T14:03:51.176Z</updated>
    
    <content type="html"><![CDATA[<p>github访问慢，一直不成功，难道非得科学上网吗，今天小编给你带来终极解决方案，让你不再为此而烦恼</p><a id="more"></a><h3 id="背景："><a href="#背景：" class="headerlink" title="背景："></a>背景：</h3><p>​        github上有很多优秀的资源和项目，对程序员开发成长的有效平台之一，但是国内访问github的并不是那么友好</p><p>经常会出现访问一直转圈圈，访问慢，或者超时失败，小编在今天之前一直都是科学上网的方式，解决现状，今天服务</p><p>费软件到期后，忽然访问不了，又不想续费了，所以找了找网上有没有可行性的解决方案，一搜不知道，还真有，</p><p>接下来小编给大家案例两种方式的访问，方式一：dev-sidecar、方式二GitHub520 </p><h3 id="1、dev-sidecar"><a href="#1、dev-sidecar" class="headerlink" title="1、dev-sidecar"></a>1、dev-sidecar</h3><p>开发者边车，命名取自service-mesh的service-sidecar，意为为开发者打辅助的边车工具<br>通过本地代理的方式将https请求代理到一些国内的加速通道上</p><h4 id="1-1开源网址："><a href="#1-1开源网址：" class="headerlink" title="1.1开源网址："></a>1.1开源网址：</h4><p><a href="https://gitee.com/docmirror/dev-sidecar" target="_blank" rel="noopener">https://gitee.com/docmirror/dev-sidecar</a></p><h4 id="1-2特性："><a href="#1-2特性：" class="headerlink" title="1.2特性："></a>1.2特性：</h4><p>1、 dns优选</p><p>2、 请求拦截</p><p>3、 github加速</p><p>4、 Stack Overflow 加速</p><p>5、 npm加速</p><h4 id="1-3安装使用"><a href="#1-3安装使用" class="headerlink" title="1.3安装使用"></a>1.3安装使用</h4><h5 id="1-3-1选择平台下载"><a href="#1-3-1选择平台下载" class="headerlink" title="1.3.1选择平台下载"></a>1.3.1选择平台下载</h5><p><img src="/2022/03/06/github%E8%AE%BF%E9%97%AE%E6%85%A2%EF%BC%8C%E4%B8%80%E7%9B%B4%E4%B8%8D%E6%88%90%E5%8A%9F%EF%BC%8C%E9%9A%BE%E9%81%93%E9%9D%9E%E5%BE%97%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E5%90%97/1646572766.jpg" style="zoom: 50%;"></p><p>​    </p><p>此项目支持平台有很多，这边以window为例，我直接下载安装，傻瓜式安装，</p><h5 id="1-3-2-安装根证书"><a href="#1-3-2-安装根证书" class="headerlink" title="1.3.2 安装根证书"></a>1.3.2 安装根证书</h5><p>第一次打开会提示安装证书，根据提示操作即可</p><p>更多有关根证书的说明，请参考 <a href="https://gitee.com/docmirror/dev-sidecar/blob/master/doc/caroot.md" target="_blank" rel="noopener">为什么要安装根证书?</a></p><blockquote><p>根证书是本地随机生成的，所以不用担心根证书的安全问题（本应用不收集任何用户信息）<br>你也可以在加速服务设置中自定义根证书（PEM格式的证书与私钥）</p><p>火狐浏览器需要<a href="https://gitee.com/docmirror/dev-sidecar#3浏览器打开提示证书不受信任" target="_blank" rel="noopener">手动安装证书</a></p></blockquote><h5 id="1-3-4开始加速吧"><a href="#1-3-4开始加速吧" class="headerlink" title="1.3.4开始加速吧"></a>1.3.4开始加速吧</h5><p><img src="/2022/03/06/github%E8%AE%BF%E9%97%AE%E6%85%A2%EF%BC%8C%E4%B8%80%E7%9B%B4%E4%B8%8D%E6%88%90%E5%8A%9F%EF%BC%8C%E9%9A%BE%E9%81%93%E9%9D%9E%E5%BE%97%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E5%90%97/1646572959.jpg" style="zoom: 50%;"></p><p>去试试打开github</p><h3 id="2、-GitHub520"><a href="#2、-GitHub520" class="headerlink" title="2、 GitHub520"></a>2、 GitHub520</h3><h4 id="2-1开源网址："><a href="#2-1开源网址：" class="headerlink" title="2.1开源网址："></a>2.1开源网址：</h4><p><a href="https://gitee.com/doshengl/GitHub520" target="_blank" rel="noopener">https://gitee.com/doshengl/GitHub520</a></p><h4 id="2-2安装使用"><a href="#2-2安装使用" class="headerlink" title="2.2安装使用"></a>2.2安装使用</h4><h5 id="2-2-1-手动方式（每次得手动更新不推荐）"><a href="#2-2-1-手动方式（每次得手动更新不推荐）" class="headerlink" title="2.2.1 手动方式（每次得手动更新不推荐）"></a>2.2.1 手动方式（每次得手动更新不推荐）</h5><h5 id="2-2-1-1-修改-hosts-文件"><a href="#2-2-1-1-修改-hosts-文件" class="headerlink" title="2.2.1.1 修改 hosts 文件"></a>2.2.1.1 修改 hosts 文件</h5><p>hosts 文件在每个系统的位置不一，详情如下：</p><ul><li>Windows 系统：<code>C:\Windows\System32\drivers\etc\hosts</code></li><li>Linux 系统：<code>/etc/hosts</code></li><li>Mac（苹果电脑）系统：<code>/etc/hosts</code></li><li>Android（安卓）系统：<code>/system/etc/hosts</code></li><li>iPhone（iOS）系统：<code>/etc/hosts</code></li></ul><p>修改方法，把第一步的内容复制到文本末尾：</p><ol><li>Windows 使用记事本。</li><li>Linux、Mac 使用 Root 权限：<code>sudo vi /etc/hosts</code>。</li><li>iPhone、iPad 须越狱、Android 必须要 root。</li></ol><h6 id="2-2-1-2-激活生效"><a href="#2-2-1-2-激活生效" class="headerlink" title="2.2.1.2 激活生效"></a>2.2.1.2 激活生效</h6><p>大部分情况下是直接生效，如未生效可尝试下面的办法，刷新 DNS：</p><ol><li>Windows：在 CMD 窗口输入：<code>ipconfig /flushdns</code></li><li>Linux 命令：<code>sudo nscd restart</code>，如报错则须安装：<code>sudo apt install nscd</code> 或 <code>sudo /etc/init.d/nscd restart</code></li><li>Mac 命令：<code>sudo killall -HUP mDNSResponder</code></li></ol><p><strong>Tips：</strong> 上述方法无效可以尝试重启机器。</p><h4 id="2-2-2-自动方式"><a href="#2-2-2-自动方式" class="headerlink" title="2.2.2 自动方式"></a>2.2.2 自动方式</h4><p><strong>Tip</strong>：推荐 <a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Foldj%2FSwitchHosts">SwitchHosts</a> 工具管理 hosts</p><p>以 SwitchHosts 为例，看一下怎么使用的，配置参考下面：</p><ul><li>Title: 随意</li><li>Type: <code>Remote</code></li><li>URL: <code>https://raw.hellogithub.com/hosts</code></li><li>Auto Refresh: 最好选 <code>1 hour</code></li></ul><p>如图：</p><p><img src="/2022/03/06/github%E8%AE%BF%E9%97%AE%E6%85%A2%EF%BC%8C%E4%B8%80%E7%9B%B4%E4%B8%8D%E6%88%90%E5%8A%9F%EF%BC%8C%E9%9A%BE%E9%81%93%E9%9D%9E%E5%BE%97%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E5%90%97/switch-hosts.png" style="zoom: 50%;"></p><p>这样每次 hosts 有更新都能及时进行更新，免去手动更新。</p><p><strong>结束语</strong>：</p><p>​    今天的分享就到这里了，欢迎大家关注微信公众号”<strong>菜鸟童靴</strong>“</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;github访问慢，一直不成功，难道非得科学上网吗，今天小编给你带来终极解决方案，让你不再为此而烦恼&lt;/p&gt;
    
    </summary>
    
    
      <category term="技术杂谈" scheme="http://yoursite.com/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="github" scheme="http://yoursite.com/tags/github/"/>
    
      <category term="科学上网" scheme="http://yoursite.com/tags/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>pandas案例学习100例（一）</title>
    <link href="http://yoursite.com/2022/02/18/pandas%E6%A1%88%E4%BE%8B%E5%AD%A6%E4%B9%A0100%E4%BE%8B%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>http://yoursite.com/2022/02/18/pandas%E6%A1%88%E4%BE%8B%E5%AD%A6%E4%B9%A0100%E4%BE%8B%EF%BC%88%E4%B8%80%EF%BC%89/</id>
    <published>2022-02-18T07:00:30.000Z</published>
    <updated>2022-03-06T13:58:04.962Z</updated>
    
    <content type="html"><![CDATA[<p>hello 大家好，长时间没有发布新的文章，证明小编在这段日子不是很忙，就是很堕落，显然是后者了</p><p>捡起键盘，准备推出pandas 案例100系列，分十次记录学习，多了你也看不进去，我也写不进去：</p><a id="more"></a><p><strong>案例1：</strong></p><p>生成一年中，所有周一的日期：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生成一年中，所有周一的日期</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">date_range = pd.date_range(start=<span class="string">'2021-01-01'</span>, end=<span class="string">'2021-12-31'</span>, freq=<span class="string">"W-MON"</span>)</span><br><span class="line">date_range = pd.date_range(start=<span class="string">'2021-01-01'</span>, periods=<span class="number">52</span>, freq=<span class="string">"W-MON"</span>)  <span class="comment"># 一年52个周</span></span><br><span class="line">print(date_range)</span><br></pre></td></tr></table></figure><p><strong>案例2：</strong></p><p>生成一个月份的所有日期</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成一个月份的所有日期</span></span><br><span class="line">date_range = pd.date_range(start=<span class="string">'2021-12-01'</span>, end=<span class="string">'2021-12-31'</span>)</span><br><span class="line">date_range = pd.date_range(start=<span class="string">'2021-12-01'</span>, periods=<span class="number">31</span>)  <span class="comment"># 一個月31天</span></span><br><span class="line">print(date_range)</span><br></pre></td></tr></table></figure><p><strong>案例3：</strong></p><p>生成一天的所有小時</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生成一天的所有小時</span></span><br><span class="line">date_range = pd.date_range(start=<span class="string">'2021-12-01'</span>, periods=<span class="number">24</span>, freq=<span class="string">"H"</span>)</span><br><span class="line">date_range = pd.date_range(start=<span class="string">'2021-12-01'</span>, end=<span class="string">'2021-12-02'</span>, closed=<span class="string">"left"</span>, freq=<span class="string">"H"</span>)</span><br><span class="line">print(date_range)</span><br></pre></td></tr></table></figure><p><strong>案例4：</strong></p><p>使用list构造 Series</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment"># 使用list构造 Series</span></span><br><span class="line">sites = [<span class="string">"Google"</span>, <span class="string">"Runoob"</span>, <span class="string">"Wiki"</span>]</span><br><span class="line">myvar = pd.Series(sites)</span><br><span class="line">print(myvar)</span><br></pre></td></tr></table></figure><p><strong>案例5：</strong></p><p>使用dict 构造 Series</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用dict 构造 Series</span></span><br><span class="line">sites = &#123;<span class="string">'x'</span>: <span class="string">"Google"</span>, <span class="string">'y'</span>: <span class="string">"Runoob"</span>, <span class="string">'z'</span>: <span class="string">"Wiki"</span>&#125;</span><br><span class="line">myvar = pd.Series(sites)</span><br><span class="line">print(myvar)</span><br></pre></td></tr></table></figure><p><strong>案例6：</strong></p><p>Series转换list</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment"># Series转换list</span></span><br><span class="line">sites = &#123;<span class="string">'x'</span>: <span class="string">"Google"</span>, <span class="string">'y'</span>: <span class="string">"Runoob"</span>, <span class="string">'z'</span>: <span class="string">"Wiki"</span>&#125;</span><br><span class="line">myvar = pd.Series(sites)</span><br><span class="line">data = myvar.tolist()</span><br><span class="line">print(data)python</span><br></pre></td></tr></table></figure><p>案例7：</p><p>将Series转换DataFrame</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment"># 将Series转换DataFrame</span></span><br><span class="line">grades = &#123;<span class="string">'语文'</span>: <span class="string">"100"</span>, <span class="string">'数学'</span>: <span class="string">"120"</span>, <span class="string">'英语'</span>: <span class="string">"60"</span>&#125;</span><br><span class="line">myvar = pd.Series(grades)</span><br><span class="line">data = pd.DataFrame(myvar, columns=[<span class="string">"grade"</span>])</span><br><span class="line">print(data)</span><br></pre></td></tr></table></figure><p><strong>案例8：</strong></p><p>用numpy 创建Series</p><p>101    10.0<br>102    20.0<br>103    30.0<br>104    40.0<br>105    50.0<br>106    60.0<br>107    70.0<br>108    80.0<br>109    90.0</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment"># 用numpy 创建Series</span></span><br><span class="line">s = pd.Series(</span><br><span class="line">    np.arange(<span class="number">10</span>, <span class="number">100</span>, <span class="number">10</span>),  <span class="comment"># 数值：10-90，间隔10</span></span><br><span class="line">    index=np.arange(<span class="number">101</span>, <span class="number">110</span>),  <span class="comment"># 索引：101-109， 间隔7</span></span><br><span class="line">    dtype=<span class="string">"float"</span>  <span class="comment"># 类型：float64</span></span><br><span class="line">)</span><br><span class="line">print(s)</span><br></pre></td></tr></table></figure><p><strong>案例9：</strong></p><p> 转换Series 的数据类型</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换Series 的数据类型</span></span><br><span class="line">s = pd.Series(</span><br><span class="line">    data=[<span class="string">"001"</span>, <span class="string">"002"</span>, <span class="string">"003"</span>, <span class="string">"004"</span>],</span><br><span class="line">    index=list(<span class="string">"abcd"</span>),</span><br><span class="line">    dtype=<span class="string">"float"</span>  <span class="comment"># 类型：float64</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">s = s.astype(int)  <span class="comment"># 方法一</span></span><br><span class="line"><span class="comment"># s = s.map(int)# 方法二</span></span><br><span class="line">print(s)</span><br></pre></td></tr></table></figure><p><strong>案例10：</strong></p><p>给Series添加元素</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给Series添加元素</span></span><br><span class="line">grades = &#123;<span class="string">'语文'</span>: <span class="string">"100"</span>, <span class="string">'数学'</span>: <span class="string">"120"</span>, <span class="string">'英语'</span>: <span class="string">"60"</span>&#125;</span><br><span class="line">data = pd.Series(grades)</span><br><span class="line">data = data.append(pd.Series(&#123;</span><br><span class="line">    <span class="string">"计算机"</span>: <span class="number">30</span>,</span><br><span class="line">    <span class="string">"化学"</span>: <span class="number">45</span></span><br><span class="line">&#125;))</span><br><span class="line">print(data)</span><br></pre></td></tr></table></figure><p><strong>案例11：</strong></p><p>用reset index将Series 转换成df</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment"># 用reset index将Series 转换成df</span></span><br><span class="line">grades = &#123;<span class="string">'语文'</span>: <span class="string">"100"</span>, <span class="string">'数学'</span>: <span class="string">"120"</span>, <span class="string">'英语'</span>: <span class="string">"60"</span>&#125;</span><br><span class="line">data = pd.Series(grades)</span><br><span class="line">df = data.reset_index()</span><br><span class="line">df.columns = [<span class="string">"course"</span>, <span class="string">"grade"</span>]</span><br><span class="line">print(data)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;hello 大家好，长时间没有发布新的文章，证明小编在这段日子不是很忙，就是很堕落，显然是后者了&lt;/p&gt;
&lt;p&gt;捡起键盘，准备推出pandas 案例100系列，分十次记录学习，多了你也看不进去，我也写不进去：&lt;/p&gt;
    
    </summary>
    
    
      <category term="数据分析" scheme="http://yoursite.com/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"/>
    
    
  </entry>
  
  <entry>
    <title>python如何批量改文件后缀和图片像素大小</title>
    <link href="http://yoursite.com/2021/12/21/python%E5%A6%82%E4%BD%95%E6%89%B9%E9%87%8F%E6%94%B9%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%92%8C%E5%9B%BE%E7%89%87%E5%83%8F%E7%B4%A0%E5%A4%A7%E5%B0%8F/"/>
    <id>http://yoursite.com/2021/12/21/python%E5%A6%82%E4%BD%95%E6%89%B9%E9%87%8F%E6%94%B9%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%92%8C%E5%9B%BE%E7%89%87%E5%83%8F%E7%B4%A0%E5%A4%A7%E5%B0%8F/</id>
    <published>2021-12-21T14:05:20.000Z</published>
    <updated>2022-03-06T13:58:01.276Z</updated>
    
    <content type="html"><![CDATA[<p>hello 大家好，我是Monday，就在我写完pandas学习案例100第一篇的时候，在图片素材里找封面图时，发现已经没有新的封面图了</p><p>都是使用过的了，于是乎，我从网上下载了一批新的图片素材，正当我满意的时候，上传时，发现</p><a id="more"></a><p><img src="/2021/12/21/python%E5%A6%82%E4%BD%95%E6%89%B9%E9%87%8F%E6%94%B9%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%92%8C%E5%9B%BE%E7%89%87%E5%83%8F%E7%B4%A0%E5%A4%A7%E5%B0%8F/2.png" style="zoom: 50%;"></p><p>我下载的图片都是webp后缀的，格式不被允许上传，这时候我们改文件的后缀为平台支持的格式就可以了，</p><p>重点来了，那么图片难道要一个一个手动改吗，No No No，会Python的你，当然应该是写个小工具批量改了</p><p>附带源码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出当前目录下所有的文件</span></span><br><span class="line">path = <span class="string">r"C:\Users\xx\Desktop\公众号素材"</span></span><br><span class="line">files = os.listdir(path)</span><br><span class="line"><span class="keyword">for</span> index, filename <span class="keyword">in</span> enumerate(files):</span><br><span class="line">    portion = os.path.splitext(filename)</span><br><span class="line">    <span class="comment"># 判断后缀</span></span><br><span class="line">    <span class="keyword">if</span> portion[<span class="number">1</span>] == <span class="string">".webp"</span>:</span><br><span class="line">        <span class="comment"># 重新组合文件名和后缀名</span></span><br><span class="line">        newname = path + <span class="string">"\\"</span> + str(index) + <span class="string">".jpg"</span></span><br><span class="line">        filename = path + <span class="string">"\\"</span> + filename</span><br><span class="line">        os.rename(filename, newname)</span><br></pre></td></tr></table></figure><p>看下效果：</p><p><img src="/2021/12/21/python%E5%A6%82%E4%BD%95%E6%89%B9%E9%87%8F%E6%94%B9%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%92%8C%E5%9B%BE%E7%89%87%E5%83%8F%E7%B4%A0%E5%A4%A7%E5%B0%8F/3.jpg" style="zoom: 50%;"></p><p>本以为完美的落幕，然并卵再次上传，发现如下图的问题</p><p><img src="/2021/12/21/python%E5%A6%82%E4%BD%95%E6%89%B9%E9%87%8F%E6%94%B9%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%92%8C%E5%9B%BE%E7%89%87%E5%83%8F%E7%B4%A0%E5%A4%A7%E5%B0%8F/0.jpg" style="zoom: 50%;"></p><p>继续盘他，写个脚本批量更改像素:</p><p>源码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">IPHONE5_WIDTH = <span class="number">530</span> <span class="comment">#改变后的宽</span></span><br><span class="line">IPHONE5_HEIGHT = <span class="number">300</span><span class="comment">#改变后的高</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 改变图片的尺寸大小</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reset_pic_size</span><span class="params">(file_path, new_path, width=IPHONE5_WIDTH, height=IPHONE5_HEIGHT)</span>:</span></span><br><span class="line">    image = Image.open(file_path)</span><br><span class="line">    image_width, image_height = image.size</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> image_width &gt; width:</span><br><span class="line">        image_height = width * image_height // image_width</span><br><span class="line">        image_width = width</span><br><span class="line">    <span class="keyword">if</span> image_height &gt; height:</span><br><span class="line">        image_width = height * image_width // image_height</span><br><span class="line">        image_height = height</span><br><span class="line"></span><br><span class="line">    new_image = image.resize((image_width, image_height), Image.ANTIALIAS)  <span class="comment"># 滤镜缩放</span></span><br><span class="line">    new_image.save(new_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从文件夹中循环改变每一张图片</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_and_resize_pic_from_dir</span><span class="params">(dir_path, new_path)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(dir_path):</span><br><span class="line">        <span class="keyword">for</span> file_name <span class="keyword">in</span> files:</span><br><span class="line">            <span class="keyword">if</span> file_name.lower().endswith(<span class="string">'jpg'</span>) <span class="keyword">or</span> file_name.lower().endswith(<span class="string">'png'</span>):</span><br><span class="line">                file_path = os.path.join(root, file_name)</span><br><span class="line">                new_file_path = new_path + file_name</span><br><span class="line">                reset_pic_size(file_path=file_path, new_path=new_file_path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    </span><br><span class="line">    file_new_path = <span class="string">r'C:\Users\XX\Desktop\公众号素材\new_'</span></span><br><span class="line">    find_and_resize_pic_from_dir(<span class="string">r'C:\Users\XX\Desktop\公众号素材'</span>, file_new_path)</span><br></pre></td></tr></table></figure><p>万事具备，看看能不能如愿上传：</p><p><img src="/2021/12/21/python%E5%A6%82%E4%BD%95%E6%89%B9%E9%87%8F%E6%94%B9%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%92%8C%E5%9B%BE%E7%89%87%E5%83%8F%E7%B4%A0%E5%A4%A7%E5%B0%8F/1.png" style="zoom: 50%;"></p><p>完美</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;hello 大家好，我是Monday，就在我写完pandas学习案例100第一篇的时候，在图片素材里找封面图时，发现已经没有新的封面图了&lt;/p&gt;
&lt;p&gt;都是使用过的了，于是乎，我从网上下载了一批新的图片素材，正当我满意的时候，上传时，发现&lt;/p&gt;
    
    </summary>
    
    
      <category term="python进阶" scheme="http://yoursite.com/categories/python%E8%BF%9B%E9%98%B6/"/>
    
    
  </entry>
  
  <entry>
    <title>深入浅出，JS原型链的工作原理和hook</title>
    <link href="http://yoursite.com/2021/07/06/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%EF%BC%8CJS%E5%8E%9F%E5%9E%8B%E9%93%BE%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%92%8Chook/"/>
    <id>http://yoursite.com/2021/07/06/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%EF%BC%8CJS%E5%8E%9F%E5%9E%8B%E9%93%BE%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%92%8Chook/</id>
    <published>2021-07-06T14:42:39.000Z</published>
    <updated>2021-07-06T15:12:57.313Z</updated>
    
    <content type="html"><![CDATA[<p>前言：原型链，即原型链条。它是由原型、原型的原型、原型的原型的原型…这一规则组合成的，经常被应用于继承。</p><a id="more"></a><p><strong>原型的作用</strong></p><p>在JS中，每个对象都有自己的原型。当我们访问对象的属性和方法时，JS会先访问对象本身的属性和方法。如果对象本身不包含这些属性和方法，则访问对象对应的原型。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 对象自身的属性</span></span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 对象自身的方法</span></span><br><span class="line">    <span class="keyword">this</span>.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//原型上的方法</span></span><br><span class="line">Person.prototype.sayAge = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="keyword">this</span>.age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xiaoming = <span class="keyword">new</span> Person(<span class="string">"XiaoMing"</span>,<span class="number">12</span>);</span><br><span class="line"><span class="keyword">var</span> xiaoHong = <span class="keyword">new</span> Person(<span class="string">"XiaoHong"</span>,<span class="number">11</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用自身不存在的方法</span></span><br><span class="line">xiaoming.sayAge(); <span class="comment">// 12</span></span><br><span class="line">xiaoHong.sayAge(); <span class="comment">// 11</span></span><br></pre></td></tr></table></figure><p>上述例子中，方法“sayAge”是在原型上而非对象中。（关于对象与原型之间更为详细的内容，可阅读文章：<a href="https://segmentfault.com/img/bVbkATy" target="_blank" rel="noopener">《浅谈JS中的构造函数、原型对象(prototype)、实例中的属性/方法之间的关系》</a>）</p><p><strong>原型链的原理</strong></p><p>原型自身也是一个对象（默认情况下所有对象都是Object的实例)。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert(xiaoming instanceof Object); &#x2F;&#x2F; true alert(Person.prototype instanceof Object); &#x2F;&#x2F; true</span><br></pre></td></tr></table></figure><p>每个对象都有自己的原型，所以Person的原型也有它自己的原型，那就是：Object.prototype(部分浏览器允许通过实例的“<strong>proto</strong>”属性访问其原型)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert(Person.prototype.__proto__ &#x3D;&#x3D; Object.prototype); &#x2F;&#x2F; true</span><br></pre></td></tr></table></figure><p>既然原型是一个对象，那么，当我们访问的属性和方法在原型不存在，就会继续访问原型的原型，直至Object.prototype。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">    <span class="keyword">this</span>.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.sayAge = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="keyword">this</span>.age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在Object.prototype增加一个“自我介绍”的方法</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.introduce = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;**</span><br><span class="line">    alert(<span class="string">"My name is "</span> + <span class="keyword">this</span>.name + <span class="string">",I'm "</span> + <span class="keyword">this</span>.age + <span class="string">" years old!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xiaoming = <span class="keyword">new</span> Person(<span class="string">"XiaoMing"</span>,<span class="number">12</span>);</span><br><span class="line"><span class="comment">// 调用对象自身和原型上均不存在的方法</span></span><br><span class="line">xiaoming.introduce(); <span class="comment">// My name is XiaoMing,I'm 12 years old!</span></span><br></pre></td></tr></table></figure><p><img src="/2021/07/06/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%EF%BC%8CJS%E5%8E%9F%E5%9E%8B%E9%93%BE%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%92%8Chook/1.png" alt="img"></p><p><strong>原型链hook案例一：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">String</span>.prototype.split_bk = <span class="built_in">String</span>.prototype.split;</span><br><span class="line"><span class="built_in">String</span>.prototype.split = <span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">    str = <span class="keyword">this</span>.toString()</span><br><span class="line">    <span class="keyword">debugger</span>;</span><br><span class="line">    <span class="keyword">return</span> str.split_bk(val)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">a = <span class="string">"加密字符串"</span>;</span><br><span class="line">a.split(<span class="string">"加密"</span>)</span><br></pre></td></tr></table></figure><p><strong>*原型链hook案例二</strong></p><p><img src="/2021/07/06/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%EF%BC%8CJS%E5%8E%9F%E5%9E%8B%E9%93%BE%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%92%8Chook/2.png" alt="image-20210706231047752"></p><p><strong>总结</strong></p><p>原型链是JS的一个特性，它实现的核心机制是：</p><p>1、访问对象的属性(方法)时，若对象本身不存在该属性(方法)，则会转向访问该对象的原型；</p><p>2、对象的原型也是一个对象。访问的属性(方法)依旧不存在于该原型，则会继续访问该原型的原型…</p><p>参考链接：<a href="https://segmentfault.com/a/1190000017254949" target="_blank" rel="noopener">https://segmentfault.com/a/1190000017254949</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前言：原型链，即原型链条。它是由原型、原型的原型、原型的原型的原型…这一规则组合成的，经常被应用于继承。&lt;/p&gt;
    
    </summary>
    
    
      <category term="逆向" scheme="http://yoursite.com/categories/%E9%80%86%E5%90%91/"/>
    
    
      <category term="逆向" scheme="http://yoursite.com/tags/%E9%80%86%E5%90%91/"/>
    
      <category term="js" scheme="http://yoursite.com/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>android设备指纹</title>
    <link href="http://yoursite.com/2021/06/29/android%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9/"/>
    <id>http://yoursite.com/2021/06/29/android%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9/</id>
    <published>2021-06-29T15:14:21.000Z</published>
    <updated>2021-06-29T15:18:48.726Z</updated>
    
    <content type="html"><![CDATA[<p><strong>1　Android 设备指纹</strong></p><p>设备ID 需要兼具稳定性和唯一性，Android 系统的开源和碎片化导致API 函数实现各不相同，所以兼容性是Android 系统中设备指纹面临的最大挑战。表4.1列举了Android 系统中比较稳定的设备参数</p><a id="more"></a><p><img src="/2021/06/29/android%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9/1.jpg" alt="img"></p><p>目前国内Android 6以上的手机占比已经超过了85%。由于考虑到用户的隐私，高版本Android 系统增加了设备信息采集的限制。</p><p><strong>2、Android Q 介绍（百度百科）：</strong></p><p>Android Q 是<a href="https://baike.baidu.com/item/谷歌/117920" target="_blank" rel="noopener">谷歌</a>公司在2019年推出的新一代<a href="https://baike.baidu.com/item/操作系统/192" target="_blank" rel="noopener">操作系统</a>。适用于<a href="https://baike.baidu.com/item/手机/6342" target="_blank" rel="noopener">手机</a>、平板电脑等移动终端设备 [1] 。Android Q的首个开发者预览版本（即测试版）在2019年3月14日发行并提供下载。正式版于2019年9月3日发行。此版本Android是各Android版本中，首次不用甜品来命名。该版本借助深色主题和手势导航打造应用体验。为确保用户隐私和安全支持新的保护措施。借助高性能编解码器、更出色的生物识别技术、更快的应用启动速度、Vulkan 1.1、NNAPI 1.2、可折叠设备和 5G 等更多功能扩展。</p><p>Android Q 于2019年9月份发布，出于对用户隐私的考虑，Android Q 限制了采集设备标识符，为Android 设备指纹带来了前所未有的挑战。Android Q 禁止非系统应用访问用户不可更改的ID，包括IMEI 号、Serial、USB 序列号等。系统Wi-Fi MAC 地址默认是随机生成的，不是固定的MAC 地址，以防止用户隐私被追踪。我们实际测试发现，IMEI、IMSI、Serial、Bluetooth MAC 都已无法获取参数，Wi-Fi MAC 获取不到真实值，但与BSSID 绑定。因此，Android Q 设备指纹的适配，不仅仅是采集函数的兼容，更重要的是设备ID 恢复逻辑（当用户修改手机某些信息时保持设备ID 不变的计算逻辑）的兼容。</p><p>从理论上来说，所有的采集项都是Android 系统公开的API，不可能在采集项被大面积篡改的情况下保持设备ID 不变。因此，设备指纹还需要对APP 运行环境进行监测，以识别异常环境。</p><p><strong>3、针对Android 作弊环境的检测方法可以归纳为以下5个方面：</strong></p><p>· 通过安装包检测安装的作弊工具。</p><p>· 通过特定特征识别root 环境。</p><p>· 使用多种方案采集同一字段信息。</p><p>· 通过通用性的作弊原理识别运行的作弊框架hook（Java/native）。</p><p>· 通过特定特征识别运行的作弊工具和模拟器。Android 黑产工具更新速度很快，样式层出不穷，需要通过黑产情报不断搜集最新的作弊方法。</p><p><strong>4、相关文章推荐：</strong></p><p><strong>Android唯一识别号（设备指纹）的生成及原理</strong></p><p><a href="https://blog.csdn.net/xiechengfa/article/details/70049409?utm_source=itdadao&amp;utm_medium=referral" target="_blank" rel="noopener">https://blog.csdn.net/xiechengfa/article/details/70049409?utm_source=itdadao&amp;utm_medium=referral</a></p><p><strong>Android硬件开发系列一指纹识别</strong></p><p><a href="https://blog.csdn.net/u010019468/article/details/70332710" target="_blank" rel="noopener">https://blog.csdn.net/u010019468/article/details/70332710</a></p><p><strong>Android 设备指纹</strong></p><p><a href="https://blog.csdn.net/DeckeDeng/article/details/78481423?locationNum=1&amp;fps=1" target="_blank" rel="noopener">https://blog.csdn.net/DeckeDeng/article/details/78481423?locationNum=1&amp;fps=1</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;1　Android 设备指纹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;设备ID 需要兼具稳定性和唯一性，Android 系统的开源和碎片化导致API 函数实现各不相同，所以兼容性是Android 系统中设备指纹面临的最大挑战。表4.1列举了Android 系统中比较稳定的设备参数&lt;/p&gt;
    
    </summary>
    
    
      <category term="逆向" scheme="http://yoursite.com/categories/%E9%80%86%E5%90%91/"/>
    
    
      <category term="风控、 逆向" scheme="http://yoursite.com/tags/%E9%A3%8E%E6%8E%A7%E3%80%81-%E9%80%86%E5%90%91/"/>
    
  </entry>
  
  <entry>
    <title>Python进阶之atexit模块使用</title>
    <link href="http://yoursite.com/2021/06/12/Python%E8%BF%9B%E9%98%B6%E4%B9%8Batexit%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8/"/>
    <id>http://yoursite.com/2021/06/12/Python%E8%BF%9B%E9%98%B6%E4%B9%8Batexit%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8/</id>
    <published>2021-06-12T14:06:23.000Z</published>
    <updated>2021-06-12T14:09:31.740Z</updated>
    
    <content type="html"><![CDATA[<p>如何让程序退出时强行执行一段代码，说起这个需求，我们就不得不说<strong>Python atexit</strong>模块了：</p><a id="more"></a><p><strong>退出处理器</strong> <code>atexit</code> 模块定义了清理函数的注册和反注册函数. 被注册的函数会在解释器正常终止时执行. <code>atexit</code> 会按照注册顺序的<em>逆序</em>执行; 如果你注册了 <code>A</code>, <code>B</code> 和 <code>C</code>, 那么在解释器终止时会依序执行 <code>C</code>, <code>B</code>, <code>A</code>.</p><p>看完这段介绍，有点类似栈的原理，后进先出</p><p><strong>1、举个例子说明：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def goodbye(name, adjective):</span><br><span class="line">   print(&quot;Goodbye %s, it was %s to meet you.&quot;% (name, adjective))</span><br><span class="line"></span><br><span class="line">def hello():</span><br><span class="line">   print(&#39;hello world!&#39;)</span><br><span class="line"></span><br><span class="line">def a():</span><br><span class="line">   print(&#39;a&#39;)</span><br><span class="line"></span><br><span class="line">import atexit</span><br><span class="line">atexit.register(goodbye, &#39;Mr.Yang&#39;, &#39;nice&#39;)#3</span><br><span class="line">atexit.register(a)#2</span><br><span class="line">hello()#1正常程序首先被执行</span><br><span class="line"></span><br><span class="line">#执行顺序 1 2 3</span><br></pre></td></tr></table></figure><p><strong>运行结果</strong></p><p><img src="/2021/06/12/Python%E8%BF%9B%E9%98%B6%E4%B9%8Batexit%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8/Python进阶之atexit模块使用\1.jpg" alt="图片"></p><p><strong>2、 作为 [decorator]: 使用，使用场景， 但是只适用于没有参数时调用</strong></p><p>举例说明，对上述代码稍作修改：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import atexit</span><br><span class="line"></span><br><span class="line">def hello():</span><br><span class="line">   print(&#39;hello world!&#39;)</span><br><span class="line">@atexit.register</span><br><span class="line">def a():</span><br><span class="line">   print(&#39;a&#39;)</span><br><span class="line"></span><br><span class="line">hello()</span><br><span class="line"></span><br><span class="line">#运行结果</span><br><span class="line">#hello world!</span><br><span class="line">#a</span><br></pre></td></tr></table></figure><p> <strong>3、取消注册， 示例如下。</strong> </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">def goodbye(name, adjective):</span><br><span class="line">   print(&quot;Goodbye %s, it was %s to meet you.&quot;% (name, adjective))</span><br><span class="line"></span><br><span class="line">def hello():</span><br><span class="line">   print(&#39;hello world!&#39;)</span><br><span class="line"></span><br><span class="line">def a():</span><br><span class="line">   print(&#39;a&#39;)</span><br><span class="line"></span><br><span class="line">import atexit</span><br><span class="line">atexit.register(goodbye, &#39;Mr.Yang&#39;, &#39;nice&#39;)#3</span><br><span class="line">atexit.register(a)#2</span><br><span class="line">hello()#1正常程序首先被执行</span><br><span class="line">atexit.unregister(a)</span><br><span class="line">#正常执行顺序 1 2 3</span><br><span class="line"></span><br><span class="line">#由于设置了取消注册atexit.unregister(a)，</span><br><span class="line"></span><br><span class="line">#注销后执行顺序 1 3</span><br></pre></td></tr></table></figure><p><strong>运行结果：</strong></p><p><img src="/2021/06/12/Python%E8%BF%9B%E9%98%B6%E4%B9%8Batexit%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8/Python进阶之atexit模块使用\2.jpg" alt="图片"></p><p>这个模块一般用来在程序结束时，做资源清理。</p><p><strong>应用场景一：</strong></p><p> 既能让程序报错，又能在报错已经还能运行<code>clean()</code>呢？</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import atexit</span><br><span class="line"></span><br><span class="line">@atexit.register</span><br><span class="line">def clean():</span><br><span class="line">   print(&#39;清理环境相关的代码&#39;)</span><br><span class="line"></span><br><span class="line">def test():</span><br><span class="line">   example &#x3D; &#123;&quot;a&quot;: 1, &quot;b&quot;: 2&#125;</span><br><span class="line">   print(example[&quot;c&quot;])#程序报错</span><br><span class="line">test()</span><br></pre></td></tr></table></figure><p>运行结果：</p><p><img src="/2021/06/12/Python%E8%BF%9B%E9%98%B6%E4%B9%8Batexit%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8/Python进阶之atexit模块使用\3.jpg" alt="图片"></p><p>这样一来，我们不需要显式调用<code>clean</code>函数了。无论程序正常结束，还是程序异常报错，<code>clean</code>函数里面的内容总会执行。</p><p><strong>*\</strong>官方文档*<em>：<a href="https://docs.python.org/zh-cn/3.7/library/atexit.html\**" target="_blank" rel="noopener">https://docs.python.org/zh-cn/3.7/library/atexit.html\**</a></em> </p><p><strong><em>*参考链接：\</em></strong><a href="https://mp.weixin.qq.com/s/lNwSBhcp9ktwgaGWpXNq-A*" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/lNwSBhcp9ktwgaGWpXNq-A*</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;如何让程序退出时强行执行一段代码，说起这个需求，我们就不得不说&lt;strong&gt;Python atexit&lt;/strong&gt;模块了：&lt;/p&gt;
    
    </summary>
    
    
      <category term="python基础" scheme="http://yoursite.com/categories/python%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="python基础" scheme="http://yoursite.com/tags/python%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>使用NanoHTTPD反射调用加密函数（一）</title>
    <link href="http://yoursite.com/2021/06/12/%E4%BD%BF%E7%94%A8NanoHTTPD%E5%8F%8D%E5%B0%84%E8%B0%83%E7%94%A8%E5%8A%A0%E5%AF%86%E5%87%BD%E6%95%B0/"/>
    <id>http://yoursite.com/2021/06/12/%E4%BD%BF%E7%94%A8NanoHTTPD%E5%8F%8D%E5%B0%84%E8%B0%83%E7%94%A8%E5%8A%A0%E5%AF%86%E5%87%BD%E6%95%B0/</id>
    <published>2021-06-12T13:47:56.000Z</published>
    <updated>2021-06-14T12:34:28.086Z</updated>
    
    <content type="html"><![CDATA[<p>利用NanoHTTPD反射调用Android APP加密函数，前奏之初识NanoHTTPD</p><a id="more"></a><h3 id="1-NanoHTTPD介绍"><a href="#1-NanoHTTPD介绍" class="headerlink" title="1.NanoHTTPD介绍"></a>1.NanoHTTPD介绍</h3><p>什么是NanoHTTPD？NanoHTTPD是一个免费、轻量级的(只有一个Java文件) HTTP服务器，可以很好地嵌入到Java程序中。支持 GET, POST, PUT等请求，支持文件上传，占用内存很小。</p><p>项目地址：<a href="https://github.com/NanoHttpd/nanohttpd" target="_blank" rel="noopener">https://github.com/NanoHttpd/nanohttpd</a></p><h3 id="2-如何嵌入？"><a href="#2-如何嵌入？" class="headerlink" title="2. 如何嵌入？"></a>2. 如何嵌入？</h3><ol><li>在build.gradle中增加一个依赖（已经懒到一定境界了，能自动的，绝不手动下载配置）：</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &#39;org.nanohttpd:nanohttpd:2.2.0&#39;</span><br></pre></td></tr></table></figure><ol><li>在包里增加一个java文件：AndroidWebServer.java`：</li></ol><p><strong>3、打开“app/src/main/AndroidManifest.xml”，在manifest标签中加入网络权限的声明，不加会报“java.net.SocketException: socket failed: EACCES ”异常错误</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.INTERNET"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p><strong>4、编写NanoHTTPD的server服务</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.ceshi;</span><br><span class="line"><span class="keyword">import</span> fi.iki.elonen.NanoHTTPD;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义一个Server继承NanoHTTPD</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AndroidWebServer</span> <span class="keyword">extends</span> <span class="title">NanoHTTPD</span> </span>&#123;</span><br><span class="line">    <span class="comment">//构造函数 赋值父类</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AndroidWebServer</span><span class="params">(<span class="keyword">int</span> port)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(port);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">serve</span><span class="params">(IHTTPSession session)</span> </span>&#123;</span><br><span class="line">        String msg = <span class="string">"&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello AutoPy&lt;/h1&gt;\n"</span>;</span><br><span class="line">        Map&lt;String, String&gt; parms = session.getParms();</span><br><span class="line">        <span class="keyword">if</span> (parms.get(<span class="string">"code"</span>) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            msg += <span class="string">"&lt;form action='?' method='get'&gt;\n  &lt;p&gt;Your code: &lt;input type='text' name='code'&gt;&lt;/p&gt;\n"</span> + <span class="string">"&lt;/form&gt;\n"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            msg += <span class="string">"&lt;p&gt;Hello, "</span> + parms.get(<span class="string">"code"</span>) + <span class="string">"!&lt;/p&gt;"</span>;</span><br><span class="line">            <span class="keyword">return</span> newFixedLengthResponse(msg + <span class="string">"&lt;/body&gt;&lt;/html&gt;\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newFixedLengthResponse(msg + <span class="string">"&lt;/body&gt;&lt;/html&gt;\n"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>5、在MainActivity类中编写如下代码，启用NanoHTTPD服务</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.ceshi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    AndroidWebServer http = <span class="keyword">new</span> AndroidWebServer(<span class="number">9988</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainActivity</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            http.start();</span><br><span class="line">            System.out.println(<span class="string">"服务启动完成"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">"服务启动错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//安卓销毁事件</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        http.stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>6、启动app</strong></p><p><strong>7、端口转发</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb forward tcp:9988 tcp:9988</span><br></pre></td></tr></table></figure><p><strong>8、调用接口</strong></p><p><img src="/2021/06/12/%E4%BD%BF%E7%94%A8NanoHTTPD%E5%8F%8D%E5%B0%84%E8%B0%83%E7%94%A8%E5%8A%A0%E5%AF%86%E5%87%BD%E6%95%B0/1.png" alt></p><p><strong>输入ss回车：</strong></p><p><img src="/2021/06/12/%E4%BD%BF%E7%94%A8NanoHTTPD%E5%8F%8D%E5%B0%84%E8%B0%83%E7%94%A8%E5%8A%A0%E5%AF%86%E5%87%BD%E6%95%B0/2.png" alt></p><p><strong>参考文章;</strong></p><p>安卓NanoHTTPD的快速入门</p><p><a href="https://blog.csdn.net/u013738666/article/details/104776840" target="_blank" rel="noopener">https://blog.csdn.net/u013738666/article/details/104776840</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;利用NanoHTTPD反射调用Android APP加密函数，前奏之初识NanoHTTPD&lt;/p&gt;
    
    </summary>
    
    
      <category term="逆向" scheme="http://yoursite.com/categories/%E9%80%86%E5%90%91/"/>
    
    
      <category term="逆向，NanoHTTPD" scheme="http://yoursite.com/tags/%E9%80%86%E5%90%91%EF%BC%8CNanoHTTPD/"/>
    
  </entry>
  
  <entry>
    <title>androidStudio建立的项目没有libs目录</title>
    <link href="http://yoursite.com/2021/06/11/androidStudio%E5%BB%BA%E7%AB%8B%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%B2%A1%E6%9C%89libs%E7%9B%AE%E5%BD%95/"/>
    <id>http://yoursite.com/2021/06/11/androidStudio%E5%BB%BA%E7%AB%8B%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%B2%A1%E6%9C%89libs%E7%9B%AE%E5%BD%95/</id>
    <published>2021-06-10T16:03:12.000Z</published>
    <updated>2021-06-11T14:18:20.514Z</updated>
    
    <content type="html"><![CDATA[<p>ndroid studio建立的项目没有libs目录<br>有时候建立新项目，没有看到lib文件夹，但是文件目录里又有</p><a id="more"></a><p>android studio建立的项目没有libs目录<br>有时候建立新项目，没有看到lib文件夹，但是文件目录里又有<br><img src="/2021/06/11/androidStudio%E5%BB%BA%E7%AB%8B%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%B2%A1%E6%9C%89libs%E7%9B%AE%E5%BD%95/androidStudio建立的项目没有libs目录\1.jpg" alt><br><img src="/2021/06/11/androidStudio%E5%BB%BA%E7%AB%8B%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%B2%A1%E6%9C%89libs%E7%9B%AE%E5%BD%95/androidStudio建立的项目没有libs目录\2.jpg" alt></p><p><strong>原因是显示目录的原因，切换成Project就可以了</strong><br><img src="/2021/06/11/androidStudio%E5%BB%BA%E7%AB%8B%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%B2%A1%E6%9C%89libs%E7%9B%AE%E5%BD%95/androidStudio建立的项目没有libs目录\3.jpg" alt></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ndroid studio建立的项目没有libs目录&lt;br&gt;有时候建立新项目，没有看到lib文件夹，但是文件目录里又有&lt;/p&gt;
    
    </summary>
    
    
      <category term="逆向" scheme="http://yoursite.com/categories/%E9%80%86%E5%90%91/"/>
    
    
      <category term="逆向，AndroidStudio" scheme="http://yoursite.com/tags/%E9%80%86%E5%90%91%EF%BC%8CAndroidStudio/"/>
    
  </entry>
  
  <entry>
    <title>python进阶之上下文管理器</title>
    <link href="http://yoursite.com/2021/06/10/%E8%BF%9B%E9%98%B6%E4%B9%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8/"/>
    <id>http://yoursite.com/2021/06/10/%E8%BF%9B%E9%98%B6%E4%B9%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8/</id>
    <published>2021-06-10T13:38:15.000Z</published>
    <updated>2021-06-10T13:43:59.830Z</updated>
    
    <content type="html"><![CDATA[<p><strong>一、文管理器作用</strong>：</p><p>上下⽂管理器允许你在有需要的时候，精确地分配和释放资源。</p><a id="more"></a><p><strong>二、案例介绍：</strong></p><p>对它使⽤最⼴泛的案例就是with语句了。想象下当你有两个相关操作，你想让它们结对执⾏，然后在它们俩中间放置⼀段代码。</p><p>上下⽂管理器就是专门让你做这个事情的。举个例⼦：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'some_file'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> opened_file: </span><br><span class="line">  opened_file.write(<span class="string">'Hola!'</span>)</span><br></pre></td></tr></table></figure><p>上⾯这段代码打开了⼀个⽂件，往它⾥⾯写⼊了⼀些数据，然后关闭了它。如果在往⽂件</p><p>写数据时发⽣异常，它会尝试去关闭⽂件。上⾯那段代码与这⼀段是等价的：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">file = open(<span class="string">'some_file'</span>, <span class="string">'w'</span>) </span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">  file.write(<span class="string">'Hola!'</span>) </span><br><span class="line"><span class="keyword">finally</span>: </span><br><span class="line">  file.close()</span><br></pre></td></tr></table></figure><p>对比两个功能一样的代码，相比较之下，with 代码更简洁，去掉了很多样板代码，它确保我们的⽂件会被关闭。</p><p><strong>三、使用上下文管理器with的优点：</strong></p><p>（1）使用with语句的目的就是把代码块放入with中执行，with结束后，自动完成清理工作，无须手动干预。</p><p>（2）在需要管理一些资源比如文件，网络连接和锁的编程环境中，可以在<strong>exit</strong>中定制自动释放资源的机制，你无须再去关系这个问题，这将大有用处。</p><p><strong>四、如何上下文管理器</strong>：</p><p><strong>1、基于类的实现</strong></p><p>⼀个上下⽂管理器的类，最起码要定义<strong>enter</strong>和<strong>exit</strong>⽅法。</p><p>让我们来构造我们⾃⼰的⽂件开启的上下⽂管理器，并学习下基础知识。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span><span class="params">(object)</span>:</span> </span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, file_name, method)</span>:</span></span><br><span class="line">          self.file_obj = open(file_name, method) </span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">          <span class="keyword">return</span> self.file_obj </span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, type, value, traceback)</span>:</span></span><br><span class="line">          self.file_obj.close()</span><br></pre></td></tr></table></figure><p>通过定义<strong>enter</strong>和<strong>exit</strong>⽅法，我们可以在with语句⾥使⽤它。我们来试试：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">with</span> File(<span class="string">'demo.txt'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> opened_file: </span><br><span class="line">  opened_file.write(<span class="string">'Hola!'</span>)</span><br></pre></td></tr></table></figure><p>我们的<strong>exit</strong>函数接受三个参数。这些参数对于每个上下⽂管理器类中的<strong>exit</strong> </p><p>⽅法都是必须的。我们来谈谈在底层都发⽣了什么。</p><ol><li><p>with语句先暂存了File类的<strong>exit</strong>⽅法</p></li><li><p>然后它调⽤File类的<strong>enter</strong>⽅法</p></li><li><p><strong>enter</strong>⽅法打开⽂件并返回给with语句</p></li><li><p>打开的⽂件句柄被传递给opened_file参数</p></li><li><p>我们使⽤.write()来写⽂件</p></li><li><p>with语句调⽤之前暂存的<strong>exit</strong>⽅法</p></li><li><p><strong>exit</strong>⽅法关闭了⽂件</p></li></ol><p><strong>（**</strong>1） 如何处理异常** </p><p>我们还没有谈到<strong>exit</strong>⽅法的这三个参数：type, value和traceback。</p><p>在第4步和第6步之间，如果发⽣异常，Python会将异常的type,value和traceback传递</p><p>到<strong>exit</strong>⽅法。</p><p>它让<strong>exit</strong>⽅法来决定如何关闭⽂件以及是否需要其他步骤。在我们的案例中，我们</p><p>并没有注意它们。</p><p>那如果我们的⽂件对象抛出⼀个异常呢？万⼀我们尝试访问⽂件对象的⼀个不⽀持的⽅</p><p>法。举个例⼦：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">with</span> File(<span class="string">'demo.txt'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> opened_file: </span><br><span class="line">    opened_file.undefined_function(<span class="string">'Hola!'</span>)</span><br></pre></td></tr></table></figure><p>我们来列⼀下，当异常发⽣时，with语句会采取哪些步骤。</p><ol><li><p>它把异常的type,value和traceback传递给<strong>exit</strong>⽅法</p></li><li><p>它让<strong>exit</strong>⽅法来处理异常</p></li><li><p>如果<strong>exit</strong>返回的是True，那么这个异常就被优雅地处理了。</p></li><li><p>如果<strong>exit</strong>返回的是True以外的任何东西，那么这个异常将被with语句抛出</p></li></ol><p>（<strong>2）怎么优雅的去处理异常：</strong></p><p>看到处理异常那里，我们仅仅就是在发生异常时，文件能正常被关闭，不需要抛出异常</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, type, value, traceback)</span>:</span> </span><br><span class="line">    print(<span class="string">"Exception has been handled"</span>) </span><br><span class="line">    self.file_obj.close() </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>我们仅仅return True，这么做就可以了</p><p><strong>完整代码：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, filepath, mode=<span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>)</span>:</span></span><br><span class="line">        self.filepath = filepath</span><br><span class="line">        self.mode = mode</span><br><span class="line">        self.encoding = encoding</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># print('enter')</span></span><br><span class="line">        self.f = open(self.filepath, mode=self.mode, encoding=self.encoding)</span><br><span class="line">        <span class="keyword">return</span> self.f</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_val, exc_tb)</span>:</span></span><br><span class="line">        <span class="comment"># print('exit')</span></span><br><span class="line">        self.f.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, item)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> getattr(self.f, item)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> Open(<span class="string">'a.txt'</span>,<span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(f)</span><br><span class="line">    f.write(<span class="string">'aaaaaa'</span>)</span><br><span class="line">    <span class="comment">#f.wasdf() #抛出异常，交给__exit__处理</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;一、文管理器作用&lt;/strong&gt;：&lt;/p&gt;
&lt;p&gt;上下⽂管理器允许你在有需要的时候，精确地分配和释放资源。&lt;/p&gt;
    
    </summary>
    
    
      <category term="python基础" scheme="http://yoursite.com/categories/python%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="python基础" scheme="http://yoursite.com/tags/python%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>如何抓取国外网站、app的包</title>
    <link href="http://yoursite.com/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85/"/>
    <id>http://yoursite.com/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85/</id>
    <published>2021-06-10T13:32:16.000Z</published>
    <updated>2021-06-14T12:36:11.009Z</updated>
    
    <content type="html"><![CDATA[<p><strong>前期准备：</strong></p><p>  配置好的Charles抓包工具，（可以抓正常国内的APP端和网页端的包）</p><p>  设置好的vpn，（可以访问国外的网站）</p><a id="more"></a><p><strong>操作环境</strong>：以windows为例</p><p>打开vpn后，我们访问一下国外的网站，测试一下vpn访问是否正常</p><p><img src="/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85/1.jpg" alt></p><p>我习惯直接访问网站测试，大家也可以使用下图所示测试：</p><p><img src="/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85/2.jpg" alt></p><p>访问正常，我们打开Chrome游览器的代理设置，显示如下图所示：</p><p><img src="/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85/3.jpg" alt></p><p>图一</p><p><strong>1、配置抓取网站的数据包</strong></p><p>准备工作做好，接下来开始配置Charles抓包工具：</p><p><img src="/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85/4.jpg" alt></p><p>依次点击之后我看到如下界面，填入图一的信息并勾选截图选项点击确定：</p><p><img src="/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85/5.jpg" alt></p><p>点击ok之后，我们打开我们的国外目标网站，抓包测试一下：</p><p><img src="/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85/如何抓取国外网站、app的包\7.jpg" alt="图片"></p><p>如图所示我们已经可以抓到包了</p><p><strong>2、接下来我们测试抓取手机端的数据包：</strong></p><p>手机设置好代理之后</p><p>我们查询一下ip，如图所示</p><p><img src="/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85/6.jpg" alt></p><p>ok，接下来我么就可以抓取手机的app了</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;前期准备：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;  配置好的Charles抓包工具，（可以抓正常国内的APP端和网页端的包）&lt;/p&gt;
&lt;p&gt;  设置好的vpn，（可以访问国外的网站）&lt;/p&gt;
    
    </summary>
    
    
      <category term="抓包" scheme="http://yoursite.com/categories/%E6%8A%93%E5%8C%85/"/>
    
    
      <category term="抓包，" scheme="http://yoursite.com/tags/%E6%8A%93%E5%8C%85%EF%BC%8C/"/>
    
  </entry>
  
</feed>
