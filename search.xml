<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>mitmproxy-ca-cert.pem证书安装不上，终极解决办法手机证书文件安装</title>
    <url>/2022/03/10/mitmproxy-ca-cert-pem%E8%AF%81%E4%B9%A6%E5%AE%89%E8%A3%85%E4%B8%8D%E4%B8%8A%EF%BC%8C%E7%BB%88%E6%9E%81%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95%E6%89%8B%E6%9C%BA%E8%AF%81%E4%B9%A6%E6%96%87%E4%BB%B6%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<p>mitmproxy-ca-cert.pem证书安装不上,终极解决办法手机证书文件安装</p>
<a id="more"></a>
<p><strong>在mitmproxy软件证书配置中，其中手机的证书安装过程一般为：</strong></p>
<p>​    将mitmproxy-ca-cert.pem”文件发送到手机上，点击证书文件，便会出现一个安装窗口。</p>
<p>但是，我的Android手机并不识别pem文件，如华为荣耀10 ，华为Nova青春版。</p>
<p><strong>解决方法为：</strong></p>
<p>（打开手机“设置”；选择“安全和隐私”；点击“更多安全设置”，找到“从SD卡安装”；搜索该证书文件，点击安装.）</p>
<p>1  设置</p>
<p>2 安全与隐私</p>
<p>3 更多安全设置</p>
<p>4 从存储设备安装</p>
<p>5 选中证书文件，点击安装</p>
<p>6 输入锁屏密码</p>
<p>7 给安装文件命名mitmproxy</p>
<p>8 结束了，完成安装！！！</p>
<p><strong>结束语</strong>：</p>
<p>​    今天的分享就到这里了，欢迎大家关注微信公众号”<strong>菜鸟童靴</strong>“</p>
]]></content>
      <categories>
        <category>技术杂谈</category>
      </categories>
      <tags>
        <tag>科学上网</tag>
        <tag>mitmproxy</tag>
      </tags>
  </entry>
  <entry>
    <title>Android10不能使用uiautomatorviewer定位元素的终极解决</title>
    <url>/2022/03/10/Android10%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8uiautomatorviewer%E5%AE%9A%E4%BD%8D%E5%85%83%E7%B4%A0%E7%9A%84%E7%BB%88%E6%9E%81%E8%A7%A3%E5%86%B3/</url>
    <content><![CDATA[<p>Android app 元素定位除了使用Appium 、Inspector 、Airtest外，还可以使用Android SDK 里tools中的uiautomatorviewer 工具。</p>
<a id="more"></a>
<p>但今天打算使用 uiautomatorviewer 进行元素定位的时候，发现无法截图，并报如下错误：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Unexpected</span> <span class="selector-tag">error</span> <span class="selector-tag">while</span> <span class="selector-tag">obtaining</span> <span class="selector-tag">UI</span> <span class="selector-tag">hierarchy</span></span><br></pre></td></tr></table></figure>
<p><strong>点击Details</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">java.lang.reflect.InvocationTargetException</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/10/Android10%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8uiautomatorviewer%E5%AE%9A%E4%BD%8D%E5%85%83%E7%B4%A0%E7%9A%84%E7%BB%88%E6%9E%81%E8%A7%A3%E5%86%B3/1.jpg" style="zoom: 50%;"></p>
<p><strong>原先使用过啊，没一点问题啊</strong>：</p>
<p>查找资料了解到，从Android 8.0开始，SDK 工具软件包在新版本中已经弃用，所以tools里的uiautomatorviewer工具都不支持了。于是开始查找解决方法。</p>
<p><strong>查找资料找到解决办法</strong>：</p>
<p>1，使用adb命令截图，再导入uiautomatorviewer进行定位。这种方法虽然可行，但太麻烦了。</p>
<p>2，下载修改过的 uiautomatorviewer.bat，将tools里的uiautomatorviewer.bat文件替换掉。</p>
<p><strong>3，终极方法！！！！将SDK目录中tools文件夹下lib中的ddmlib、ddms、ddmuilib 、uiautomatorviewer这四个jar文件替换掉即可。下面是这四个新文件的下载地址：</strong></p>
<p> 链接：<a href="https://pan.baidu.com/s/1NIPNk8ApQIPveVkAfVOpJA" target="_blank" rel="noopener">https://pan.baidu.com/s/1NIPNk8ApQIPveVkAfVOpJA</a><br> 提取码：k5rc<br> <strong>替换完成后，重新打开tools中uiautomatorviewer.bat即可进行元素定位。</strong></p>
<p><img src="/2022/03/10/Android10%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8uiautomatorviewer%E5%AE%9A%E4%BD%8D%E5%85%83%E7%B4%A0%E7%9A%84%E7%BB%88%E6%9E%81%E8%A7%A3%E5%86%B3/end.jpg" style="zoom: 50%;"></p>
<p><strong>结束语</strong>：</p>
<p>​    今天的分享就到这里了，欢迎大家关注微信公众号<strong>菜鸟童靴</strong></p>
]]></content>
      <categories>
        <category>爬虫</category>
      </categories>
      <tags>
        <tag>自动化</tag>
        <tag>ui</tag>
      </tags>
  </entry>
  <entry>
    <title>Autojs通过VSCode电脑进行调试</title>
    <url>/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/</url>
    <content><![CDATA[<p>hello 大家好我是Monday，今天给大家带来一篇关于自动化的文章，Auto js如何通过VS Code电脑进行调试？</p>
<a id="more"></a>
<h2 id="前提："><a href="#前提：" class="headerlink" title="前提："></a>前提：</h2><p>首先手机里面安装AutoJs app, 官方代码，</p>
<p>apk 在release 里面下载： <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fhyb1996%2FAuto.js" target="_blank" rel="noopener">https://github.com/hyb1996/Auto.js</a></p>
<p>官方下载VS code:  <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fcode.visualstudio.com%2F" target="_blank" rel="noopener">https://code.visualstudio.com/</a></p>
<h2 id="一、vscode启动Auto-js"><a href="#一、vscode启动Auto-js" class="headerlink" title="一、vscode启动Auto.js"></a>一、vscode启动Auto.js</h2><h3 id="1-vscode里安装auto-js插件"><a href="#1-vscode里安装auto-js插件" class="headerlink" title="1.vscode里安装auto.js插件"></a>1.vscode里安装auto.js插件</h3><p><img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/1.png" style="zoom: 100%;"></p>
<h3 id="2-ctrl-shift-p调出命令面板"><a href="#2-ctrl-shift-p调出命令面板" class="headerlink" title="2.ctrl + shift + p调出命令面板"></a>2.ctrl + shift + p调出命令面板</h3><p><img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/2.png" style="zoom: 100%;"></p>
<p> <img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/3.png" style="zoom: 100%;"></p>
<h2 id="二、连接手机操作"><a href="#二、连接手机操作" class="headerlink" title="二、连接手机操作"></a>二、连接手机操作</h2><h3 id="1、ipconfig查看自己本机ip"><a href="#1、ipconfig查看自己本机ip" class="headerlink" title="1、ipconfig查看自己本机ip"></a>1、ipconfig查看自己本机ip</h3><h3 id="2、手机打开Auto-js侧边选项卡—-gt-连接电脑——-gt-输入ip地址。与电脑同意局域网，或者手机连接电脑无线"><a href="#2、手机打开Auto-js侧边选项卡—-gt-连接电脑——-gt-输入ip地址。与电脑同意局域网，或者手机连接电脑无线" class="headerlink" title="2、手机打开Auto.js侧边选项卡—-&gt;连接电脑——&gt;输入ip地址。与电脑同意局域网，或者手机连接电脑无线"></a>2、手机打开Auto.js侧边选项卡—-&gt;连接电脑——&gt;输入ip地址。与电脑同意局域网，或者手机连接电脑无线</h3><p><img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/4.png" style="zoom: 100%;"></p>
<h4 id="此时可以看到连接成功"><a href="#此时可以看到连接成功" class="headerlink" title="此时可以看到连接成功"></a>此时可以看到连接成功</h4><p><img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/5.png" style="zoom: 100%;"></p>
<p> 在vscode里新建js文件，按f5或命令run，就可以在手机上运行</p>
<p><img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/6.png" style="zoom: 100%;"></p>
<p>手机弹出toast</p>
<p><img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/7.png" style="zoom: 100%;"></p>
<p>保存文件，ctrl + shift + p</p>
<p><img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/8.png" style="zoom: 100%;"></p>
<p> 可以看到连接的手机信息，选择就能保存成功</p>
<p><img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/9.png" style="zoom: 100%;"></p>
<p> <img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/10.png" style="zoom: 100%;"></p>
<p><img src="/2022/03/10/Autojs%E9%80%9A%E8%BF%87VSCode%E7%94%B5%E8%84%91%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95/11.png" style="zoom: 100%;"></p>
<h1 id="插件常用命令"><a href="#插件常用命令" class="headerlink" title="插件常用命令"></a>插件常用命令</h1><p>Start Server: 启动插件服务。之后在确保手机和电脑在同一区域网的情况下，在Auto.js的侧拉菜单中使用连接电脑功能连接。<br>Stop Server: 停止插件服务。<br>Run 运行当前编辑器的脚本。如果有多个设备连接，则在所有设备运行。<br>Rerun 停止当前文件对应的脚本并重新运行。如果有多个设备连接，则在所有设备重新运行。<br>Stop 停止当前文件对应的脚本。如果有多个设备连接，则在所有设备停止。<br>StopAll 停止所有正在运行的脚本。如果有多个设备连接，则在所有设备运行所有脚本。<br>Save 保存当前文件到手机的脚本默认目录（文件名会加上前缀remote)。如果有多个设备连接，则在所有设备保存。<br>RunOnDevice: 弹出设备菜单并在指定设备运行脚本。<br>SaveToDevice: 弹出设备菜单并在指定设备保存脚本。<br>New Project（新建项目）：选择一个空文件夹（或者在文件管理器中新建一个空文件夹），将会自动创建一个项目<br>Run Project（运行项目）：运行一个项目，需要Auto.js 4.0.4Alpha5以上支持<br>Save Project（保存项目）：保存一个项目，需要Auto.js 4.0.4Alpha5以上支持</p>
<p><strong>结束语</strong>：</p>
<p>​    今天的分享就到这里了，欢迎大家关注微信公众号”<strong>菜鸟童靴</strong>“</p>
]]></content>
      <categories>
        <category>爬虫</category>
      </categories>
      <tags>
        <tag>自动化</tag>
        <tag>爬虫</tag>
      </tags>
  </entry>
  <entry>
    <title>mitmproxy安装和使用方法总结</title>
    <url>/2022/03/09/mitmproxy%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<hr>
<p>笔记_mitmproxy安装和使用方法总结</p>
<a id="more"></a>
<p><strong>MitmProxy 介绍</strong>：</p>
<p>支持 HTTP 和 HTTPS 的抓包程序，类似 Fiddler、Charles 的功能，只不过它是一个控制台的形式操作。<br>同时 MitmProxy 还有两个关联组件，一个是 MitmDump，它是 MitmProxy 的命令行接口，利用它我们可以对接 Python 脚本，用 Python 实现监听后的处理。另一个是 MitmWeb，它是一个 Web 程序，通过它我们可以清楚地观察到 MitmProxy 捕获的请求。</p>
<p><strong>相关链接</strong></p>
<p>mitmproxy不错的中文学习网站 <a href="https://blog.wolfogre.com/posts/usage-of-mitmproxy/" target="_blank" rel="noopener">https://blog.wolfogre.com/posts/usage-of-mitmproxy/</a> </p>
<p>GitHub：<a href="https://github.com/mitmproxy/mitmproxy" target="_blank" rel="noopener">https://github.com/mitmproxy/mitmproxy</a><br>官方网站：<a href="https://mitmproxy.org" target="_blank" rel="noopener">https://mitmproxy.org</a><br>PyPi：<a href="https://pypi.python.org/pypi/mitmproxy" target="_blank" rel="noopener">https://pypi.python.org/pypi/mitmproxy</a><br>官方文档：<a href="http://docs.mitmproxy.org" target="_blank" rel="noopener">http://docs.mitmproxy.org</a><br>MitmDump脚本：<a href="http://docs.mitmproxy.org/en/stable/scripting/overview.html" target="_blank" rel="noopener">http://docs.mitmproxy.org/en/stable/scripting/overview.html</a><br>下载地址：<a href="https://github.com/mitmproxy/mitmproxy/releases" target="_blank" rel="noopener">https://github.com/mitmproxy/mitmproxy/releases</a><br>DockerHub：<a href="https://hub.docker.com/r/mitmproxy/mitmproxy" target="_blank" rel="noopener">https://hub.docker.com/r/mitmproxy/mitmproxy</a></p>
<p>报错可能解决方案： <a href="https://blog.csdn.net/andrew_wf/article/details/84991989" target="_blank" rel="noopener">https://blog.csdn.net/andrew_wf/article/details/84991989</a> </p>
<p><strong>安装：</strong></p>
<p> pip install mitmproxy </p>
<p> 这是最简单和通用的安装方式，执行完毕之后即可完成 MitmProxy的安装，另外还安装了MitmDump、MitmWeb 两个组件 </p>
<p><strong>安装证书</strong></p>
<p>安装好mitmproxy后，到C:\Users\Administrator.mitmproxy目录下</p>
<p><strong>电脑安装证书：</strong><br>mitmproxy-ca.p12</p>
<p>双击下一，直到最后</p>
<p><strong>手机安装证书：</strong><br>mitmproxy-ca.pem</p>
<p><strong>手机模拟器安装证书：</strong></p>
<p>mitmproxy-ca.pem</p>
<p>设置-安全-从SD卡导入证书即可</p>
<p><strong>这样我们就可以愉快的使用mitmproxy去搞一些事情了：</strong></p>
<p><strong>我下面用它抓取一下，皮皮虾app推荐模块抓取：</strong></p>
<p>首先建立两个py文件，一个用于app的视频json信息的抓取</p>
<p><strong>(1)get_request_data.py</strong>  :</p>
<p>用来获取视频列表的url和headers</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">'../'</span>)</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> mitmproxy</span><br><span class="line"><span class="keyword">from</span> mitmproxy <span class="keyword">import</span> http</span><br><span class="line"><span class="keyword">from</span> mitmproxy <span class="keyword">import</span> flow, proxy, controller, options</span><br><span class="line"><span class="keyword">from</span> mitmproxy.proxy.server <span class="keyword">import</span> ProxyServer</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">程序运行</span></span><br><span class="line"><span class="string"> mitmdump -s xxxx.py</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">response</span><span class="params">(flow)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'https://it.snssdk.com/bds/feed/stream/'</span> <span class="keyword">in</span> flow.request.url:</span><br><span class="line">        datas = flow.request.headers</span><br><span class="line">        headers = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> k,v <span class="keyword">in</span> datas.items():</span><br><span class="line">            headers[k] = v</span><br><span class="line">        print(<span class="string">f'root_url&gt;&gt;&gt;<span class="subst">&#123;flow.request.url&#125;</span>&lt;&lt;&lt;headers&gt;&gt;&gt;<span class="subst">&#123;headers&#125;</span>&lt;&lt;&lt;'</span>)</span><br></pre></td></tr></table></figure>
<p><strong>(2)spider_data.py</strong>  :</p>
<p>对获取到url和headers进行对视频信息的抓取</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">管道执行命令</span></span><br><span class="line"><span class="string"> mitmdump -s &lt;python1.y&gt; | python &lt;python2.py&gt;</span></span><br><span class="line"><span class="string">  mitmdump -s test.py | python receive.py</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">from</span> jsonpath <span class="keyword">import</span> jsonpath</span><br><span class="line"><span class="keyword">from</span> glom <span class="keyword">import</span> glom</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> sys.stdin:</span><br><span class="line">    root_url = re.search(<span class="string">'root_url&gt;&gt;&gt;(.*?)&lt;&lt;&lt;'</span>, line)</span><br><span class="line">    headers = re.search(<span class="string">'headers&gt;&gt;&gt;(.*?)&lt;&lt;&lt;'</span>, line)</span><br><span class="line">    <span class="keyword">if</span> root_url <span class="keyword">and</span> headers:</span><br><span class="line">        html = requests.get(root_url.group(<span class="number">1</span>),headers=eval(headers.group(<span class="number">1</span>)))</span><br><span class="line">        html.encoding = <span class="string">'utf-8'</span></span><br><span class="line">        data_info = html.json()</span><br><span class="line"></span><br><span class="line">        data_list = glom(data_info, <span class="string">'data.data'</span>)</span><br><span class="line">        <span class="keyword">for</span> datas <span class="keyword">in</span> data_list:</span><br><span class="line">            data = glom(datas, <span class="string">'item.share'</span>)</span><br><span class="line">            title = <span class="string">''</span>.join(jsonpath(data, <span class="string">"$..title"</span>))</span><br><span class="line">            url = <span class="string">''</span>.join(jsonpath(data, <span class="string">"$..compound_page_url"</span>))</span><br><span class="line">            image_url = <span class="string">''</span>.join(jsonpath(data, <span class="string">"$..image_url"</span>))</span><br><span class="line">            video_url = glom(datas, <span class="string">'item.origin_video_download.url_list'</span>)[<span class="number">0</span>].get(<span class="string">'url'</span>)</span><br><span class="line"></span><br><span class="line">            release_time = datas[<span class="string">'item'</span>][<span class="string">'create_time'</span>]</span><br><span class="line">            print(title)</span><br><span class="line">            print(url)</span><br><span class="line">            print(image_url)</span><br><span class="line">            print(video_url)</span><br><span class="line">            print(release_time)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p><strong>怎么运行：</strong></p>
<p>进入cmd，窗口</p>
<p>mitmdump -s get_request_data.py | python spider_data.py</p>
<p>在手机端滑动就行了</p>
<p><strong>总结：</strong></p>
<p>中间抓取思路有很多种，get_request_data.py在文件里print()的信息写到文件里或数据库里，mitmdump -s get_request_data.py  在窗口执行这个命令，我们单独在写个程序，扫描数据库或文件，单独进行抓取数据</p>
<p>本文这个，只是小编想用一下，管道命令，</p>
<p><strong>结束语</strong>：</p>
<p> 今天的分享就到这里了，欢迎大家关注微信公众号”<strong>菜鸟童靴</strong>“</p>
]]></content>
      <categories>
        <category>技术杂谈</category>
      </categories>
      <tags>
        <tag>科学上网</tag>
        <tag>mitmproxy</tag>
      </tags>
  </entry>
  <entry>
    <title>安卓7.0以上手机写入安全证书</title>
    <url>/2022/03/09/%E5%AE%89%E5%8D%937-0%E4%BB%A5%E4%B8%8A%E6%89%8B%E6%9C%BA%E5%86%99%E5%85%A5%E5%AE%89%E5%85%A8%E8%AF%81%E4%B9%A6/</url>
    <content><![CDATA[<p>安卓7.0以上手机写入安全证书，具体操作？</p>
<a id="more"></a>
<h3 id="1、背景："><a href="#1、背景：" class="headerlink" title="1、背景："></a><strong>1、背景：</strong></h3><p>谷歌在安卓7.0修改了安全策略，用户添加的CA证书不能再用于安全连接，</p>
<p>对于https传输的数据就抓取不到了，会显示<strong>“<unknown></unknown></strong>“。</p>
<p>既然又知道了原因，那就总还是有办法去解决的。我们只要把代理软件的根证书安装成系统证书就可以了。</p>
<h3 id="2、解决方法及操作方法"><a href="#2、解决方法及操作方法" class="headerlink" title="2、解决方法及操作方法"></a><strong>2、解决方法及操作方法</strong></h3><p>实际上将证书安装到系统区操作还是相对简单的，</p>
<p><strong>（1）将证书用指定的名称放到指定的位置就可以了</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;system&#x2F;etc&#x2F;security&#x2F;cacerts&#x2F;</span><br></pre></td></tr></table></figure>
<p><strong>（2）先将我们的根证书名称改为</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;Certificate_Hash&gt;.&lt;Number&gt;</span><br></pre></td></tr></table></figure>
<p>Certificate_Hash表示证书文件的hash值，Number是为了防止证书文件的hash值一致而增加的后缀（用0就行了）</p>
<p><strong>（3）下载自己的根证书FiddlerRoot.cer，使用</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">openssl x509 -subject_hash_old -in &lt;Certificate_File&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/09/%E5%AE%89%E5%8D%937-0%E4%BB%A5%E4%B8%8A%E6%89%8B%E6%9C%BA%E5%86%99%E5%85%A5%E5%AE%89%E5%85%A8%E8%AF%81%E4%B9%A6/1.jpg" style="zoom: 150%;"></p>
<p>计算证书hash ，根据hash将证书重命名为 c8750f0d.0（c8750f0d.0是笔者证书的hash，大家的肯定不一样）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cp ***.pem c8750f0d.0</span><br></pre></td></tr></table></figure>
<p>然后将c8750f0d.0文件复制到</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;system&#x2F;etc&#x2F;security&#x2F;cacerts&#x2F;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/09/%E5%AE%89%E5%8D%937-0%E4%BB%A5%E4%B8%8A%E6%89%8B%E6%9C%BA%E5%86%99%E5%85%A5%E5%AE%89%E5%85%A8%E8%AF%81%E4%B9%A6/2.jpg" style="zoom: 150%;"></p>
<p>完成后我们就可以看到代理软件的证书出现在系统区了。</p>
<p><strong>这里还有一点需要单独说明，/system/etc/security/cacerts/目录的写权限，需要手机root权限。</strong></p>
<h3 id="3、将证书安装到System中"><a href="#3、将证书安装到System中" class="headerlink" title="3、将证书安装到System中"></a>3、将证书安装到System中</h3><p>不要直接用adb push，安卓5以后有问题，不通用。</p>
<p><strong>（1）重启adb，作为root启动</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb root</span><br></pre></td></tr></table></figure>
<p><strong>（2）获取Android设备上访问/system的权限</strong></p>
<p>在早期的Android版本中（API LEVEL &lt; 28），需要使用如下命令获得访问权限：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb shell su -c &quot;mount -o rw,remount &#x2F;system&quot;</span><br></pre></td></tr></table></figure>
<p>API LEVEL &gt;= 29，否则，使用如下命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb shell su -c &quot;mount -o rw,remount &#x2F;system&quot;</span><br></pre></td></tr></table></figure>
<p>（<strong>3）将自己的证书push到系统证书目录</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb push c8750f0d.0 &#x2F;system&#x2F;etc&#x2F;security&#x2F;cacerts </span><br><span class="line">adb shell &quot;chmod 664 &#x2F;system&#x2F;etc&#x2F;security&#x2F;cacerts&#x2F;c8750f0d.0&quot;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/09/%E5%AE%89%E5%8D%937-0%E4%BB%A5%E4%B8%8A%E6%89%8B%E6%9C%BA%E5%86%99%E5%85%A5%E5%AE%89%E5%85%A8%E8%AF%81%E4%B9%A6/3.jpg" style="zoom: 150%;"></p>
<h4 id="3-1、如果失敗了，解决办法："><a href="#3-1、如果失敗了，解决办法：" class="headerlink" title="3.1、如果失敗了，解决办法："></a><strong>3.1、如果失敗了，解决办法：</strong></h4><p>（<strong>1）通过微信传输文件后，点击保存文件到手机，</strong> </p>
<p>​        文件的目录存放的位置： /sdcard/Download/WeiXin</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mido:&#x2F;sdcard&#x2F;Download&#x2F;WeiXin # pwd</span><br><span class="line">&#x2F;sdcard&#x2F;Download&#x2F;WeiXin</span><br><span class="line">mido:&#x2F;sdcard&#x2F;Download&#x2F;WeiXin # cp c8750f0d.0 &#x2F;system&#x2F;etc&#x2F;security&#x2F;cacerts&#x2F;</span><br><span class="line">mido:&#x2F;sdcard&#x2F;Download&#x2F;WeiXin #</span><br></pre></td></tr></table></figure>
<p><strong>（2）如果修改了之后还是提示Read-only file system，还有方法</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb root</span><br><span class="line"></span><br><span class="line">adb disable-verity</span><br><span class="line"></span><br><span class="line">adb reboot #手机会重启，不用关闭cmd窗口，手机可能需要拔掉数据写重新连接</span><br><span class="line"></span><br><span class="line">adb root</span><br><span class="line"></span><br><span class="line">adb shell </span><br><span class="line"></span><br><span class="line">mount -o rw,remount &#x2F;system  #再次进行修改</span><br></pre></td></tr></table></figure>
<p><strong>(3)如果还是错误还是报错’/system’ not in /proc/mounts</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mount -o rw,remount -t auto &#x2F;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/03/09/%E5%AE%89%E5%8D%937-0%E4%BB%A5%E4%B8%8A%E6%89%8B%E6%9C%BA%E5%86%99%E5%85%A5%E5%AE%89%E5%85%A8%E8%AF%81%E4%B9%A6/4.jpg" style="zoom: 150%;"></p>
<p>验证成功</p>
<p><img src="/2022/03/09/%E5%AE%89%E5%8D%937-0%E4%BB%A5%E4%B8%8A%E6%89%8B%E6%9C%BA%E5%86%99%E5%85%A5%E5%AE%89%E5%85%A8%E8%AF%81%E4%B9%A6/5.jpg" style="zoom: 150%;"></p>
<p><strong>结束语</strong>：</p>
<p>​    今天的分享就到这里了，欢迎大家关注微信公众号”<strong>菜鸟童靴</strong>“</p>
]]></content>
      <categories>
        <category>爬虫</category>
      </categories>
      <tags>
        <tag>抓包</tag>
        <tag>证书</tag>
      </tags>
  </entry>
  <entry>
    <title>github访问慢，一直不成功，难道非得科学上网吗</title>
    <url>/2022/03/06/github%E8%AE%BF%E9%97%AE%E6%85%A2%EF%BC%8C%E4%B8%80%E7%9B%B4%E4%B8%8D%E6%88%90%E5%8A%9F%EF%BC%8C%E9%9A%BE%E9%81%93%E9%9D%9E%E5%BE%97%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E5%90%97/</url>
    <content><![CDATA[<p>github访问慢，一直不成功，难道非得科学上网吗，今天小编给你带来终极解决方案，让你不再为此而烦恼</p>
<a id="more"></a>
<h3 id="背景："><a href="#背景：" class="headerlink" title="背景："></a>背景：</h3><p>​        github上有很多优秀的资源和项目，对程序员开发成长的有效平台之一，但是国内访问github的并不是那么友好</p>
<p>经常会出现访问一直转圈圈，访问慢，或者超时失败，小编在今天之前一直都是科学上网的方式，解决现状，今天服务</p>
<p>费软件到期后，忽然访问不了，又不想续费了，所以找了找网上有没有可行性的解决方案，一搜不知道，还真有，</p>
<p>接下来小编给大家案例两种方式的访问，方式一：dev-sidecar、方式二GitHub520 </p>
<h3 id="1、dev-sidecar"><a href="#1、dev-sidecar" class="headerlink" title="1、dev-sidecar"></a>1、dev-sidecar</h3><p>开发者边车，命名取自service-mesh的service-sidecar，意为为开发者打辅助的边车工具<br>通过本地代理的方式将https请求代理到一些国内的加速通道上</p>
<h4 id="1-1开源网址："><a href="#1-1开源网址：" class="headerlink" title="1.1开源网址："></a>1.1开源网址：</h4><p><a href="https://gitee.com/docmirror/dev-sidecar" target="_blank" rel="noopener">https://gitee.com/docmirror/dev-sidecar</a></p>
<h4 id="1-2特性："><a href="#1-2特性：" class="headerlink" title="1.2特性："></a>1.2特性：</h4><p>1、 dns优选</p>
<p>2、 请求拦截</p>
<p>3、 github加速</p>
<p>4、 Stack Overflow 加速</p>
<p>5、 npm加速</p>
<h4 id="1-3安装使用"><a href="#1-3安装使用" class="headerlink" title="1.3安装使用"></a>1.3安装使用</h4><h5 id="1-3-1选择平台下载"><a href="#1-3-1选择平台下载" class="headerlink" title="1.3.1选择平台下载"></a>1.3.1选择平台下载</h5><p><img src="/2022/03/06/github%E8%AE%BF%E9%97%AE%E6%85%A2%EF%BC%8C%E4%B8%80%E7%9B%B4%E4%B8%8D%E6%88%90%E5%8A%9F%EF%BC%8C%E9%9A%BE%E9%81%93%E9%9D%9E%E5%BE%97%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E5%90%97/1646572766.jpg" style="zoom: 50%;"></p>
<p>​    </p>
<p>此项目支持平台有很多，这边以window为例，我直接下载安装，傻瓜式安装，</p>
<h5 id="1-3-2-安装根证书"><a href="#1-3-2-安装根证书" class="headerlink" title="1.3.2 安装根证书"></a>1.3.2 安装根证书</h5><p>第一次打开会提示安装证书，根据提示操作即可</p>
<p>更多有关根证书的说明，请参考 <a href="https://gitee.com/docmirror/dev-sidecar/blob/master/doc/caroot.md" target="_blank" rel="noopener">为什么要安装根证书?</a></p>
<blockquote>
<p>根证书是本地随机生成的，所以不用担心根证书的安全问题（本应用不收集任何用户信息）<br>你也可以在加速服务设置中自定义根证书（PEM格式的证书与私钥）</p>
<p>火狐浏览器需要<a href="https://gitee.com/docmirror/dev-sidecar#3浏览器打开提示证书不受信任" target="_blank" rel="noopener">手动安装证书</a></p>
</blockquote>
<h5 id="1-3-4开始加速吧"><a href="#1-3-4开始加速吧" class="headerlink" title="1.3.4开始加速吧"></a>1.3.4开始加速吧</h5><p><img src="/2022/03/06/github%E8%AE%BF%E9%97%AE%E6%85%A2%EF%BC%8C%E4%B8%80%E7%9B%B4%E4%B8%8D%E6%88%90%E5%8A%9F%EF%BC%8C%E9%9A%BE%E9%81%93%E9%9D%9E%E5%BE%97%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E5%90%97/1646572959.jpg" style="zoom: 50%;"></p>
<p>去试试打开github</p>
<h3 id="2、-GitHub520"><a href="#2、-GitHub520" class="headerlink" title="2、 GitHub520"></a>2、 GitHub520</h3><h4 id="2-1开源网址："><a href="#2-1开源网址：" class="headerlink" title="2.1开源网址："></a>2.1开源网址：</h4><p><a href="https://gitee.com/doshengl/GitHub520" target="_blank" rel="noopener">https://gitee.com/doshengl/GitHub520</a></p>
<h4 id="2-2安装使用"><a href="#2-2安装使用" class="headerlink" title="2.2安装使用"></a>2.2安装使用</h4><h5 id="2-2-1-手动方式（每次得手动更新不推荐）"><a href="#2-2-1-手动方式（每次得手动更新不推荐）" class="headerlink" title="2.2.1 手动方式（每次得手动更新不推荐）"></a>2.2.1 手动方式（每次得手动更新不推荐）</h5><h5 id="2-2-1-1-修改-hosts-文件"><a href="#2-2-1-1-修改-hosts-文件" class="headerlink" title="2.2.1.1 修改 hosts 文件"></a>2.2.1.1 修改 hosts 文件</h5><p>hosts 文件在每个系统的位置不一，详情如下：</p>
<ul>
<li>Windows 系统：<code>C:\Windows\System32\drivers\etc\hosts</code></li>
<li>Linux 系统：<code>/etc/hosts</code></li>
<li>Mac（苹果电脑）系统：<code>/etc/hosts</code></li>
<li>Android（安卓）系统：<code>/system/etc/hosts</code></li>
<li>iPhone（iOS）系统：<code>/etc/hosts</code></li>
</ul>
<p>修改方法，把第一步的内容复制到文本末尾：</p>
<ol>
<li>Windows 使用记事本。</li>
<li>Linux、Mac 使用 Root 权限：<code>sudo vi /etc/hosts</code>。</li>
<li>iPhone、iPad 须越狱、Android 必须要 root。</li>
</ol>
<h6 id="2-2-1-2-激活生效"><a href="#2-2-1-2-激活生效" class="headerlink" title="2.2.1.2 激活生效"></a>2.2.1.2 激活生效</h6><p>大部分情况下是直接生效，如未生效可尝试下面的办法，刷新 DNS：</p>
<ol>
<li>Windows：在 CMD 窗口输入：<code>ipconfig /flushdns</code></li>
<li>Linux 命令：<code>sudo nscd restart</code>，如报错则须安装：<code>sudo apt install nscd</code> 或 <code>sudo /etc/init.d/nscd restart</code></li>
<li>Mac 命令：<code>sudo killall -HUP mDNSResponder</code></li>
</ol>
<p><strong>Tips：</strong> 上述方法无效可以尝试重启机器。</p>
<h4 id="2-2-2-自动方式"><a href="#2-2-2-自动方式" class="headerlink" title="2.2.2 自动方式"></a>2.2.2 自动方式</h4><p><strong>Tip</strong>：推荐 <a href="https://gitee.com/link?target=https%3A%2F%2Fgithub.com%2Foldj%2FSwitchHosts">SwitchHosts</a> 工具管理 hosts</p>
<p>以 SwitchHosts 为例，看一下怎么使用的，配置参考下面：</p>
<ul>
<li>Title: 随意</li>
<li>Type: <code>Remote</code></li>
<li>URL: <code>https://raw.hellogithub.com/hosts</code></li>
<li>Auto Refresh: 最好选 <code>1 hour</code></li>
</ul>
<p>如图：</p>
<p><img src="/2022/03/06/github%E8%AE%BF%E9%97%AE%E6%85%A2%EF%BC%8C%E4%B8%80%E7%9B%B4%E4%B8%8D%E6%88%90%E5%8A%9F%EF%BC%8C%E9%9A%BE%E9%81%93%E9%9D%9E%E5%BE%97%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E5%90%97/switch-hosts.png" style="zoom: 50%;"></p>
<p>这样每次 hosts 有更新都能及时进行更新，免去手动更新。</p>
<p><strong>结束语</strong>：</p>
<p>​    今天的分享就到这里了，欢迎大家关注微信公众号”<strong>菜鸟童靴</strong>“</p>
]]></content>
      <categories>
        <category>技术杂谈</category>
      </categories>
      <tags>
        <tag>github</tag>
        <tag>科学上网</tag>
      </tags>
  </entry>
  <entry>
    <title>pandas案例学习100例（一）</title>
    <url>/2022/02/18/pandas%E6%A1%88%E4%BE%8B%E5%AD%A6%E4%B9%A0100%E4%BE%8B%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    <content><![CDATA[<p>hello 大家好，长时间没有发布新的文章，证明小编在这段日子不是很忙，就是很堕落，显然是后者了</p>
<p>捡起键盘，准备推出pandas 案例100系列，分十次记录学习，多了你也看不进去，我也写不进去：</p>
<a id="more"></a>
<p><strong>案例1：</strong></p>
<p>生成一年中，所有周一的日期：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#生成一年中，所有周一的日期</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">date_range = pd.date_range(start=<span class="string">'2021-01-01'</span>, end=<span class="string">'2021-12-31'</span>, freq=<span class="string">"W-MON"</span>)</span><br><span class="line">date_range = pd.date_range(start=<span class="string">'2021-01-01'</span>, periods=<span class="number">52</span>, freq=<span class="string">"W-MON"</span>)  <span class="comment"># 一年52个周</span></span><br><span class="line">print(date_range)</span><br></pre></td></tr></table></figure>
<p><strong>案例2：</strong></p>
<p>生成一个月份的所有日期</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 生成一个月份的所有日期</span></span><br><span class="line">date_range = pd.date_range(start=<span class="string">'2021-12-01'</span>, end=<span class="string">'2021-12-31'</span>)</span><br><span class="line">date_range = pd.date_range(start=<span class="string">'2021-12-01'</span>, periods=<span class="number">31</span>)  <span class="comment"># 一個月31天</span></span><br><span class="line">print(date_range)</span><br></pre></td></tr></table></figure>
<p><strong>案例3：</strong></p>
<p>生成一天的所有小時</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#生成一天的所有小時</span></span><br><span class="line">date_range = pd.date_range(start=<span class="string">'2021-12-01'</span>, periods=<span class="number">24</span>, freq=<span class="string">"H"</span>)</span><br><span class="line">date_range = pd.date_range(start=<span class="string">'2021-12-01'</span>, end=<span class="string">'2021-12-02'</span>, closed=<span class="string">"left"</span>, freq=<span class="string">"H"</span>)</span><br><span class="line">print(date_range)</span><br></pre></td></tr></table></figure>
<p><strong>案例4：</strong></p>
<p>使用list构造 Series</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment"># 使用list构造 Series</span></span><br><span class="line">sites = [<span class="string">"Google"</span>, <span class="string">"Runoob"</span>, <span class="string">"Wiki"</span>]</span><br><span class="line">myvar = pd.Series(sites)</span><br><span class="line">print(myvar)</span><br></pre></td></tr></table></figure>
<p><strong>案例5：</strong></p>
<p>使用dict 构造 Series</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用dict 构造 Series</span></span><br><span class="line">sites = &#123;<span class="string">'x'</span>: <span class="string">"Google"</span>, <span class="string">'y'</span>: <span class="string">"Runoob"</span>, <span class="string">'z'</span>: <span class="string">"Wiki"</span>&#125;</span><br><span class="line">myvar = pd.Series(sites)</span><br><span class="line">print(myvar)</span><br></pre></td></tr></table></figure>
<p><strong>案例6：</strong></p>
<p>Series转换list</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment"># Series转换list</span></span><br><span class="line">sites = &#123;<span class="string">'x'</span>: <span class="string">"Google"</span>, <span class="string">'y'</span>: <span class="string">"Runoob"</span>, <span class="string">'z'</span>: <span class="string">"Wiki"</span>&#125;</span><br><span class="line">myvar = pd.Series(sites)</span><br><span class="line">data = myvar.tolist()</span><br><span class="line">print(data)python</span><br></pre></td></tr></table></figure>
<p>案例7：</p>
<p>将Series转换DataFrame</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment"># 将Series转换DataFrame</span></span><br><span class="line">grades = &#123;<span class="string">'语文'</span>: <span class="string">"100"</span>, <span class="string">'数学'</span>: <span class="string">"120"</span>, <span class="string">'英语'</span>: <span class="string">"60"</span>&#125;</span><br><span class="line">myvar = pd.Series(grades)</span><br><span class="line">data = pd.DataFrame(myvar, columns=[<span class="string">"grade"</span>])</span><br><span class="line">print(data)</span><br></pre></td></tr></table></figure>
<p><strong>案例8：</strong></p>
<p>用numpy 创建Series</p>
<p>101    10.0<br>102    20.0<br>103    30.0<br>104    40.0<br>105    50.0<br>106    60.0<br>107    70.0<br>108    80.0<br>109    90.0</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment"># 用numpy 创建Series</span></span><br><span class="line">s = pd.Series(</span><br><span class="line">    np.arange(<span class="number">10</span>, <span class="number">100</span>, <span class="number">10</span>),  <span class="comment"># 数值：10-90，间隔10</span></span><br><span class="line">    index=np.arange(<span class="number">101</span>, <span class="number">110</span>),  <span class="comment"># 索引：101-109， 间隔7</span></span><br><span class="line">    dtype=<span class="string">"float"</span>  <span class="comment"># 类型：float64</span></span><br><span class="line">)</span><br><span class="line">print(s)</span><br></pre></td></tr></table></figure>
<p><strong>案例9：</strong></p>
<p> 转换Series 的数据类型</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换Series 的数据类型</span></span><br><span class="line">s = pd.Series(</span><br><span class="line">    data=[<span class="string">"001"</span>, <span class="string">"002"</span>, <span class="string">"003"</span>, <span class="string">"004"</span>],</span><br><span class="line">    index=list(<span class="string">"abcd"</span>),</span><br><span class="line">    dtype=<span class="string">"float"</span>  <span class="comment"># 类型：float64</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">s = s.astype(int)  <span class="comment"># 方法一</span></span><br><span class="line"><span class="comment"># s = s.map(int)# 方法二</span></span><br><span class="line">print(s)</span><br></pre></td></tr></table></figure>
<p><strong>案例10：</strong></p>
<p>给Series添加元素</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给Series添加元素</span></span><br><span class="line">grades = &#123;<span class="string">'语文'</span>: <span class="string">"100"</span>, <span class="string">'数学'</span>: <span class="string">"120"</span>, <span class="string">'英语'</span>: <span class="string">"60"</span>&#125;</span><br><span class="line">data = pd.Series(grades)</span><br><span class="line">data = data.append(pd.Series(&#123;</span><br><span class="line">    <span class="string">"计算机"</span>: <span class="number">30</span>,</span><br><span class="line">    <span class="string">"化学"</span>: <span class="number">45</span></span><br><span class="line">&#125;))</span><br><span class="line">print(data)</span><br></pre></td></tr></table></figure>
<p><strong>案例11：</strong></p>
<p>用reset index将Series 转换成df</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment"># 用reset index将Series 转换成df</span></span><br><span class="line">grades = &#123;<span class="string">'语文'</span>: <span class="string">"100"</span>, <span class="string">'数学'</span>: <span class="string">"120"</span>, <span class="string">'英语'</span>: <span class="string">"60"</span>&#125;</span><br><span class="line">data = pd.Series(grades)</span><br><span class="line">df = data.reset_index()</span><br><span class="line">df.columns = [<span class="string">"course"</span>, <span class="string">"grade"</span>]</span><br><span class="line">print(data)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>数据分析</category>
      </categories>
  </entry>
  <entry>
    <title>python如何批量改文件后缀和图片像素大小</title>
    <url>/2021/12/21/python%E5%A6%82%E4%BD%95%E6%89%B9%E9%87%8F%E6%94%B9%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%92%8C%E5%9B%BE%E7%89%87%E5%83%8F%E7%B4%A0%E5%A4%A7%E5%B0%8F/</url>
    <content><![CDATA[<p>hello 大家好，我是Monday，就在我写完pandas学习案例100第一篇的时候，在图片素材里找封面图时，发现已经没有新的封面图了</p>
<p>都是使用过的了，于是乎，我从网上下载了一批新的图片素材，正当我满意的时候，上传时，发现</p>
<a id="more"></a>
<p><img src="/2021/12/21/python%E5%A6%82%E4%BD%95%E6%89%B9%E9%87%8F%E6%94%B9%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%92%8C%E5%9B%BE%E7%89%87%E5%83%8F%E7%B4%A0%E5%A4%A7%E5%B0%8F/2.png" style="zoom: 50%;"></p>
<p>我下载的图片都是webp后缀的，格式不被允许上传，这时候我们改文件的后缀为平台支持的格式就可以了，</p>
<p>重点来了，那么图片难道要一个一个手动改吗，No No No，会Python的你，当然应该是写个小工具批量改了</p>
<p>附带源码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出当前目录下所有的文件</span></span><br><span class="line">path = <span class="string">r"C:\Users\xx\Desktop\公众号素材"</span></span><br><span class="line">files = os.listdir(path)</span><br><span class="line"><span class="keyword">for</span> index, filename <span class="keyword">in</span> enumerate(files):</span><br><span class="line">    portion = os.path.splitext(filename)</span><br><span class="line">    <span class="comment"># 判断后缀</span></span><br><span class="line">    <span class="keyword">if</span> portion[<span class="number">1</span>] == <span class="string">".webp"</span>:</span><br><span class="line">        <span class="comment"># 重新组合文件名和后缀名</span></span><br><span class="line">        newname = path + <span class="string">"\\"</span> + str(index) + <span class="string">".jpg"</span></span><br><span class="line">        filename = path + <span class="string">"\\"</span> + filename</span><br><span class="line">        os.rename(filename, newname)</span><br></pre></td></tr></table></figure>
<p>看下效果：</p>
<p><img src="/2021/12/21/python%E5%A6%82%E4%BD%95%E6%89%B9%E9%87%8F%E6%94%B9%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%92%8C%E5%9B%BE%E7%89%87%E5%83%8F%E7%B4%A0%E5%A4%A7%E5%B0%8F/3.jpg" style="zoom: 50%;"></p>
<p>本以为完美的落幕，然并卵再次上传，发现如下图的问题</p>
<p><img src="/2021/12/21/python%E5%A6%82%E4%BD%95%E6%89%B9%E9%87%8F%E6%94%B9%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%92%8C%E5%9B%BE%E7%89%87%E5%83%8F%E7%B4%A0%E5%A4%A7%E5%B0%8F/0.jpg" style="zoom: 50%;"></p>
<p>继续盘他，写个脚本批量更改像素:</p>
<p>源码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">IPHONE5_WIDTH = <span class="number">530</span> <span class="comment">#改变后的宽</span></span><br><span class="line">IPHONE5_HEIGHT = <span class="number">300</span><span class="comment">#改变后的高</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 改变图片的尺寸大小</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reset_pic_size</span><span class="params">(file_path, new_path, width=IPHONE5_WIDTH, height=IPHONE5_HEIGHT)</span>:</span></span><br><span class="line">    image = Image.open(file_path)</span><br><span class="line">    image_width, image_height = image.size</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> image_width &gt; width:</span><br><span class="line">        image_height = width * image_height // image_width</span><br><span class="line">        image_width = width</span><br><span class="line">    <span class="keyword">if</span> image_height &gt; height:</span><br><span class="line">        image_width = height * image_width // image_height</span><br><span class="line">        image_height = height</span><br><span class="line"></span><br><span class="line">    new_image = image.resize((image_width, image_height), Image.ANTIALIAS)  <span class="comment"># 滤镜缩放</span></span><br><span class="line">    new_image.save(new_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从文件夹中循环改变每一张图片</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_and_resize_pic_from_dir</span><span class="params">(dir_path, new_path)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(dir_path):</span><br><span class="line">        <span class="keyword">for</span> file_name <span class="keyword">in</span> files:</span><br><span class="line">            <span class="keyword">if</span> file_name.lower().endswith(<span class="string">'jpg'</span>) <span class="keyword">or</span> file_name.lower().endswith(<span class="string">'png'</span>):</span><br><span class="line">                file_path = os.path.join(root, file_name)</span><br><span class="line">                new_file_path = new_path + file_name</span><br><span class="line">                reset_pic_size(file_path=file_path, new_path=new_file_path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    </span><br><span class="line">    file_new_path = <span class="string">r'C:\Users\XX\Desktop\公众号素材\new_'</span></span><br><span class="line">    find_and_resize_pic_from_dir(<span class="string">r'C:\Users\XX\Desktop\公众号素材'</span>, file_new_path)</span><br></pre></td></tr></table></figure>
<p>万事具备，看看能不能如愿上传：</p>
<p><img src="/2021/12/21/python%E5%A6%82%E4%BD%95%E6%89%B9%E9%87%8F%E6%94%B9%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%92%8C%E5%9B%BE%E7%89%87%E5%83%8F%E7%B4%A0%E5%A4%A7%E5%B0%8F/1.png" style="zoom: 50%;"></p>
<p>完美</p>
]]></content>
      <categories>
        <category>python进阶</category>
      </categories>
  </entry>
  <entry>
    <title>深入浅出，JS原型链的工作原理和hook</title>
    <url>/2021/07/06/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%EF%BC%8CJS%E5%8E%9F%E5%9E%8B%E9%93%BE%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%92%8Chook/</url>
    <content><![CDATA[<p>前言：原型链，即原型链条。它是由原型、原型的原型、原型的原型的原型…这一规则组合成的，经常被应用于继承。</p>
<a id="more"></a>
<p><strong>原型的作用</strong></p>
<p>在JS中，每个对象都有自己的原型。当我们访问对象的属性和方法时，JS会先访问对象本身的属性和方法。如果对象本身不包含这些属性和方法，则访问对象对应的原型。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 对象自身的属性</span></span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 对象自身的方法</span></span><br><span class="line">    <span class="keyword">this</span>.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//原型上的方法</span></span><br><span class="line">Person.prototype.sayAge = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="keyword">this</span>.age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xiaoming = <span class="keyword">new</span> Person(<span class="string">"XiaoMing"</span>,<span class="number">12</span>);</span><br><span class="line"><span class="keyword">var</span> xiaoHong = <span class="keyword">new</span> Person(<span class="string">"XiaoHong"</span>,<span class="number">11</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用自身不存在的方法</span></span><br><span class="line">xiaoming.sayAge(); <span class="comment">// 12</span></span><br><span class="line">xiaoHong.sayAge(); <span class="comment">// 11</span></span><br></pre></td></tr></table></figure>
<p>上述例子中，方法“sayAge”是在原型上而非对象中。（关于对象与原型之间更为详细的内容，可阅读文章：<a href="https://segmentfault.com/img/bVbkATy" target="_blank" rel="noopener">《浅谈JS中的构造函数、原型对象(prototype)、实例中的属性/方法之间的关系》</a>）</p>
<p><strong>原型链的原理</strong></p>
<p>原型自身也是一个对象（默认情况下所有对象都是Object的实例)。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alert(xiaoming instanceof Object); &#x2F;&#x2F; true alert(Person.prototype instanceof Object); &#x2F;&#x2F; true</span><br></pre></td></tr></table></figure>
<p>每个对象都有自己的原型，所以Person的原型也有它自己的原型，那就是：Object.prototype(部分浏览器允许通过实例的“<strong>proto</strong>”属性访问其原型)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alert(Person.prototype.__proto__ &#x3D;&#x3D; Object.prototype); &#x2F;&#x2F; true</span><br></pre></td></tr></table></figure>
<p>既然原型是一个对象，那么，当我们访问的属性和方法在原型不存在，就会继续访问原型的原型，直至Object.prototype。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">    <span class="keyword">this</span>.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.sayAge = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="keyword">this</span>.age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在Object.prototype增加一个“自我介绍”的方法</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.introduce = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;**</span><br><span class="line">    alert(<span class="string">"My name is "</span> + <span class="keyword">this</span>.name + <span class="string">",I'm "</span> + <span class="keyword">this</span>.age + <span class="string">" years old!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xiaoming = <span class="keyword">new</span> Person(<span class="string">"XiaoMing"</span>,<span class="number">12</span>);</span><br><span class="line"><span class="comment">// 调用对象自身和原型上均不存在的方法</span></span><br><span class="line">xiaoming.introduce(); <span class="comment">// My name is XiaoMing,I'm 12 years old!</span></span><br></pre></td></tr></table></figure>
<p><img src="/2021/07/06/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%EF%BC%8CJS%E5%8E%9F%E5%9E%8B%E9%93%BE%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%92%8Chook/1.png" alt="img"></p>
<p><strong>原型链hook案例一：</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">String</span>.prototype.split_bk = <span class="built_in">String</span>.prototype.split;</span><br><span class="line"><span class="built_in">String</span>.prototype.split = <span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">    str = <span class="keyword">this</span>.toString()</span><br><span class="line">    <span class="keyword">debugger</span>;</span><br><span class="line">    <span class="keyword">return</span> str.split_bk(val)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">a = <span class="string">"加密字符串"</span>;</span><br><span class="line">a.split(<span class="string">"加密"</span>)</span><br></pre></td></tr></table></figure>
<p><strong>*原型链hook案例二</strong></p>
<p><img src="/2021/07/06/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%EF%BC%8CJS%E5%8E%9F%E5%9E%8B%E9%93%BE%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%92%8Chook/2.png" alt="image-20210706231047752"></p>
<p><strong>总结</strong></p>
<p>原型链是JS的一个特性，它实现的核心机制是：</p>
<p>1、访问对象的属性(方法)时，若对象本身不存在该属性(方法)，则会转向访问该对象的原型；</p>
<p>2、对象的原型也是一个对象。访问的属性(方法)依旧不存在于该原型，则会继续访问该原型的原型…</p>
<p>参考链接：<a href="https://segmentfault.com/a/1190000017254949" target="_blank" rel="noopener">https://segmentfault.com/a/1190000017254949</a></p>
]]></content>
      <categories>
        <category>逆向</category>
      </categories>
      <tags>
        <tag>逆向</tag>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>android设备指纹</title>
    <url>/2021/06/29/android%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9/</url>
    <content><![CDATA[<p><strong>1　Android 设备指纹</strong></p>
<p>设备ID 需要兼具稳定性和唯一性，Android 系统的开源和碎片化导致API 函数实现各不相同，所以兼容性是Android 系统中设备指纹面临的最大挑战。表4.1列举了Android 系统中比较稳定的设备参数</p>
<a id="more"></a>
<p><img src="/2021/06/29/android%E8%AE%BE%E5%A4%87%E6%8C%87%E7%BA%B9/1.jpg" alt="img"></p>
<p>目前国内Android 6以上的手机占比已经超过了85%。由于考虑到用户的隐私，高版本Android 系统增加了设备信息采集的限制。</p>
<p><strong>2、Android Q 介绍（百度百科）：</strong></p>
<p>Android Q 是<a href="https://baike.baidu.com/item/谷歌/117920" target="_blank" rel="noopener">谷歌</a>公司在2019年推出的新一代<a href="https://baike.baidu.com/item/操作系统/192" target="_blank" rel="noopener">操作系统</a>。适用于<a href="https://baike.baidu.com/item/手机/6342" target="_blank" rel="noopener">手机</a>、平板电脑等移动终端设备 [1] 。Android Q的首个开发者预览版本（即测试版）在2019年3月14日发行并提供下载。正式版于2019年9月3日发行。此版本Android是各Android版本中，首次不用甜品来命名。该版本借助深色主题和手势导航打造应用体验。为确保用户隐私和安全支持新的保护措施。借助高性能编解码器、更出色的生物识别技术、更快的应用启动速度、Vulkan 1.1、NNAPI 1.2、可折叠设备和 5G 等更多功能扩展。</p>
<p>Android Q 于2019年9月份发布，出于对用户隐私的考虑，Android Q 限制了采集设备标识符，为Android 设备指纹带来了前所未有的挑战。Android Q 禁止非系统应用访问用户不可更改的ID，包括IMEI 号、Serial、USB 序列号等。系统Wi-Fi MAC 地址默认是随机生成的，不是固定的MAC 地址，以防止用户隐私被追踪。我们实际测试发现，IMEI、IMSI、Serial、Bluetooth MAC 都已无法获取参数，Wi-Fi MAC 获取不到真实值，但与BSSID 绑定。因此，Android Q 设备指纹的适配，不仅仅是采集函数的兼容，更重要的是设备ID 恢复逻辑（当用户修改手机某些信息时保持设备ID 不变的计算逻辑）的兼容。</p>
<p>从理论上来说，所有的采集项都是Android 系统公开的API，不可能在采集项被大面积篡改的情况下保持设备ID 不变。因此，设备指纹还需要对APP 运行环境进行监测，以识别异常环境。</p>
<p><strong>3、针对Android 作弊环境的检测方法可以归纳为以下5个方面：</strong></p>
<p>· 通过安装包检测安装的作弊工具。</p>
<p>· 通过特定特征识别root 环境。</p>
<p>· 使用多种方案采集同一字段信息。</p>
<p>· 通过通用性的作弊原理识别运行的作弊框架hook（Java/native）。</p>
<p>· 通过特定特征识别运行的作弊工具和模拟器。Android 黑产工具更新速度很快，样式层出不穷，需要通过黑产情报不断搜集最新的作弊方法。</p>
<p><strong>4、相关文章推荐：</strong></p>
<p><strong>Android唯一识别号（设备指纹）的生成及原理</strong></p>
<p><a href="https://blog.csdn.net/xiechengfa/article/details/70049409?utm_source=itdadao&amp;utm_medium=referral" target="_blank" rel="noopener">https://blog.csdn.net/xiechengfa/article/details/70049409?utm_source=itdadao&amp;utm_medium=referral</a></p>
<p><strong>Android硬件开发系列一指纹识别</strong></p>
<p><a href="https://blog.csdn.net/u010019468/article/details/70332710" target="_blank" rel="noopener">https://blog.csdn.net/u010019468/article/details/70332710</a></p>
<p><strong>Android 设备指纹</strong></p>
<p><a href="https://blog.csdn.net/DeckeDeng/article/details/78481423?locationNum=1&amp;fps=1" target="_blank" rel="noopener">https://blog.csdn.net/DeckeDeng/article/details/78481423?locationNum=1&amp;fps=1</a></p>
]]></content>
      <categories>
        <category>逆向</category>
      </categories>
      <tags>
        <tag>风控、 逆向</tag>
      </tags>
  </entry>
  <entry>
    <title>Python进阶之atexit模块使用</title>
    <url>/2021/06/12/Python%E8%BF%9B%E9%98%B6%E4%B9%8Batexit%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<p>如何让程序退出时强行执行一段代码，说起这个需求，我们就不得不说<strong>Python atexit</strong>模块了：</p>
<a id="more"></a>
<p><strong>退出处理器</strong> <code>atexit</code> 模块定义了清理函数的注册和反注册函数. 被注册的函数会在解释器正常终止时执行. <code>atexit</code> 会按照注册顺序的<em>逆序</em>执行; 如果你注册了 <code>A</code>, <code>B</code> 和 <code>C</code>, 那么在解释器终止时会依序执行 <code>C</code>, <code>B</code>, <code>A</code>.</p>
<p>看完这段介绍，有点类似栈的原理，后进先出</p>
<p><strong>1、举个例子说明：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def goodbye(name, adjective):</span><br><span class="line">   print(&quot;Goodbye %s, it was %s to meet you.&quot;% (name, adjective))</span><br><span class="line"></span><br><span class="line">def hello():</span><br><span class="line">   print(&#39;hello world!&#39;)</span><br><span class="line"></span><br><span class="line">def a():</span><br><span class="line">   print(&#39;a&#39;)</span><br><span class="line"></span><br><span class="line">import atexit</span><br><span class="line">atexit.register(goodbye, &#39;Mr.Yang&#39;, &#39;nice&#39;)#3</span><br><span class="line">atexit.register(a)#2</span><br><span class="line">hello()#1正常程序首先被执行</span><br><span class="line"></span><br><span class="line">#执行顺序 1 2 3</span><br></pre></td></tr></table></figure>
<p><strong>运行结果</strong></p>
<p><img src="/2021/06/12/Python%E8%BF%9B%E9%98%B6%E4%B9%8Batexit%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8/Python进阶之atexit模块使用\1.jpg" alt="图片"></p>
<p><strong>2、 作为 [decorator]: 使用，使用场景， 但是只适用于没有参数时调用</strong></p>
<p>举例说明，对上述代码稍作修改：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import atexit</span><br><span class="line"></span><br><span class="line">def hello():</span><br><span class="line">   print(&#39;hello world!&#39;)</span><br><span class="line">@atexit.register</span><br><span class="line">def a():</span><br><span class="line">   print(&#39;a&#39;)</span><br><span class="line"></span><br><span class="line">hello()</span><br><span class="line"></span><br><span class="line">#运行结果</span><br><span class="line">#hello world!</span><br><span class="line">#a</span><br></pre></td></tr></table></figure>
<p> <strong>3、取消注册， 示例如下。</strong> </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def goodbye(name, adjective):</span><br><span class="line">   print(&quot;Goodbye %s, it was %s to meet you.&quot;% (name, adjective))</span><br><span class="line"></span><br><span class="line">def hello():</span><br><span class="line">   print(&#39;hello world!&#39;)</span><br><span class="line"></span><br><span class="line">def a():</span><br><span class="line">   print(&#39;a&#39;)</span><br><span class="line"></span><br><span class="line">import atexit</span><br><span class="line">atexit.register(goodbye, &#39;Mr.Yang&#39;, &#39;nice&#39;)#3</span><br><span class="line">atexit.register(a)#2</span><br><span class="line">hello()#1正常程序首先被执行</span><br><span class="line">atexit.unregister(a)</span><br><span class="line">#正常执行顺序 1 2 3</span><br><span class="line"></span><br><span class="line">#由于设置了取消注册atexit.unregister(a)，</span><br><span class="line"></span><br><span class="line">#注销后执行顺序 1 3</span><br></pre></td></tr></table></figure>
<p><strong>运行结果：</strong></p>
<p><img src="/2021/06/12/Python%E8%BF%9B%E9%98%B6%E4%B9%8Batexit%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8/Python进阶之atexit模块使用\2.jpg" alt="图片"></p>
<p>这个模块一般用来在程序结束时，做资源清理。</p>
<p><strong>应用场景一：</strong></p>
<p> 既能让程序报错，又能在报错已经还能运行<code>clean()</code>呢？</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import atexit</span><br><span class="line"></span><br><span class="line">@atexit.register</span><br><span class="line">def clean():</span><br><span class="line">   print(&#39;清理环境相关的代码&#39;)</span><br><span class="line"></span><br><span class="line">def test():</span><br><span class="line">   example &#x3D; &#123;&quot;a&quot;: 1, &quot;b&quot;: 2&#125;</span><br><span class="line">   print(example[&quot;c&quot;])#程序报错</span><br><span class="line">test()</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="/2021/06/12/Python%E8%BF%9B%E9%98%B6%E4%B9%8Batexit%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8/Python进阶之atexit模块使用\3.jpg" alt="图片"></p>
<p>这样一来，我们不需要显式调用<code>clean</code>函数了。无论程序正常结束，还是程序异常报错，<code>clean</code>函数里面的内容总会执行。</p>
<p><strong>*\</strong>官方文档*<em>：<a href="https://docs.python.org/zh-cn/3.7/library/atexit.html\**" target="_blank" rel="noopener">https://docs.python.org/zh-cn/3.7/library/atexit.html\**</a></em> </p>
<p><strong><em>*参考链接：\</em></strong><a href="https://mp.weixin.qq.com/s/lNwSBhcp9ktwgaGWpXNq-A*" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/lNwSBhcp9ktwgaGWpXNq-A*</a></p>
]]></content>
      <categories>
        <category>python基础</category>
      </categories>
      <tags>
        <tag>python基础</tag>
      </tags>
  </entry>
  <entry>
    <title>使用NanoHTTPD反射调用加密函数（一）</title>
    <url>/2021/06/12/%E4%BD%BF%E7%94%A8NanoHTTPD%E5%8F%8D%E5%B0%84%E8%B0%83%E7%94%A8%E5%8A%A0%E5%AF%86%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<p>利用NanoHTTPD反射调用Android APP加密函数，前奏之初识NanoHTTPD</p>
<a id="more"></a>
<h3 id="1-NanoHTTPD介绍"><a href="#1-NanoHTTPD介绍" class="headerlink" title="1.NanoHTTPD介绍"></a>1.NanoHTTPD介绍</h3><p>什么是NanoHTTPD？NanoHTTPD是一个免费、轻量级的(只有一个Java文件) HTTP服务器，可以很好地嵌入到Java程序中。支持 GET, POST, PUT等请求，支持文件上传，占用内存很小。</p>
<p>项目地址：<a href="https://github.com/NanoHttpd/nanohttpd" target="_blank" rel="noopener">https://github.com/NanoHttpd/nanohttpd</a></p>
<h3 id="2-如何嵌入？"><a href="#2-如何嵌入？" class="headerlink" title="2. 如何嵌入？"></a>2. 如何嵌入？</h3><ol>
<li>在build.gradle中增加一个依赖（已经懒到一定境界了，能自动的，绝不手动下载配置）：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">compile &#39;org.nanohttpd:nanohttpd:2.2.0&#39;</span><br></pre></td></tr></table></figure>
<ol>
<li>在包里增加一个java文件：AndroidWebServer.java`：</li>
</ol>
<p><strong>3、打开“app/src/main/AndroidManifest.xml”，在manifest标签中加入网络权限的声明，不加会报“java.net.SocketException: socket failed: EACCES ”异常错误</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.INTERNET"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>4、编写NanoHTTPD的server服务</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.ceshi;</span><br><span class="line"><span class="keyword">import</span> fi.iki.elonen.NanoHTTPD;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义一个Server继承NanoHTTPD</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AndroidWebServer</span> <span class="keyword">extends</span> <span class="title">NanoHTTPD</span> </span>&#123;</span><br><span class="line">    <span class="comment">//构造函数 赋值父类</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AndroidWebServer</span><span class="params">(<span class="keyword">int</span> port)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(port);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">serve</span><span class="params">(IHTTPSession session)</span> </span>&#123;</span><br><span class="line">        String msg = <span class="string">"&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello AutoPy&lt;/h1&gt;\n"</span>;</span><br><span class="line">        Map&lt;String, String&gt; parms = session.getParms();</span><br><span class="line">        <span class="keyword">if</span> (parms.get(<span class="string">"code"</span>) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            msg += <span class="string">"&lt;form action='?' method='get'&gt;\n  &lt;p&gt;Your code: &lt;input type='text' name='code'&gt;&lt;/p&gt;\n"</span> + <span class="string">"&lt;/form&gt;\n"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            msg += <span class="string">"&lt;p&gt;Hello, "</span> + parms.get(<span class="string">"code"</span>) + <span class="string">"!&lt;/p&gt;"</span>;</span><br><span class="line">            <span class="keyword">return</span> newFixedLengthResponse(msg + <span class="string">"&lt;/body&gt;&lt;/html&gt;\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newFixedLengthResponse(msg + <span class="string">"&lt;/body&gt;&lt;/html&gt;\n"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>5、在MainActivity类中编写如下代码，启用NanoHTTPD服务</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.ceshi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    AndroidWebServer http = <span class="keyword">new</span> AndroidWebServer(<span class="number">9988</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainActivity</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            http.start();</span><br><span class="line">            System.out.println(<span class="string">"服务启动完成"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">"服务启动错误"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//安卓销毁事件</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        http.stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>6、启动app</strong></p>
<p><strong>7、端口转发</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb forward tcp:9988 tcp:9988</span><br></pre></td></tr></table></figure>
<p><strong>8、调用接口</strong></p>
<p><img src="/2021/06/12/%E4%BD%BF%E7%94%A8NanoHTTPD%E5%8F%8D%E5%B0%84%E8%B0%83%E7%94%A8%E5%8A%A0%E5%AF%86%E5%87%BD%E6%95%B0/1.png" alt></p>
<p><strong>输入ss回车：</strong></p>
<p><img src="/2021/06/12/%E4%BD%BF%E7%94%A8NanoHTTPD%E5%8F%8D%E5%B0%84%E8%B0%83%E7%94%A8%E5%8A%A0%E5%AF%86%E5%87%BD%E6%95%B0/2.png" alt></p>
<p><strong>参考文章;</strong></p>
<p>安卓NanoHTTPD的快速入门</p>
<p><a href="https://blog.csdn.net/u013738666/article/details/104776840" target="_blank" rel="noopener">https://blog.csdn.net/u013738666/article/details/104776840</a></p>
]]></content>
      <categories>
        <category>逆向</category>
      </categories>
      <tags>
        <tag>逆向，NanoHTTPD</tag>
      </tags>
  </entry>
  <entry>
    <title>androidStudio建立的项目没有libs目录</title>
    <url>/2021/06/11/androidStudio%E5%BB%BA%E7%AB%8B%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%B2%A1%E6%9C%89libs%E7%9B%AE%E5%BD%95/</url>
    <content><![CDATA[<p>ndroid studio建立的项目没有libs目录<br>有时候建立新项目，没有看到lib文件夹，但是文件目录里又有</p>
<a id="more"></a>
<p>android studio建立的项目没有libs目录<br>有时候建立新项目，没有看到lib文件夹，但是文件目录里又有<br><img src="/2021/06/11/androidStudio%E5%BB%BA%E7%AB%8B%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%B2%A1%E6%9C%89libs%E7%9B%AE%E5%BD%95/androidStudio建立的项目没有libs目录\1.jpg" alt><br><img src="/2021/06/11/androidStudio%E5%BB%BA%E7%AB%8B%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%B2%A1%E6%9C%89libs%E7%9B%AE%E5%BD%95/androidStudio建立的项目没有libs目录\2.jpg" alt></p>
<p><strong>原因是显示目录的原因，切换成Project就可以了</strong><br><img src="/2021/06/11/androidStudio%E5%BB%BA%E7%AB%8B%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%B2%A1%E6%9C%89libs%E7%9B%AE%E5%BD%95/androidStudio建立的项目没有libs目录\3.jpg" alt></p>
]]></content>
      <categories>
        <category>逆向</category>
      </categories>
      <tags>
        <tag>逆向，AndroidStudio</tag>
      </tags>
  </entry>
  <entry>
    <title>python进阶之上下文管理器</title>
    <url>/2021/06/10/%E8%BF%9B%E9%98%B6%E4%B9%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8/</url>
    <content><![CDATA[<p><strong>一、文管理器作用</strong>：</p>
<p>上下⽂管理器允许你在有需要的时候，精确地分配和释放资源。</p>
<a id="more"></a>
<p><strong>二、案例介绍：</strong></p>
<p>对它使⽤最⼴泛的案例就是with语句了。想象下当你有两个相关操作，你想让它们结对执⾏，然后在它们俩中间放置⼀段代码。</p>
<p>上下⽂管理器就是专门让你做这个事情的。举个例⼦：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'some_file'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> opened_file: </span><br><span class="line">  opened_file.write(<span class="string">'Hola!'</span>)</span><br></pre></td></tr></table></figure>
<p>上⾯这段代码打开了⼀个⽂件，往它⾥⾯写⼊了⼀些数据，然后关闭了它。如果在往⽂件</p>
<p>写数据时发⽣异常，它会尝试去关闭⽂件。上⾯那段代码与这⼀段是等价的：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">file = open(<span class="string">'some_file'</span>, <span class="string">'w'</span>) </span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">  file.write(<span class="string">'Hola!'</span>) </span><br><span class="line"><span class="keyword">finally</span>: </span><br><span class="line">  file.close()</span><br></pre></td></tr></table></figure>
<p>对比两个功能一样的代码，相比较之下，with 代码更简洁，去掉了很多样板代码，它确保我们的⽂件会被关闭。</p>
<p><strong>三、使用上下文管理器with的优点：</strong></p>
<p>（1）使用with语句的目的就是把代码块放入with中执行，with结束后，自动完成清理工作，无须手动干预。</p>
<p>（2）在需要管理一些资源比如文件，网络连接和锁的编程环境中，可以在<strong>exit</strong>中定制自动释放资源的机制，你无须再去关系这个问题，这将大有用处。</p>
<p><strong>四、如何上下文管理器</strong>：</p>
<p><strong>1、基于类的实现</strong></p>
<p>⼀个上下⽂管理器的类，最起码要定义<strong>enter</strong>和<strong>exit</strong>⽅法。</p>
<p>让我们来构造我们⾃⼰的⽂件开启的上下⽂管理器，并学习下基础知识。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span><span class="params">(object)</span>:</span> </span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, file_name, method)</span>:</span></span><br><span class="line">          self.file_obj = open(file_name, method) </span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">          <span class="keyword">return</span> self.file_obj </span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, type, value, traceback)</span>:</span></span><br><span class="line">          self.file_obj.close()</span><br></pre></td></tr></table></figure>
<p>通过定义<strong>enter</strong>和<strong>exit</strong>⽅法，我们可以在with语句⾥使⽤它。我们来试试：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">with</span> File(<span class="string">'demo.txt'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> opened_file: </span><br><span class="line">  opened_file.write(<span class="string">'Hola!'</span>)</span><br></pre></td></tr></table></figure>
<p>我们的<strong>exit</strong>函数接受三个参数。这些参数对于每个上下⽂管理器类中的<strong>exit</strong> </p>
<p>⽅法都是必须的。我们来谈谈在底层都发⽣了什么。</p>
<ol>
<li><p>with语句先暂存了File类的<strong>exit</strong>⽅法</p>
</li>
<li><p>然后它调⽤File类的<strong>enter</strong>⽅法</p>
</li>
<li><p><strong>enter</strong>⽅法打开⽂件并返回给with语句</p>
</li>
<li><p>打开的⽂件句柄被传递给opened_file参数</p>
</li>
<li><p>我们使⽤.write()来写⽂件</p>
</li>
<li><p>with语句调⽤之前暂存的<strong>exit</strong>⽅法</p>
</li>
<li><p><strong>exit</strong>⽅法关闭了⽂件</p>
</li>
</ol>
<p><strong>（**</strong>1） 如何处理异常** </p>
<p>我们还没有谈到<strong>exit</strong>⽅法的这三个参数：type, value和traceback。</p>
<p>在第4步和第6步之间，如果发⽣异常，Python会将异常的type,value和traceback传递</p>
<p>到<strong>exit</strong>⽅法。</p>
<p>它让<strong>exit</strong>⽅法来决定如何关闭⽂件以及是否需要其他步骤。在我们的案例中，我们</p>
<p>并没有注意它们。</p>
<p>那如果我们的⽂件对象抛出⼀个异常呢？万⼀我们尝试访问⽂件对象的⼀个不⽀持的⽅</p>
<p>法。举个例⼦：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">with</span> File(<span class="string">'demo.txt'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> opened_file: </span><br><span class="line">    opened_file.undefined_function(<span class="string">'Hola!'</span>)</span><br></pre></td></tr></table></figure>
<p>我们来列⼀下，当异常发⽣时，with语句会采取哪些步骤。</p>
<ol>
<li><p>它把异常的type,value和traceback传递给<strong>exit</strong>⽅法</p>
</li>
<li><p>它让<strong>exit</strong>⽅法来处理异常</p>
</li>
<li><p>如果<strong>exit</strong>返回的是True，那么这个异常就被优雅地处理了。</p>
</li>
<li><p>如果<strong>exit</strong>返回的是True以外的任何东西，那么这个异常将被with语句抛出</p>
</li>
</ol>
<p>（<strong>2）怎么优雅的去处理异常：</strong></p>
<p>看到处理异常那里，我们仅仅就是在发生异常时，文件能正常被关闭，不需要抛出异常</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, type, value, traceback)</span>:</span> </span><br><span class="line">    print(<span class="string">"Exception has been handled"</span>) </span><br><span class="line">    self.file_obj.close() </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>我们仅仅return True，这么做就可以了</p>
<p><strong>完整代码：</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, filepath, mode=<span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>)</span>:</span></span><br><span class="line">        self.filepath = filepath</span><br><span class="line">        self.mode = mode</span><br><span class="line">        self.encoding = encoding</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># print('enter')</span></span><br><span class="line">        self.f = open(self.filepath, mode=self.mode, encoding=self.encoding)</span><br><span class="line">        <span class="keyword">return</span> self.f</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_val, exc_tb)</span>:</span></span><br><span class="line">        <span class="comment"># print('exit')</span></span><br><span class="line">        self.f.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, item)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> getattr(self.f, item)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> Open(<span class="string">'a.txt'</span>,<span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(f)</span><br><span class="line">    f.write(<span class="string">'aaaaaa'</span>)</span><br><span class="line">    <span class="comment">#f.wasdf() #抛出异常，交给__exit__处理</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>python基础</category>
      </categories>
      <tags>
        <tag>python基础</tag>
      </tags>
  </entry>
  <entry>
    <title>如何抓取国外网站、app的包</title>
    <url>/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85/</url>
    <content><![CDATA[<p><strong>前期准备：</strong></p>
<p>  配置好的Charles抓包工具，（可以抓正常国内的APP端和网页端的包）</p>
<p>  设置好的vpn，（可以访问国外的网站）</p>
<a id="more"></a>
<p><strong>操作环境</strong>：以windows为例</p>
<p>打开vpn后，我们访问一下国外的网站，测试一下vpn访问是否正常</p>
<p><img src="/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85/1.jpg" alt></p>
<p>我习惯直接访问网站测试，大家也可以使用下图所示测试：</p>
<p><img src="/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85/2.jpg" alt></p>
<p>访问正常，我们打开Chrome游览器的代理设置，显示如下图所示：</p>
<p><img src="/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85/3.jpg" alt></p>
<p>图一</p>
<p><strong>1、配置抓取网站的数据包</strong></p>
<p>准备工作做好，接下来开始配置Charles抓包工具：</p>
<p><img src="/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85/4.jpg" alt></p>
<p>依次点击之后我看到如下界面，填入图一的信息并勾选截图选项点击确定：</p>
<p><img src="/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85/5.jpg" alt></p>
<p>点击ok之后，我们打开我们的国外目标网站，抓包测试一下：</p>
<p><img src="/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85/如何抓取国外网站、app的包\7.jpg" alt="图片"></p>
<p>如图所示我们已经可以抓到包了</p>
<p><strong>2、接下来我们测试抓取手机端的数据包：</strong></p>
<p>手机设置好代理之后</p>
<p>我们查询一下ip，如图所示</p>
<p><img src="/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85/6.jpg" alt></p>
<p>ok，接下来我么就可以抓取手机的app了</p>
]]></content>
      <categories>
        <category>抓包</category>
      </categories>
      <tags>
        <tag>抓包，</tag>
      </tags>
  </entry>
  <entry>
    <title>python抽象类原理以及编写</title>
    <url>/2021/06/09/%E6%8A%BD%E8%B1%A1%E7%B1%BB%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E7%BC%96%E5%86%99/</url>
    <content><![CDATA[<p><strong>前言：</strong></p>
<p>好久没写文章了，今天来给大家更新一篇，最近会陆续整理，发出一下以前做的笔记</p>
<a id="more"></a>
<p><strong>1.抽象类概念</strong></p>
<p>抽象类是一个特殊的类，只能被继承，不能实例化</p>
<p><strong>2.为什么要有抽象类</strong></p>
<p>其实在未接触抽象类概念时，我们可以构造香蕉、苹果、梨之类的类，然后让它们继承水果这个的基类，水果的基类包含一个eat函数。</p>
<p>但是你有没有想过，我们可以将香蕉、苹果、梨实例化，去吃香蕉、苹果、梨。但是我们却不能将水果实例化，因为我们无法吃到叫水果的这个东西。</p>
<p>所以抽象类中只能有抽象方法（没有实现功能），该类不能被实例化，只能被继承，且子类必须实现抽象方法。</p>
<p><strong>3.抽象类的作用</strong></p>
<p>在不同的模块中通过抽象基类来调用，可以用最精简的方式展示出代码之间的逻辑关系，让模块之间的依赖清晰简单。</p>
<p>抽象类的编程，让每个人可以关注当前抽象类的方法和描述，而不需要考虑过多的实现细节，这对协同开发有很大意义，也让代码可读性更高。</p>
<p>Python 自带的abc模块用于实现抽象类相关的定义和操作。</p>
<p>我们通过一个简单的例子来说明，如何在 Python 中实现抽象类：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span><span class="params">(ABC)</span>:</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">walk</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dance</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'我正在跳舞'</span>)</span><br></pre></td></tr></table></figure>
<p>从abc模块导入ABC类，和abstractmethod抽象方法装饰器。基于ABC类可以实现一个抽象类。通过@abstractmethod装饰一个方法，让它成为一个抽象方法。抽象方法在子类中必需被实现。</p>
<p>注意：</p>
<p>抽象类不能被实例化，所以我们实例化一下，可以看到这里报错了</p>
<p><img src="\抽象类原理以及编写\1.jpg" alt></p>
<p>我们再看一下，如果继承抽象类，但是没有实现其中的某个抽象方法，也会导致报错</p>
<p><img src="\抽象类原理以及编写\2.jpg" alt></p>
<p>抽象类People中的dance不是抽象方法，所以子类不需要覆盖。</p>
<p><strong>总结：</strong></p>
<p>抽象类是软件开发中一个非常重要的概念，通过定义抽象类，我们可以约定子类必需实现的方法。当我们一个类有几十上百个方法时，用抽象方法来防止子类漏掉某些方法是非常方便的做法。</p>
<p><strong>完整代码</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span><span class="params">(ABC)</span>:</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">walk</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dance</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'我正在跳舞'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">kid1</span><span class="params">(People)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">walk</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'走路'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">eat</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'吃饭'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    k = kid1()</span><br><span class="line">    k.dance()</span><br><span class="line">    k.eat()</span><br><span class="line">    k.walk()</span><br></pre></td></tr></table></figure>
<p><img src="\抽象类原理以及编写\3.jpg" alt></p>
<p>如果文章对你有用，记得分享和关注，菜鸟童靴公众号</p>
<p><img src="\抽象类原理以及编写\4.jpg" alt></p>
]]></content>
      <categories>
        <category>python基础</category>
      </categories>
      <tags>
        <tag>python基础</tag>
      </tags>
  </entry>
  <entry>
    <title>Python进阶之闭包和作用域</title>
    <url>/2021/06/09/Python%E8%BF%9B%E9%98%B6%E4%B9%8B%E9%97%AD%E5%8C%85%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F%E2%80%8B/</url>
    <content><![CDATA[<p><strong>前言：</strong></p>
<p>好久没写文章了，今天来给大家更新一篇，最近会陆续整理，发出一下以前做的笔记</p>
<a id="more"></a>
<p><strong>作用域</strong>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">g_count = <span class="number">0</span>  <span class="comment"># 全局作用域</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span><span class="params">()</span>:</span></span><br><span class="line">    o_count = <span class="number">1</span>  <span class="comment"># 闭包函数外的函数中</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">        i_count = <span class="number">2</span>  <span class="comment"># 局部作用域</span></span><br></pre></td></tr></table></figure>
<p>Python 中只有模块（module），类（class）以及函数（def、lambda）才会引入新的作用域，其它的代码块</p>
<p>（如 if/elif/else/、try/except、for/while等）是不会引入新的作用域的，也就是说这些语句内定义的变量，外部也可以访问，</p>
<p>如下代码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="literal">True</span>:</span><br><span class="line">    msg = <span class="string">'I am from beijing'</span></span><br><span class="line">print(msg)</span><br><span class="line">//运行结果 I am <span class="keyword">from</span> beijing</span><br></pre></td></tr></table></figure>
<p><strong>全局变量和局部变量</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">total = <span class="number">0</span>  <span class="comment"># 全局变量</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span><span class="params">(arg1, arg2)</span>:</span></span><br><span class="line">    total = arg1 + arg2  <span class="comment"># total在这里是局部变量.</span></span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line">print(total)<span class="comment">#函数外是全局变量total</span></span><br><span class="line">total = sum(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">print(total)<span class="comment">#局部变量total</span></span><br></pre></td></tr></table></figure>
<h3 id="global-和-nonlocal关键字"><a href="#global-和-nonlocal关键字" class="headerlink" title="global 和 nonlocal关键字"></a>global 和 nonlocal关键字</h3><p>当内部作用域想修改外部作用域的变量时</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">num = <span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> num  <span class="comment"># 需要使用 global 关键字声明</span></span><br><span class="line">    print(num) </span><br><span class="line">    num = <span class="number">123</span></span><br><span class="line">    print(num)</span><br><span class="line">fun1()</span><br><span class="line">print(num)</span><br><span class="line"><span class="comment">#结果</span></span><br><span class="line"><span class="comment">#1</span></span><br><span class="line"><span class="comment">#123</span></span><br><span class="line"><span class="comment">#123</span></span><br></pre></td></tr></table></figure>
<p>如果要修改嵌套作用域（非全局作用域）中的变量则需要 nonlocal 关键字了 ，仅读取就无所谓了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lazy_sum</span><span class="params">(*args)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sum</span><span class="params">()</span>:</span></span><br><span class="line">        ax = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> args:</span><br><span class="line">            ax += n</span><br><span class="line">        <span class="keyword">return</span> ax</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line"></span><br><span class="line">s = lazy_sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">print(s, type(s),s(),sep=<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Output&gt;&gt;&gt;</span></span><br><span class="line">&lt;function lazy_sum.&lt;locals&gt;.sum at <span class="number">0x10768ed90</span>&gt;</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">function</span>'&gt;</span></span><br><span class="line"><span class="class">15</span></span><br></pre></td></tr></table></figure>
<p><strong>进入正题：</strong></p>
<p><strong>闭包</strong></p>
<p> 在函数嵌套的程序结构中，如果内层函数包含对外层函数局部变量的引用，同时外层函数的返回结果又是对内层函数的引用，这就构成了一个闭包。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lazy_sum</span><span class="params">(*args)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sum</span><span class="params">()</span>:</span></span><br><span class="line">        ax = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> args:</span><br><span class="line">            ax += n</span><br><span class="line">        <span class="keyword">return</span> ax</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line"></span><br><span class="line">s = lazy_sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">print(s, type(s),s(),sep=<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Output&gt;&gt;&gt;</span></span><br><span class="line">&lt;function lazy_sum.&lt;locals&gt;.sum at <span class="number">0x10768ed90</span>&gt;</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">function</span>'&gt;</span></span><br><span class="line"><span class="class">15</span></span><br></pre></td></tr></table></figure>
<p>在上面的代码中，我们在外层函数<code>lazy_sum</code>中又嵌套了的内层函数<code>sum</code>，<code>sum</code>引用了<code>lazy_sum</code>的参数，并且<code>lazy_sum</code> 将<code>sum</code> 作为返回结果。如果是按照命令式语言的规则（如C++，C#），在执行<code>sum</code>函数时，会由于在其作用域内找不到<code>args</code>变量而出错，但是在函数式语言中，<strong>当内嵌的函数体内有引用外部作用域的变量时，将会把定义时涉及到的引用环境和函数体打包成一个整体返回</strong>，这中程序结构就是上面说的”闭包(Closure)”。所以说，闭包就是由函数及其相关的引用环境组合而成的实体，即：闭包=函数+引用环境。</p>
<p>从运行结果中可以看到，当调用<code>lazy_sum(*args)</code>时，返回的是内部求和函数的引用地址，当调用函数<code>sum()</code> 时，才真正计算求和的结果。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">s1 = lazy_sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">s2 = lazy_sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">print(s1==s2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output&gt;&gt;&gt;</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>我们使 用<code>nonlocal</code> 关键字 对上面的代码进行更改一下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lazy_sum</span><span class="params">(*args)</span>:</span></span><br><span class="line">    ax = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sum</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">nonlocal</span> ax</span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> args:</span><br><span class="line">            ax += n</span><br><span class="line">        <span class="keyword">return</span> ax</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line"></span><br><span class="line">s = lazy_sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">print(s, type(s), s(), sep=<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Output&gt;&gt;&gt;</span></span><br><span class="line">&lt;function lazy_sum.&lt;locals&gt;.sum at <span class="number">0x000001B0D80612F0</span>&gt;</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">function</span>'&gt;</span></span><br><span class="line"><span class="class">15</span></span><br></pre></td></tr></table></figure>
<p><strong>闭包的应用场景：</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UrlTemplate</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, template)</span>:</span></span><br><span class="line">        self.template = template</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">openr</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.template.format_map(kwargs)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 上面的类可以被一个更简单的函数代替</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">url_template</span><span class="params">(template)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">openr</span><span class="params">(**kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> template.format_map(kwargs)</span><br><span class="line">    <span class="keyword">return</span> openr</span><br><span class="line"></span><br><span class="line">root_url = url_template(<span class="string">'https://www.jianshu.com/search?q=&#123;name&#125;&amp;page=&#123;page&#125;&amp;type=&#123;type&#125;'</span>)</span><br><span class="line"></span><br><span class="line">print(root_url(name=<span class="string">'sss'</span>, page=<span class="string">'1'</span>, type=<span class="string">'note'</span>))</span><br></pre></td></tr></table></figure>
<p><strong>总结</strong></p>
<p>使用一个内部函数或者闭包的方案通常会更优雅一些。简单来讲，一个闭包就是一个函数，只不过在函数内部带上了一个额外的变量环境。闭包关键特点就是它会记住自己被定义时的环境。因此，在我们的解决方案中，opener() 函数记住了template参数的值，并在接下来的调用中使用它。任何时候只要碰到需要给某个函数增加额外的状态信息的问题，都可以考虑使用闭包。相比将函数转换成一个类而言，闭包通常是一种更加简洁和优雅的方案。</p>
<p><strong><em>参考链接：\</em></strong></p>
<p><em><a href="https://www.jianshu.com/p/77d78d84a69c" target="_blank" rel="noopener">https://www.jianshu.com/p/77d78d84a69c</a></em></p>
]]></content>
      <categories>
        <category>python基础</category>
      </categories>
      <tags>
        <tag>python基础</tag>
        <tag>面试集锦</tag>
      </tags>
  </entry>
  <entry>
    <title>Hook框架xposed的简单demo</title>
    <url>/2021/06/07/Hook%E6%A1%86%E6%9E%B6xposed%E7%9A%84%E7%AE%80%E5%8D%95demo/</url>
    <content><![CDATA[<p>简介：Xposed框架是一款可以在不修改APK的情况下影响程序运行的框架服务，通过替换/system/bin/app_process程序控制zygote进程，使得app_process在启动过程中会加载XposedBridge.jar这个jar包，从而完成对Zygote进程及其创建的虚拟机的劫持。<br>Github地址：<a href="https://github.com/rovo89/Xposed" target="_blank" rel="noopener">https://github.com/rovo89/Xposed</a></p>
<a id="more"></a>
<h4 id="1、编写hook的app-例子："><a href="#1、编写hook的app-例子：" class="headerlink" title="1、编写hook的app 例子："></a>1、编写hook的app 例子：</h4><h5 id="（1）-建立一个空工程，编写一个登陆界面，用自定义的一个方法"><a href="#（1）-建立一个空工程，编写一个登陆界面，用自定义的一个方法" class="headerlink" title="（1）.建立一个空工程，编写一个登陆界面，用自定义的一个方法"></a>（1）.建立一个空工程，编写一个登陆界面，用自定义的一个方法</h5><p><img src="/2021/06/07/Hook%E6%A1%86%E6%9E%B6xposed%E7%9A%84%E7%AE%80%E5%8D%95demo/3.png" alt></p>
<p><strong>代码如下</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;EditText</span><br><span class="line">       android:id&#x3D;&quot;@+id&#x2F;et1&quot;</span><br><span class="line">       android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class="line">       android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">       android:layout_marginStart&#x3D;&quot;24dp&quot;</span><br><span class="line">       android:layout_marginTop&#x3D;&quot;96dp&quot;</span><br><span class="line">       android:layout_marginEnd&#x3D;&quot;24dp&quot;</span><br><span class="line">       android:hint&#x3D;&quot;zhanghao&quot;</span><br><span class="line">       android:inputType&#x3D;&quot;textEmailAddress&quot;</span><br><span class="line">       android:selectAllOnFocus&#x3D;&quot;true&quot;</span><br><span class="line">       app:layout_constraintEnd_toEndOf&#x3D;&quot;parent&quot;</span><br><span class="line">       app:layout_constraintStart_toStartOf&#x3D;&quot;parent&quot;</span><br><span class="line">       app:layout_constraintTop_toTopOf&#x3D;&quot;parent&quot; &#x2F;&gt;</span><br><span class="line">   &lt;EditText</span><br><span class="line">       android:id&#x3D;&quot;@+id&#x2F;et2&quot;</span><br><span class="line">       android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class="line">       android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">       android:layout_marginStart&#x3D;&quot;24dp&quot;</span><br><span class="line">       android:layout_marginTop&#x3D;&quot;8dp&quot;</span><br><span class="line">       android:layout_marginEnd&#x3D;&quot;24dp&quot;</span><br><span class="line">       android:hint&#x3D;&quot;Password&quot;</span><br><span class="line">       android:imeOptions&#x3D;&quot;actionDone&quot;</span><br><span class="line">       android:inputType&#x3D;&quot;textPassword&quot;</span><br><span class="line">       android:selectAllOnFocus&#x3D;&quot;true&quot;</span><br><span class="line">       app:layout_constraintEnd_toEndOf&#x3D;&quot;parent&quot;</span><br><span class="line">       app:layout_constraintStart_toStartOf&#x3D;&quot;parent&quot;</span><br><span class="line">       app:layout_constraintTop_toBottomOf&#x3D;&quot;@+id&#x2F;et1&quot;</span><br><span class="line">        &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">   &lt;Button</span><br><span class="line">       android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class="line">       android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">       android:onClick&#x3D;&quot;my_onClick&quot;</span><br><span class="line">       android:text&#x3D;&quot;登陆&quot;</span><br><span class="line">       android:textSize&#x3D;&quot;26dp&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>
<h5 id="（2）MainActivity中添加"><a href="#（2）MainActivity中添加" class="headerlink" title="（2）MainActivity中添加"></a>（2）MainActivity中添加</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.hookdemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">my_onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        EditText editText = (EditText) findViewById(R.id.et1);</span><br><span class="line">        EditText editText1 = (EditText) findViewById(R.id.et2);</span><br><span class="line">        String string = editText.getText().toString();</span><br><span class="line">        String string1 = editText1.getText().toString();</span><br><span class="line">        <span class="keyword">if</span>(CheckRegister(string,string1))&#123;</span><br><span class="line">            Toast.makeText(MainActivity.<span class="keyword">this</span>,<span class="string">"登陆成功"</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Toast.makeText(MainActivity.<span class="keyword">this</span>,<span class="string">"登陆失败"</span>,Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">CheckRegister</span><span class="params">(String string, String string1)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> string.equals(string1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果，两个输入框输入相同时 提示登陆成功，不同时 提示登陆失败</p>
<h4 id="2、hook准备，新建项目，引入xposed-jar包"><a href="#2、hook准备，新建项目，引入xposed-jar包" class="headerlink" title="2、hook准备，新建项目，引入xposed  jar包"></a>2、hook准备，新建项目，引入xposed  jar包</h4><p><img src="/2021/06/07/Hook%E6%A1%86%E6%9E%B6xposed%E7%9A%84%E7%AE%80%E5%8D%95demo/2.png" alt></p>
<h4 id="3、搞定XposedBridgeApi-xx-jar-与-build-gradle，"><a href="#3、搞定XposedBridgeApi-xx-jar-与-build-gradle，" class="headerlink" title="3、搞定XposedBridgeApi-xx.jar 与 build.gradle，"></a><strong>3、搞定XposedBridgeApi-xx.jar 与 build.gradle，</strong></h4><p>在 “项目名称/app/src/main/”目录下找到build.gradle，</p>
<p>在图示位置加上：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">	jcenter()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以及</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">compileOnly &#39;de.robv.android.xposed:api:82&#39;</span><br><span class="line"></span><br><span class="line">compileOnly &#39;de.robv.android.xposed:api:82:sources&#39;</span><br></pre></td></tr></table></figure>
<p>这句代码是告诉AndroidStuido使用jcenter作为代码仓库，从这个仓库里远程寻找 de.robv.android.xposed:api:82 这个API。</p>
<p>写完之后， build.gradle会提示文件已经修改，是否同步。点击 “sync now”，同步即可：</p>
<h4 id="4-声明主入口类路径"><a href="#4-声明主入口类路径" class="headerlink" title="4. 声明主入口类路径"></a>4. 声明主入口类路径</h4><p>需要在 main 文件夹下建立 assets 文件夹中新建一个 xposed_init 的文件，并在其中声明主入口类</p>
<p><img src="/2021/06/07/Hook%E6%A1%86%E6%9E%B6xposed%E7%9A%84%E7%AE%80%E5%8D%95demo/1.png" alt></p>
<h4 id="5、创建hook代码"><a href="#5、创建hook代码" class="headerlink" title="5、创建hook代码"></a>5、创建hook代码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.ceshi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookLoadPackage;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XC_MethodHook;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedBridge;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedHelpers;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.callbacks.XC_LoadPackage;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by 18459 on 2016/6/27.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> <span class="keyword">implements</span> <span class="title">IXposedHookLoadPackage</span></span>&#123;</span><br><span class="line">    <span class="comment">//被HOOK的程序的包名和类名</span></span><br><span class="line">    String packName = <span class="string">"com.example.hookdemo"</span>;</span><br><span class="line">    String className = <span class="string">"com.example.hookdemo.MainActivity"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam loadPackageParam)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!loadPackageParam.packageName.equals(packName))</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">//打印日志加载的包名</span></span><br><span class="line">        XposedBridge.log(<span class="string">"Loaded app: "</span> + loadPackageParam.packageName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// replaceHookedMethod 替换方法</span></span><br><span class="line">        <span class="comment">// beforeHookedMethod 方法前执行</span></span><br><span class="line">        <span class="comment">// afterHookedMethod 方法后执行</span></span><br><span class="line">        <span class="comment">// 处理是的情况</span></span><br><span class="line">        <span class="comment">// 找到对应类的方法，进行hook，hook的方式有两种</span></span><br><span class="line">        XposedHelpers.findAndHookMethod(className,     <span class="comment">// 类名</span></span><br><span class="line">                loadPackageParam.classLoader, <span class="comment">// 类加载器</span></span><br><span class="line">                <span class="string">"CheckRegister"</span>, <span class="comment">// 方法名</span></span><br><span class="line">                String<span class="class">.<span class="keyword">class</span>,   // 参数1</span></span><br><span class="line"><span class="class">                <span class="title">String</span>.<span class="title">class</span>,   // 参数2</span></span><br><span class="line"><span class="class">                <span class="title">new</span> <span class="title">XC_MethodHook</span>() </span>&#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                        <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                        XposedBridge.log(<span class="string">"beforeHookedMethod"</span>);</span><br><span class="line">                        Log.d(<span class="string">"xposedplugin"</span>,(String) param.args[<span class="number">0</span>]);</span><br><span class="line">                        Log.d(<span class="string">"xposedplugin"</span>, (String) param.args[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">                        XposedBridge.log(<span class="string">"hook前账号"</span>+(String) param.args[<span class="number">0</span>]);</span><br><span class="line">                        XposedBridge.log(<span class="string">"hook前密码"</span>+(String) param.args[<span class="number">1</span>]);</span><br><span class="line">                        <span class="comment">//将两个参数改为相等</span></span><br><span class="line">                        param.args[<span class="number">0</span>] = <span class="string">"123"</span>;</span><br><span class="line">                        param.args[<span class="number">1</span>] = <span class="string">"123"</span>;</span><br><span class="line"></span><br><span class="line">                        XposedBridge.log(<span class="string">"hook后账号"</span>+(String) param.args[<span class="number">0</span>]);</span><br><span class="line">                        XposedBridge.log(<span class="string">"hook后密码"</span>+(String) param.args[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">//这样设置函数的返回值</span></span><br><span class="line">                        param.setResult(<span class="keyword">true</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="comment">//这个hook方法之后有啥用还不知道</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                        <span class="keyword">super</span>.afterHookedMethod(param);</span><br><span class="line">                        XposedBridge.log(<span class="string">"afterHookedMethod"</span>);</span><br><span class="line"></span><br><span class="line">                        Log.d(<span class="string">"xposedplugin"</span>, (String) param.args[<span class="number">0</span>]);</span><br><span class="line">                        Log.d(<span class="string">"xposedplugin"</span>, (String) param.args[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6、生成apk-安装"><a href="#6、生成apk-安装" class="headerlink" title="6、生成apk 安装"></a>6、生成apk 安装</h4><h4 id="7、apk导入xpose模块，重启手机"><a href="#7、apk导入xpose模块，重启手机" class="headerlink" title="7、apk导入xpose模块，重启手机"></a>7、apk导入xpose模块，重启手机</h4><p>​    </p>
<h4 id="8、结果演示"><a href="#8、结果演示" class="headerlink" title="8、结果演示"></a>8、结果演示</h4><p><img src="/2021/06/07/Hook%E6%A1%86%E6%9E%B6xposed%E7%9A%84%E7%AE%80%E5%8D%95demo/1.jpg" style="zoom: 25%;"></p>
<p>xpose日志</p>
<p>I/Xposed ( 3570): Found Xposed class ‘de/robv/android/xposed/XposedBridge’, now initializing<br>06-12 18:10:58.280 I/Xposed ( 3570): Loading modules from /data/app/com.example.ceshi-1/base.apk<br>06-12 18:11:02.882 I/Xposed ( 3570):  Loading class com.example.ceshi.Main<br>06-12 18:11:45.428 I/Xposed ( 8549): Loaded app: com.example.hookdemo<br>06-12 18:11:53.710 I/Xposed ( 8549): beforeHookedMethod<br>06-12 18:11:53.723 I/Xposed ( 8549): hook前账号ddddd<br>06-12 18:11:53.723 I/Xposed ( 8549): hook前密码jj<br>06-12 18:11:53.726 I/Xposed ( 8549): hook后账号123<br>06-12 18:11:53.726 I/Xposed ( 8549): hook后密码123</p>
<p><strong>参考链接：</strong></p>
<p>1、###### Hook框架xposed的简单demo</p>
<p><a href="https://blog.csdn.net/coc_k/article/details/52584059" target="_blank" rel="noopener">https://blog.csdn.net/coc_k/article/details/52584059</a></p>
<p>2、###### Using the Xposed Framework API</p>
<p><a href="https://github.com/rovo89/XposedBridge/wiki/Using-the-Xposed-Framework-API" target="_blank" rel="noopener">https://github.com/rovo89/XposedBridge/wiki/Using-the-Xposed-Framework-API</a></p>
<p><a href="https://github.com/rovo89/XposedBridge/wiki/Development-tutorial" target="_blank" rel="noopener">https://github.com/rovo89/XposedBridge/wiki/Development-tutorial</a><br>3、Xposed之Hook方法笔记<br><a href="https://www.jianshu.com/p/c513a2289db0" target="_blank" rel="noopener">https://www.jianshu.com/p/c513a2289db0</a><br>4、关于XposedHook的实践<br><a href="https://www.jianshu.com/p/4e474495865e" target="_blank" rel="noopener">https://www.jianshu.com/p/4e474495865e</a></p>
]]></content>
      <categories>
        <category>逆向</category>
      </categories>
      <tags>
        <tag>逆向，AndroidStudio</tag>
      </tags>
  </entry>
  <entry>
    <title>AndroidStudio使用USB真机调试教程</title>
    <url>/2021/06/07/AndroidStudio%E4%BD%BF%E7%94%A8USB%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<p>Android开发者第一步学习的应该就是真机调试了。但是很多初次接触android studio的同学还是不知道如何用真机调试，今天我就给大家写一个教程，希望可以帮到需要的人。</p>
<a id="more"></a>
<h2 id="一、真机调试"><a href="#一、真机调试" class="headerlink" title="一、真机调试"></a>一、真机调试</h2><p>   1.先用usb线把你的测试手机连接到你的电脑上，并且安装驱动</p>
<p>   2.安装好驱动后就可以在电脑上读取手机的文件。接下来就是设置测试手机（寻找开发者选项）。</p>
<p>​    1）点击测试机“设置“，在设置中，寻找开发者选项，如果没有开发者选项，按接下来的步骤操作：找到关于手机，点击关于手机。然后找到“版本号”（小米手机是MIUI版本），点击几次版本号(最多5次)，系统即提示“您现在处于开发者模式”。注：不同手机提示可能不同。然后返回设置就会找到开发者选项。</p>
<pre><code> 2）然后在设置中找到“安全性（部分手机：系统安全）”，点击进入。找到“未知来源”，点击后会弹出系统提示，点击确认
</code></pre><p>​     3）点击开发者选项，点击启用，会弹出一个系统提示，点击确认。然后再勾选USB调试，系统又会弹出提示，继续点击确认。</p>
<p>​    3.接下来设置android studio。打开android studio，在工具栏中找到，app选项，点击会弹出 Edit Configurations..选项，点击进入，然后在设置页面中找到  Deploymeng target Options下的Target选项，(新版可能找不到，可直接点击运行)，然后选择为USB Device。然后点击OK。至此咱就已经基本设置好了。可以进行真机测试了。</p>
<p> 结果如图所示：</p>
<p><img src="/2021/06/07/AndroidStudio%E4%BD%BF%E7%94%A8USB%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95%E6%95%99%E7%A8%8B/1.png" style="zoom: 50%;"></p>
<h2 id="二、Android应用各部分说明"><a href="#二、Android应用各部分说明" class="headerlink" title="二、Android应用各部分说明"></a>二、Android应用各部分说明</h2><p><strong>（1）MainActivity.java文件</strong><br>主要活动代码，实际的应用程序文件，将被转化为Dalvik可执行文件并运行。R.layout.activity_main 引用res/layout/activity_main.xml文件。</p>
<p>onCreate()  活动被加载之后众多被调用的方法之一。</p>
<p><strong>（2）AndroidManifest.xml文件</strong></p>
<p>AndroidManifest.xml文件是整个应用程序的信息描述文件，定义了应用程序中包含的Activity,Service,Content provider和BroadcastReceiver组件信息。每个应用程序在根目录下必须包含一个AndroidManifest.xml文件，且文件名不能修改。在AndroidManifest.xml文件中，首先看到是的<manifest>节点，它是整个应用程序的基本属性，涵盖了默认进程名字，应用程序标识，安装位置，对系统的要求以及应用程序的版本等。</manifest></p>
<p>android:icon是普通图标。</p>
<p>android:roundIcon是圆形图标。</p>
<p>android:label属性指定应用的名称。</p>
<p>android:name属性指定一个Activity类子类的全名。</p>
<p>意图过滤器的action被命名为android.intent.action.MAIN，表明这个活动被用做应用程序的入口。</p>
<p>意图过滤器的category被命名为android.intent.category.LAUNCHER，表明应用程序可以通过设备启动器的图标来启动。</p>
<p>@string指的是strings.xml，因此@string/app_name指的是定义在strings.xml中的app_name，这里实际为”demo”。</p>
<p><strong>（3）activity_main.xml文件</strong><br>activity_main.xml 我们将频繁修改这个文件来改变应用程序的布局。</p>
<p>TextView是一个用于构建用户图形界面的Android控件。</p>
<p>它包含有许多不同的属性，诸如android:layout_width, android:layout_height等用来设置它的宽度和高度等。</p>
<p>这里我们给它显示一句话“御风而上，神游天下!”，并且字体颜色为红色，引用自strings.xml文件。</p>
<h2 id="三、建立一个空工程，编写获取序列号的简单例子"><a href="#三、建立一个空工程，编写获取序列号的简单例子" class="headerlink" title="三、建立一个空工程，编写获取序列号的简单例子"></a>三、建立一个空工程，编写获取序列号的简单例子</h2><p><strong>1.获取手机状态需要设置权限</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span>=<span class="string">"com.example.demoimei"</span>&gt;</span><br><span class="line">  &lt;uses-permission android:name="android.permission.READ_PHONE_STATE"&gt;&lt;/uses-permission&gt;</span><br><span class="line">  &lt;application</span><br></pre></td></tr></table></figure>
<p><strong>2.编写布局文件</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;TextView</span><br><span class="line">    android:id=<span class="string">"@+id/tv1"</span></span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:text=<span class="string">"Hello World!"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;TextView</span><br><span class="line">    android:id=<span class="string">"@+id/tv2"</span></span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:text=<span class="string">"Hello World!"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p><strong>3、编写主 Activity 类中的 onCreate 函数</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cockroach.hook_object;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.telephony.TelephonyManager;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    </span><br><span class="line">        TextView tv1 = (TextView) findViewById(R.id.tv1);</span><br><span class="line">        TextView tv2 = (TextView) findViewById(R.id.tv2);</span><br><span class="line">        TelephonyManager tm = (TelephonyManager)getSystemService(Context.TELEPHONY_SERVICE);</span><br><span class="line">        tv1.setText(<span class="string">"imei:"</span> + tm.getDeviceId());</span><br><span class="line">        tv2.setText(<span class="string">"imsi:"</span> + tm.getSubscriberId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果出现闪退问题，报错</p>
<p> java.lang.SecurityException: getDeviceId: Neither user 10226 nor current process has android.permis</p>
<p>这可能是手机设置的问题，我手机的 应用程序-&gt; 授予权限就OK了</p>
<p><strong>运行结果如下：</strong></p>
<p><img src="/2021/06/07/AndroidStudio%E4%BD%BF%E7%94%A8USB%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95%E6%95%99%E7%A8%8B/2.jpg" style="zoom: 50%;"></p>
<p>这就是我们的等会要hook的apk程序，下面编写xposed插件</p>
]]></content>
      <categories>
        <category>逆向</category>
      </categories>
      <tags>
        <tag>逆向，AndroidStudio</tag>
      </tags>
  </entry>
  <entry>
    <title>生成器中的return有什么作用</title>
    <url>/2021/06/06/%E7%94%9F%E6%88%90%E5%99%A8%E4%B8%AD%E7%9A%84return%E6%9C%89%E4%BB%80%E4%B9%88%E4%BD%9C%E7%94%A8/</url>
    <content><![CDATA[<p>生成器中的return有什么作用</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_data</span><span class="params">(num)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> num &gt; <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(num):</span><br><span class="line">            <span class="keyword">yield</span> i</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> num</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    res = generate_data(num=<span class="number">12</span>)</span><br><span class="line">    print(res, type(res))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">        print(i, type(i))</span><br></pre></td></tr></table></figure>
<p><strong>运行结果：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;generator object generate_data at 0x000002279C741750&gt; &lt;class &#39;generator&#39;&gt;</span><br><span class="line">0 &lt;class &#39;int&#39;&gt;</span><br><span class="line">1 &lt;class &#39;int&#39;&gt;</span><br><span class="line">2 &lt;class &#39;int&#39;&gt;</span><br><span class="line">3 &lt;class &#39;int&#39;&gt;</span><br><span class="line">4 &lt;class &#39;int&#39;&gt;</span><br><span class="line">5 &lt;class &#39;int&#39;&gt;</span><br><span class="line">6 &lt;class &#39;int&#39;&gt;</span><br><span class="line">7 &lt;class &#39;int&#39;&gt;</span><br><span class="line">8 &lt;class &#39;int&#39;&gt;</span><br><span class="line">9 &lt;class &#39;int&#39;&gt;</span><br><span class="line">10 &lt;class &#39;int&#39;&gt;</span><br><span class="line">11 &lt;class &#39;int&#39;&gt;</span><br></pre></td></tr></table></figure>
<p><strong>今天的重点，当num值小于10时：</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">res = generate_data(num=<span class="number">5</span>)</span><br><span class="line">   print(res, type(res))</span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">       print(i, type(i))</span><br></pre></td></tr></table></figure>
<p><strong>运行结果：</strong></p>
<p><generator object generate_data at 0x00000282b21e1750> <class 'generator'></class></generator></p>
<p>并没有返回5这个值,但是代码也没有报错，通过印结果，这说明返回的res 也是生成器</p>
<p><strong>带着疑问，我们进行搜索</strong></p>
<p><a href="https://stackoverflow.com/questions/16780002/return-in-generator-together-with-yield-in-python-3-3" target="_blank" rel="noopener">https://stackoverflow.com/questions/16780002/return-in-generator-together-with-yield-in-python-3-3</a></p>
<p><strong>这时候我们明白了：</strong></p>
<p>return 在生成器中，表示生成器运行完成了，可以结束了。然后生成器会抛出一个StopIteration的异常。而for循环能够检测到这个异常，于是结束循环。所以当我们传入的参数为5的时候，生成器直接运行到了return，于是它直接就抛出StopIteration，于是for 循环检测到这个异常就结束了。<br> 在生成器里面的return只是一个结束标志，它不会把后面写的值返回给调用者。这跟函数里面的return语句是不一样的.</p>
<p><strong>我们验证一下：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def f():</span><br><span class="line">    return 3</span><br><span class="line">    yield 2</span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    x &#x3D; f()</span><br><span class="line">    print(x.__next__())</span><br></pre></td></tr></table></figure>
<p><strong>运行结果：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;E:&#x2F;workerspace&#x2F;demo&#x2F;a.py&quot;, line 14, in &lt;module&gt;</span><br><span class="line">    print(x.__next__())</span><br><span class="line">StopIteration: 3</span><br></pre></td></tr></table></figure>
<p>果真如此</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>python基础</category>
      </categories>
      <tags>
        <tag>Python基础</tag>
        <tag>生成器</tag>
      </tags>
  </entry>
  <entry>
    <title>xposed-hook原理</title>
    <url>/2021/06/06/xposed-hook%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<p>xposed hook 原理介绍</p>
<a id="more"></a>
<p><strong>1、xposed工作原理：</strong></p>
<p>Android基于Linux，第一个启动的进程自然是<code>init进程</code>，该进程会启动所有Android进程的父进程——<code>Zygote(孵化)进程</code>，该进程的启动配置在<code>/init.rc</code>脚本中，而Zygote进程对应的执行文件是<code>/system/bin/app_process</code>，该文件完成类库的加载以及一些函数的调用工作。在Zygote进程创建后，再fork出SystemServer进程和其他进程。而Xposed Framework呢，就是<strong>用自己实现的app_process替换掉了系统原本提供的app_process</strong>，加载一个额外的jar包，然后入口从原来的<code>com.android.internal.osZygoteInit.main()</code>被替换成了<code>de.robv.android.xposed.XposedBridge.main()</code>，然后<strong>创建的Zygote进程就变成Hook的Zygote进程了</strong>，而后面Fork出来的进程也是被Hook过的。这个Jar包在<code>/data/data/de.rbov.android.xposed.installer/bin/XposedBridge.jar</code>。</p>
<p>「拦截」。Xposed 通过劫持 Android 系统的 zygote 进程来加载自定义功能，这就像是半路截杀，在应用运行之前就已经将我们需要的自定义内容强加在了系统进程当中。</p>
<p><strong>2、Android 系统的Zygote初始化过程</strong></p>
<p><strong>参考链接：</strong><a href="https://www.jianshu.com/p/2303e7efb956" target="_blank" rel="noopener">https://www.jianshu.com/p/2303e7efb956</a></p>
<p><strong>3、xposed拦截流程：</strong></p>
<ul>
<li>startVM() 启动虚拟机并且初始化</li>
<li>startReg() 注册一些JNI的方法</li>
<li>start() 启动Zygote，依次执行 startVM()-&gt;startReg()-&gt;callMain()</li>
<li>callMain() 通过反射调用传入的className对象的main函数，如在init.cpp函数里面传入的ZygoteInit对象和RuntimeInit对象，调用callMain方法就会调用对应的main方法。</li>
</ul>
<p><strong>也就是说在安卓系统启动的时候，在执行callmain()这个函数的时候，我们就把我们的自定义的一些模块注入到，系统进程中了。</strong></p>
]]></content>
      <categories>
        <category>逆向</category>
      </categories>
      <tags>
        <tag>Hook</tag>
        <tag>frida</tag>
        <tag>逆向</tag>
      </tags>
  </entry>
  <entry>
    <title>你应该要了解的https</title>
    <url>/2021/06/06/%E4%BD%A0%E5%BA%94%E8%AF%A5%E8%A6%81%E4%BA%86%E8%A7%A3%E7%9A%84https/</url>
    <content><![CDATA[<p>近几年，互联网发生着翻天覆地的变化，尤其是我们一直习以为常的HTTP协议，在逐渐的被HTTPS协议所取代，在浏览器、搜索引擎、CA机构、大型互联网企业的共同促进下，互联网迎来了“HTTPS加密时代”，HTTPS将在未来的几年内全面取代HTTP成为传输协议的主流。</p>
<a id="more"></a>
<p>读完本文，希望你能明白：</p>
<ul>
<li>HTTP通信存在什么问题</li>
<li>HTTPS如何改进HTTP存在那些问题</li>
<li>HTTPS工作原理是什么</li>
</ul>
<h2 id="一、什么是HTTPS"><a href="#一、什么是HTTPS" class="headerlink" title="一、什么是HTTPS"></a>一、什么是HTTPS</h2><p>HTTPS是在HTTP上建立SSL加密层，并对传输数据进行加密，是HTTP协议的安全版。现在它被广泛用于万维网上安全敏感的通讯，例如交易支付方面。</p>
<p>HTTPS主要作用是：</p>
<p>（1）对数据进行加密，并建立一个信息安全通道，来保证传输过程中的数据安全;</p>
<p>（2）对网站服务器进行真实身份认证。</p>
<p>我们经常会在Web的登录页面和购物结算界面等使用HTTPS通信。使用HTTPS通信时，不再用<code>http://</code>，而是改用<code>https://</code>。另外，当浏览器访问HTTPS通信有效的Web网站时，浏览器的地址栏内会出现一个带锁的标记。对HTTPS的显示方式会因浏览器的不同而有所改变。</p>
<p><img src="./你应该要了解的https/1.jpg" alt></p>
<h2 id="二、为什么需要HTTPS"><a href="#二、为什么需要HTTPS" class="headerlink" title="二、为什么需要HTTPS"></a>二、为什么需要HTTPS</h2><p>在HTTP协议中有可能存在信息窃取或身份伪装等安全问题。使用HTTPS通信机制可以有效地防止这些问题，接下来，我们先来了解下<br>HTTP协议存在的哪些问题：</p>
<ul>
<li>通信使用明文（不加密），内容可能被窃听</li>
</ul>
<p>由于HTTP本身不具备加密的功能，所以也无法做到对通信整体（使用HTTP协议通信的请求和响应的内容）进行加密。即，<strong>HTTP报文使用明文（指未经过加密的报文）方式发送</strong>。</p>
<p>HTTP明文协议的缺陷是导致数据泄露、数据篡改、流量劫持、钓鱼攻击等安全问题的重要原因。HTTP协议无法加密数据，所有通信数据都在网络中明文“裸奔”。通过网络的嗅探设备及一些技术手段，就可还原HTTP报文内容。</p>
<ul>
<li>无法证明报文的完整性，所以可能遭篡改</li>
</ul>
<p>所谓完整性是指信息的准确度。若无法证明其完整性，通常也就意味着无法判断信息是否准确。由于HTTP协议无法证明通信的报文完整性，因此，在请求或响应送出之后直到对方接收之前的这段时间内，即使请求或响应的内容遭到篡改，也没有办法获悉。<br>换句话说，<strong>没有任何办法确认，发出的请求/响应和接收到的请求/响应是前后相同的</strong>。</p>
<ul>
<li>不验证通信方的身份，因此有可能遭遇伪装</li>
</ul>
<p><strong>HTTP协议中的请求和响应不会对通信方进行确认</strong>。在HTTP协议通信时，由于不存在确认通信方的处理步骤，任何人都可以发起请求。另外，服务器只要接收到请求，不管对方是谁都会返回一个响应（但也仅限于发送端的IP地址和端口号没有被Web服务器设定限制访问的前提下）</p>
<p>HTTP协议无法验证通信方身份，任何人都可以伪造虚假服务器欺骗用户，实现“钓鱼欺诈”，用户无法察觉。</p>
<p>反观HTTPS协议，它比HTTP协议相比多了以下优势（下文会详细介绍）:</p>
<ul>
<li>数据隐私性：内容经过对称加密，每个连接生成一个唯一的加密密钥</li>
<li>数据完整性：内容传输经过完整性校验</li>
<li>身份认证：第三方无法伪造服务端（客户端）身份</li>
</ul>
<h2 id="三、HTTPS如何解决HTTP上述问题"><a href="#三、HTTPS如何解决HTTP上述问题" class="headerlink" title="三、HTTPS如何解决HTTP上述问题?"></a>三、HTTPS如何解决HTTP上述问题?</h2><p>HTTPS并非是应用层的一种新协议。只是HTTP通信接口部分用SSL和TLS协议代替而已。</p>
<p>通常，HTTP直接和TCP通信。当使用SSL时，则演变成先和SSL通信，再由SSL和TCP通信了。简言之，<strong>所谓HTTPS，其实就是身披SSL协议这层外壳的HTTP</strong>。</p>
<p><img src="./你应该要了解的https/2.jpg" alt></p>
<p>在采用SSL后，HTTP就拥有了HTTPS的加密、证书和完整性保护这些功能。也就是说<strong>HTTP加上加密处理和认证以及完整性保护后即是HTTPS</strong>。</p>
<p><img src="./你应该要了解的https/3.jpg" alt></p>
<p>HTTPS 协议的主要功能基本都依赖于 TLS/SSL 协议，TLS/SSL 的功能实现主要依赖于三类基本算法：散列函数 、对称加密和非对称加密，<strong>其利用非对称加密实现身份认证和密钥协商，对称加密算法采用协商的密钥对数据加密，基于散列函数验证信息的完整性</strong>。</p>
<p><img src="./你应该要了解的https/4.jpg" alt></p>
<h3 id="1-解决内容可能被窃听的问题——加密"><a href="#1-解决内容可能被窃听的问题——加密" class="headerlink" title="1.解决内容可能被窃听的问题——加密"></a>1.解决内容可能被窃听的问题——加密</h3><h4 id="方法1-对称加密"><a href="#方法1-对称加密" class="headerlink" title="方法1.对称加密"></a>方法1.对称加密</h4><p>这种方式加密和解密同用一个密钥。加密和解密都会用到密钥。<strong>没有密钥就无法对密码解密，反过来说，任何人只要持有密钥就能解密了</strong>。</p>
<p>以对称加密方式加密时必须将密钥也发给对方。可究竟怎样才能安全地转交？在互联网上转发密钥时，如果通信被监听那么密钥就可会落人攻击者之手，同时也就失去了加密的意义。另外还得设法安全地保管接收到的密钥。</p>
<h4 id="方法2-非对称加密"><a href="#方法2-非对称加密" class="headerlink" title="方法2.非对称加密"></a>方法2.非对称加密</h4><p>公开密钥加密使用一对非对称的密钥。一把叫做私有密钥，另一把叫做公开密钥。顾名思义，<strong>私有密钥不能让其他任何人知道，而公开密钥则可以随意发布，任何人都可以获得</strong>。</p>
<p>使用公开密钥加密方式，发送密文的一方使用<strong>对方的公开密钥</strong>进行加密处理，对方收到被加密的信息后，再使用自己的私有密钥进行解密。利用这种方式，不需要发送用来解密的私有密钥，也不必担心密钥被攻击者窃听而盗走。<br><img src="./你应该要了解的https/5.jpg" alt></p>
<p>非对称加密的特点是信息传输一对多，服务器只需要维持一个私钥就能够和多个客户端进行加密通信。</p>
<p>这种方式有以下缺点：</p>
<ul>
<li>公钥是公开的，所以针对私钥加密的信息，黑客截获后可以使用公钥进行解密，获取其中的内容；</li>
<li>公钥并不包含服务器的信息，使用非对称加密算法无法确保服务器身份的合法性，存在中间人攻击的风险，服务器发送给客户端的公钥可能在传送过程中被中间人截获并篡改；</li>
<li>使用非对称加密<strong>在数据加密解密过程需要消耗一定时间</strong>，降低了数据传输效率；</li>
</ul>
<h4 id="方法3-对称加密-非对称加密-HTTPS采用这种方式"><a href="#方法3-对称加密-非对称加密-HTTPS采用这种方式" class="headerlink" title="方法3.对称加密+非对称加密(HTTPS采用这种方式)"></a>方法3.对称加密+非对称加密(HTTPS采用这种方式)</h4><p>使用对称密钥的好处是解密的效率比较快，使用非对称密钥的好处是可以使得传输的内容不能被破解，因为就算你拦截到了数据，但是没有对应的私钥，也是不能破解内容的。就比如说你抢到了一个保险柜，但是没有保险柜的钥匙也不能打开保险柜。那我们就将对称加密与非对称加密结合起来,充分利用两者各自的优势，<strong>在交换密钥环节使用非对称加密方式，之后的建立通信交换报文阶段则使用对称加密方式</strong>。</p>
<p>具体做法是：<strong>发送密文的一方使用对方的公钥进行加密处理“对称的密钥”，然后对方用自己的私钥解密拿到“对称的密钥”，这样可以确保交换的密钥是安全的前提下，使用对称加密方式进行通信</strong>。所以，HTTPS采用对称加密和非对称加密两者并用的混合加密机制。</p>
<h3 id="2-解决报文可能遭篡改问题——数字签名"><a href="#2-解决报文可能遭篡改问题——数字签名" class="headerlink" title="2.解决报文可能遭篡改问题——数字签名"></a>2.解决报文可能遭篡改问题——数字签名</h3><p>网络传输过程中需要经过很多中间节点，虽然数据无法被解密，但可能被篡改，那如何校验数据的完整性呢？——校验数字签名。</p>
<p><strong>数字签名有两种功效</strong>：</p>
<ul>
<li>能确定消息确实是由发送方签名并发出来的，因为别人假冒不了发送方的签名。</li>
<li>数字签名能确定消息的完整性,证明数据是否未被篡改过。</li>
</ul>
<p><strong>数字签名如何生成:</strong><br><img src="./你应该要了解的https/6.jpg" alt></p>
<p>将一段文本先用Hash函数生成消息摘要，然后用发送者的私钥加密生成数字签名，与原文文一起传送给接收者。接下来就是接收者校验数字签名的流程了。</p>
<p><strong>校验数字签名流程</strong>：</p>
<p><img src="./你应该要了解的https/7.jpg" alt="img"></p>
<p>接收者只有用发送者的公钥才能解密被加密的摘要信息，然后用HASH函数对收到的原文产生一个摘要信息，与上一步得到的摘要信息对比。如果相同，则说明收到的信息是完整的，在传输过程中没有被修改，否则说明信息被修改过，因此数字签名能够验证信息的完整性。</p>
<p>假设消息传递在Kobe，James两人之间发生。James将消息连同数字签名一起发送给Kobe，Kobe接收到消息后，通过校验数字签名，就可以验证接收到的消息就是James发送的。当然，这个过程的前提是Kobe知道James的公钥。问题的关键的是，和消息本身一样，公钥不能在不安全的网络中直接发送给Kobe,或者说拿到的公钥如何证明是James的。</p>
<p>此时就需要引入了<strong>证书颁发机构</strong>（Certificate Authority，简称CA），CA数量并不多，Kobe客户端内置了所有受信任CA的证书。CA对James的公钥（和其他信息）数字签名后生成证书。</p>
<h3 id="3-解决通信方身份可能被伪装的问题——数字证书"><a href="#3-解决通信方身份可能被伪装的问题——数字证书" class="headerlink" title="3.解决通信方身份可能被伪装的问题——数字证书"></a>3.解决通信方身份可能被伪装的问题——数字证书</h3><p>数字证书认证机构处于客户端与服务器双方都可信赖的第三方机构的立场上。<br><img src="./你应该要了解的https/8.jpg" alt>们来介绍一下数字证书认证机构的业务流程：</p>
<ul>
<li>服务器的运营人员向第三方机构CA提交公钥、组织信息、个人信息(域名)等信息并申请认证;</li>
<li>CA通过线上、线下等多种手段验证申请者提供信息的真实性，如组织是否存在、企业是否合法，是否拥有域名的所有权等;</li>
<li>如信息审核通过，CA会向申请者签发认证文件-证书。证书包含以下信息：申请者公钥、申请者的组织信息和个人信息、签发机构 CA的信息、有效时间、证书序列号等信息的明文，同时包含一个签名。 其中签名的产生算法：首先，使用散列函数计算公开的明文信息的信息摘要，然后，采用 CA的私钥对信息摘要进行加密，密文即签名;</li>
<li>客户端 Client 向服务器 Server 发出请求时，Server 返回证书文件;</li>
<li>客户端 Client 读取证书中的相关的明文信息，采用相同的散列函数计算得到信息摘要，然后，利用对应 CA的公钥解密签名数据，对比证书的信息摘要，如果一致，则可以确认证书的合法性，即服务器的公开密钥是值得信赖的。</li>
<li>客户端还会验证证书相关的域名信息、有效时间等信息; 客户端会内置信任CA的证书信息(包含公钥)，如果CA不被信任，则找不到对应 CA的证书，证书也会被判定非法。</li>
</ul>
<h2 id="四、-HTTPS工作流程"><a href="#四、-HTTPS工作流程" class="headerlink" title="四、 HTTPS工作流程"></a>四、 HTTPS工作流程</h2><p><img src="./你应该要了解的https/9.jpg" alt></p>
<p>1.Client发起一个HTTPS（比如<code>https://juejin.im/user/5a9a9cdcf265da238b7d771c</code>）的请求，根据RFC2818的规定，Client知道需要连接Server的443（默认）端口。</p>
<p>2.Server把事先配置好的公钥证书（public key certificate）返回给客户端。</p>
<p>3.Client验证公钥证书：比如是否在有效期内，证书的用途是不是匹配Client请求的站点，是不是在CRL吊销列表里面，它的上一级证书是否有效，这是一个递归的过程，直到验证到根证书（操作系统内置的Root证书或者Client内置的Root证书）。如果验证通过则继续，不通过则显示警告信息。</p>
<p>4.Client使用伪随机数生成器生成加密所使用的对称密钥，然后用证书的公钥加密这个对称密钥，发给Server。</p>
<p>5.Server使用自己的私钥（private key）解密这个消息，得到对称密钥。至此，Client和Server双方都持有了相同的对称密钥。</p>
<p>6.Server使用对称密钥加密“明文内容A”，发送给Client。</p>
<p>7.Client使用对称密钥解密响应的密文，得到“明文内容A”。</p>
<p>8.Client再次发起HTTPS的请求，使用对称密钥加密请求的“明文内容B”，然后Server使用对称密钥解密密文，得到“明文内容B”。</p>
<h2 id="五、HTTP-与-HTTPS-的区别"><a href="#五、HTTP-与-HTTPS-的区别" class="headerlink" title="五、HTTP 与 HTTPS 的区别"></a>五、HTTP 与 HTTPS 的区别</h2><ul>
<li>HTTP 是明文传输协议，HTTPS 协议是由 SSL+HTTP 协议构建的可进行加密传输、身份认证的网络协议，比 HTTP 协议安全。</li>
<li></li>
</ul>
<p><img src="你应该要了解的https/10.jpg" alt></p>
<p>关于安全性，用最简单的比喻形容两者的关系就是卡车运货，HTTP下的运货车是敞篷的，货物都是暴露的。而https则是封闭集装箱车，安全性自然提升不少。</p>
<ul>
<li>HTTPS比HTTP更加安全，对搜索引擎更友好，利于SEO,谷歌、百度优先索引HTTPS网页;</li>
<li>HTTPS需要用到SSL证书，而HTTP不用;</li>
<li>HTTPS标准端口443，HTTP标准端口80;</li>
<li>HTTPS基于传输层，HTTP基于应用层;</li>
<li>HTTPS在浏览器显示绿色安全锁，HTTP没有显示;</li>
</ul>
<h2 id="六、为何不所有的网站都使用HTTPS"><a href="#六、为何不所有的网站都使用HTTPS" class="headerlink" title="六、为何不所有的网站都使用HTTPS"></a>六、为何不所有的网站都使用HTTPS</h2><p>既然HTTPS那么安全可靠，那为何不所有的Web网站都使用HTTPS？</p>
<p>首先，很多人还是会觉得HTTPS实施有门槛，这个门槛在于需要权威CA颁发的SSL证书。从证书的选择、购买到部署，传统的模式下都会比较耗时耗力。</p>
<p>其次，HTTPS普遍认为性能消耗要大于HTTP，因为<strong>与纯文本通信相比，加密通信会消耗更多的CPU及内存资源</strong>。如果每次通信都加密，会消耗相当多的资源，平摊到一台计算机上时，能够处理的请求数量必定也会随之减少。但事实并非如此，用户可以通过性能优化、把证书部署在SLB或CDN，来解决此问题。举个实际的例子，“双十一”期间，全站HTTPS的淘宝、天猫依然保证了网站和移动端的访问、浏览、交易等操作的顺畅、平滑。通过测试发现，经过优化后的许多页面性能与HTTP持平甚至还有小幅提升，因此HTTPS经过优化之后其实并不慢。</p>
<p>除此之外，<strong>想要节约购买证书的开销也是原因之一</strong>。要进行HTTPS通信，证书是必不可少的。而使用的证书必须向认证机构（CA）购买。</p>
<p>最后是安全意识。相比国内，国外互联网行业的安全意识和技术应用相对成熟，HTTPS部署趋势是由社会、企业、政府共同去推动的。</p>
]]></content>
      <categories>
        <category>https,面试集锦</category>
      </categories>
      <tags>
        <tag>面试集锦</tag>
        <tag>https</tag>
      </tags>
  </entry>
  <entry>
    <title>bloomfilter</title>
    <url>/2021/06/06/bloomfilter/</url>
    <content><![CDATA[<p>布隆过滤器介绍</p>
<a id="more"></a>
<h2 id="什么是布隆过滤器"><a href="#什么是布隆过滤器" class="headerlink" title="什么是布隆过滤器"></a><strong>什么是布隆过滤器</strong></h2><p>本质上布隆过滤器是一种数据结构，比较巧妙的概率型数据结构（probabilistic data structure），特点是高效地插入和查询，可以用来告诉你 <strong>“某样东西一定不存在或者可能存在”</strong>。</p>
<p>相比于传统的 List、Set、Map 等数据结构，它更高效、占用空间更少，但是缺点是其返回的结果是概率性的，而不是确切的。</p>
<h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a><strong>实现原理</strong></h2><p><strong>HashMap 的问题</strong></p>
<p>讲述布隆过滤器的原理之前，我们先思考一下，通常你判断某个元素是否存在用的是什么？应该蛮多人回答 HashMap 吧，确实可以将值映射到 HashMap 的 Key，然后可以在 O(1) 的时间复杂度内返回结果，效率奇高。但是 HashMap 的实现也有缺点，例如存储容量占比高，考虑到负载因子的存在，通常空间是不能被用满的，而一旦你的值很多例如上亿的时候，那 HashMap 占据的内存大小就变得很可观了。</p>
<p>还比如说你的数据集存储在远程服务器上，本地服务接受输入，而数据集非常大不可能一次性读进内存构建 HashMap 的时候，也会存在问题。</p>
<p><strong>布隆过滤器数据结构</strong></p>
<p>布隆过滤器是一个 bit 向量或者说 bit 数组，长这样：</p>
<p><img src="/2021/06/06/bloomfilter/1.jpg" alt></p>
<p>如果我们要映射一个值到布隆过滤器中，我们需要使用<strong>多个不同的哈希函数</strong>生成<strong>多个哈希值，</strong>并对每个生成的哈希值指向的 bit 位置 1，例如针对值 “baidu” 和三个不同的哈希函数分别生成了哈希值 1、4、7，则上图转变为：</p>
<p><img src="/2021/06/06/bloomfilter/2.jpg" alt></p>
<p>Ok，我们现在再存一个值 “tencent”，如果哈希函数返回 3、4、8 的话，图继续变为：</p>
<p><img src="/2021/06/06/bloomfilter/3.jpg" alt></p>
<p>值得注意的是，4 这个 bit 位由于两个值的哈希函数都返回了这个 bit 位，因此它被覆盖了。现在我们如果想查询 “dianping” 这个值是否存在，哈希函数返回了 1、5、8三个值，结果我们发现 5 这个 bit 位上的值为 0，<strong>说明没有任何一个值映射到这个 bit 位上</strong>，因此我们可以很确定地说 “dianping” 这个值不存在。而当我们需要查询 “baidu” 这个值是否存在的话，那么哈希函数必然会返回 1、4、7，然后我们检查发现这三个 bit 位上的值均为 1，那么我们可以说 “baidu” <strong>存在了么？答案是不可以，只能是 “baidu” 这个值可能存在。</strong></p>
<p>这是为什么呢？答案跟简单，因为随着增加的值越来越多，被置为 1 的 bit 位也会越来越多，这样某个值 “taobao” 即使没有被存储过，但是万一哈希函数返回的三个 bit 位都被其他值置位了 1 ，那么程序还是会判断 “taobao” 这个值存在。</p>
<h2 id="支持删除么"><a href="#支持删除么" class="headerlink" title="支持删除么"></a>支持删除么</h2><p>感谢评论区提醒，传统的布隆过滤器并不支持删除操作。但是名为 Counting Bloom filter 的变种可以用来测试元素计数个数是否绝对小于某个阈值，它支持元素删除。可以参考文章 <a href="https://link.zhihu.com/?target=https%3A//cloud.tencent.com/developer/article/1136056">Counting Bloom Filter 的原理和实现</a></p>
<h2 id="如何选择哈希函数个数和布隆过滤器长度"><a href="#如何选择哈希函数个数和布隆过滤器长度" class="headerlink" title="如何选择哈希函数个数和布隆过滤器长度"></a><strong>如何选择哈希函数个数和布隆过滤器长度</strong></h2><p>很显然，过小的布隆过滤器很快所有的 bit 位均为 1，那么查询任何值都会返回“可能存在”，起不到过滤的目的了。布隆过滤器的长度会直接影响误报率，布隆过滤器越长其误报率越小。</p>
<p>另外，哈希函数的个数也需要权衡，个数越多则布隆过滤器 bit 位置位 1 的速度越快，且布隆过滤器的效率越低；但是如果太少的话，那我们的误报率会变高。</p>
<p><img src="/2021/06/06/bloomfilter/4.jpg" alt>k 为哈希函数个数，m 为布隆过滤器长度，n 为插入的元素个数，p 为误报率</p>
<p>如何选择适合业务的 k 和 m 值呢，这里直接贴一个公式：</p>
<p><img src="/2021/06/06/bloomfilter/5.png" alt></p>
<p>如何推导这个公式这里只是提一句，因为对于使用来说并没有太大的意义，你让一个高中生来推会推得很快。k 次哈希函数某一 bit 位未被置为 1 的概率为：</p>
<p><img src="/2021/06/06/bloomfilter/6.png" alt></p>
<p>插入n个元素后依旧为 0 的概率和为 1 的概率分别是：</p>
<p><img src="/2021/06/06/bloomfilter/7.png" alt></p>
<p>标明某个元素是否在集合中所需的 k 个位置都按照如上的方法设置为 1，但是该方法可能会使算法错误的认为某一原本不在集合中的元素却被检测为在该集合中（False Positives），该概率由以下公式确定</p>
<p><img src="/2021/06/06/bloomfilter/8.png" alt></p>
<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a><strong>最佳实践</strong></h2><p>常见的适用常见有，利用布隆过滤器减少磁盘 IO 或者网络请求，因为一旦一个值必定不存在的话，我们可以不用进行后续昂贵的查询请求。</p>
<p>另外，既然你使用布隆过滤器来加速查找和判断是否存在，那么性能很低的哈希函数不是个好选择，推荐 MurmurHash、Fnv 这些。</p>
<p><strong>大Value拆分</strong></p>
<p>Redis 因其支持 setbit 和 getbit 操作，且纯内存性能高等特点，因此天然就可以作为布隆过滤器来使用。但是布隆过滤器的不当使用极易产生大 Value，增加 Redis 阻塞风险，因此生成环境中建议对体积庞大的布隆过滤器进行拆分。</p>
<p>拆分的形式方法多种多样，但是本质是不要将 Hash(Key) 之后的请求分散在多个节点的多个小 bitmap 上，而是应该拆分成多个小 bitmap 之后，对一个 Key 的所有哈希函数都落在这一个小 bitmap 上。</p>
<p><strong>参考资料：</strong></p>
<p><a href="https://hackernoon.com/probabilistic-data-structures-bloom-filter-5374112a7832" target="_blank" rel="noopener">https://hackernoon.com/probabilistic-data-structures-bloom-filter-5374112a7832</a></p>
<p><a href="https://www.jasondavies.com/bloomfilter/" target="_blank" rel="noopener">https://www.jasondavies.com/bloomfilter/</a></p>
<p><strong>转载</strong> ：<a href="https://zhuanlan.zhihu.com/p/43263751" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/43263751</a></p>
]]></content>
      <categories>
        <category>去重</category>
      </categories>
      <tags>
        <tag>去重， 面试集锦</tag>
      </tags>
  </entry>
  <entry>
    <title>同步和异步，进程，线程和协程之间的区别和联系</title>
    <url>/2021/06/05/%E5%90%8C%E6%AD%A5%E5%92%8C%E5%BC%82%E6%AD%A5%EF%BC%8C%E8%BF%9B%E7%A8%8B%EF%BC%8C%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%8D%8F%E7%A8%8B%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB%E5%92%8C%E8%81%94%E7%B3%BB/</url>
    <content><![CDATA[<p>同步和异步，进程，线程和协程之间的区别和联系</p>
<a id="more"></a>
<h1 id="同步和异步，进程，线程和协程之间的区别和联系"><a href="#同步和异步，进程，线程和协程之间的区别和联系" class="headerlink" title="同步和异步，进程，线程和协程之间的区别和联系"></a>同步和异步，进程，线程和协程之间的区别和联系</h1><p><strong>同步和异步、阻塞和非阻塞</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">异步： 多任务， 多个任务之间执行没有先后顺序，可以同时运行，执行的先后顺序不会有什么影响，存在的多条运行主线</span><br><span class="line">同步： 多任务， 多个任务之间执行的时候要求有先后顺序，必须一个先执行完成之后，另一个才能继续执行， 只有一个主线</span><br><span class="line">阻塞：从调用者的角度出发，如果在调用的时候，被卡住，不能再继续向下运行，需要等待，就说是阻塞</span><br><span class="line">非阻塞： 从调用者的角度出发， 如果在调用的时候，没有被卡住，能够继续向下运行，无需等待，就说是非阻塞</span><br></pre></td></tr></table></figure>
<p><strong>1）同步、异步</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">函数或方法被调用的时候，调用者是否得到最终的结果。</span><br><span class="line"></span><br><span class="line">直接得到最终结果的结果，就是同步调用。（打饭模型，打饭不打好不走开，直到打饭给我后才离开）</span><br><span class="line">不直接得到的最终的结果，就是异步调用。（打饭，不会一直等着，会时不时的过来看看，打完了把饭拿走，异步不保证多长时间打完了饭）</span><br></pre></td></tr></table></figure>
<p><strong>2）阻塞、非阻塞：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">函数或方法调用的时候，是否立即返回。</span><br><span class="line"></span><br><span class="line">立即返回就是非阻塞调用。</span><br><span class="line">不立即返回就是阻塞调用。</span><br></pre></td></tr></table></figure>
<p><strong>3）区别：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">同步、异步，与阻塞、非阻塞不相关。</span><br><span class="line">同步、异步强调的是结果。阻塞和非阻塞强调的是时间，是否等待。</span><br><span class="line">同步与异步区别在于：调用者是否得到了想要的最终结果。</span><br><span class="line">同步就是一直要执行到返回最终结果。异步就是直接返回了，但是返回的不是最终的结果，调用者不能通过这种调用得到结果，还要通过被调用者，使用其他方式通知调用者，来取回最终结果。</span><br><span class="line">阻塞与非阻塞的区别在于，调用者是否还能干其他的事情。</span><br><span class="line">阻塞，调用者只能干等。非阻塞，调用者可以先忙一会别的，不用一直等。</span><br></pre></td></tr></table></figure>
<p><strong>4）联系：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">同步阻塞：调用者阻塞，直到等到拿到最终结果。（打饭模型，什么事情也不敢，就等着打饭，打饭是结果，什么也不干，一直在等着，同步加阻塞）</span><br><span class="line">同步非阻塞：（等着打饭，但是可以玩会手机，看看电视，打饭是结果，但是不用一直在等着）</span><br><span class="line">异步阻塞：（我要打饭，你说等着较好，并没有返回饭给我，我啥事不干，就干等着饭好了叫我）</span><br><span class="line">异步非阻塞：回调的话。（我要打饭，你说等较好，并没有返回饭给我，可以在旁边看看电视，玩玩手机，饭好了叫我）</span><br></pre></td></tr></table></figure>
<h2 id="进程、线程和协程之间的区别和联系"><a href="#进程、线程和协程之间的区别和联系" class="headerlink" title="进程、线程和协程之间的区别和联系"></a><strong>进程、线程和协程之间的区别和联系</strong></h2><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a><strong>定义</strong></h2><p>进程: 一个运行起来的程序或者软件叫做进程，进程是操作系统分配资源的 基本单位<br>线程：指进程内的一个执行单元,也是进程内的可调度实体。<br>协程：是一种程序组件，是由子例程（过程、函数、例程、方法、子程序）的概念泛化而来的，子例程只有一个入口点且只返回一次，而协程允许多个入口点，可以在指定位置挂起和恢复执行。</p>
<h2 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h2><p>进程是资源分配的最小单位,线程是CPU调度的最小单位.<br>进程是操作系统资源分配的单位<br>线程是CPU调度的单位<br>进程切换需要的资源最大，效率很低<br>线程切换需要的资源一般，效率一般<br>协程切换需要资源很小，效率高</p>
<h2 id="线程与进程的区别"><a href="#线程与进程的区别" class="headerlink" title="线程与进程的区别"></a>线程与进程的区别</h2><p>同一个进程中的线程共享同一内存空间，但是进程之间是独立的。<br>同一个进程中的所有线程的数据是共享的（进程通讯），进程之间的数据是独立的。<br>对主线程的修改可能会影响其他线程的行为，但是父进程的修改（除了删除以外）不会影响其他子进程。<br>一个进程至少有一个线程<br>同一个进程的线程之间可以直接通信，但是进程之间的交流需要借助中间代理(队列)来实现<br>创建新的线程很容易，但是创建新的进程需要对父进程做一次复制。<br>一个线程可以操作同一进程的其他线程，但是进程只能操作其子进程。<br>线程启动速度快，进程启动速度慢（但是两者运行速度没有可比性）。</p>
<h2 id="协程与线程的比较"><a href="#协程与线程的比较" class="headerlink" title="协程与线程的比较"></a>协程与线程的比较</h2><p>一个线程可以多个协程，一个进程也可以单独拥有多个协程，这样python中则能使用多核CPU。<br>线程进程都是同步机制，而协程则是异步<br>协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态</p>
<p><strong>代码demo：</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consumer</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">"%s准备开始吃包子啦..."</span> % name)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        new_baozi = <span class="keyword">yield</span></span><br><span class="line">        print(<span class="string">"[%s] 正在吃包子 %s"</span> % (name,new_baozi))</span><br><span class="line">        <span class="comment">#time.sleep(1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">producer</span><span class="params">()</span>:</span></span><br><span class="line">    r = con.__next__()</span><br><span class="line">    r = con2.__next__()</span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> n &lt; <span class="number">5</span>:    <span class="comment"># 生产者只做5个包子</span></span><br><span class="line">        n += <span class="number">1</span></span><br><span class="line">        print(<span class="string">"\033[32;1m[producer]\033[0m做好了新包子 %s"</span> % n )</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        con.send(n)</span><br><span class="line">        con2.send(n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 定义2个消费者、1个生产者</span></span><br><span class="line">    con = consumer(<span class="string">"c1"</span>)</span><br><span class="line">    con2 = consumer(<span class="string">"c2"</span>)</span><br><span class="line">    p = producer()</span><br></pre></td></tr></table></figure>
<p>协程介绍： <a href="https://zhuanlan.zhihu.com/p/38528865" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/38528865</a> </p>
<p>参考链接 ： <a href="https://blog.csdn.net/DD18203614685/article/details/93226319" target="_blank" rel="noopener">https://blog.csdn.net/DD18203614685/article/details/93226319</a> </p>
]]></content>
      <categories>
        <category>python基础知识</category>
      </categories>
      <tags>
        <tag>面试集锦</tag>
        <tag>python基础知识</tag>
      </tags>
  </entry>
  <entry>
    <title>douyin-signature</title>
    <url>/2021/05/28/douyin-signature/</url>
    <content><![CDATA[<p>声明：本文只作学习研究，禁止用于非法用途，否则后果自负，如有侵权，请告知删除，谢谢！</p>
<p>练习网站平台：</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">JXU1MjREJXU5NzYyJXU2NkI0JXU5NzMyJXU3Njg0JXU4RkQ4JXU0RTBEJXU2NjBFJXU2NjNFJXU0RTQ4</span><br></pre></td></tr></table></figure>
<p><strong>抓取目标：</strong></p>
<p>这次要分析的如何抓取指定用户发布的视频<br>开启分析之旅：</p>
<p>首先在手机上分享出，我们要抓取的用户</p>
<p><img src="/2021/05/28/douyin-signature/1.png" alt></p>
<p>看到这个页面之后，我抓一下包分析一下</p>
<p> <img src="/2021/05/28/douyin-signature/2.png" alt></p>
<p><strong>滑动刷新多抓两个包，进行比较，分析一下参数</strong></p>
<p><img src="/2021/05/28/douyin-signature/17.png" alt></p>
<p>max_cursor ：每次会根据，上一次的抓包结果里面有</p>
<p>_signature:每次是变化的，和今日头条那个差不多（预计）</p>
<p>dytk:这个值呢，插看原网页就有，如图所示</p>
<p> <img src="/2021/05/28/douyin-signature/3.png" alt></p>
<p>让我们瞧一瞧_signature这个参数,全局搜索参数</p>
<p><img src="/2021/05/28/douyin-signature/4.png" alt></p>
<p>进入到第一个js文件，我们发现</p>
<p><img src="/2021/05/28/douyin-signature/5.png" alt></p>
<p>继续向下搜索signature,我们看到生成的函数：</p>
<p><img src="/2021/05/28/douyin-signature/6.png" alt></p>
<p>打上断点分析一下</p>
<p><img src="/2021/05/28/douyin-signature/7.png" alt></p>
<p>我们发现仅仅需要传进去uid，我们就能生成_signature值，我们把js复制下下来进行分析，</p>
<p>这里有两种还原方式：</p>
<p>下面我阐述其中一种：</p>
<p>首先么搜索_bytedAcrawler。结果如图所示：</p>
<p><img src="/2021/05/28/douyin-signature/8.png" alt></p>
<p>我们进入这个函数：</p>
<p>接下来把这个函数复制出来：</p>
<p>!function(t) {<br>    if (t.<strong>M = t.</strong>M || {},<br>        !t.<strong>M.require) {<br>        var e, n, r = document.getElementsByTagName(“head”)[0], i = {}, o = {}, a = {}, u = {}, c = {}, s = {}, l = function(t, n) {<br>            if (!(t in u)) {<br>                u[t] = !0;<br>                var i = document.createElement(“script”);<br>                if (n) {<br>                    var o = setTimeout(n, e.timeout);<br>                    i.onerror = function() {<br>                        clearTimeout(o),<br>                            n()<br>                    }<br>                    ;<br>                    var a = function() {<br>                        clearTimeout(o)<br>                    };<br>                    “onload”in i ? i.onload = a : i.onreadystatechange = function() {<br>                        (“loaded” === this.readyState || “complete” === this.readyState) &amp;&amp; a()<br>                    }<br>                }<br>                return i.type = “text/javascript”,<br>                    i.src = t,<br>                    r.appendChild(i),<br>                    i<br>            }<br>        }, f = function(t, e, n) {<br>            var r = i[t] || (i[t] = []);<br>            r.push(e);<br>            var o, a = c[t] || c[t + “.js”] || {}, u = a.pkg;<br>            o = u ? s[u].url || s[u].uri : a.url || a.uri || t,<br>                l(o, n &amp;&amp; function() {<br>                    n(t)<br>                }<br>                )<br>        };<br>        n = function(t, e) {<br>            “function” != typeof e &amp;&amp; (e = arguments[2]),<br>                t = t.replace(/.js$/i, “”),<br>                o[t] = e;<br>            var n = i[t];<br>            if (n) {<br>                for (var r = 0, a = n.length; a &gt; r; r++)<br>                    n<a href>r</a>;<br>                delete i[t]<br>            }<br>        }<br>            ,<br>            e = function(t) {<br>                if (t &amp;&amp; t.splice)<br>                    return e.async.apply(this, arguments);<br>                t = e.alias(t);<br>                var n = a[t];<br>                if (n)<br>                    return n.exports;<br>                var r = o[t];<br>                if (!r)<br>                    throw “[ModJS] Cannot find module <code>&quot; + t + &quot;</code>“;<br>                n = a[t] = {<br>                    exports: {}<br>                };<br>                var i = “function” == typeof r ? r.apply(n, [e, n.exports, n]) : r;<br>                return i &amp;&amp; (n.exports = i),<br>                n.exports &amp;&amp; !n.exports[“default”] &amp;&amp; Object.defineProperty &amp;&amp; Object.isExtensible(n.exports) &amp;&amp; Object.defineProperty(n.exports, “default”, {<br>                    value: n.exports<br>                }),<br>                    n.exports<br>            }<br>            ,<br>            e.async = function(n, r, i) {<br>                function a(t) {<br>                    for (var n, r = 0, h = t.length; h &gt; r; r++) {<br>                        var p = e.alias(t[r]);<br>                        p in o ? (n = c[p] || c[p + “.js”],<br>                        n &amp;&amp; “deps”in n &amp;&amp; a(n.deps)) : p in s || (s[p] = !0,<br>                            l++,<br>                            f(p, u, i),<br>                            n = c[p] || c[p + “.js”],<br>                        n &amp;&amp; “deps”in n &amp;&amp; a(n.deps))<br>                    }<br>                }<br>                function u() {<br>                    if (0 === l—) {<br>                        for (var i = [], o = 0, a = n.length; a &gt; o; o++)<br>                            i[o] = e(n[o]);<br>                        r &amp;&amp; r.apply(t, i)<br>                    }<br>                }<br>                “string” == typeof n &amp;&amp; (n = [n]);<br>                var s = {}<br>                    , l = 0;<br>                a(n),<br>                    u()<br>            }<br>            ,<br>            e.resourceMap = function(t) {<br>                var e, n;<br>                n = t.res;<br>                for (e in n)<br>                    n.hasOwnProperty(e) &amp;&amp; (c[e] = n[e]);<br>                n = t.pkg;<br>                for (e in n)<br>                    n.hasOwnProperty(e) &amp;&amp; (s[e] = n[e])<br>            }<br>            ,<br>            e.loadJs = function(t) {<br>                l(t)<br>            }<br>            ,<br>            e.loadCss = function(t) {<br>                if (t.content) {<br>                    var e = document.createElement(“style”);<br>                    e.type = “text/css”,<br>                        e.styleSheet ? e.styleSheet.cssText = t.content : e.innerHTML = t.content,<br>                        r.appendChild(e)<br>                } else if (t.url) {<br>                    var n = document.createElement(“link”);<br>                    n.href = t.url,<br>                        n.rel = “stylesheet”,<br>                        n.type = “text/css”,<br>                        r.appendChild(n)<br>                }<br>            }<br>            ,<br>            e.alias = function(t) {<br>                return t.replace(/.js$/i, “”)<br>            }<br>            ,<br>            e.timeout = 5e3,<br>            t.</strong>M.define = n,<br>            t.__M.require = e<br>    }<br>}(this);</p>
<p><strong>M.define(“douyin_falcon:node_modules/byted-acrawler/dist/runtime”, function(l, e) {<br>    Function(function(l) {<br>        return ‘e(e,a,r){(b[e]||(b[e]=t(“x,y”,”x “+e+” y”)(r,a)}a(e,a,r){(k[r]||(k[r]=t(“x,y”,”new x<a href="&quot;+Array(r+1">y</a>.join(“,x[y]”)(1)+”)”)(e,a)}r(e,a,r){n,t,s={},b=s.d=r?r.d+1:0;for(s[“$”+b]=s,t=0;t<b;t)s[n="$"+t]=r[n];for(t=0,b=s=a;t<b;t)s[t]=a[t];c(e,0,s)}c(t,b,k){u(e){v[x]=e}f{g=,ting(bg)}l{try{y=c(t,b,k)}catch(e){h=e,y=l}}for(h,y,d,g,v=[],x=0;;)switch(g=){case 1:u(!)4:f5:u((e){a="0,r=e;{c=a<r;c&&u(e[a]),c}}(6:y=,u((y8:if(g=,lg,g=,y===c)b+=g;else" if(y!="=l)y9:c10:u(s(11:y=,u(+y)12:for(y=f,d=[],g=0;g<y;g)d[g]=y.charCodeAt(g)^g+y;u(String.fromCharCode.apply(null,d13:y=,h=delete" [y]14:59:u((g=")?(y=x,v.slice(x-=g,y:[])61:u([])62:g=,k[0]=65599*k[0]+k[1].charCodeAt(g)">&gt;&gt;065:h=,y=,[y]=h66:u(e(t[b],,67:y=,d=,u((g=).x===c?r(g.y,y,k):g.apply(d,y68:u(e((g=t[b])&lt;”&lt;”?(b—,f):g+g,,70:u(!1)71:n72:+f73:u(parseInt(f,3675:if(){bcase 74:g=&lt;<16>&gt;16g76:u(k[])77:y=,u([y])78:g=,u(a(v,x-=g+1,g79:g=,u(k[“$”+g])81:h=,[f]=h82:u([f])83:h=,k[]=h84:!085:void 086:u(v[x-1])88:h=,y=,h,y89:u({e{r(e.y,arguments,k)}e.y=f,e.x=c,e})90:null91:h93:h=0:;default:u((g&lt;<16>&gt;16)-16)}}n=this,t=n.Function,s=Object.keys||(e){a={},r=0;for(c in e)a[r]=c;a=r,a},b={},k={};r’.replace(/[-]/g, function(e) {<br>            return l[15 &amp; e.charCodeAt(0)]<br>        })<br>    }(“v[x++]=v[—x]t.charCodeAt(b++)-32function return ))++.substrvar .length(),b+=;break;case ;break}”.split(“”)))()(‘gr$Daten Иb/s!l y͒yĹg,(lfi~ah`{mv,-n|jqewVxp{rvmmx,&amp;effkx[!cs”l”.Pq%widthl”@q&amp;heightl”vr<em>getContextx$”2d[!cs#l#,</em>;?|u.|uc{uq$fontl#vr(fillTextx<script type="math/tex">龘ฑภ경2<[#c}l#2q*shadowBlurl#1q-shadowOffsetXl#</script>limeq+shadowColorl#vr#arcx88802[%c}l#vr&amp;strokex[ c}l”v,)}eOmyoZB]mx[ cs!0s$l$Pb<k7l l!r&lengthb%^l$1+s$jl s#i$1ek1s$gr#tack4)zgr#tac$! +0o![#cj?o ]!l$b%s"o ]!l"l$b*b^0d#>&gt;&gt;s!0s%yA0s”l”l!r&amp;lengthb<k+l"^l"1+s"jl s&l&z0l!$ +["cs\'(0l#i\'1ps9wxb&s() &{s) s(gr&stringr,fromcharcodes)0s*ywl ._b&s o!])l l jb<k$.aj;l .tb<k$.gj .^b<k&i"-4j!+& s+ypo!]+s!l!l hd>&l!l Bd>&+l!l <d>&+l!l 6d>&+l!l &+ s,y=o!o!]/q"13o!l q"10o!],l 2d>& s.{s-yMo!o!]0q"13o!]*Ld<l 4d#>&gt;&gt;b|s!o!l q”10o!],l!&amp; s/yIo!o!].q”13o!],o!]*Jd<l 6d#>&gt;&gt;b|&amp;o!]+l &amp;+ s0l-l!&amp;l-l!i\’1z141z4b/@d&lt;l”b|&amp;+l-l(l!b^&amp;+l-l&amp;zl\’g,)gk}ejo{cm,)|yn~Lij~em[“cl$b%@d&lt;l&amp;zl\’l $ +[“cl$b%b|&amp;+l-l%8d&lt;@b|l!b^&amp;+ q$sign ‘, [Object.defineProperty(e, “</l></l></d></k+l"^l"1+s"jl></k7l></16></16></b;t)s[n="$"+t]=r[n];for(t=0,b=s=a;t<b;t)s[t]=a[t];c(e,0,s)}c(t,b,k){u(e){v[x]=e}f{g=,ting(bg)}l{try{y=c(t,b,k)}catch(e){h=e,y=l}}for(h,y,d,g,v=[],x=0;;)switch(g=){case></strong>esModule”, {<br>        value: !0<br>    })])<br>});</p>
<p>var dycs = __M.require(“douyin_falcon:node_modules/byted-acrawler/dist/runtime”);</p>
<p>function sign(uid){<br>    return dycs.sign(uid);<br>}<br>console.log(sign(382237371544059));<br> 初步还原点代码，下面我们继续分析</p>
<p>接下来就是我们本片文章的重点内容：</p>
<p>我进入函数sign里，看看最检测有哪些：</p>
<p><img src="/2021/05/28/douyin-signature/9.png" alt></p>
<p>打上断点，调试，一顿操作猛如虎：</p>
<p><img src="/2021/05/28/douyin-signature/10.png" alt></p>
<p>首先看到的是webdriver的检测，这里是检测selenium等等webdriver的特征，这就是为啥无法用selenium获取数据的原因</p>
<p>我们继续调试;</p>
<p>然后是对location对象进行检测</p>
<p><img src="/2021/05/28/douyin-signature/11.png" alt></p>
<p><strong>环境参数_zid</strong> </p>
<p><img src="/2021/05/28/douyin-signature/12.png" alt></p>
<p>接下来是重要的环节，继续调试可以发现这个js还对canvas做了检测 </p>
<p><img src="/2021/05/28/douyin-signature/13.png" alt></p>
<p> 最后是tac的字符串，这段东西是动态生成的，需要从静态页面源码获取 </p>
<p><img src="/2021/05/28/douyin-signature/14.png" alt></p>
<p>接下来开始逐步还原js加密算法：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">window = <span class="keyword">global</span>;</span><br><span class="line"> </span><br><span class="line">document = &#123;</span><br><span class="line">    _zid :<span class="number">1</span>,</span><br><span class="line">    createElement: function() &#123;</span><br><span class="line">        <span class="keyword">return</span> canvas</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">canvas = &#123;</span><br><span class="line">    getContext: function getContext() &#123;</span><br><span class="line">        <span class="keyword">return</span> CanvasRenderingContext2D</span><br><span class="line">    &#125;,</span><br><span class="line">    toDataURL: function toDataURL() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAQCAYAAABQrvyxAAACy0lEQVRIS8XWT4hVVRwH8M+bCBt9KWGaGJG5KSEN3LSoINqEbgSjP+S0KaRFELgTohRtkasg7M8ESZAGLSoCXczGTUbowk0uso0WyJDUCE6kI+/Nk9+dc+DM8b5pIBzP5t573r2/9/33+93bMX8Nquu47KS9+C2ft9y25FuP4o02QBloDbgmdzvJrMYxPF/JMo49uIZbCLSpn5+vwd4JN57CcziYQLU60KZ6GaFSkNvpQJ3HUXyIb/EC3kw3jLcpWz88rAdKsrvwWlLnPbyN84j9o4i9rFzUD/W+wRMZSBGNtmaKOhtbatzSAws5EIXb+iCsPVUAOYut+Ayv4mscKkjlfAehn5DV/THlviYQ4J9JBJdXvdHqwGIUnyM6MGKVMTc8gpOum005fRBX8QP+wkcFgZJwdqYEGQ0aKxMNkqV7meCCTRwkstrleR6rAZ2+FcZt8L7DruiZcUDPYezDNryD+ysCOUIlqZrAuwiisf/3kAHdSiCDLY85OvN/G1hmvQ88bK2ffYLfrLTJdAP6U2xJysUflWCjXoALkBlgmwOl0mW/5P2xiFPZxMPGaO3AXIEV6DpuuylHfIlzVnosEbiIr1LGSwJ/pGkSU2RiEQRqohl87ptL/zUK2+d9BGiNvqumHPWFF5vx9qu7bdYTzViCKwkEgO04s0gHwqWTSYg6SVF3/zAHhvdAgO+adR9GnPN7E4+YQhd1mukT5+XYHOZAE4GEaliEwoGP8XIayws6UH9ClOrPnd9loOdeG02bdMVex+zzPX7BlI7+kIb7P9v1OyPXejqcqR3oGDHQt8xyM82d/7rHqOuu6VrjH9950g6nbcBZOxL4Scw0g3WJ1/weGOg4out1XaxKX5+9dBy100smvOVZp5zweZN7LjUfV53mHbDkqyYw4iGvmLHbegNrTZvV96cHXPC4dSaNmbC/eUFdwOU7CT7Uugk6/uUeZMZ6UQAAAABJRU5ErkJggg=="</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">CanvasRenderingContext2D = &#123;</span><br><span class="line">    arc: function arc() &#123;&#125;,</span><br><span class="line">    stroke: function stroke() &#123;&#125;,</span><br><span class="line">    fillText: function fillText() &#123;&#125;,</span><br><span class="line">&#125;;</span><br><span class="line">window.document=document;</span><br><span class="line"> </span><br><span class="line">navigator = &#123;</span><br><span class="line">    userAgent: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36'</span>,</span><br><span class="line">    // userAgent: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36"</span>,</span><br><span class="line">&#125;;</span><br><span class="line">window.navigator = navigator;</span><br><span class="line"> </span><br><span class="line">location = &#123;</span><br><span class="line">    <span class="string">"href"</span>: <span class="string">"https://www.iesdouyin.com/share/user/102064772608"</span>,</span><br><span class="line">    <span class="string">"origin"</span>: <span class="string">"https://www.iesdouyin.com"</span>,</span><br><span class="line">    <span class="string">"protocol"</span>: <span class="string">"https:"</span></span><br><span class="line">    ,</span><br><span class="line">&#125;;</span><br><span class="line">window.location = location;</span><br></pre></td></tr></table></figure>
<p> 游览器对象补充完毕：</p>
<p>我们和并完成代码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"> </span><br><span class="line">window = <span class="keyword">global</span>;</span><br><span class="line"> </span><br><span class="line">document = &#123;</span><br><span class="line">    createElement: function() &#123;</span><br><span class="line">        <span class="keyword">return</span> canvas</span><br><span class="line">    &#125;,</span><br><span class="line">    getElementsByTagName:function () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">canvas = &#123;</span><br><span class="line">    getContext: function getContext() &#123;</span><br><span class="line">        <span class="keyword">return</span> CanvasRenderingContext2D</span><br><span class="line">    &#125;,</span><br><span class="line">    toDataURL: function toDataURL() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAQCAYAAABQrvyxAAACy0lEQVRIS8XWT4hVVRwH8M+bCBt9KWGaGJG5KSEN3LSoINqEbgSjP+S0KaRFELgTohRtkasg7M8ESZAGLSoCXczGTUbowk0uso0WyJDUCE6kI+/Nk9+dc+DM8b5pIBzP5t573r2/9/33+93bMX8Nquu47KS9+C2ft9y25FuP4o02QBloDbgmdzvJrMYxPF/JMo49uIZbCLSpn5+vwd4JN57CcziYQLU60KZ6GaFSkNvpQJ3HUXyIb/EC3kw3jLcpWz88rAdKsrvwWlLnPbyN84j9o4i9rFzUD/W+wRMZSBGNtmaKOhtbatzSAws5EIXb+iCsPVUAOYut+Ayv4mscKkjlfAehn5DV/THlviYQ4J9JBJdXvdHqwGIUnyM6MGKVMTc8gpOum005fRBX8QP+wkcFgZJwdqYEGQ0aKxMNkqV7meCCTRwkstrleR6rAZ2+FcZt8L7DruiZcUDPYezDNryD+ysCOUIlqZrAuwiisf/3kAHdSiCDLY85OvN/G1hmvQ88bK2ffYLfrLTJdAP6U2xJysUflWCjXoALkBlgmwOl0mW/5P2xiFPZxMPGaO3AXIEV6DpuuylHfIlzVnosEbiIr1LGSwJ/pGkSU2RiEQRqohl87ptL/zUK2+d9BGiNvqumHPWFF5vx9qu7bdYTzViCKwkEgO04s0gHwqWTSYg6SVF3/zAHhvdAgO+adR9GnPN7E4+YQhd1mukT5+XYHOZAE4GEaliEwoGP8XIayws6UH9ClOrPnd9loOdeG02bdMVex+zzPX7BlI7+kIb7P9v1OyPXejqcqR3oGDHQt8xyM82d/7rHqOuu6VrjH9950g6nbcBZOxL4Scw0g3WJ1/weGOg4out1XaxKX5+9dBy100smvOVZp5zweZN7LjUfV53mHbDkqyYw4iGvmLHbegNrTZvV96cHXPC4dSaNmbC/eUFdwOU7CT7Uugk6/uUeZMZ6UQAAAABJRU5ErkJggg=="</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">CanvasRenderingContext2D = &#123;</span><br><span class="line">    arc: function arc() &#123;&#125;,</span><br><span class="line">    stroke: function stroke() &#123;&#125;,</span><br><span class="line">    fillText: function fillText() &#123;&#125;,</span><br><span class="line">&#125;;</span><br><span class="line">window.document=document;</span><br><span class="line"> </span><br><span class="line">navigator = &#123;</span><br><span class="line">    userAgent: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36'</span>,</span><br><span class="line">    // userAgent: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36"</span>,</span><br><span class="line">&#125;;</span><br><span class="line">window.navigator = navigator;</span><br><span class="line"> </span><br><span class="line">location = &#123;</span><br><span class="line">    <span class="string">"href"</span>: <span class="string">"https://www.iesdouyin.com/share/user/102064772608"</span>,</span><br><span class="line">    <span class="string">"origin"</span>: <span class="string">"https://www.iesdouyin.com"</span>,</span><br><span class="line">    <span class="string">"protocol"</span>: <span class="string">"https:"</span>,</span><br><span class="line">&#125;;</span><br><span class="line">window.location = location;</span><br><span class="line">tac=<span class="string">'i)6a62m09ams!i$141qs"0y\u02a1g,&amp;qnfme|ms g,)gk&#125;ejo&#123;\x7fcms!g,&amp;Iebli\x7fms"l!,)~oih\x7fgyucmk"t (\x80,.jjvx|vDgyg&#125;knbl"d"inkfl"v,.jjvx|vDgyg&#125;knbmxl!,)~oih\x7fgyucgr&amp;Objectn vuq%valuevfq(writable[#c&#125;) %&#123;s#t ,4KJarz&#125;hrjxl@EWCOQDRB,3LKfs&#123;&#125;wsnqB&#123;iAMWBP@,;DCj&#123;&#125;DSKUAWyTK[C[XrHZ^RFZ[[,7HGn\x7fyxowiES&#125;PGWOW\\vL^BN,5JI`&#125;&#123;~iuk&#123;m\x7fRAQMURxNG,3LKsnsjpl~nB&#123;iAMWBP@,2MLpg\x7fa&#125;kEnrjl~PQGG,5JI`&#125;&#123;~iuk&#123;m\x7fTLTVDVWMM,1NMwf|`rjF\x7fm&#125;qk~TD,4KJert|tripAjNVPBTUCC,4KJpo|ksmyoAjNVPBTUCC[+s#,)Vyn`h`fe|,,olbcCt~vz|cz,6ID&#125;u\x7fuuhs@ieg|v@EHZMOY[#s$l$*%s%l%u&amp;k4s&amp;l$l&amp;ms\'l l\'mk"t j\x06l#*%s%l%u&amp;k?s&amp;l#l&amp;ms\'l ,(lfi~ah`&#123;ml\'mk"t j\ufffbl ,(lfi~ah`&#123;m*%s%l%u&amp;kls&amp;l&amp;vr%matchxgr&amp;RegExp$*\\$[a-z]dc_$ n"[!cvk:&#125;l ,(lfi~ah`&#123;ml&amp;m,&amp;efkaoTmk"t j\uffcef z[ cb|1d&lt;,%Dscafgd"in,8[xtm&#125;nLzNEGQMKAdGG^NTY\x1ckgd"inb&lt;b|1d&lt;g,&amp;TboLr&#123;m,(\x02)!jx-2n&amp;vr$testxg,%@tug&#123;mn ,%vrfkbm[!cb|'</span>;</span><br><span class="line"> </span><br><span class="line">// tac=<span class="string">'i)69f3puf9ts!i$1019s"0y\u02a1g,&amp;qnfme|ms g,)gk&#125;ejo&#123;\x7fcms!g,&amp;Iebli\x7fms"l!,)~oih\x7fgyucmk"t (\x80,.jjvx|vDgyg&#125;knbl"d"inkfl"v,.jjvx|vDgyg&#125;knbmxl!,)~oih\x7fgyucgr&amp;Objectn vuq%valuevfq(writable[#c&#125;) %&#123;s#t ,4KJarz&#125;hrjxl@EWCOQDRB,3LKfs&#123;&#125;wsnqB&#123;iAMWBP@,;DCj&#123;&#125;DSKUAWyTK[C[XrHZ^RFZ[[,7HGn\x7fyxowiES&#125;PGWOW\\vL^BN,5JI`&#125;&#123;~iuk&#123;m\x7fRAQMURxNG,3LKsnsjpl~nB&#123;iAMWBP@,2MLpg\x7fa&#125;kEnrjl~PQGG,5JI`&#125;&#123;~iuk&#123;m\x7fTLTVDVWMM,1NMwf|`rjF\x7fm&#125;qk~TD,4KJert|tripAjNVPBTUCC,4KJpo|ksmyoAjNVPBTUCC[+s#,)Vyn`h`fe|,,olbcCt~vz|cz,6ID&#125;u\x7fuuhs@ieg|v@EHZMOY[#s$l$*%s%l%u&amp;k4s&amp;l$l&amp;ms\'l l\'mk"t j\x06l#*%s%l%u&amp;k?s&amp;l#l&amp;ms\'l ,(lfi~ah`&#123;ml\'mk"t j\ufffbl ,(lfi~ah`&#123;m*%s%l%u&amp;kls&amp;l&amp;vr%matchxgr&amp;RegExp$*\\$[a-z]dc_$ n"[!cvk:&#125;l ,(lfi~ah`&#123;ml&amp;m,&amp;efkaoTmk"t j\uffcef z[ cb|1d&lt;,%Dscafgd"in,8[xtm&#125;nLzNEGQMKAdGG^NTY\x1ckgd"inb&lt;b|1d&lt;g,&amp;TboLr&#123;m,(\x02)!jx-2n&amp;vr$testxg,%@tug&#123;mn ,%vrfkbm[!cb|'</span></span><br><span class="line">!function(t) &#123;</span><br><span class="line">    <span class="keyword">if</span> (t.__M = t.__M || &#123;&#125;,</span><br><span class="line">        !t.__M.require) &#123;</span><br><span class="line">        var e, n, r = document.getElementsByTagName(<span class="string">"head"</span>)[<span class="number">0</span>], i = &#123;&#125;, o = &#123;&#125;, a = &#123;&#125;, u = &#123;&#125;, c = &#123;&#125;, s = &#123;&#125;, l = function(t, n) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!(t <span class="keyword">in</span> u)) &#123;</span><br><span class="line">                u[t] = !<span class="number">0</span>;</span><br><span class="line">                var i = document.createElement(<span class="string">"script"</span>);</span><br><span class="line">                <span class="keyword">if</span> (n) &#123;</span><br><span class="line">                    var o = setTimeout(n, e.timeout);</span><br><span class="line">                    i.onerror = function() &#123;</span><br><span class="line">                        clearTimeout(o),</span><br><span class="line">                            n()</span><br><span class="line">                    &#125;</span><br><span class="line">                    ;</span><br><span class="line">                    var a = function() &#123;</span><br><span class="line">                        clearTimeout(o)</span><br><span class="line">                    &#125;;</span><br><span class="line">                    "onload"in i ? i.onload = a : i.onreadystatechange = function() &#123;</span><br><span class="line">                        (<span class="string">"loaded"</span> === this.readyState || <span class="string">"complete"</span> === this.readyState) &amp;&amp; a()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> i.type = <span class="string">"text/javascript"</span>,</span><br><span class="line">                    i.src = t,</span><br><span class="line">                    r.appendChild(i),</span><br><span class="line">                    i</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, f = function(t, e, n) &#123;</span><br><span class="line">            var r = i[t] || (i[t] = []);</span><br><span class="line">            r.push(e);</span><br><span class="line">            var o, a = c[t] || c[t + <span class="string">".js"</span>] || &#123;&#125;, u = a.pkg;</span><br><span class="line">            o = u ? s[u].url || s[u].uri : a.url || a.uri || t,</span><br><span class="line">                l(o, n &amp;&amp; function() &#123;</span><br><span class="line">                    n(t)</span><br><span class="line">                &#125;</span><br><span class="line">                )</span><br><span class="line">        &#125;;</span><br><span class="line">        n = function(t, e) &#123;</span><br><span class="line">            <span class="string">"function"</span> != typeof e &amp;&amp; (e = arguments[<span class="number">2</span>]),</span><br><span class="line">                t = t.replace(/\.js$/i, <span class="string">""</span>),</span><br><span class="line">                o[t] = e;</span><br><span class="line">            var n = i[t];</span><br><span class="line">            <span class="keyword">if</span> (n) &#123;</span><br><span class="line">                <span class="keyword">for</span> (var r = <span class="number">0</span>, a = n.length; a &gt; r; r++)</span><br><span class="line">                    n[r]();</span><br><span class="line">                delete i[t]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">            ,</span><br><span class="line">            e = function(t) &#123;</span><br><span class="line">                <span class="keyword">if</span> (t &amp;&amp; t.splice)</span><br><span class="line">                    <span class="keyword">return</span> e.<span class="keyword">async</span>.apply(this, arguments);</span><br><span class="line">                t = e.alias(t);</span><br><span class="line">                var n = a[t];</span><br><span class="line">                <span class="keyword">if</span> (n)</span><br><span class="line">                    <span class="keyword">return</span> n.exports;</span><br><span class="line">                var r = o[t];</span><br><span class="line">                <span class="keyword">if</span> (!r)</span><br><span class="line">                    throw <span class="string">"[ModJS] Cannot find module `"</span> + t + <span class="string">"`"</span>;</span><br><span class="line">                n = a[t] = &#123;</span><br><span class="line">                    exports: &#123;&#125;</span><br><span class="line">                &#125;;</span><br><span class="line">                var i = "function" == typeof r ? r.apply(n, [e, n.exports, n]) : r;</span><br><span class="line">                <span class="keyword">return</span> i &amp;&amp; (n.exports = i),</span><br><span class="line">                n.exports &amp;&amp; !n.exports[<span class="string">"default"</span>] &amp;&amp; Object.defineProperty &amp;&amp; Object.isExtensible(n.exports) &amp;&amp; Object.defineProperty(n.exports, <span class="string">"default"</span>, &#123;</span><br><span class="line">                    value: n.exports</span><br><span class="line">                &#125;),</span><br><span class="line">                    n.exports</span><br><span class="line">            &#125;</span><br><span class="line">            ,</span><br><span class="line">            e.<span class="keyword">async</span> = function(n, r, i) &#123;</span><br><span class="line">                function a(t) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (var n, r = <span class="number">0</span>, h = t.length; h &gt; r; r++) &#123;</span><br><span class="line">                        var p = e.alias(t[r]);</span><br><span class="line">                        p in o ? (n = c[p] || c[p + ".js"],</span><br><span class="line">                        n &amp;&amp; <span class="string">"deps"</span><span class="keyword">in</span> n &amp;&amp; a(n.deps)) : p <span class="keyword">in</span> s || (s[p] = !<span class="number">0</span>,</span><br><span class="line">                            l++,</span><br><span class="line">                            f(p, u, i),</span><br><span class="line">                            n = c[p] || c[p + <span class="string">".js"</span>],</span><br><span class="line">                        n &amp;&amp; <span class="string">"deps"</span><span class="keyword">in</span> n &amp;&amp; a(n.deps))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                function u() &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="number">0</span> === l--) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (var i = [], o = <span class="number">0</span>, a = n.length; a &gt; o; o++)</span><br><span class="line">                            i[o] = e(n[o]);</span><br><span class="line">                        r &amp;&amp; r.apply(t, i)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="string">"string"</span> == typeof n &amp;&amp; (n = [n]);</span><br><span class="line">                var s = &#123;&#125;</span><br><span class="line">                    , l = <span class="number">0</span>;</span><br><span class="line">                a(n),</span><br><span class="line">                    u()</span><br><span class="line">            &#125;</span><br><span class="line">            ,</span><br><span class="line">            e.resourceMap = function(t) &#123;</span><br><span class="line">                var e, n;</span><br><span class="line">                n = t.res;</span><br><span class="line">                <span class="keyword">for</span> (e <span class="keyword">in</span> n)</span><br><span class="line">                    n.hasOwnProperty(e) &amp;&amp; (c[e] = n[e]);</span><br><span class="line">                n = t.pkg;</span><br><span class="line">                <span class="keyword">for</span> (e <span class="keyword">in</span> n)</span><br><span class="line">                    n.hasOwnProperty(e) &amp;&amp; (s[e] = n[e])</span><br><span class="line">            &#125;</span><br><span class="line">            ,</span><br><span class="line">            e.loadJs = function(t) &#123;</span><br><span class="line">                l(t)</span><br><span class="line">            &#125;</span><br><span class="line">            ,</span><br><span class="line">            e.loadCss = function(t) &#123;</span><br><span class="line">                <span class="keyword">if</span> (t.content) &#123;</span><br><span class="line">                    var e = document.createElement(<span class="string">"style"</span>);</span><br><span class="line">                    e.type = <span class="string">"text/css"</span>,</span><br><span class="line">                        e.styleSheet ? e.styleSheet.cssText = t.content : e.innerHTML = t.content,</span><br><span class="line">                        r.appendChild(e)</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (t.url) &#123;</span><br><span class="line">                    var n = document.createElement(<span class="string">"link"</span>);</span><br><span class="line">                    n.href = t.url,</span><br><span class="line">                        n.rel = <span class="string">"stylesheet"</span>,</span><br><span class="line">                        n.type = <span class="string">"text/css"</span>,</span><br><span class="line">                        r.appendChild(n)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            ,</span><br><span class="line">            e.alias = function(t) &#123;</span><br><span class="line">                <span class="keyword">return</span> t.replace(/\.js$/i, <span class="string">""</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            ,</span><br><span class="line">            e.timeout = <span class="number">5e3</span>,</span><br><span class="line">            t.__M.define = n,</span><br><span class="line">            t.__M.require = e</span><br><span class="line">    &#125;</span><br><span class="line">&#125;(window);</span><br><span class="line">__M.define(<span class="string">"douyin_falcon:node_modules/byted-acrawler/dist/runtime"</span>, function(l, e) &#123;</span><br><span class="line">    Function(function(l) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'e(e,a,r)&#123;(b[e]||(b[e]=t("x,y","x "+e+" y")(r,a)&#125;a(e,a,r)&#123;(k[r]||(k[r]=t("x,y","new x[y]("+Array(r+1).join(",x[y]")(1)+")")(e,a)&#125;r(e,a,r)&#123;n,t,s=&#123;&#125;,b=s.d=r?r.d+1:0;for(s["$"+b]=s,t=0;t&lt;b;t)s[n="$"+t]=r[n];for(t=0,b=s=a;t&lt;b;t)s[t]=a[t];c(e,0,s)&#125;c(t,b,k)&#123;u(e)&#123;v[x]=e&#125;f&#123;g=,ting(bg)&#125;l&#123;try&#123;y=c(t,b,k)&#125;catch(e)&#123;h=e,y=l&#125;&#125;for(h,y,d,g,v=[],x=0;;)switch(g=)&#123;case 1:u(!)4:f5:u((e)&#123;a=0,r=e;&#123;c=a&lt;r;c&amp;&amp;u(e[a]),c&#125;&#125;(6:y=,u((y8:if(g=,lg,g=,y===c)b+=g;else if(y!==l)y9:c10:u(s(11:y=,u(+y)12:for(y=f,d=[],g=0;g&lt;y;g)d[g]=y.charCodeAt(g)^g+y;u(String.fromCharCode.apply(null,d13:y=,h=delete [y]14:59:u((g=)?(y=x,v.slice(x-=g,y:[])61:u([])62:g=,k[0]=65599*k[0]+k[1].charCodeAt(g)&gt;&gt;&gt;065:h=,y=,[y]=h66:u(e(t[b],,67:y=,d=,u((g=).x===c?r(g.y,y,k):g.apply(d,y68:u(e((g=t[b])&lt;"&lt;"?(b--,f):g+g,,70:u(!1)71:n72:+f73:u(parseInt(f,3675:if()&#123;bcase 74:g=&lt;&lt;16&gt;&gt;16g76:u(k[])77:y=,u([y])78:g=,u(a(v,x-=g+1,g79:g=,u(k["$"+g])81:h=,[f]=h82:u([f])83:h=,k[]=h84:!085:void 086:u(v[x-1])88:h=,y=,h,y89:u(&#123;e&#123;r(e.y,arguments,k)&#125;e.y=f,e.x=c,e&#125;)90:null91:h93:h=0:;default:u((g&lt;&lt;16&gt;&gt;16)-16)&#125;&#125;n=this,t=n.Function,s=Object.keys||(e)&#123;a=&#123;&#125;,r=0;for(c in e)a[r]=c;a=r,a&#125;,b=&#123;&#125;,k=&#123;&#125;;r'</span>.replace(/[-]/g, function(e) &#123;</span><br><span class="line">            <span class="keyword">return</span> l[<span class="number">15</span> &amp; e.charCodeAt(<span class="number">0</span>)]</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;(<span class="string">"v[x++]=v[--x]t.charCodeAt(b++)-32function return ))++.substrvar .length(),b+=;break;case ;break&#125;"</span>.split(<span class="string">""</span>)))()(<span class="string">'gr$Daten Иb/s!l y͒yĹg,(lfi~ah`&#123;mv,-n|jqewVxp&#123;rvmmx,&amp;effkx[!cs"l".Pq%widthl"@q&amp;heightl"vr*getContextx$"2d[!cs#l#,*;?|u.|uc&#123;uq$fontl#vr(fillTextx$$龘ฑภ경2&lt;[#c&#125;l#2q*shadowBlurl#1q-shadowOffsetXl#$$limeq+shadowColorl#vr#arcx88802[%c&#125;l#vr&amp;strokex[ c&#125;l"v,)&#125;eOmyoZB]mx[ cs!0s$l$Pb&lt;k7l l!r&amp;lengthb%^l$1+s$jl  s#i$1ek1s$gr#tack4)zgr#tac$! +0o![#cj?o ]!l$b%s"o ]!l"l$b*b^0d#&gt;&gt;&gt;s!0s%yA0s"l"l!r&amp;lengthb&lt;k+l"^l"1+s"jl  s&amp;l&amp;z0l!$ +["cs\'(0l#i\'1ps9wxb&amp;s() &amp;&#123;s)/s(gr&amp;Stringr,fromCharCodes)0s*yWl ._b&amp;s o!])l l Jb&lt;k$.aj;l .Tb&lt;k$.gj/l .^b&lt;k&amp;i"-4j!+&amp; s+yPo!]+s!l!l Hd&gt;&amp;l!l Bd&gt;&amp;+l!l &lt;d&gt;&amp;+l!l 6d&gt;&amp;+l!l &amp;+ s,y=o!o!]/q"13o!l q"10o!],l 2d&gt;&amp; s.&#123;s-yMo!o!]0q"13o!]*Ld&lt;l 4d#&gt;&gt;&gt;b|s!o!l q"10o!],l!&amp; s/yIo!o!].q"13o!],o!]*Jd&lt;l 6d#&gt;&gt;&gt;b|&amp;o!]+l &amp;+ s0l-l!&amp;l-l!i\'1z141z4b/@d&lt;l"b|&amp;+l-l(l!b^&amp;+l-l&amp;zl\'g,)gk&#125;ejo&#123;cm,)|yn~Lij~em["cl$b%@d&lt;l&amp;zl\'l $ +["cl$b%b|&amp;+l-l%8d&lt;@b|l!b^&amp;+ q$sign '</span>, [Object.defineProperty(e, <span class="string">"__esModule"</span>, &#123;</span><br><span class="line">        value: !<span class="number">0</span></span><br><span class="line">    &#125;)])</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">var dycs = __M.require(<span class="string">"douyin_falcon:node_modules/byted-acrawler/dist/runtime"</span>);</span><br><span class="line"> </span><br><span class="line">function sign(uid)&#123;</span><br><span class="line">    <span class="keyword">return</span> dycs.sign(uid);</span><br><span class="line">&#125;</span><br><span class="line">console.log(sign(<span class="number">382237371544059</span>));</span><br></pre></td></tr></table></figure>
<p>到这里我们就还原成功了：</p>
<p><img src="/2021/05/28/douyin-signature/15.png" alt></p>
<p>到此我们分析结束，</p>
<p>请求数据时注意：</p>
<p>保持游览器头和js写的一致，如有疑问，搜索公众号，后台点击联系我。</p>
<p>微信公众号菜鸟童靴，不定期更新，欢迎关注，我们一起进步</p>
<p>​          <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TcElaaWE4OGljZ1RVSzJjaWI5d1U5RUdWaDRrcWVIRVVpYmtFaWE4TVdTbG40MlJEZnpnaWFJTHhiUllJR2ZxdmQzeTVWRlk0aWNkREY3dW4zRUZWSjlSaG1LT1EvNjQw?x-oss-process=image/format,png" alt="img">      </p>
]]></content>
      <categories>
        <category>python爬虫，js逆向</category>
      </categories>
      <tags>
        <tag>爬虫</tag>
        <tag>反编译</tag>
        <tag>js逆向，刷机，root</tag>
      </tags>
  </entry>
  <entry>
    <title>frida-hook原理</title>
    <url>/2021/05/06/frida-hook%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<p>frida hook 原理介绍</p>
<a id="more"></a>
<p>frida使用的是<strong>动态二进制插桩技术</strong>（<strong>DBI</strong>），首先来了解一下插桩技术：</p>
<p><strong>一、插桩技术是指将额外的代码注入程序中以收集运行时的信息，可分为两种：</strong></p>
<p><strong>(1)源代码插桩[Source Code Instrumentation(SCI)]</strong>：</p>
<p>顾名思义，在程序源代码的基础上增加（注入）额外的代码，从而达到预期目的或者功能；</p>
<p><img src="/2021/05/06/frida-hook%E5%8E%9F%E7%90%86/1.jpg" alt></p>
<p><strong>(2)二进制插桩（Binary Instrumentation）：</strong></p>
<p>额外代码注入到二进制可执行文件中，通过修改汇编地址，改变程序运行内容，运行后再返回到原来程序运行出处，从而实现程序的额外功能。<br> ●静态二进制插桩[Static Binary Instrumentation(SBI)]：在程序执行前插入额外的代码和数据，生成一个永久改变的可执行文件。<br> ●动态二进制插桩[Dynamic Binary Instrumentation(DBI)]：在程序运行时实时地插入额外代码和数据，对可执行文件没有任何永久改变。</p>
<p><strong>二、DBI能做什么？</strong></p>
<blockquote>
<p>（1）访问进程的内存<br>（2）在应用程序运行时覆盖一些功能<br>（3）从导入的类中调用函数<br>（4）在堆上查找对象实例并使用这些对象实例<br>（5）Hook，跟踪和拦截函数等等</p>
</blockquote>
<h3 id="两种模式"><a href="#两种模式" class="headerlink" title="两种模式"></a>两种模式</h3><ol>
<li><p>attach模式<br>attach到已经存在的进程，核心原理是ptrace修改进程内存，如果进程处于调试状态（traceid不等于0），则attach失败</p>
</li>
<li><p>spawn模式<br>启动一个新的进程并挂起，在启动的同时注入frida代码，适用于在进程启动前的一些hook，如hook RegisterNative等，注入完成后调用resume恢复进程。</p>
</li>
</ol>
<p>参考资料;</p>
<p><a href="https://frida.re/" target="_blank" rel="noopener">https://frida.re/</a></p>
<p><a href="https://mabin004.github.io/2018/07/31/Mac上编译Frida/" target="_blank" rel="noopener">https://mabin004.github.io/2018/07/31/Mac%E4%B8%8A%E7%BC%96%E8%AF%91Frida/</a></p>
]]></content>
      <categories>
        <category>逆向</category>
      </categories>
      <tags>
        <tag>Hook</tag>
        <tag>frida</tag>
        <tag>逆向</tag>
      </tags>
  </entry>
  <entry>
    <title>日常开发中，超级实用的热更新插件</title>
    <url>/2021/02/14/%E6%97%A5%E5%B8%B8%E5%BC%80%E5%8F%91%E4%B8%AD%EF%BC%8C%E8%B6%85%E7%BA%A7%E5%AE%9E%E7%94%A8%E7%9A%84%E7%83%AD%E6%9B%B4%E6%96%B0%E6%8F%92%E4%BB%B6/</url>
    <content><![CDATA[<p><strong>前言：</strong></p>
<p>好久没写文章了，今天来给大家更新一篇，非常实用的文章，希望能在工作中，帮助到你们</p>
<a id="more"></a>
<p><strong>1、背景：</strong></p>
<p>  在程序开发过程中,每次增加新的需求，按照常规做法，你都要改项目代码，然后重新启动程序。</p>
<p><strong>2、痛点：</strong></p>
<p>  这种方式很麻烦，如何改动很小的话，很得不偿失，</p>
<p><strong>3、期望：</strong></p>
<p>  那么有没有一种方式，可以在不需要重新启动程序，就可以完成文件线上实时更新，且能被运行的程序正常读取到。</p>
<p><strong>4、热乎乎的干货来了</strong></p>
<p>  答案有的，接下来，就是今天我们要介绍的”热更新”这一功能，也可以称之为“插件系统”，所谓的“插件系统”，看起来非常高大，实际上远离非常简单，我们的主程序定期扫描特定文件夹，如果发现新增文件或者有文件发生了修改，就热加载这个文件中的代码。</p>
<p>本文依托，python 的 importlib.reload函数来实现此功能。</p>
<p>（1）首先创建一个setting.py文件，文件内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">redis&#x3D;&quot;你好&quot;</span><br></pre></td></tr></table></figure>
<p>（2）再创建一个ceshi.py文件，文件内容</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> reload_conf <span class="keyword">import</span> setting</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ceshi</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        importlib.reload(setting)</span><br><span class="line">        print(setting.redis)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">ceshi()</span><br></pre></td></tr></table></figure>
<p>我们在控制台运行ceshi.py文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python3 ceshi.py</span><br></pre></td></tr></table></figure>
<p>我们会看到控制台源源不断的 打印出 你好，如图所示：</p>
<p><img src="/2021/02/14/%E6%97%A5%E5%B8%B8%E5%BC%80%E5%8F%91%E4%B8%AD%EF%BC%8C%E8%B6%85%E7%BA%A7%E5%AE%9E%E7%94%A8%E7%9A%84%E7%83%AD%E6%9B%B4%E6%96%B0%E6%8F%92%E4%BB%B6/更新插件3.png" alt></p>
<p>我们保持程序在运行的同时，更改setting中的文件内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">redis&#x3D;&quot;你好，精神小伙&quot;</span><br></pre></td></tr></table></figure>
<p>当我更改完之后，你就会发现控制台，输出内容变成了“你好，精神小伙”如图所示</p>
<p><img src="/2021/02/14/%E6%97%A5%E5%B8%B8%E5%BC%80%E5%8F%91%E4%B8%AD%EF%BC%8C%E8%B6%85%E7%BA%A7%E5%AE%9E%E7%94%A8%E7%9A%84%E7%83%AD%E6%9B%B4%E6%96%B0%E6%8F%92%E4%BB%B6/更新插件2.png" alt></p>
<p>这样愉快的就解决了我们问题</p>
<p><strong>注 意 ：</strong></p>
<p>1、代码中的 <strong>importlib.reload(setting)</strong> 中的<strong>setting</strong>，必须是module ，也就是setting这个文件，否则会报错**</p>
<p><img src="/2021/02/14/%E6%97%A5%E5%B8%B8%E5%BC%80%E5%8F%91%E4%B8%AD%EF%BC%8C%E8%B6%85%E7%BA%A7%E5%AE%9E%E7%94%A8%E7%9A%84%E7%83%AD%E6%9B%B4%E6%96%B0%E6%8F%92%E4%BB%B6/更新插件1.png" alt></p>
<p>2、如果你的程序是在，pycharm上运行的话，会出现更新完文件，但是没有被及时打印出，这是因为，pycharm 有个缓存，不是实时写到硬盘上的，最好在更改完文件是，ctrl + s保存下，就可以实时热加载了。</p>
<p>当然如果你是在cmd窗口运行，那就不需要担心了</p>
<p><strong>彩 蛋 </strong>：</p>
<p>为了更好的在实际应用中，发挥作用，我们可以把这个功能，写成装饰器，代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line"><span class="keyword">from</span> reload_conf <span class="keyword">import</span> setting</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">module_reload</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kw)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            importlib.reload(setting)</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kw)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">            logger.error(err)</span><br><span class="line">            traceback.print_exc()</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@module_reload</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ceshi</span><span class="params">()</span>:</span></span><br><span class="line">    print(setting.redis)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        ceshi()</span><br></pre></td></tr></table></figure>
<p>本文到此结束，这样就可以基于importlib.reload，你可以写一段代码，监控某个特定的文件，一旦发现里面内容被新增、修改你就把这些变动的代码热加载一次。然后正在运行中的 Python 程序就可以不停机使用新增的功能了。</p>
]]></content>
      <categories>
        <category>python爬虫，python技巧</category>
      </categories>
      <tags>
        <tag>python爬虫， 热更新文件， 技术优化</tag>
      </tags>
  </entry>
  <entry>
    <title>oneplus6手机刷机实战教程</title>
    <url>/2021/01/14/oneplus6%E6%89%8B%E6%9C%BA%E5%88%B7%E6%9C%BA%E5%AE%9E%E6%88%98%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<p>本篇文章，仅仅讲的是刷机实战和刷机的用处，对刷机的专有名词和原理不做解释，（网站文章教程很多，后期也会整合一篇笔记出来）</p>
<a id="more"></a>
<p><strong>手机刷机有什么好处？</strong><br>　　1）手机root，刷机后的大多数ROM可以自动ROOT，获得最高的管理权限，可以使用更好玩，更丰富的手机软件。<br>　　2）优化手机系统性能，由于可定制的ROM（即刷机ROM）对内存进行了优化处理，删除了一些不常用的软件，以及针对特定人群进行定制优化，因此在性能上更加卓越。<br>　　3）解决手机运行卡、慢等问题，许多朋友可能会遇到手机无缘无故的重启、卡机、无法启动、无法关机等等问题。如果其他方法不奏效，刷机是最直接的方式。<br>　　4）改变官方版本的界面，自定义自己手机界面，官方版本的版本包由于采用优化技术来重点提高了性能，因此对于界面缺乏个性化和多样化的设计，尤其是所提供的主题包有限，从而降低了用户的体验度。因此可以通过刷机来拥有更加丰富的用户界面。</p>
<p>​        5) 对于程序员来说，用处大大的，比如 使用frida 对app进行hook拦截等</p>
<p>当然有利就有弊。许多用户在刷机前也会担心会有什么后遗症，或者刷机不当造成更大的损失。<br><strong>手机刷机有什么坏处？</strong><br>　　有一些朋友可能从手机买来到一直用到抛弃的过程中都没有进行过一次手机刷机，因为可能听说一些手机刷机的坏处。<br>　　首先最重要的一点手机刷机也就是抛弃了手机厂商对手机的调整，自己定义了手机的功能，所以显而易见的大多数厂商的手机在刷机后是不再享受官方联保服务。<br>　　下载了不适合的rom里面可能包含了捆绑病毒等文件，不是任何情况下都适合刷机，比如硬件问题你的手机喇叭损坏了，你想通过刷机来解决这可能吗？<br>　　新手需要学习刷机教学，刚接触刷机不久的用户可能由于某些不规范的操作导致手机刷机后遗留各种问题，轻则手机无信号，重则可能连手机变砖，无信号等等！</p>
<hr>
<p><strong>oneplus6刷机实操教程：</strong></p>
<p><strong>第一步：解锁一加**</strong>6<strong> </strong>bl**</p>
<p> 解锁教程：<a href="https://oneplus.gadgethacks.com/how-to/unlock-bootloader-your-oneplus-6-0185473/" target="_blank" rel="noopener">https:<strong>//</strong>oneplus.gadgethacks.com<strong>/</strong>how<strong>-</strong>to<strong>/</strong>unlock<strong>-</strong>bootloader<strong>-</strong>your<strong>-</strong>oneplus<strong>-</strong>6<strong>-</strong>0185473<strong>/</strong></a></p>
<p>1、启用开发者选项</p>
<p>现在您需要启用手机上的“开发人员选项”菜单来访问一个允许您解锁引导装载程序的设置。点击设置-&gt; 关于手机，然后向下滚动到底部，快速连续点击“版本号”七次。如果操作正确，您将看到一个祝酒词，声明“您现在是一名开发人员”</p>
<p>2、启用 OEM 解锁</p>
<p>从这里，点击后退按钮一次，头回到主设置页面。向下滚动，你会发现新解锁的开发者选项菜单。选择它，然后向下滚动，并启用开关旁边的“ OEM 解锁”在下一页。点击弹出窗口上的“启用” ，如果提示输入你的手机密码。</p>
<p>3、启用高级重启</p>
<p>当你还在“开发者选项”菜单中时，向下滚动并启用“高级重新启动”设置。这将使进入 Fastboot 模式变得更加容易。</p>
<p>4、启动到快速启动模式</p>
<p>启用高级重新启动后，按住电源按钮，打开电源菜单。在第一个提示符上选择“ Reboot” ，然后在第二个提示符上选择“ Bootloader（引导加载器）”并确认您的选择。当您的电话启动进入快速启动模式，继续并连接到您的计算机与 USB 数据线，但留在主要的快速启动菜单。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">或者命令实行： adb reboot bootloader</span><br></pre></td></tr></table></figure>
<p>5、</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fastboot oem unlock</span><br></pre></td></tr></table></figure>
<p>6、</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">选择 unlock the bootloader</span><br></pre></td></tr></table></figure>
<p>给你的手机长达15分钟的时间来完成擦除程序，然后简单地再次运行初始设置，就像你第一次打开你的手机一样。此时，您的引导加载程序已正式解锁，因此您可以开始刷新自定义固件文件了！</p>
<p><strong>第2步开始刷机：</strong></p>
<p>1、解锁完成，adb reboot bootloader 进入手机开发者模式，打开adb调试，通过以下指令刷入rec</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fastboot boot twrp**-**3.2.3**-**x_blu_spark_v9.86_op6.img （输入临时twrp）</span><br></pre></td></tr></table></figure>
<p>2、选择语言，中文，向右滑动 允许修改， 自动重启到rec模式后,首先进行清除，直接划</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb push twrp-installer-3.3.1-2-enchilada.zip &#x2F;sdcard adb push Magisk-v20.4.zip &#x2F;sdcard</span><br></pre></td></tr></table></figure>
<p>3、点击安装twrp<strong>-</strong>installer，选择多个刷机包Magisk，向右滑动， 返回重启选择系统进行重启 再选择系统，重启机即可，不要直接在刷完包之后重启系统。</p>
<p>4、测试root是否启动成功：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adb shell su</span><br></pre></td></tr></table></figure>
<p><strong>第3步如果失败了先重新刷入系统，换成官方系统，重复第一二步骤即可</strong></p>
<p> 刷机教程:https:<strong>//</strong>bbs.mokeedev.com<strong>/</strong>t<strong>/</strong>topic<strong>/</strong>14940 直接看最下面的刷回官方系统的教程</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">（1）、电脑安装一加驱动，官方系统的一加6连接电脑，电脑会有一个 CD驱动器Oneplus drivers，双击它安装。</span><br><span class="line">（2）、把准备工作下载的 氧OS_9.0系统_一加6救砖包enchilada_22_O.27_181025.zip 解压 </span><br><span class="line">（3）、双击打开 MsmDownloadTool V4.0_factory.exe，手机完全关机后，按住音量加键 不松，插入数据线，显示已连接后松手，</span><br><span class="line">（4）点击start，等待完成，手机自动重启。</span><br><span class="line">	！！！注意！！！氧os开机一路跳过，不要联网，氢os随便</span><br></pre></td></tr></table></figure>
<p><img src="/2021/01/14/oneplus6%E6%89%8B%E6%9C%BA%E5%88%B7%E6%9C%BA%E5%AE%9E%E6%88%98%E6%95%99%E7%A8%8B/2.png" alt></p>
<p>本片文章结束，文章所用资源，微信公众号后台回复oneplus6刷机，可得到。</p>
<p>文章首发于微信公众号菜鸟童靴，不定期更新，如有需要后台加微信</p>
<p><img src="https://img-blog.csdnimg.cn/20200304210850537.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JpZ0JveV9Db2Rlcg==,size_16,color_FFFFFF,t_70" alt="img"></p>
]]></content>
      <categories>
        <category>python爬虫，手机刷机</category>
      </categories>
      <tags>
        <tag>爬虫</tag>
        <tag>反编译</tag>
        <tag>js逆向，刷机，root</tag>
      </tags>
  </entry>
  <entry>
    <title>如何用window命令行更改文件创建和修改时间</title>
    <url>/2020/10/17/%E5%A6%82%E4%BD%95%E7%94%A8window%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%9B%B4%E6%94%B9%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BF%AE%E6%94%B9%E6%97%B6%E9%97%B4/</url>
    <content><![CDATA[<p>昨天朋友突然给我发来消息，说他有个文件，文件的创建时间和修改时间，想修改一下，往前提个几天，刚开始给他推荐了几个软件，但是想想一个程序员怎么能用他人的软件呢，于是乎，安排……..</p>
 <a id="more"></a>
<h3 id="1-步骤："><a href="#1-步骤：" class="headerlink" title="1. 步骤："></a>1. 步骤：</h3><p>　　新建一个bat文件，在其中添加语句：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@ECHO OFF</span><br><span class="line">powershell.exe -command &quot;ls &#39;folder_path\*.dll&#39; | foreach-object &#123; $_.LastWriteTime &#x3D; Get-Date; $_.CreationTime &#x3D; Get-Date; $_.LastAccessTime &#x3D; Get-Date;&#125;&quot;</span><br><span class="line">PAUSE</span><br></pre></td></tr></table></figure>
<h3 id="2-解释："><a href="#2-解释：" class="headerlink" title="2. 解释："></a>2. 解释：</h3><p>　　代码将folder_path路径下的所有dll文件的创建时间和修改时间改成现在的时间。</p>
<p>　　-command: tells powershell to run the following command and return immediately</p>
<p>　　ls: list all matching files at the path specified</p>
<p>　　foreach-object: run the following block on each file that ls found</p>
<p>　　$_.LastWriteTime = Get-Date: for each file, set the LastWriteTime to the value returned by Get-Date (today’s date and time)</p>
<p>　　$_.CreationTime = Get-Date： for each file, set the CreationTime to the value returned by Get-Date (today’s date and time)</p>
<h3 id="3-修改至指定时间："><a href="#3-修改至指定时间：" class="headerlink" title="3. 修改至指定时间："></a>3. 修改至指定时间：</h3><p>　　将.LastWriteTime=Get−Date:改为.LastWriteTime=Get−Date:改为_.LastWriteTime = ‘01/11/2004 22:13:36’：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@ECHO OFF</span><br><span class="line">powershell.exe -command &quot;ls &#39;folder_path\*.*&#39; | foreach-object &#123; $_.LastWriteTime &#x3D; &#39;01&#x2F;11&#x2F;2004 22:13:36&#39;; $_.CreationTime &#x3D; &#39;01&#x2F;11&#x2F;2004 22:13:36&#39; &#125;&quot;</span><br><span class="line">PAUSE</span><br></pre></td></tr></table></figure>
<h3 id="4-递归文件夹中所有文件："><a href="#4-递归文件夹中所有文件：" class="headerlink" title="4. 递归文件夹中所有文件："></a>4. 递归文件夹中所有文件：</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@ECHO OFF</span><br><span class="line">powershell.exe -command &quot;Get-Childitem -path &#39;E:\project_llj\install\test\&#39; -Recurse | foreach-object &#123; $_.LastWriteTime &#x3D; Get-Date; $_.CreationTime &#x3D; Get-Date &#125;&quot; </span><br><span class="line">PAUSE</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>技术杂谈</category>
      </categories>
  </entry>
  <entry>
    <title>JS解析之 某json混淆阅读思路</title>
    <url>/2020/01/04/JS%E8%A7%A3%E6%9E%90%E4%B9%8B%20%E6%9F%90json%E6%B7%B7%E6%B7%86%E9%98%85%E8%AF%BB%E6%80%9D%E8%B7%AF/</url>
    <content><![CDATA[<p> 目标网址：<a href="http://www.python-spider.com/" target="_blank" rel="noopener">http://www.python-spider.com</a></p>
<p>  采集任务：成功获取首页HTML源码</p>
<a id="more"></a>
<hr>
<p><strong>一、代码分析</strong></p>
<p>闲话少叙，让我们开搞</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">'http://www.python-spider.com'</span></span><br><span class="line">response = requests.get(url)</span><br><span class="line">html = response.content.decode()</span><br><span class="line">print(html)</span><br></pre></td></tr></table></figure>
<p>​    直接发请求观察返回代码（目标网站<strong>不限制</strong>请求头、IP等进行，所以无需传入headers），查看返回代码——-&gt;</p>
<p><img src="/2020/01/04/JS%E8%A7%A3%E6%9E%90%E4%B9%8B%20%E6%9F%90json%E6%B7%B7%E6%B7%86%E9%98%85%E8%AF%BB%E6%80%9D%E8%B7%AF/www5\Hexo\BoyYongXin\source\_posts\images\微信图片_20200104211607.png" alt="微信图片_20200104211607"></p>

<p>​    没有错，就是上面一坨。<strong>sojson.v5</strong> 映入眼帘，这么恶心的代码，可以说毫无可读性。自然是要先js美化走一波（如何美化请自行百度 JS美化 第一个网页即可）</p>
<p>美化后，代码就清晰可见了———&gt;</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">;</span><br><span class="line"><span class="keyword">var</span> encode_version = <span class="string">'sojson.v5'</span>,</span><br><span class="line">    arktk = <span class="string">'__0x67e38'</span>,</span><br><span class="line">    __0x67e38 = [<span class="string">'w7dkI2rDmcK0'</span>, <span class="string">'HsK8E8K9wpk7DCEmew=='</span>, <span class="string">'w4kwwr4qwrM='</span>, <span class="string">'w5czYMKJVkEowqg='</span>, <span class="string">'DBtxwq4='</span>, <span class="string">'wphiw6vCisKpcsOMwqTCh8OmLsKewobDg2PCgErCiRwQBwE9d8OVZcKbwpI='</span>, <span class="string">'McOXHUvDmB7ChHDCtQ=='</span>, <span class="string">'JTvCosKMwoc='</span>, <span class="string">'5Lm46IOe5YmJ6ZudO0tlw4nCsMK2ez0f'</span>, <span class="string">'w4LDnFp+Ug=='</span>, <span class="string">'UsKVwq7Co8OZw4w='</span>, <span class="string">'FXrDjsOEAFw='</span>, <span class="string">'wpvDksKeaSt8dg=='</span>, <span class="string">'woB/wrslwqNkXhY='</span>];</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">_0x15e061, _0x24d8c2</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x28d7df = <span class="function"><span class="keyword">function</span> (<span class="params">_0x3a3784</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (--_0x3a3784) &#123;</span><br><span class="line">            _0x15e061[<span class="string">'push'</span>](_0x15e061[<span class="string">'shift'</span>]());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    _0x28d7df(++_0x24d8c2);</span><br><span class="line">&#125;(__0x67e38, <span class="number">0x1c9</span>));</span><br><span class="line"><span class="keyword">var</span> _0x421e = <span class="function"><span class="keyword">function</span> (<span class="params">_0x6a3a69, _0x333514</span>) </span>&#123;</span><br><span class="line">    _0x6a3a69 = _0x6a3a69 - <span class="number">0x0</span>;</span><br><span class="line">    <span class="keyword">var</span> _0x39a8d7 = __0x67e38[_0x6a3a69];</span><br><span class="line">    <span class="keyword">if</span> (_0x421e[<span class="string">'initialized'</span>] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x22548a = <span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">'undefined'</span> ? <span class="built_in">window</span> : <span class="keyword">typeof</span> process === <span class="string">'object'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">require</span> === <span class="string">'function'</span> &amp;&amp; <span class="keyword">typeof</span> global === <span class="string">'object'</span> ? global : <span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">var</span> _0x582a25 = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='</span>;</span><br><span class="line">            _0x22548a[<span class="string">'atob'</span>] || (_0x22548a[<span class="string">'atob'</span>] = <span class="function"><span class="keyword">function</span> (<span class="params">_0x35d241</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> _0x5e5a32 = <span class="built_in">String</span>(_0x35d241)[<span class="string">'replace'</span>](<span class="regexp">/=+$/</span>, <span class="string">''</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> _0x28a5e3 = <span class="number">0x0</span>, _0x2b45a3, _0x343cbf, _0xe0f1d0 = <span class="number">0x0</span>, _0x431162 = <span class="string">''</span>; _0x343cbf = _0x5e5a32[<span class="string">'charAt'</span>](_0xe0f1d0++);~ _0x343cbf &amp;&amp; (_0x2b45a3 = _0x28a5e3 % <span class="number">0x4</span> ? _0x2b45a3 * <span class="number">0x40</span> + _0x343cbf : _0x343cbf, _0x28a5e3++ % <span class="number">0x4</span>) ? _0x431162 += <span class="built_in">String</span>[<span class="string">'fromCharCode'</span>](<span class="number">0xff</span> &amp; _0x2b45a3 &gt;&gt; (<span class="number">-0x2</span> * _0x28a5e3 &amp; <span class="number">0x6</span>)) : <span class="number">0x0</span>) &#123;</span><br><span class="line">                    _0x343cbf = _0x582a25[<span class="string">'indexOf'</span>](_0x343cbf);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> _0x431162;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;());</span><br><span class="line">        <span class="keyword">var</span> _0x5d2a8c = <span class="function"><span class="keyword">function</span> (<span class="params">_0x354c7d, _0xac1c57</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x3ef3da = [],</span><br><span class="line">                _0x1e7821 = <span class="number">0x0</span>,</span><br><span class="line">                _0x363fd2, _0x3b7037 = <span class="string">''</span>,</span><br><span class="line">                _0x3533d5 = <span class="string">''</span>;</span><br><span class="line">            _0x354c7d = atob(_0x354c7d);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0x39c851 = <span class="number">0x0</span>, _0x63560e = _0x354c7d[<span class="string">'length'</span>]; _0x39c851 &lt; _0x63560e; _0x39c851++) &#123;</span><br><span class="line">                _0x3533d5 += <span class="string">'%'</span> + (<span class="string">'00'</span> + _0x354c7d[<span class="string">'charCodeAt'</span>](_0x39c851)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'slice'</span>](<span class="number">-0x2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            _0x354c7d = <span class="built_in">decodeURIComponent</span>(_0x3533d5);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0xdb88b7 = <span class="number">0x0</span>; _0xdb88b7 &lt; <span class="number">0x100</span>; _0xdb88b7++) &#123;</span><br><span class="line">                _0x3ef3da[_0xdb88b7] = _0xdb88b7;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (_0xdb88b7 = <span class="number">0x0</span>; _0xdb88b7 &lt; <span class="number">0x100</span>; _0xdb88b7++) &#123;</span><br><span class="line">                _0x1e7821 = (_0x1e7821 + _0x3ef3da[_0xdb88b7] + _0xac1c57[<span class="string">'charCodeAt'</span>](_0xdb88b7 % _0xac1c57[<span class="string">'length'</span>])) % <span class="number">0x100</span>;</span><br><span class="line">                _0x363fd2 = _0x3ef3da[_0xdb88b7];</span><br><span class="line">                _0x3ef3da[_0xdb88b7] = _0x3ef3da[_0x1e7821];</span><br><span class="line">                _0x3ef3da[_0x1e7821] = _0x363fd2;</span><br><span class="line">            &#125;</span><br><span class="line">            _0xdb88b7 = <span class="number">0x0</span>;</span><br><span class="line">            _0x1e7821 = <span class="number">0x0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0x3cdf31 = <span class="number">0x0</span>; _0x3cdf31 &lt; _0x354c7d[<span class="string">'length'</span>]; _0x3cdf31++) &#123;</span><br><span class="line">                _0xdb88b7 = (_0xdb88b7 + <span class="number">0x1</span>) % <span class="number">0x100</span>;</span><br><span class="line">                _0x1e7821 = (_0x1e7821 + _0x3ef3da[_0xdb88b7]) % <span class="number">0x100</span>;</span><br><span class="line">                _0x363fd2 = _0x3ef3da[_0xdb88b7];</span><br><span class="line">                _0x3ef3da[_0xdb88b7] = _0x3ef3da[_0x1e7821];</span><br><span class="line">                _0x3ef3da[_0x1e7821] = _0x363fd2;</span><br><span class="line">                _0x3b7037 += <span class="built_in">String</span>[<span class="string">'fromCharCode'</span>](_0x354c7d[<span class="string">'charCodeAt'</span>](_0x3cdf31) ^ _0x3ef3da[(_0x3ef3da[_0xdb88b7] + _0x3ef3da[_0x1e7821]) % <span class="number">0x100</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> _0x3b7037;</span><br><span class="line">        &#125;;</span><br><span class="line">        _0x421e[<span class="string">'rc4'</span>] = _0x5d2a8c;</span><br><span class="line">        _0x421e[<span class="string">'data'</span>] = &#123;&#125;;</span><br><span class="line">        _0x421e[<span class="string">'initialized'</span>] = !![];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> _0x548bc2 = _0x421e[<span class="string">'data'</span>][_0x6a3a69];</span><br><span class="line">    <span class="keyword">if</span> (_0x548bc2 === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (_0x421e[<span class="string">'once'</span>] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            _0x421e[<span class="string">'once'</span>] = !![];</span><br><span class="line">        &#125;</span><br><span class="line">        _0x39a8d7 = _0x421e[<span class="string">'rc4'</span>](_0x39a8d7, _0x333514);</span><br><span class="line">        _0x421e[<span class="string">'data'</span>][_0x6a3a69] = _0x39a8d7;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        _0x39a8d7 = _0x548bc2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _0x39a8d7;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> timestamp = <span class="keyword">new</span> <span class="built_in">Date</span>()[<span class="string">'valueOf'</span>]();</span><br><span class="line"><span class="keyword">var</span> token = <span class="built_in">window</span>[<span class="string">'btoa'</span>](<span class="string">'aiding_win'</span> + <span class="built_in">String</span>(<span class="built_in">Math</span>[_0x421e(<span class="string">'0x0'</span>, <span class="string">'OoTU'</span>)](timestamp / <span class="number">0xf4240</span>)));</span><br><span class="line"><span class="built_in">document</span>[_0x421e(<span class="string">'0x1'</span>, <span class="string">'l[QL'</span>)] = _0x421e(<span class="string">'0x2'</span>, <span class="string">'75NN'</span>) + token[_0x421e(<span class="string">'0x3'</span>, <span class="string">'xR0U'</span>)](<span class="string">'='</span>, <span class="string">''</span>) + <span class="string">'sp'</span> + token + _0x421e(<span class="string">'0x4'</span>, <span class="string">'vC8m'</span>);</span><br><span class="line"><span class="built_in">document</span>[_0x421e(<span class="string">'0x5'</span>, <span class="string">'n%hx'</span>)] = _0x421e(<span class="string">'0x6'</span>, <span class="string">'rDxU'</span>) + <span class="built_in">String</span>(<span class="built_in">Math</span>[_0x421e(<span class="string">'0x7'</span>, <span class="string">'vC8m'</span>)](timestamp / <span class="number">0xf4240</span>)) + _0x421e(<span class="string">'0x8'</span>, <span class="string">'3B5*'</span>);</span><br><span class="line"><span class="keyword">let</span> nh = <span class="built_in">window</span>[<span class="string">'location'</span>][_0x421e(<span class="string">'0x9'</span>, <span class="string">'L64&amp;'</span>)];</span><br><span class="line"><span class="keyword">let</span> href = nh[<span class="string">'split'</span>](<span class="string">'/'</span>);</span><br><span class="line"><span class="keyword">if</span> (href[<span class="string">'length'</span>] &gt;= <span class="number">0x3</span>) &#123;</span><br><span class="line">    setTimeout(<span class="string">'javascript:location.href=nh'</span>, <span class="number">0x1f4</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    setTimeout(_0x421e(<span class="string">'0xa'</span>, <span class="string">'&amp;#k4'</span>), <span class="number">0x1f4</span>);</span><br><span class="line">&#125;; <span class="keyword">if</span> (!(<span class="keyword">typeof</span> encode_version !== <span class="string">'undefined'</span> &amp;&amp; encode_version === _0x421e(<span class="string">'0xb'</span>, <span class="string">'5Khz'</span>))) &#123;</span><br><span class="line">    <span class="built_in">window</span>[_0x421e(<span class="string">'0xc'</span>, <span class="string">'*#To'</span>)](_0x421e(<span class="string">'0xd'</span>, <span class="string">'2e!l'</span>));</span><br><span class="line">&#125;;</span><br><span class="line">encode_version = <span class="string">'sojson.v5'</span>;</span><br></pre></td></tr></table></figure>
<hr>
<p>​    当看到这美化后的一坨代码的时候，我相信大家大家还是一脸懵逼。不过不要紧，让我们逐个分析</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> encode_version = <span class="string">'sojson.v5'</span>,</span><br><span class="line">    arktk = <span class="string">'__0x67e38'</span>,</span><br><span class="line">    __0x67e38 = [<span class="string">'w7dkI2rDmcK0'</span>, <span class="string">'HsK8E8K9wpk7DCEmew=='</span>, <span class="string">'w4kwwr4qwrM='</span>, <span class="string">'w5czYMKJVkEowqg='</span>, <span class="string">'DBtxwq4='</span>, <span class="string">'wphiw6vCisKpcsOMwqTCh8OmLsKewobDg2PCgErCiRwQBwE9d8OVZcKbwpI='</span>, <span class="string">'McOXHUvDmB7ChHDCtQ=='</span>, <span class="string">'JTvCosKMwoc='</span>, <span class="string">'5Lm46IOe5YmJ6ZudO0tlw4nCsMK2ez0f'</span>, <span class="string">'w4LDnFp+Ug=='</span>, <span class="string">'UsKVwq7Co8OZw4w='</span>, <span class="string">'FXrDjsOEAFw='</span>, <span class="string">'wpvDksKeaSt8dg=='</span>, <span class="string">'woB/wrslwqNkXhY='</span>];</span><br></pre></td></tr></table></figure>
<p>​    首先，声明了3个变量。暂时先放这就行了。</p>
<p>​    继续向下看，我们就会看到了一个匿名函数 —-&gt; </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">_0x15e061, _0x24d8c2</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x28d7df = <span class="function"><span class="keyword">function</span> (<span class="params">_0x3a3784</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (--_0x3a3784) &#123;</span><br><span class="line">            _0x15e061[<span class="string">'push'</span>](_0x15e061[<span class="string">'shift'</span>]());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    _0x28d7df(++_0x24d8c2);</span><br><span class="line">&#125;(__0x67e38, <span class="number">0x1c9</span>));</span><br></pre></td></tr></table></figure>
<p>​    这个功能不难看出，是一个数组移位函数。我们继续向下看，就会看到一个很长很长的函数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> _0x421e = <span class="function"><span class="keyword">function</span> (<span class="params">_0x6a3a69, _0x333514</span>) </span>&#123;</span><br><span class="line">    _0x6a3a69 = _0x6a3a69 - <span class="number">0x0</span>;</span><br><span class="line">    <span class="keyword">var</span> _0x39a8d7 = __0x67e38[_0x6a3a69];</span><br><span class="line">    <span class="keyword">if</span> (_0x421e[<span class="string">'initialized'</span>] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x22548a = <span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">'undefined'</span> ? <span class="built_in">window</span> : <span class="keyword">typeof</span> process === <span class="string">'object'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">require</span> === <span class="string">'function'</span> &amp;&amp; <span class="keyword">typeof</span> global === <span class="string">'object'</span> ? global : <span class="keyword">this</span>;</span><br><span class="line">            <span class="keyword">var</span> _0x582a25 = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='</span>;</span><br><span class="line">            _0x22548a[<span class="string">'atob'</span>] || (_0x22548a[<span class="string">'atob'</span>] = <span class="function"><span class="keyword">function</span> (<span class="params">_0x35d241</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> _0x5e5a32 = <span class="built_in">String</span>(_0x35d241)[<span class="string">'replace'</span>](<span class="regexp">/=+$/</span>, <span class="string">''</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> _0x28a5e3 = <span class="number">0x0</span>, _0x2b45a3, _0x343cbf, _0xe0f1d0 = <span class="number">0x0</span>, _0x431162 = <span class="string">''</span>; _0x343cbf = _0x5e5a32[<span class="string">'charAt'</span>](_0xe0f1d0++);~ _0x343cbf &amp;&amp; (_0x2b45a3 = _0x28a5e3 % <span class="number">0x4</span> ? _0x2b45a3 * <span class="number">0x40</span> + _0x343cbf : _0x343cbf, _0x28a5e3++ % <span class="number">0x4</span>) ? _0x431162 += <span class="built_in">String</span>[<span class="string">'fromCharCode'</span>](<span class="number">0xff</span> &amp; _0x2b45a3 &gt;&gt; (<span class="number">-0x2</span> * _0x28a5e3 &amp; <span class="number">0x6</span>)) : <span class="number">0x0</span>) &#123;</span><br><span class="line">                    _0x343cbf = _0x582a25[<span class="string">'indexOf'</span>](_0x343cbf);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> _0x431162;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;());</span><br><span class="line">        <span class="keyword">var</span> _0x5d2a8c = <span class="function"><span class="keyword">function</span> (<span class="params">_0x354c7d, _0xac1c57</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> _0x3ef3da = [],</span><br><span class="line">                _0x1e7821 = <span class="number">0x0</span>,</span><br><span class="line">                _0x363fd2, _0x3b7037 = <span class="string">''</span>,</span><br><span class="line">                _0x3533d5 = <span class="string">''</span>;</span><br><span class="line">            _0x354c7d = atob(_0x354c7d);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0x39c851 = <span class="number">0x0</span>, _0x63560e = _0x354c7d[<span class="string">'length'</span>]; _0x39c851 &lt; _0x63560e; _0x39c851++) &#123;</span><br><span class="line">                _0x3533d5 += <span class="string">'%'</span> + (<span class="string">'00'</span> + _0x354c7d[<span class="string">'charCodeAt'</span>](_0x39c851)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'slice'</span>](<span class="number">-0x2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            _0x354c7d = <span class="built_in">decodeURIComponent</span>(_0x3533d5);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0xdb88b7 = <span class="number">0x0</span>; _0xdb88b7 &lt; <span class="number">0x100</span>; _0xdb88b7++) &#123;</span><br><span class="line">                _0x3ef3da[_0xdb88b7] = _0xdb88b7;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (_0xdb88b7 = <span class="number">0x0</span>; _0xdb88b7 &lt; <span class="number">0x100</span>; _0xdb88b7++) &#123;</span><br><span class="line">                _0x1e7821 = (_0x1e7821 + _0x3ef3da[_0xdb88b7] + _0xac1c57[<span class="string">'charCodeAt'</span>](_0xdb88b7 % _0xac1c57[<span class="string">'length'</span>])) % <span class="number">0x100</span>;</span><br><span class="line">                _0x363fd2 = _0x3ef3da[_0xdb88b7];</span><br><span class="line">                _0x3ef3da[_0xdb88b7] = _0x3ef3da[_0x1e7821];</span><br><span class="line">                _0x3ef3da[_0x1e7821] = _0x363fd2;</span><br><span class="line">            &#125;</span><br><span class="line">            _0xdb88b7 = <span class="number">0x0</span>;</span><br><span class="line">            _0x1e7821 = <span class="number">0x0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0x3cdf31 = <span class="number">0x0</span>; _0x3cdf31 &lt; _0x354c7d[<span class="string">'length'</span>]; _0x3cdf31++) &#123;</span><br><span class="line">                _0xdb88b7 = (_0xdb88b7 + <span class="number">0x1</span>) % <span class="number">0x100</span>;</span><br><span class="line">                _0x1e7821 = (_0x1e7821 + _0x3ef3da[_0xdb88b7]) % <span class="number">0x100</span>;</span><br><span class="line">                _0x363fd2 = _0x3ef3da[_0xdb88b7];</span><br><span class="line">                _0x3ef3da[_0xdb88b7] = _0x3ef3da[_0x1e7821];</span><br><span class="line">                _0x3ef3da[_0x1e7821] = _0x363fd2;</span><br><span class="line">                _0x3b7037 += <span class="built_in">String</span>[<span class="string">'fromCharCode'</span>](_0x354c7d[<span class="string">'charCodeAt'</span>](_0x3cdf31) ^ _0x3ef3da[(_0x3ef3da[_0xdb88b7] + _0x3ef3da[_0x1e7821]) % <span class="number">0x100</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> _0x3b7037;</span><br><span class="line">        &#125;;</span><br><span class="line">        _0x421e[<span class="string">'rc4'</span>] = _0x5d2a8c;</span><br><span class="line">        _0x421e[<span class="string">'data'</span>] = &#123;&#125;;</span><br><span class="line">        _0x421e[<span class="string">'initialized'</span>] = !![];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> _0x548bc2 = _0x421e[<span class="string">'data'</span>][_0x6a3a69];</span><br><span class="line">    <span class="keyword">if</span> (_0x548bc2 === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (_0x421e[<span class="string">'once'</span>] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            _0x421e[<span class="string">'once'</span>] = !![];</span><br><span class="line">        &#125;</span><br><span class="line">        _0x39a8d7 = _0x421e[<span class="string">'rc4'</span>](_0x39a8d7, _0x333514);</span><br><span class="line">        _0x421e[<span class="string">'data'</span>][_0x6a3a69] = _0x39a8d7;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        _0x39a8d7 = _0x548bc2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _0x39a8d7;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>​    这个函数比较复杂，乍一看看不出什么端倪，只能分析出这是一个函数（包含两个形参），并且有一个返回值，我们继续向下阅读剩余代码</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> timestamp = <span class="keyword">new</span> <span class="built_in">Date</span>()[<span class="string">'valueOf'</span>]();</span><br><span class="line"><span class="keyword">var</span> token = <span class="built_in">window</span>[<span class="string">'btoa'</span>](<span class="string">'aiding_win'</span> + <span class="built_in">String</span>(<span class="built_in">Math</span>[_0x421e(<span class="string">'0x0'</span>, <span class="string">'OoTU'</span>)](timestamp / <span class="number">0xf4240</span>)));</span><br><span class="line"><span class="built_in">document</span>[_0x421e(<span class="string">'0x1'</span>, <span class="string">'l[QL'</span>)] = _0x421e(<span class="string">'0x2'</span>, <span class="string">'75NN'</span>) + token[_0x421e(<span class="string">'0x3'</span>, <span class="string">'xR0U'</span>)](<span class="string">'='</span>, <span class="string">''</span>) + <span class="string">'sp'</span> + token + _0x421e(<span class="string">'0x4'</span>, <span class="string">'vC8m'</span>);</span><br><span class="line"><span class="built_in">document</span>[_0x421e(<span class="string">'0x5'</span>, <span class="string">'n%hx'</span>)] = _0x421e(<span class="string">'0x6'</span>, <span class="string">'rDxU'</span>) + <span class="built_in">String</span>(<span class="built_in">Math</span>[_0x421e(<span class="string">'0x7'</span>, <span class="string">'vC8m'</span>)](timestamp / <span class="number">0xf4240</span>)) + _0x421e(<span class="string">'0x8'</span>, <span class="string">'3B5*'</span>);</span><br><span class="line"><span class="keyword">let</span> nh = <span class="built_in">window</span>[<span class="string">'location'</span>][_0x421e(<span class="string">'0x9'</span>, <span class="string">'L64&amp;'</span>)];</span><br><span class="line"><span class="keyword">let</span> href = nh[<span class="string">'split'</span>](<span class="string">'/'</span>);</span><br><span class="line"><span class="keyword">if</span> (href[<span class="string">'length'</span>] &gt;= <span class="number">0x3</span>) &#123;</span><br><span class="line">    setTimeout(<span class="string">'javascript:location.href=nh'</span>, <span class="number">0x1f4</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    setTimeout(_0x421e(<span class="string">'0xa'</span>, <span class="string">'&amp;#k4'</span>), <span class="number">0x1f4</span>);</span><br><span class="line">&#125;; <span class="keyword">if</span> (!(<span class="keyword">typeof</span> encode_version !== <span class="string">'undefined'</span> &amp;&amp; encode_version === _0x421e(<span class="string">'0xb'</span>, <span class="string">'5Khz'</span>))) &#123;</span><br><span class="line">    <span class="built_in">window</span>[_0x421e(<span class="string">'0xc'</span>, <span class="string">'*#To'</span>)](_0x421e(<span class="string">'0xd'</span>, <span class="string">'2e!l'</span>));</span><br><span class="line">&#125;;</span><br><span class="line">encode_version = <span class="string">'sojson.v5'</span>;</span><br></pre></td></tr></table></figure>
<p>可以看出，这最后一部分的代码就很零散，隐隐约约的能看出一些关键字。但是想要理解代码含义还是有一定难度，最初笔者也卡住了很久，直到最后。。。我做了自己的网站，才看出这最后部分的端倪，我先上一段代码——&gt;</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> timestamp = (<span class="keyword">new</span> <span class="built_in">Date</span>()).valueOf();</span><br><span class="line"><span class="keyword">var</span> token=<span class="built_in">window</span>.btoa(<span class="string">'aiding_win'</span> + <span class="built_in">String</span>(<span class="built_in">Math</span>.round(timestamp/<span class="number">1000000</span>)));</span><br><span class="line"><span class="built_in">document</span>.cookie=<span class="string">'token='</span> + token.replace(<span class="string">'='</span>, <span class="string">''</span>) + <span class="string">'sp'</span> + token+ <span class="string">'; path=/'</span> ;</span><br><span class="line"><span class="built_in">document</span>.cookie=<span class="string">'tokentime='</span> + <span class="built_in">String</span>(<span class="built_in">Math</span>.round(timestamp/<span class="number">1000000</span>))+ <span class="string">'; path=/'</span> ;</span><br><span class="line"><span class="keyword">let</span> nh = <span class="built_in">window</span>.location.href;</span><br><span class="line"><span class="keyword">let</span> href = nh.split(<span class="string">'/'</span>);</span><br><span class="line"><span class="keyword">if</span> (href.length &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">    setTimeout(<span class="string">"javascript:location.href=nh"</span>, <span class="number">500</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    setTimeout(<span class="string">"javascript:location.href='/'"</span>, <span class="number">500</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​    上面的代码其实是我原始的cookie生成js代码。是不是发现了什么端倪？ 没错，最后一部分明显就是原始代码通过混淆得到的。所以我们就有了一个大胆的猜测</p>
<p>之前所有的代码实际上都是为了 _0x421e这个函数服务，最终的目的就是制造了一个真实的解密函数 _0x421e 来解密原始代码。既然有了猜测，我们就开始尝试破解它！</p>
<hr>
<p><strong>二、反混淆</strong></p>
<p>其实反混淆的逻辑非常简单，通过第一部分的分析可知，整个sojson的加密是由四部分组合而成的</p>
<p>\1. 变量声明</p>
<p>\2. 数组移位</p>
<p>\3. 解密函数</p>
<p>\4. 执行函数</p>
<p>​    不说废话了，调试神奇 chrome console登场，新建标签页，F12，console一气呵成（有条件的可以使用 node.js，没有电脑的可以用口算/心算）。之后把前三部分丢进console里，怒敲回车！</p>

<p><img src="/2020/01/04/JS%E8%A7%A3%E6%9E%90%E4%B9%8B%20%E6%9F%90json%E6%B7%B7%E6%B7%86%E9%98%85%E8%AF%BB%E6%80%9D%E8%B7%AF/www5\Hexo\BoyYongXin\source\_posts\images\微信图片_20200104211316.png" alt="微信图片_20200104211316"></p>
<p>可以看到解密函数正常，并没有报错。那么整个反混淆就完成了。下面就是在解密函数的基础上断点调试找cookie实际生成代码，模拟后即可</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line"><span class="string">"Accept"</span>:<span class="string">"application/json, text/javascript, */*; q=0.01"</span>,</span><br><span class="line"><span class="string">"Accept-Encoding"</span>:<span class="string">"gzip, deflate"</span>,</span><br><span class="line"><span class="string">"Accept-Language"</span>:<span class="string">"zh-CN,zh;q=0.9"</span>,</span><br><span class="line"><span class="string">"Connection"</span>:<span class="string">"keep-alive"</span>,</span><br><span class="line"><span class="string">"Cookie"</span>:<span class="string">"token=YWlkaW5nX3dpbjE1NzgxNDIspYWlkaW5nX3dpbjE1NzgxNDI=; tokentime=1578142"</span>,</span><br><span class="line"><span class="string">"Host"</span>:<span class="string">"www.python-spider.com"</span>,</span><br><span class="line"><span class="string">"Referer"</span>:<span class="string">"http://www.python-spider.com/content?sku=996"</span>,</span><br><span class="line"><span class="string">"User-Agent"</span>:<span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.88 Safari/537.36"</span>,</span><br><span class="line"><span class="string">"X-Requested-With"</span>:<span class="string">"XMLHttpRequest"</span>,</span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">'http://www.python-spider.com/detail?skuID=996'</span></span><br><span class="line">response = requests.get(url,headers=headers)</span><br><span class="line">html = response.content.decode()</span><br><span class="line">print(html)</span><br></pre></td></tr></table></figure>
<p>代码里加入cookie生成方式：</p>
<p>补充一下知识点：</p>
<h1 id="Window-btoa-方法"><a href="#Window-btoa-方法" class="headerlink" title="Window btoa() 方法"></a>Window btoa() 方法</h1><hr>
<h2 id="定义和用法"><a href="#定义和用法" class="headerlink" title="定义和用法"></a>定义和用法</h2><p>btoa() 方法用于创建一个 base-64 编码的字符串。</p>
<p>该方法使用 “A-Z”, “a-z”, “0-9”, “+”, “/“ 和 “=” 字符来编码字符串。</p>
<p>base-64 解码使用方法是 <a href="https://www.runoob.com/jsref/met-win-atob.html" target="_blank" rel="noopener">atob()</a> 。</p>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">window.btoa(str)</span><br></pre></td></tr></table></figure>
<p>最后python代码复现：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line">   </span><br><span class="line">    <span class="string">"Cookie"</span>:<span class="string">""</span>,</span><br><span class="line">    <span class="string">"Host"</span>:<span class="string">"www.python-spider.com"</span>,</span><br><span class="line">    <span class="string">"Referer"</span>:<span class="string">"http://www.python-spider.com/content?sku=996"</span>,</span><br><span class="line">    <span class="string">"User-Agent"</span>:<span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.88 Safari/537.36"</span>,</span><br><span class="line">    <span class="string">"X-Requested-With"</span>:<span class="string">"XMLHttpRequest"</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">timestamp = time.time()*<span class="number">1000</span></span><br><span class="line">result_str = <span class="string">'aiding_win'</span> + str(round(timestamp/<span class="number">1000000</span>))</span><br><span class="line">token = base64.encodebytes(result_str.encode(<span class="string">'utf-8'</span>)).decode(<span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line">cookie = <span class="string">'token=%ssp%s'</span>%(token.replace(<span class="string">'='</span>, <span class="string">''</span>),token)</span><br><span class="line">tokentime =<span class="string">'tokentime='</span> + str(round(timestamp/<span class="number">1000000</span>))</span><br><span class="line">headers[<span class="string">"Cookie"</span>] = cookie + <span class="string">";"</span> + tokentime</span><br><span class="line">headers[<span class="string">"Cookie"</span>] = headers[<span class="string">"Cookie"</span>].replace(<span class="string">"\n"</span>,<span class="string">""</span>)</span><br><span class="line">url = <span class="string">'http://www.python-spider.com/detail?skuID=996'</span></span><br><span class="line">response = requests.get(url,headers=headers)</span><br><span class="line">html = response.content.decode()</span><br><span class="line">print(html)</span><br></pre></td></tr></table></figure>
<p>本文参考链接：<a href="http://www.python-spider.com/content?sku=996" target="_blank" rel="noopener">http://www.python-spider.com/content?sku=996</a></p>
<p><a href="https://blog.csdn.net/Mandyucan/article/details/80421711" target="_blank" rel="noopener">https://blog.csdn.net/Mandyucan/article/details/80421711</a></p>
]]></content>
      <categories>
        <category>python爬虫</category>
      </categories>
      <tags>
        <tag>爬虫</tag>
        <tag>反编译</tag>
        <tag>js逆向</tag>
      </tags>
  </entry>
  <entry>
    <title>某日报搜索参数securitykey加密破解</title>
    <url>/2019/12/31/people-app/</url>
    <content><![CDATA[<p>感觉好久没发文章了，最近小编基本处于放养状态，言归正传，最近遇到一个app，怎么遇到的呢，还用说么，公司来活了，给你的任务</p>
 <a id="more"></a>
<p><strong>任务要求：</strong></p>
<p>给定一批关键词，进行搜索，把搜索结果近期的数据，进行，提取、入库。</p>
<p>接到这个app，首先进行常规操作，配置好手机代理，进行fiddler抓包，于是乎，抓到包了，拿下来，使用postman进行模拟请求</p>
<p>数据返回成功，ok完事了？？</p>
<p>根本不可能，更换一个关键词；不换关键词，请求下一页；都不能用，分析一下请求结构</p>
<p><img src="https://img-blog.csdnimg.cn/20191231151029774.png" alt="img"></p>
<p>我们看到是post请求，一起看看他的form表单</p>
<p><img src="https://img-blog.csdnimg.cn/20191231151224429.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JpZ0JveV9Db2Rlcg==,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>如何确定那个参数是校验加密，反复抓包几次，对比信息即可，对比发现：</p>
<p>securitykey ：主要校验参数<br>longitude，latitude 经纬度，暂时不重要<br>province_code 时间戳，十位时间戳，后面跟000</p>
<p>开始下一个步骤，反编译APP，看他的源码，找到加密参数的方法</p>
<p>小坑出现了，使用apktool反编译失败，有点猫腻，jadx直接打开apk，如图所示</p>
<p><img src="https://img-blog.csdnimg.cn/20191231152321514.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JpZ0JveV9Db2Rlcg==,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>不看不知道，一看吓一跳，腾讯和360加固，有加固，需要脱壳</p>
<p>脱壳成功后，把所有脱出来的classs.dex文件，全部拿到，对比一下，先拿文件最大的下手</p>
<p><img src="https://img-blog.csdnimg.cn/20191231152730740.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JpZ0JveV9Db2Rlcg==,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>全局搜索，加密参数，我们找到了这个文件，瞧一瞧是不是咱所需要的</p>
<p><img src="https://img-blog.csdnimg.cn/20191231152951945.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JpZ0JveV9Db2Rlcg==,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>如标注位置，发现正是咱们所需要的，加密算法调用，进入getMD5Str方法里面去，看看是如何加密的</p>
<p><img src="https://img-blog.csdnimg.cn/20191231153145614.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JpZ0JveV9Db2Rlcg==,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>看一看，瞧一瞧，hook这个方法，看看传进来的是什么参数</p>
<p><img src="https://img-blog.csdnimg.cn/20191231153415752.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0JpZ0JveV9Db2Rlcg==,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>跟据多次堆栈和print打印的结果，发现发参数基本就是这个了</p>
<p>有几个参数是变化的，标注一下</p>
<p>经纬度，页码，时间戳</p>
<p>这个app到这里基本就差不多，破解了，</p>
<p>本想着直接python调用这段java代码呢，研究了一下（代码不多），加密代码，使用python还原一下</p>
<p>md5_str = hashlib.md5(security_args.encode(encoding=’UTF-8’)).hexdigest()</p>
<p>其实就是python的md5加密，哈哈</p>
<p>构造请求就可以了，完整代码，就不上传了</p>
]]></content>
      <categories>
        <category>python爬虫</category>
      </categories>
      <tags>
        <tag>爬虫</tag>
        <tag>反编译</tag>
        <tag>Android逆向</tag>
      </tags>
  </entry>
  <entry>
    <title>自动化工具uiautomator2安装和使用教程</title>
    <url>/2019/12/21/%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7uiautomator2%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<p><strong>1、参考链接</strong></p>
<p> GitHub： <a href="https://github.com/openatx/uiautomator2" target="_blank" rel="noopener">https://github.com/openatx/uiautomator2</a><br> <a id="more"></a></p>
<p><strong>2、工作原理：</strong></p>
<p>三、uiautomator2工作原理：</p>
<p><img src="https://img2018.cnblogs.com/blog/1231206/201903/1231206-20190317123618691-734760575.png" alt="img"></p>
<p>如图所示，python-uiautomator2主要分为两个部分，python客户端，移动设备</p>
<ul>
<li>python端: 运行脚本，并向移动设备发送HTTP请求</li>
<li>移动设备：移动设备上运行了封装了uiautomator2的HTTP服务，解析收到的请求，并转化成uiautomator2的代码。</li>
</ul>
<p>整个过程</p>
<ol>
<li>在移动设备上安装<code>atx-agent</code>(守护进程), 随后<code>atx-agent</code>启动uiautomator2服务(默认7912端口)进行监听</li>
<li>在PC上编写测试脚本并执行（相当于发送HTTP请求到移动设备的server端）</li>
<li>移动设备通过WIFI或USB接收到PC上发来的HTTP请求，执行制定的操作</li>
</ol>
<p><strong>三、安装测试</strong></p>
<p><strong>第一步：</strong></p>
<p>先准备一台（不要两台）开启了<code>开发者选项</code>的安卓手机，连接上电脑，确保执行<code>adb devices</code>可以看到连接上的设备。</p>
<ul>
<li>运行<code>pip3 install -U uiautomator2</code>安装uiautomator2</li>
<li>运行<code>python3 -m uiautomator2 init</code>安装包含httprpc服务的apk到手机+<code>atx-agent, minicap, minitouch</code></li>
</ul>
<p><strong>第二步：</strong></p>
<p>命令行运行<code>python</code>打开python交互窗口。然后将下面的命令输入到窗口中。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import uiautomator2 as u2</span><br><span class="line"></span><br><span class="line">d &#x3D; u2.connect() # connect to device</span><br><span class="line">print(d.info)</span><br></pre></td></tr></table></figure>
<p>这时看到类似下面的输出，就可以正式开始用我们这个库了。因为这个库功能太多，后面还有很多的内容，需要慢慢去看 ….</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#39;currentPackageName&#39;: &#39;net.oneplus.launcher&#39;, &#39;displayHeight&#39;: 1920, &#39;displayRotation&#39;: 0, &#39;displaySizeDpX&#39;: 411, &#39;displaySizeDpY&#39;: 731, &#39;displayWidth&#39;: 1080, &#39;productName&#39;: &#39;OnePlus5&#39;, &#39;</span><br><span class="line">screenOn&#39;: True, &#39;sdkInt&#39;: 27, &#39;naturalOrientation&#39;: True&#125;</span><br></pre></td></tr></table></figure>
<p><strong>四、应用及操作</strong></p>
<p><strong>调用uiautomator2的过程</strong></p>
<ol>
<li>配置手机设备参数，设置具体操作的是哪一台手机</li>
<li>抓取手机上应用的控件，制定对应的控件来进行操作</li>
<li>对抓取到的控件进行操作，比如点击、填写参数等。</li>
</ol>
<p><strong>配置手机设备参数</strong></p>
<p>python-uiautomator2连接手机的方式有两种，一种是通过WIFI，另外一种是通过USB。两种方法各有优缺点。<br>WIFI最便利的地方要数可以不用连接数据线，USB则可以用在PC和手机网络不在一个网段用不了的情况。</p>
<ol>
<li><p>使用WIFI连接</p>
<p>手机获取到手机的IP，并确保电脑可以PING通手机。手机的IP可以在设置-WIFI设置里面获取到。<br>比如手机的IP是<code>192.168.0.100</code>，连接设备的代码为</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import uiautomator2 as u2d &#x3D; u2.connect(&#39;192.168.0.100&#39;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用USB连接</p>
<p>手机的序列号可以通过<code>adb devices</code>获取到，假设序列号是<code>123456f</code>，连接代码为</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import uiautomator2 as u2d &#x3D; u2.connect_usb(&#39;123456f&#39;)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="抓取手机上应用的控件"><a href="#抓取手机上应用的控件" class="headerlink" title="抓取手机上应用的控件"></a>抓取手机上应用的控件</h4><p>安装方法: <code>pip install --pre weditor</code></p>
<p>使用方法:<br>首先运行<code>python -m weditor</code>，之后浏览器会自动打开一个网页 <code>http://atx.open.netease.com</code> （注：这个网址仅提供一个前端，而<code>python -mweditor</code>这个命令则本地开放了HTTP的接口，前端去跟本地的服务去通信）</p>
<p>定位方式</p>
<ol>
<li>ResourceId定位: <code>d(resourceId=&quot;com.smartisanos.clock:id/text_stopwatch&quot;).click()</code></li>
<li>Text定位 <code>d(text=&quot;秒表&quot;).click()</code></li>
<li>Description定位 <code>d(description=&quot;..&quot;).click()</code></li>
<li>ClassName定位 <code>d(className=&quot;android.widget.TextView&quot;).click()</code></li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2019/12/21/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.<br><a id="more"></a></p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
  </entry>
</search>
